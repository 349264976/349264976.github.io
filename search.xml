<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>VUEå­¦ä¹ </title>
      <link href="/2023/07/17/VUE%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/07/17/VUE%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="vueå­¦ä¹ "><a href="#vueå­¦ä¹ " class="headerlink" title="vueå­¦ä¹ "></a>vueå­¦ä¹ </h1><p>è¦æ±‚ï¼š ä½¿ç”¨æ•°æ®éœ€è¦å­˜åœ¨</p><p>â€‹ä¸èƒ½å†æ’å€¼è¡¨è¾¾å¼ä¸­ä½¿ç”¨å…³é”®å­—ç­‰è¯­å¥</p><p>â€‹ä¸èƒ½å†æ ‡ç­¾ä¸­ä½¿ç”¨æ’å€¼è¡¨è¾¾å¼</p><pre><code class="vue">&lt;div id=&quot;app&quot;&gt;        &lt;!-- ç¼–å†™ä¸€äº›ç”¨äºæ¸²æŸ“çš„ä»£ç é€»è¾‘ --&gt;        &#123;&#123;name+name&#125;&#125;        &#123;&#123;name.toUpperCase()&#125;&#125;    &lt;/div&gt;    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js&quot;&gt;&lt;/script&gt;    &lt;script&gt;        const app=new Vue(            &#123;                el: &#39;#app&#39;,                data: &#123;                    //è¿™ä¸ªæ•°æ®æ˜¯å“åº”å¼æ•°æ®                    name: &#39;tony&#39;                &#125;            &#125;        )    &lt;/script&gt;</code></pre><p>VUEä¸­æ•°æ®æ”¹å˜é¡µé¢ä¸­çš„æ¸²æŸ“ä¹Ÿä¼šæ”¹å˜</p><p>VUEä¸­çš„ç‰¹ç‚¹å“åº”å¼æ˜¾ç¤º</p><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230717203822221.png" alt="image-20230717203822221"></p><h4 id="VUEçš„æŒ‡ä»¤æ“ä½œ"><a href="#VUEçš„æŒ‡ä»¤æ“ä½œ" class="headerlink" title="VUEçš„æŒ‡ä»¤æ“ä½œ"></a>VUEçš„æŒ‡ä»¤æ“ä½œ</h4><p>V-HTML ï¼šå¯ä»¥æ›¿æ¢ document.innerHtml å¯ä»¥è§£æhtmlè¯­å¥å¹¶ä¸”å±•ç¤ºåˆ°æ ‡ç­¾å†…å®¹</p><p>v-show </p><p>1.æ§åˆ¶å…ƒç´ éšè—</p><p>2.è¯­æ³•ï¼šv-show&#x3D;â€è¡¨è¾¾å¼â€ è¡¨è¾¾å¼çš„å€¼ trueæ˜¾ç¤º ï¼Œfalse éšè—</p><p>å®é™…ä¸Šæ˜¯æ§åˆ¶æ ‡ç­¾çš„displayï¼šnoneæ¥æ§åˆ¶å†…å®¹æ˜¯å¦æ˜¾ç¤º æ˜¯æ˜¾ç¤ºä¸ä¸æ˜¾ç¤ºçš„é—®é¢˜</p><p>é¢‘ç¹æ“ä½œçš„é¡µé¢ç”¨</p><p>v-if </p><p>1.æ§åˆ¶å…ƒç´ éšè—(æ¡ä»¶æ¸²æŸ“)</p><p>2.è¯­æ³• v-if&#x3D;â€è¡¨è¾¾å¼â€œ è¡¨è¾¾å¼å€¼ trueæ˜¾ç¤ºï¼Œfalse éšè—</p><p>å®é™…ä¸Šæ˜¯æ§åˆ¶åˆ¤æ–­æ¡ä»¶å†³å®šæ˜¯å¦åˆ›å»ºæ ‡ç­¾ æ˜¯å­˜åœ¨ä¸ä¸å­˜åœ¨çš„é—®é¢˜</p><p> ä¸ç»å¸¸æ“ä½œçš„ç”¨v-if</p><p>v-else v-else-if</p><p>1.ä½œç”¨ï¼šè¾…åŠ©v-if è¿›è¡Œåˆ¤æ–­æ¸²æŸ“</p><p>2.è¯­æ³•ï¼šv-else v-else-if&#x3D;â€è¡¨è¾¾å¼â€œ</p><p>3.æ³¨æ„ï¼šéœ€è¦ç´§æŒ¨ç€v-ifä¸€èµ·ä½¿ç”¨</p><p>ag</p><pre><code class="vue">               &lt;div&gt;                &lt;div v-if=&quot;score &gt;= 90&quot;&gt;ä¼˜ç§€&lt;/div&gt;                &lt;div v-else-if=&quot;score &gt;= 70&quot;&gt;æ™®é€š&lt;/div&gt;                &lt;div v-else-if=&quot;score &gt;= 60&quot;&gt;åŠæ ¼&lt;/div&gt;                &lt;div v-else&gt;æˆç»©è¿‡ä½å»ºè®®é‡å¼€&lt;/div&gt;              &lt;/div&gt;</code></pre><p>v-on</p><p>1.ä½œç”¨ï¼šæ³¨å†Œæ—¶é—´&#x3D;æ·»åŠ ç›‘å¬+æä¾›å¤„ç†é€»è¾‘</p><p>2.è¯­æ³•ï¼š</p><p>1.v-onï¼šäº‹ä»¶å&#x3D;â€å†…æ•›è¯­å¥â€</p><p>v-on:&#x3D;&#x3D;@</p><pre><code class="vue">           &lt;button v-on:click=&quot;count--&quot;&gt;-&lt;/button&gt;           &lt;span&gt;&#123;&#123;count&#125;&#125;&lt;/span&gt;             &lt;button v-on:click=&quot;count++&quot;&gt;+&lt;/button&gt;            &lt;button @click=&quot;count--&quot;&gt;-&lt;/button&gt;           &lt;span&gt;&#123;&#123;count&#125;&#125;&lt;/span&gt;             &lt;button @click=&quot;count++&quot;&gt;+&lt;/button&gt;  </code></pre><p>2.v-onï¼šæ—¶é—´å&#x3D;â€methodsä¸­çš„å‡½æ•°åå­—â€œ</p><pre><code class="vue">  &lt;/div&gt;      &lt;button @click=&quot;fn&quot;&gt;æ˜¾ç¤ºoréšè—&lt;/button&gt;    &lt;h1 v-show=&quot;flag&quot;&gt;é»‘é©¬ç¨‹åºå‘˜&lt;/h1&gt;    &lt;/div&gt;          methods:                  &#123;                    fn()&#123;                        this.flag=!this.flag;                    &#125;                &#125;</code></pre><p>v-onè°ƒç”¨ä¼ å‚æ•°</p><p>v-bindï¼šå±æ€§å&#x3D;â€œè¡¨è¾¾å¼â€</p><p>1.ä½œç”¨ï¼šåŠ¨æ€çš„è®¾ç½®htmlçš„æ ‡ç­¾å±æ€§-ã€‹ src url title â€¦.</p><p>2.è¯­æ³•ï¼š v-bind:å±æ€§å&#x3D;â€œè¡¨è¾¾å¼â€</p><p>å¯ä»¥å°†v-bindæ”¹å†™æˆï¼š</p><pre><code class="vue">    &lt;img v-bind:src=&quot;imgurl&quot; alt=&quot;&quot;&gt; tup&lt;/img&gt;</code></pre><p>v-for</p><p>v-for&#x3D;â€(item,index) in æ•°ç»„â€</p><p>item æ¯ä¸€é¡¹ï¼Œindex ä¸‹æ ‡</p><pre><code class="vue"> &lt;ul&gt;      &lt;li v-for=&quot;(item, index) in booksList&quot;                                     :key=&quot;item.id&quot;&gt;        &lt;span&gt;&#123;&#123; item.name &#125;&#125;&lt;/span&gt;        &lt;span&gt;&#123;&#123; item.author &#125;&#125;&lt;/span&gt;        &lt;!-- æ³¨å†Œç‚¹å‡»äº‹ä»¶ â†’  é€šè¿‡ id è¿›è¡Œåˆ é™¤æ•°ç»„ä¸­çš„ å¯¹åº”é¡¹ --&gt;        &lt;button @click=&quot;del(item.id)&quot;&gt;åˆ é™¤&lt;/button&gt;      &lt;/li&gt;    &lt;/ul&gt; &lt;script&gt;    const app = new Vue(&#123;      el: &#39;#app&#39;,      data: &#123;        booksList: [          &#123; id: 1, name: &#39;ã€Šçº¢æ¥¼æ¢¦ã€‹&#39;, author: &#39;æ›¹é›ªèŠ¹&#39; &#125;,          &#123; id: 2, name: &#39;ã€Šè¥¿æ¸¸è®°ã€‹&#39;, author: &#39;å´æ‰¿æ©&#39; &#125;,          &#123; id: 3, name: &#39;ã€Šæ°´æµ’ä¼ ã€‹&#39;, author: &#39;æ–½è€åºµ&#39; &#125;,          &#123; id: 4, name: &#39;ã€Šä¸‰å›½æ¼”ä¹‰ã€‹&#39;, author: &#39;ç½—è´¯ä¸­&#39; &#125;        ]      &#125;,      methods: &#123;        del (id) &#123;          // console.log(&#39;åˆ é™¤&#39;, id)          // é€šè¿‡ id è¿›è¡Œåˆ é™¤æ•°ç»„ä¸­çš„ å¯¹åº”é¡¹ â†’ filter(ä¸ä¼šæ”¹å˜åŸæ•°ç»„)          // filter: æ ¹æ®æ¡ä»¶ï¼Œä¿ç•™æ»¡è¶³æ¡ä»¶çš„å¯¹åº”é¡¹ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°æ•°ç»„ã€‚          // console.log(this.booksList.filter(item =&gt; item.id !== id))          this.booksList = this.booksList.filter(item =&gt; item.id !== id)        &#125;      &#125;    &#125;)  &lt;/script&gt;</code></pre><p>v-model</p><p>1.ä½œç”¨ï¼šç»™è¡¨å•å…ƒç´ ä½¿ç”¨ï¼ŒåŒå‘çš„ç»‘å®š â€“&gt;å¯ä»¥å¿«é€Ÿè·å–æˆ–è€…è®¾ç½®è¡¨å•å†…å®¹</p><p>v-model&#x3D;â€å˜é‡â€</p><p>æ•°æ®å˜åŒ– è§†å›¾è‡ªåŠ¨æ›´æ–° </p><p>è§†å›¾å˜åŒ–æ•°æ®è‡ªåŠ¨æ›´æ–°</p><p>åŒå‘ç»‘å®š</p><pre><code> &lt;div id=&quot;app&quot;&gt;    &lt;!--       v-model å¯ä»¥è®©æ•°æ®å’Œè§†å›¾ï¼Œå½¢æˆåŒå‘æ•°æ®ç»‘å®š      (1) æ•°æ®å˜åŒ–ï¼Œè§†å›¾è‡ªåŠ¨æ›´æ–°      (2) è§†å›¾å˜åŒ–ï¼Œæ•°æ®è‡ªåŠ¨æ›´æ–°      å¯ä»¥å¿«é€Ÿ[è·å–]æˆ–[è®¾ç½®]è¡¨å•å…ƒç´ çš„å†…å®¹     --&gt;    è´¦æˆ·ï¼š&lt;input type=&quot;text&quot; v-model=&quot;username&quot;&gt; &lt;br&gt;&lt;br&gt;    å¯†ç ï¼š&lt;input type=&quot;password&quot; v-model=&quot;password&quot;&gt; &lt;br&gt;&lt;br&gt;    &lt;button @click=&quot;login&quot;&gt;ç™»å½•&lt;/button&gt;    &lt;button @click=&quot;reset&quot;&gt;é‡ç½®&lt;/button&gt;  &lt;/div&gt;  &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;&gt;&lt;/script&gt;  &lt;script&gt;    const app = new Vue(&#123;      el: &#39;#app&#39;,      data: &#123;        username: &#39;&#39;,        password: &#39;&#39;      &#125;,      methods: &#123;        login () &#123;          console.log(this.username, this.password)        &#125;,        reset () &#123;          this.username = &#39;&#39;          this.password = &#39;&#39;        &#125;      &#125;    &#125;)  &lt;/script&gt;</code></pre><h4 id="ç¬¬ä¸€ä¸ªå°æ¡ˆä¾‹"><a href="#ç¬¬ä¸€ä¸ªå°æ¡ˆä¾‹" class="headerlink" title="ç¬¬ä¸€ä¸ªå°æ¡ˆä¾‹"></a>ç¬¬ä¸€ä¸ªå°æ¡ˆä¾‹</h4><pre><code class="vue">&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;&lt;meta charset=&quot;UTF-8&quot; /&gt;&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; /&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;./index.css&quot; /&gt;&lt;title&gt;è®°äº‹æœ¬&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;!-- ä¸»ä½“åŒºåŸŸ --&gt;&lt;section id=&quot;app&quot;&gt;  &lt;!-- è¾“å…¥æ¡† --&gt;  &lt;header class=&quot;header&quot;&gt;    &lt;h1&gt;å°é»‘è®°äº‹æœ¬&lt;/h1&gt;    &lt;input v-model=&quot;todoName&quot; placeholder=&quot;è¯·è¾“å…¥ä»»åŠ¡&quot; class=&quot;new-todo&quot; /&gt;    &lt;button class=&quot;add&quot; @click=&quot;add()&quot;&gt;æ·»åŠ ä»»åŠ¡&lt;/button&gt;  &lt;/header&gt;  &lt;!-- åˆ—è¡¨åŒºåŸŸ --&gt;  &lt;section class=&quot;main&quot;&gt;    &lt;ul class=&quot;todo-list&quot;&gt;      &lt;li class=&quot;todo&quot; v-for=&quot;(item,index) in list&quot; v-bind:key=&quot;list&quot;&gt;        &lt;div class=&quot;view&quot;&gt;          &lt;span class=&quot;index&quot;&gt;&#123;&#123;index+1&#125;&#125;.&lt;/span&gt; &lt;label&gt;&#123;&#123;item.name&#125;&#125;&lt;/label&gt;          &lt;button @click=&quot;del(item.id)&quot; class=&quot;destroy&quot;&gt;åˆ é™¤&lt;/button&gt;        &lt;/div&gt;      &lt;/li&gt;    &lt;/ul&gt;  &lt;/section&gt;  &lt;!-- ç»Ÿè®¡å’Œæ¸…ç©º --&gt;  &lt;footer class=&quot;footer&quot;&gt;    &lt;!-- ç»Ÿè®¡ --&gt;    &lt;span class=&quot;todo-count&quot;&gt;åˆ è®¡:&lt;strong&gt; &#123;&#123;list.length&#125;&#125; &lt;/strong&gt;&lt;/span&gt;    &lt;!-- æ¸…ç©º --&gt;    &lt;button v-show=&quot;list.length&gt;0&quot; class=&quot;clear-completed&quot; @click=&quot;qk&quot;&gt;      æ¸…ç©ºä»»åŠ¡    &lt;/button&gt;  &lt;/footer&gt;&lt;/section&gt;&lt;!-- åº•éƒ¨ --&gt;&lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;&gt;&lt;/script&gt;&lt;script&gt;  const app = new Vue(&#123;    el: &#39;#app&#39;,    data: &#123;      list:[        &#123;id:1,name: &quot;è·‘æ­¥ä¸€å…¬é‡Œ&quot;&#125;,        &#123;id:2,name: &quot;æ´—æ¾¡ä¸€å°æ—¶&quot;&#125;,      ]    &#125;,  methods:&#123;    del(id)&#123;      this.list=this.list.filter(item=&gt;item.id !==id)    &#125;,    add()&#123;      if(this.todoName.trim()===&quot;&quot;)&#123;        alert(&quot;åç§°ä¸èƒ½ä¸ºç©º&quot;)        return      &#125;      this.list.unshift(&#123;        id: +new Date(),        name: this.todoName      &#125;)      this.todoName=&quot;&quot;    &#125;,    qk()&#123;      this.list=[]    &#125;  &#125;  &#125;)&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><pre><code class="css">html,body &#123;  margin: 0;  padding: 0;&#125;body &#123;  background: #fff;&#125;button &#123;  margin: 0;  padding: 0;  border: 0;  background: none;  font-size: 100%;  vertical-align: baseline;  font-family: inherit;  font-weight: inherit;  color: inherit;  -webkit-appearance: none;  appearance: none;  -webkit-font-smoothing: antialiased;  -moz-osx-font-smoothing: grayscale;&#125;body &#123;  font: 14px &#39;Helvetica Neue&#39;, Helvetica, Arial, sans-serif;  line-height: 1.4em;  background: #f5f5f5;  color: #4d4d4d;  min-width: 230px;  max-width: 550px;  margin: 0 auto;  -webkit-font-smoothing: antialiased;  -moz-osx-font-smoothing: grayscale;  font-weight: 300;&#125;:focus &#123;  outline: 0;&#125;.hidden &#123;  display: none;&#125;#app &#123;  background: #fff;  margin: 180px 0 40px 0;  padding: 15px;  position: relative;  box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.2), 0 25px 50px 0 rgba(0, 0, 0, 0.1);&#125;#app .header input &#123;  border: 2px solid rgba(175, 47, 47, 0.8);  border-radius: 10px;&#125;#app .add &#123;  position: absolute;  right: 15px;  top: 15px;  height: 68px;  width: 140px;  text-align: center;  background-color: rgba(175, 47, 47, 0.8);  color: #fff;  cursor: pointer;  font-size: 18px;  border-radius: 0 10px 10px 0;&#125;#app input::-webkit-input-placeholder &#123;  font-style: italic;  font-weight: 300;  color: #e6e6e6;&#125;#app input::-moz-placeholder &#123;  font-style: italic;  font-weight: 300;  color: #e6e6e6;&#125;#app input::input-placeholder &#123;  font-style: italic;  font-weight: 300;  color: gray;&#125;#app h1 &#123;  position: absolute;  top: -120px;  width: 100%;  left: 50%;  transform: translateX(-50%);  font-size: 60px;  font-weight: 100;  text-align: center;  color: rgba(175, 47, 47, 0.8);  -webkit-text-rendering: optimizeLegibility;  -moz-text-rendering: optimizeLegibility;  text-rendering: optimizeLegibility;&#125;.new-todo,.edit &#123;  position: relative;  margin: 0;  width: 100%;  font-size: 24px;  font-family: inherit;  font-weight: inherit;  line-height: 1.4em;  border: 0;  color: inherit;  padding: 6px;  box-shadow: inset 0 -1px 5px 0 rgba(0, 0, 0, 0.2);  box-sizing: border-box;  -webkit-font-smoothing: antialiased;  -moz-osx-font-smoothing: grayscale;&#125;.new-todo &#123;  padding: 16px;  border: none;  background: rgba(0, 0, 0, 0.003);  box-shadow: inset 0 -2px 1px rgba(0, 0, 0, 0.03);&#125;.main &#123;  position: relative;  z-index: 2;&#125;.todo-list &#123;  margin: 0;  padding: 0;  list-style: none;  overflow: hidden;&#125;.todo-list li &#123;  position: relative;  font-size: 24px;  height: 60px;  box-sizing: border-box;  border-bottom: 1px solid #e6e6e6;&#125;.todo-list li:last-child &#123;  border-bottom: none;&#125;.todo-list .view .index &#123;  position: absolute;  color: gray;  left: 10px;  top: 20px;  font-size: 22px;&#125;.todo-list li .toggle &#123;  text-align: center;  width: 40px;  /* auto, since non-WebKit browsers doesn&#39;t support input styling */  height: auto;  position: absolute;  top: 0;  bottom: 0;  margin: auto 0;  border: none; /* Mobile Safari */  -webkit-appearance: none;  appearance: none;&#125;.todo-list li .toggle &#123;  opacity: 0;&#125;.todo-list li .toggle + label &#123;  /*        Firefox requires `#` to be escaped - https://bugzilla.mozilla.org/show_bug.cgi?id=922433        IE and Edge requires *everything* to be escaped to render, so we do that instead of just the `#` - https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/7157459/    */  background-image: url(&#39;data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%22-10%20-18%20100%20135%22%3E%3Ccircle%20cx%3D%2250%22%20cy%3D%2250%22%20r%3D%2250%22%20fill%3D%22none%22%20stroke%3D%22%23ededed%22%20stroke-width%3D%223%22/%3E%3C/svg%3E&#39;);  background-repeat: no-repeat;  background-position: center left;&#125;.todo-list li .toggle:checked + label &#123;  background-image: url(&#39;data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%22-10%20-18%20100%20135%22%3E%3Ccircle%20cx%3D%2250%22%20cy%3D%2250%22%20r%3D%2250%22%20fill%3D%22none%22%20stroke%3D%22%23bddad5%22%20stroke-width%3D%223%22/%3E%3Cpath%20fill%3D%22%235dc2af%22%20d%3D%22M72%2025L42%2071%2027%2056l-4%204%2020%2020%2034-52z%22/%3E%3C/svg%3E&#39;);&#125;.todo-list li label &#123;  word-break: break-all;  padding: 15px 15px 15px 60px;  display: block;  line-height: 1.2;  transition: color 0.4s;&#125;.todo-list li.completed label &#123;  color: #d9d9d9;  text-decoration: line-through;&#125;.todo-list li .destroy &#123;  display: none;  position: absolute;  top: 0;  right: 10px;  bottom: 0;  width: 40px;  height: 40px;  margin: auto 0;  font-size: 30px;  color: #cc9a9a;  margin-bottom: 11px;  transition: color 0.2s ease-out;&#125;.todo-list li .destroy:hover &#123;  color: #af5b5e;&#125;.todo-list li .destroy:after &#123;  content: &#39;Ã—&#39;;&#125;.todo-list li:hover .destroy &#123;  display: block;&#125;.todo-list li .edit &#123;  display: none;&#125;.todo-list li.editing:last-child &#123;  margin-bottom: -1px;&#125;.footer &#123;  color: #777;  padding: 10px 15px;  height: 20px;  text-align: center;  border-top: 1px solid #e6e6e6;&#125;.footer:before &#123;  content: &#39;&#39;;  position: absolute;  right: 0;  bottom: 0;  left: 0;  height: 50px;  overflow: hidden;  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.2), 0 8px 0 -3px #f6f6f6,    0 9px 1px -3px rgba(0, 0, 0, 0.2), 0 16px 0 -6px #f6f6f6,    0 17px 2px -6px rgba(0, 0, 0, 0.2);&#125;.todo-count &#123;  float: left;  text-align: left;&#125;.todo-count strong &#123;  font-weight: 300;&#125;.filters &#123;  margin: 0;  padding: 0;  list-style: none;  position: absolute;  right: 0;  left: 0;&#125;.filters li &#123;  display: inline;&#125;.filters li a &#123;  color: inherit;  margin: 3px;  padding: 3px 7px;  text-decoration: none;  border: 1px solid transparent;  border-radius: 3px;&#125;.filters li a:hover &#123;  border-color: rgba(175, 47, 47, 0.1);&#125;.filters li a.selected &#123;  border-color: rgba(175, 47, 47, 0.2);&#125;.clear-completed,html .clear-completed:active &#123;  float: right;  position: relative;  line-height: 20px;  text-decoration: none;  cursor: pointer;&#125;.clear-completed:hover &#123;  text-decoration: underline;&#125;.info &#123;  margin: 50px auto 0;  color: #bfbfbf;  font-size: 15px;  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);  text-align: center;&#125;.info p &#123;  line-height: 1;&#125;.info a &#123;  color: inherit;  text-decoration: none;  font-weight: 400;&#125;.info a:hover &#123;  text-decoration: underline;&#125;/*    Hack to remove background from Mobile Safari.    Can&#39;t use it globally since it destroys checkboxes in Firefox*/@media screen and (-webkit-min-device-pixel-ratio: 0) &#123;  .toggle-all,  .todo-list li .toggle &#123;    background: none;  &#125;  .todo-list li .toggle &#123;    height: 40px;  &#125;&#125;@media (max-width: 430px) &#123;  .footer &#123;    height: 50px;  &#125;  .filters &#123;    bottom: 10px;  &#125;&#125;</code></pre><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230718001533335.png" alt="image-20230718001533335"></p><p>@keyup.enter é”®ç›˜å›è½¦ç›‘å¬</p><p>v-modelä¿®é¥°ç¬¦</p><p>v-model.trim  -ã€‹ å–å‡ºé¦–å°¾ç©ºæ ¼</p><p>v-model.number-ã€‹ è½¬æ•°å­—</p><p>@æ—¶é—´å.stop  -ã€‹ é˜»æ­¢å†’æ³¡</p><p>@æ—¶é—´å.prevent -ã€‹é˜»æ­¢é»˜è®¤è¡Œä¸º</p><p>v-bindçš„æ ·å¼å¢å¼º</p><p>å¯¹.classæ“ä½œ</p><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230718205311938.png" alt="image-20230718205311938"></p><pre><code class="vue"> &lt;div id=&quot;app&quot;&gt;    &lt;ul&gt;      &lt;li v-for=&quot;(item,index) in list&quot;&gt;&lt;a :class=&quot;&#123;active: index===activeIndex&#125;&quot; href=&quot;#&quot; @click=&quot;activeIndex= index&quot;&gt;&#123;&#123;item.name&#125;&#125;&lt;/a&gt;&lt;/li&gt;    &lt;/ul&gt;  &lt;/div&gt;  &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;&gt;&lt;/script&gt;  &lt;script&gt;    const app = new Vue(&#123;      el: &#39;#app&#39;,      data: &#123;        activeIndex: 0,        list: [          &#123; id: 1, name: &#39;äº¬ä¸œç§’æ€&#39; &#125;,          &#123; id: 2, name: &#39;æ¯æ—¥ç‰¹ä»·&#39; &#125;,          &#123; id: 3, name: &#39;å“ç±»ç§’æ€&#39; &#125;        ]      &#125;    &#125;)</code></pre><p>å¯¹stytleæ“ä½œ</p><pre><code class="vue">&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;  &lt;meta charset=&quot;UTF-8&quot;&gt;  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;  &lt;title&gt;Document&lt;/title&gt;  &lt;style&gt;    .progress &#123;      height: 25px;      width: 400px;      border-radius: 15px;      background-color: #272425;      border: 3px solid #272425;      box-sizing: border-box;      margin-bottom: 30px;    &#125;    .inner &#123;      width: 50%;      height: 20px;      border-radius: 10px;      text-align: right;      position: relative;      background-color: #409eff;      background-size: 20px 20px;      box-sizing: border-box;      transition: all 1s;    &#125;    .inner span &#123;      position: absolute;      right: -20px;      bottom: -25px;    &#125;  &lt;/style&gt;&lt;/head&gt;&lt;body&gt;  &lt;div id=&quot;app&quot;&gt;    &lt;div class=&quot;progress&quot;&gt;      &lt;div :style=&quot;&#123;width: percent+&#39;%&#39;&#125;&quot; class=&quot;inner&quot;&gt;        &lt;span&gt;&#123;&#123;percent+'%'&#125;&#125;&lt;/span&gt;      &lt;/div&gt;    &lt;/div&gt;    &lt;button @click=&quot;setpercent(25)&quot;&gt;è®¾ç½®25%&lt;/button&gt;    &lt;button @click=&quot;setpercent(50)&quot;&gt;è®¾ç½®50%&lt;/button&gt;    &lt;button @click=&quot;setpercent(75)&quot;&gt;è®¾ç½®75%&lt;/button&gt;    &lt;button @click=&quot;setpercent(100)&quot;&gt;è®¾ç½®100%&lt;/button&gt;  &lt;/div&gt;  &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;&gt;&lt;/script&gt;  &lt;script&gt;    const app = new Vue(&#123;      el: &#39;#app&#39;,      data: &#123;        percent: 30      &#125;,      methods: &#123;        setpercent(x)&#123;            this.percent=x;        &#125;      &#125;    &#125;)  &lt;/script&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230718210424696.png" alt="image-20230718210424696"></p><p>v-modelåœ¨è¡¨å•å…¶ä»–å±æ€§çš„ä½¿ç”¨</p><pre><code class="vue"> &lt;div id=&quot;app&quot;&gt;    &lt;h3&gt;å°é»‘å­¦ä¹ ç½‘&lt;/h3&gt;    å§“åï¼š      &lt;input v-model=&quot;username&quot; type=&quot;text&quot;&gt;       &lt;br&gt;&lt;br&gt;    æ˜¯å¦å•èº«ï¼š      &lt;input type=&quot;checkbox&quot; v-model=&quot;isSingle&quot;&gt;       &lt;br&gt;&lt;br&gt;    &lt;!--       å‰ç½®ç†è§£ï¼š        1. name:  ç»™å•é€‰æ¡†åŠ ä¸Š name å±æ€§ å¯ä»¥åˆ†ç»„ â†’ åŒä¸€ç»„äº’ç›¸ä¼šäº’æ–¥        2. value: ç»™å•é€‰æ¡†åŠ ä¸Š value å±æ€§ï¼Œç”¨äºæäº¤ç»™åå°çš„æ•°æ®      ç»“åˆ Vue ä½¿ç”¨ â†’ v-model    --&gt;    æ€§åˆ«:       &lt;input v-model=&quot;gender&quot; type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;1&quot;&gt;ç”·      &lt;input v-model=&quot;gender&quot; type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;0&quot;&gt;å¥³      &lt;br&gt;&lt;br&gt;    &lt;!--       å‰ç½®ç†è§£ï¼š        1. option éœ€è¦è®¾ç½® value å€¼ï¼Œæäº¤ç»™åå°        2. select çš„ value å€¼ï¼Œå…³è”äº†é€‰ä¸­çš„ option çš„ value å€¼      ç»“åˆ Vue ä½¿ç”¨ â†’ v-model    --&gt;    æ‰€åœ¨åŸå¸‚:      &lt;select v-model=&quot;cityname&quot;&gt;        &lt;option value=&quot;bj&quot;&gt;åŒ—äº¬&lt;/option&gt;        &lt;option value=&quot;sh&quot;&gt;ä¸Šæµ·&lt;/option&gt;        &lt;option value=&quot;cd&quot;&gt;æˆéƒ½&lt;/option&gt;        &lt;option value=&quot;nj&quot;&gt;å—äº¬&lt;/option&gt;      &lt;/select&gt;      &lt;br&gt;&lt;br&gt;    è‡ªæˆ‘æè¿°ï¼š      &lt;textarea v-model=&quot;desc&quot;&gt;&lt;/textarea&gt;     &lt;button&gt;ç«‹å³æ³¨å†Œ&lt;/button&gt;  &lt;/div&gt;  &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;&gt;&lt;/script&gt;  &lt;script&gt;    const app = new Vue(&#123;      el: &#39;#app&#39;,      data: &#123;        username: &#39;2314&#39;,        isSingle: false,        gender: 1,        cityname: &#39;sh&#39;,        desc: 264452      &#125;    &#125;)  &lt;/script&gt;</code></pre><p>è®¡ç®—å±æ€§</p><h5 id="computedè®¡ç®—å±æ€§"><a href="#computedè®¡ç®—å±æ€§" class="headerlink" title="computedè®¡ç®—å±æ€§"></a>computedè®¡ç®—å±æ€§</h5><pre><code>&lt;body&gt;  &lt;div id=&quot;app&quot;&gt;    &lt;h3&gt;å°é»‘çš„ç¤¼ç‰©æ¸…å•&lt;/h3&gt;    &lt;table&gt;      &lt;tr&gt;        &lt;th&gt;åå­—&lt;/th&gt;        &lt;th&gt;æ•°é‡&lt;/th&gt;      &lt;/tr&gt;      &lt;tr v-for=&quot;(item, index) in list&quot; :key=&quot;item.id&quot;&gt;        &lt;td&gt;&#123;&#123; item.name &#125;&#125;&lt;/td&gt;        &lt;td&gt;&#123;&#123; item.num &#125;&#125;ä¸ª&lt;/td&gt;      &lt;/tr&gt;    &lt;/table&gt;    &lt;!-- ç›®æ ‡ï¼šç»Ÿè®¡æ±‚å’Œï¼Œæ±‚å¾—ç¤¼ç‰©æ€»æ•° --&gt;    &lt;p&gt;ç¤¼ç‰©æ€»æ•°ï¼š&#123;&#123;totalCount&#125;&#125;ä¸ª&lt;/p&gt;  &lt;/div&gt;  &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;&gt;&lt;/script&gt;  &lt;script&gt;    const app = new Vue(&#123;      el: &#39;#app&#39;,      data: &#123;        // ç°æœ‰çš„æ•°æ®        list: [          &#123; id: 1, name: &#39;ç¯®çƒ&#39;, num: 1 &#125;,          &#123; id: 2, name: &#39;ç©å…·&#39;, num: 2 &#125;,          &#123; id: 3, name: &#39;é“…ç¬”&#39;, num: 5 &#125;,        ]      &#125;,      computed: &#123;        totalCount()&#123;                      //éœ€æ±‚ï¼š å¯¹this.listæ•°ç»„é‡Œé¢çš„numè¿›è¡Œæ±‚å’Œ          let total= this.list.reduce((sum,item)=&gt; sum+item.num,0)          return total;        &#125;      &#125;    &#125;)  &lt;/script&gt;&lt;/body&gt;</code></pre><p>è¿™é‡Œé¢çš„totalCountåªæ˜¯ä¸€ä¸ªå±æ€§ ä»–ä¸æ˜¯ä¸€ä¸ªå‡½æ•° åªæ˜¯ä¸€ä¸ªå±æ€§ å¯ä»¥ç›´æ¥ç”¨ </p><p>å¦å¤– reduceï¼ˆsumï¼Œitemï¼‰&#x3D;ã€‹sum +item.numï¼Œ0</p><pre><code>computed: &#123;        totalCount()&#123;                      //éœ€æ±‚ï¼š å¯¹this.listæ•°ç»„é‡Œé¢çš„numè¿›è¡Œæ±‚å’Œ          let total= this.list.reduce((sum,item)=&gt; sum+item.num,0)          return total;        &#125;      &#125;</code></pre><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230718213627406.png" alt="image-20230718213627406"></p><p>è®¡ç®—å±æ€§çš„å®Œæ•´å†™æ³•</p><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230718214407703.png" alt="image-20230718214407703"></p><pre><code class="vue">  &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;&gt;&lt;/script&gt;  &lt;script&gt;    const app = new Vue(&#123;      el: &#39;#app&#39;,      data: &#123;        fname: &#39;æ&#39;,        lname: &#39;99&#39;,      &#125;,      methods: &#123;        changename()&#123;          this.updatename=&#39;å•å¸ƒ&#39;        &#125;      &#125;,      computed: &#123;        updatename:&#123;          get()&#123;            this.fullname=this.fname+this.lname           return this.fullname;          &#125;,          // å½“updatenameè®¡ç®—å±æ€§è¢«ä¿®æ”¹æ—¶ æ‰§è¡Œsetå‡½æ•° å¹¶ä¸”          // è¿™ä¸ªæ“ä½œæ˜¯åŒå‘çš„ ä½†æ˜¯å…·ä½“çš„é€»è¾‘æ˜¯è‡ªå·±å®ç°          set(value)&#123;            this.fname=value.slice(0,1),            this.lname=value.slice(1)          &#125;        &#125;      &#125;,          &#125;)  &lt;/script&gt;</code></pre><p>ç»¼åˆå¤§æ¡ˆä¾‹</p><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230718224255059.png" alt="image-20230718224255059"></p><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230718224323286.png" alt="image-20230718224323286"></p><pre><code class="vue"> &lt;body&gt;    &lt;div id=&quot;app&quot; class=&quot;score-case&quot;&gt;      &lt;div class=&quot;table&quot;&gt;        &lt;table&gt;          &lt;thead&gt;            &lt;tr&gt;              &lt;th&gt;ç¼–å·&lt;/th&gt;              &lt;th&gt;ç§‘ç›®&lt;/th&gt;              &lt;th&gt;æˆç»©&lt;/th&gt;              &lt;th&gt;æ“ä½œ&lt;/th&gt;            &lt;/tr&gt;          &lt;/thead&gt;          &lt;tbody v-if=&quot;list.length&gt;0&quot;&gt;            &lt;tr v-for=&quot;(item,index) in list&quot; :key=&quot;item.id&quot;&gt;              &lt;td&gt;&#123;&#123;item.id&#125;&#125;&lt;/td&gt;              &lt;td&gt;&#123;&#123;item.subject&#125;&#125;&lt;/td&gt;              &lt;td :class=&quot;&#123;red: item.score&lt;60&#125;&quot;&gt;&#123;&#123;item.score&#125;&#125;&lt;/td&gt;              &lt;td&gt;&lt;a @click.prevent=&quot;del(item.id)&quot; href=&quot;www.baidu.comwww.baidu.com&quot;&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt;            &lt;/tr&gt;          &lt;/tbody&gt;          &lt;tbody v-else&gt;            &lt;tr&gt;              &lt;td colspan=&quot;5&quot;&gt;                &lt;span class=&quot;none&quot;&gt;æš‚æ— æ•°æ®&lt;/span&gt;              &lt;/td&gt;            &lt;/tr&gt;          &lt;/tbody&gt;          &lt;tfoot&gt;            &lt;tr&gt;              &lt;td colspan=&quot;5&quot;&gt;                &lt;span&gt;æ€»åˆ†ï¼š&#123;&#123;totalScore&#125;&#125;&lt;/span&gt;                &lt;span style=&quot;margin-left: 50px&quot;&gt;å¹³å‡åˆ†ï¼š&#123;&#123;averageScorce&#125;&#125;&lt;/span&gt;              &lt;/td&gt;            &lt;/tr&gt;          &lt;/tfoot&gt;        &lt;/table&gt;      &lt;/div&gt;      &lt;div class=&quot;form&quot;&gt;        &lt;div class=&quot;form-item&quot;&gt;          &lt;div class=&quot;label&quot;&gt;ç§‘ç›®ï¼š&lt;/div&gt;          &lt;div class=&quot;input&quot;&gt;            &lt;input               type=&quot;text&quot;              placeholder=&quot;è¯·è¾“å…¥ç§‘ç›®&quot;            v-model.trim=&quot;subject&quot; /&gt;          &lt;/div&gt;        &lt;/div&gt;        &lt;div class=&quot;form-item&quot;&gt;          &lt;div class=&quot;label&quot;&gt;åˆ†æ•°ï¼š&lt;/div&gt;          &lt;div class=&quot;input&quot;&gt;            &lt;input              type=&quot;text&quot;              placeholder=&quot;è¯·è¾“å…¥åˆ†æ•°&quot;             v-model=&quot;score&quot;/&gt;          &lt;/div&gt;        &lt;/div&gt;        &lt;div class=&quot;form-item&quot;&gt;          &lt;div class=&quot;label&quot;&gt;&lt;/div&gt;          &lt;div class=&quot;input&quot;&gt;            &lt;button class=&quot;submit&quot; @click=&quot;add()&quot; &gt;æ·»åŠ &lt;/button&gt;          &lt;/div&gt;        &lt;/div&gt;      &lt;/div&gt;    &lt;/div&gt;    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;&gt;&lt;/script&gt;    &lt;script&gt;      const app = new Vue(&#123;        el: &#39;#app&#39;,        data: &#123;          list: [            &#123; id: 1, subject: &#39;è¯­æ–‡&#39;, score: 20 &#125;,            &#123; id: 7, subject: &#39;æ•°å­¦&#39;, score: 99 &#125;,            &#123; id: 12, subject: &#39;è‹±è¯­&#39;, score: 70 &#125;,          ],          subject: &#39;&#39;,          score: 0,        &#125;,        methods:&#123;          del(id)&#123;            this.list=this.list.filter(item=&gt; item.id!=id);          &#125;,          add()&#123;            if(!this.subject)&#123;              alert(&quot;è¯·è¾“å…¥ç§‘ç›®&quot;);              return            &#125;            if(typeof this.score !==&#39;number&#39;)&#123;              alert(&quot;è¾“å…¥æ­£ç¡®çš„åˆ†æ•°&quot;)              return            &#125;            this.list.unshift(&#123;              id: +new Date(),              subject: this.subject,              score: this.score            &#125;)            this.subject=&#39;&#39;,            this.score=&#39;&#39;          &#125;        &#125;,        computed:&#123;          totalScore()&#123;            return this.list.reduce((sum,item)=&gt;sum+item.score,0)          &#125;,          averageScorce()&#123;            if(this.list.length===0)&#123;              return 0;            &#125;              return (this.totalScore/this.list.length).toFixed(2)          &#125;                  &#125;      &#125;)    &lt;/script&gt;</code></pre><p>watchç›‘å¬å™¨</p><p>ç›‘å¬frutilistæ•°æ®ä¸€æ—¦æ”¹å˜è·å¾—æœ€æ–°å€¼</p><pre><code>        watch:&#123;          fruitList:&#123;            deep:true,            handler(newValue)&#123;              localStorage.setItem(&quot;fruit&quot;,JSON.stringify(newValue))            &#125;          &#125;        &#125;</code></pre><h3 id="é‡è¦æ–¹æ³•"><a href="#é‡è¦æ–¹æ³•" class="headerlink" title="é‡è¦æ–¹æ³•"></a>é‡è¦æ–¹æ³•</h3><p>æ•°ç»„.reduce</p><p>å¯ä»¥å®ç°ç´¯åŠ æ•ˆæœ</p><pre><code>return this.fruitList.reduce((sum, item) =&gt; sum + item, 0);</code></pre><p>åœ¨è¿™é‡Œï¼Œç´¯åŠ å™¨å‡½æ•° <code>(sum, item) =&gt; sum + item</code> å°†æ¯ä¸ªå…ƒç´ ä¾æ¬¡åŠ åˆ°ç´¯åŠ å™¨ <code>sum</code> ä¸Šï¼Œæœ€ç»ˆè¿”å›æ€»å’Œã€‚åˆå§‹å€¼ä¸º 0ï¼Œç¡®ä¿äº†å½“ <code>fruitList</code> ä¸ºç©ºæ•°ç»„æ—¶ï¼Œä¹Ÿèƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚</p><p>array.find å®ç°æ‰¾åˆ°æŒ‡å®šidçš„æ•°ç»„å…ƒç´ </p><p>ä½ çš„ä»£ç  <code>fruit.num--;</code> æ˜¯æƒ³è¦å°†æ‰¾åˆ°çš„æ°´æœå¯¹è±¡çš„ <code>num</code> å±æ€§å‡ 1ã€‚ä¸è¿‡ï¼Œåœ¨ä½¿ç”¨ <code>find</code> æ–¹æ³•æ‰¾åˆ°å¯¹è±¡åï¼Œéœ€è¦ç¡®ä¿å¯¹è±¡å­˜åœ¨æ‰èƒ½æ‰§è¡Œå‡æ³•æ“ä½œï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ã€‚</p><pre><code>const fruit = this.fruitList.find(item =&gt; item.id === id);if (fruit) &#123;  fruit.num--;&#125;</code></pre><p>é€šè¿‡æ·»åŠ æ¡ä»¶åˆ¤æ–­ï¼Œ<code>if (fruit)</code> ç¡®ä¿äº†å¯¹è±¡å­˜åœ¨æ—¶æ‰æ‰§è¡Œå‡æ³•æ“ä½œã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨æ‰¾ä¸åˆ°å¯¹è±¡æ—¶å‡ºç°é”™è¯¯ï¼Œç¡®ä¿ä»£ç çš„ç¨³å®šæ€§ã€‚</p><p>æ•°ç»„.filter å¯ä»¥å®ç°æ•°ç»„å…ƒç´ çš„åˆ é™¤</p><p>ä½ çš„ä»£ç  <code>this.fruitList = this.fruitList.filter(item =&gt; item.id !== id);</code> æ˜¯æƒ³è¦ä» <code>fruitList</code> æ•°ç»„ä¸­ç§»é™¤æŒ‡å®š <code>id</code> çš„æ°´æœå¯¹è±¡ã€‚</p><p><code>filter</code> æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«æ»¡è¶³æŒ‡å®šæ¡ä»¶çš„æ‰€æœ‰å…ƒç´ ã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>filter</code> æ–¹æ³•æ¥è¿‡æ»¤æ‰æŒ‡å®š <code>id</code> çš„æ°´æœå¯¹è±¡ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¿®æ­£åçš„ä»£ç ç¤ºä¾‹ï¼š</p><pre><code>javascriptCopy Codethis.fruitList = this.fruitList.filter(item =&gt; item.id !== id);</code></pre><p>é€šè¿‡ä½¿ç”¨ <code>filter</code> æ–¹æ³•å¹¶æŒ‡å®šæ¡ä»¶ <code>item.id !== id</code>ï¼Œæˆ‘ä»¬å°†ç­›é€‰å‡º <code>id</code> ä¸ç­‰äºç»™å®šå€¼çš„æ°´æœå¯¹è±¡ï¼Œç„¶åå°†ç»“æœèµ‹å€¼ç»™ <code>fruitList</code> æ•°ç»„ã€‚è¿™æ ·å°±å®ç°äº†ä»æ•°ç»„ä¸­ç§»é™¤æŒ‡å®š <code>id</code> çš„æ°´æœå¯¹è±¡çš„æ“ä½œã€‚</p><h1 id="ç»¼åˆæ¡ˆä¾‹è´­ç‰©è½¦"><a href="#ç»¼åˆæ¡ˆä¾‹è´­ç‰©è½¦" class="headerlink" title="ç»¼åˆæ¡ˆä¾‹è´­ç‰©è½¦"></a>ç»¼åˆæ¡ˆä¾‹è´­ç‰©è½¦</h1><p><strong>å®ç°åŠŸèƒ½</strong></p><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230719223605712.png" alt="image-20230719223605712"></p><p>éœ€æ±‚</p><p>1.æ¸²æŸ“åŠŸèƒ½</p><p>2.åˆ é™¤åŠŸèƒ½</p><p>3.ä¿®æ”¹åŠŸèƒ½</p><p>4.å…¨é€‰åé€‰</p><p>5.ç»Ÿè®¡é€‰ä¸­çš„æ€»ä»·å’Œæ€»æ•°é‡</p><p>6.æŒä¹…åŒ–åˆ°æœ¬åœ°</p><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230719223714850.png" alt="image-20230719223714850"></p><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;link rel=&quot;stylesheet&quot; href=&quot;./css/inputnumber.css&quot; /&gt;    &lt;link rel=&quot;stylesheet&quot; href=&quot;./css/index.css&quot; /&gt;    &lt;title&gt;è´­ç‰©è½¦&lt;/title&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;div class=&quot;app-container&quot; id=&quot;app&quot;&gt;      &lt;!-- é¡¶éƒ¨banner --&gt;      &lt;div class=&quot;banner-box&quot;&gt;&lt;img src=&quot;http://autumnfish.cn/static/fruit.jpg&quot; alt=&quot;&quot; /&gt;&lt;/div&gt;      &lt;!-- é¢åŒ…å±‘ --&gt;      &lt;div class=&quot;breadcrumb&quot;&gt;        &lt;span&gt;ğŸ &lt;/span&gt;        /        &lt;span&gt;è´­ç‰©è½¦&lt;/span&gt;      &lt;/div&gt;      &lt;!-- è´­ç‰©è½¦ä¸»ä½“ --&gt;      &lt;div class=&quot;main&quot; v-if=&quot;fruitList.length&gt;0&quot;&gt;        &lt;div class=&quot;table&quot;&gt;          &lt;!-- å¤´éƒ¨ --&gt;          &lt;div class=&quot;thead&quot;&gt;            &lt;div class=&quot;tr&quot;&gt;              &lt;div class=&quot;th&quot;&gt;é€‰ä¸­&lt;/div&gt;              &lt;div class=&quot;th th-pic&quot;&gt;å›¾ç‰‡&lt;/div&gt;              &lt;div class=&quot;th&quot;&gt;å•ä»·&lt;/div&gt;              &lt;div class=&quot;th num-th&quot;&gt;ä¸ªæ•°&lt;/div&gt;              &lt;div class=&quot;th&quot;&gt;å°è®¡&lt;/div&gt;              &lt;div class=&quot;th&quot;&gt;æ“ä½œ&lt;/div&gt;            &lt;/div&gt;          &lt;/div&gt;          &lt;!-- èº«ä½“ --&gt;          &lt;div class=&quot;tbody&quot;&gt;            &lt;div  v-for=&quot;(item,index) in fruitList&quot; :key=&quot;item.id&quot; class=&quot;tr&quot; :class=&quot;&#123;active: item.isChecked&#125;&quot;&gt;              &lt;div class=&quot;td&quot;&gt;&lt;input type=&quot;checkbox&quot; v-model=&quot;item.isChecked&quot; /&gt;&lt;/div&gt;              &lt;div class=&quot;td&quot;&gt;&lt;img :src=&quot;item.icon&quot; alt=&quot;&quot; /&gt;&lt;/div&gt;              &lt;div class=&quot;td&quot;&gt;&#123;&#123;item.price&#125;&#125;&lt;/div&gt;              &lt;div class=&quot;td&quot;&gt;                &lt;div class=&quot;my-input-number&quot;&gt;                  &lt;button :disabled=&quot;item.num&lt;=1&quot; class=&quot;decrease&quot; @click=&quot;inc(item.id)&quot;&gt; - &lt;/button&gt;                  &lt;span class=&quot;my-input__inner&quot;&gt;&#123;&#123;item.num&#125;&#125;&lt;/span&gt;                  &lt;button class=&quot;increase&quot; @click=&quot;su(item.id)&quot;&gt; + &lt;/button&gt;                &lt;/div&gt;              &lt;/div&gt;              &lt;div class=&quot;td&quot;&gt;&#123;&#123;item.price * item.num&#125;&#125;&lt;/div&gt;              &lt;div class=&quot;td&quot;&gt;&lt;button @click=&quot;del(item.id)&quot;&gt;åˆ é™¤&lt;/button&gt;&lt;/div&gt;            &lt;/div&gt;          &lt;/div&gt;        &lt;/div&gt;        &lt;!-- åº•éƒ¨ --&gt;        &lt;div class=&quot;bottom&quot;&gt;          &lt;!-- å…¨é€‰ --&gt;          &lt;label class=&quot;check-all&quot; &gt;            &lt;input type=&quot;checkbox&quot; v-model=&quot;isall&quot; /&gt;            å…¨é€‰          &lt;/label&gt;          &lt;div class=&quot;right-box&quot;&gt;            &lt;!-- æ‰€æœ‰å•†å“æ€»ä»· --&gt;            &lt;span class=&quot;price-box&quot;&gt;æ€»ä»·&amp;nbsp;&amp;nbsp;:&amp;nbsp;&amp;nbsp;Â¥&amp;nbsp;&lt;span class=&quot;price&quot;&gt;&#123;&#123;totalprice&#125;&#125;&lt;/span&gt;&lt;/span&gt;            &lt;!-- ç»“ç®—æŒ‰é’® --&gt;            &lt;button class=&quot;pay&quot;&gt;ç»“ç®—( &#123;&#123;totalcount&#125;&#125; )&lt;/button&gt;          &lt;/div&gt;        &lt;/div&gt;      &lt;/div&gt;      &lt;!-- ç©ºè½¦ --&gt;      &lt;div class=&quot;empty&quot; v-else&gt;ğŸ›’ç©ºç©ºå¦‚ä¹Ÿ&lt;/div&gt;    &lt;/div&gt;    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;&gt;&lt;/script&gt;    &lt;script&gt;      const defaltArr= [            &#123;              id: 1,              icon: &#39;http://autumnfish.cn/static/ç«é¾™æœ.png&#39;,              isChecked: true,              num: 2,              price: 6,            &#125;,            &#123;              id: 2,              icon: &#39;http://autumnfish.cn/static/è”æ.png&#39;,              isChecked: false,              num: 7,              price: 20,            &#125;,            &#123;              id: 3,              icon: &#39;http://autumnfish.cn/static/æ¦´è².png&#39;,              isChecked: false,              num: 3,              price: 40,            &#125;,            &#123;              id: 4,              icon: &#39;http://autumnfish.cn/static/é¸­æ¢¨.png&#39;,              isChecked: true,              num: 10,              price: 3,            &#125;,            &#123;              id: 5,              icon: &#39;http://autumnfish.cn/static/æ¨±æ¡ƒ.png&#39;,              isChecked: false,              num: 20,              price: 34,            &#125;,          ]      const app = new Vue(&#123;        el: &#39;#app&#39;,        data: &#123;          fruitList: JSON.parse(localStorage.getItem(&#39;fruit&#39;))||defaltArr,        &#125;,        methods:&#123;          del(id)&#123;              this.fruitList=this.fruitList.filter(item=&gt; item.id!==id)          &#125;,          su(id)&#123;            const fruit=this.fruitList.find(item=&gt;item.id===id)            fruit.num++;          &#125;,          inc(id)&#123;            const fruit=this.fruitList.find(iteitem=&gt;item.id===id)            fruit.num--;          &#125;        &#125;,        computed: &#123;          isall:&#123;            get()&#123;            return this.fruitList.every(item=&gt; item.isChecked);          &#125;,          set(value)&#123;            this.fruitList.forEach(item =&gt; item.isChecked= value);          &#125;          &#125;,          totalcount()&#123;            return this.fruitList.reduce((sum,item)=&gt;item.isChecked?item.num+sum:sum=sum,0);          &#125;,          totalprice()&#123;            return this.fruitList.reduce((sum,item)=&gt;item.isChecked?item.num*item.price+sum:sum=sum,0);          &#125;          // isall()&#123;          //   //å¿…é¡»è‹å“¦æœ‰çš„å°é€‰æ‹©æ¡†éƒ½é€‰ä¸­æˆ‘ä»¬æ‰é€‰ä¸­è¿™ä¸ª-every          //   return this.fruitList.every(item=&gt;item.isChecked)          // &#125;        &#125;,        watch:&#123;          fruitList:&#123;            deep:true,            handler(newValue)&#123;              localStorage.setItem(&quot;fruit&quot;,JSON.stringify(newValue))            &#125;          &#125;        &#125;      &#125;)    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h1 id="VUEçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#VUEçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="VUEçš„ç”Ÿå‘½å‘¨æœŸ"></a>VUEçš„ç”Ÿå‘½å‘¨æœŸ</h1><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230719224810721.png" alt="image-20230719224810721"></p><p><strong>vueçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆé’©å­å‡½æ•°ï¼‰</strong></p><pre><code class="vue"> &lt;script&gt;    const app = new Vue(&#123;      el: &#39;#app&#39;,      data: &#123;        count: 100,        title: &#39;è®¡æ•°å™¨&#39;      &#125;,      // 1. åˆ›å»ºé˜¶æ®µï¼ˆå‡†å¤‡æ•°æ®ï¼‰      beforeCreate () &#123;        console.log(&#39;beforeCreate å“åº”å¼æ•°æ®å‡†å¤‡å¥½ä¹‹å‰&#39;, this.count)      &#125;,      created () &#123;        console.log(&#39;created å“åº”å¼æ•°æ®å‡†å¤‡å¥½ä¹‹å&#39;, this.count)        // this.æ•°æ®å = è¯·æ±‚å›æ¥çš„æ•°æ®        // å¯ä»¥å¼€å§‹å‘é€åˆå§‹åŒ–æ¸²æŸ“çš„è¯·æ±‚äº†      &#125;,      // 2. æŒ‚è½½é˜¶æ®µï¼ˆæ¸²æŸ“æ¨¡æ¿ï¼‰      beforeMount () &#123;        console.log(&#39;beforeMount æ¨¡æ¿æ¸²æŸ“ä¹‹å‰&#39;, document.querySelector(&#39;h3&#39;).innerHTML)      &#125;,      mounted () &#123;        console.log(&#39;mounted æ¨¡æ¿æ¸²æŸ“ä¹‹å&#39;, document.querySelector(&#39;h3&#39;).innerHTML)        // å¯ä»¥å¼€å§‹æ“ä½œdomäº†      &#125;,      // 3. æ›´æ–°é˜¶æ®µ(ä¿®æ”¹æ•°æ® â†’ æ›´æ–°è§†å›¾)      beforeUpdate () &#123;        console.log(&#39;beforeUpdate æ•°æ®ä¿®æ”¹äº†ï¼Œè§†å›¾è¿˜æ²¡æ›´æ–°&#39;, document.querySelector(&#39;span&#39;).innerHTML)      &#125;,      updated () &#123;        console.log(&#39;updated æ•°æ®ä¿®æ”¹äº†ï¼Œè§†å›¾å·²ç»æ›´æ–°&#39;, document.querySelector(&#39;span&#39;).innerHTML)      &#125;,      // 4. å¸è½½é˜¶æ®µ      beforeDestroy () &#123;        console.log(&#39;beforeDestroy, å¸è½½å‰&#39;)        console.log(&#39;æ¸…é™¤æ‰ä¸€äº›Vueä»¥å¤–çš„èµ„æºå ç”¨ï¼Œå®šæ—¶å™¨ï¼Œå»¶æ—¶å™¨...&#39;)      &#125;,      destroyed () &#123;        console.log(&#39;destroyedï¼Œå¸è½½å&#39;)      &#125;    &#125;)  &lt;/script&gt;</code></pre><p>æ­¤å‡½æ•°æ˜¯åœ¨æ•°æ®åˆ›å»ºå®Œæ¯•</p><p>é’©å­å‡½æ•° ä¸€èˆ¬æ“ä½œæ•°æ®éœ€è¦åœ¨createdï¼ˆï¼‰å‡½æ•°ä¸­è¿›è¡Œ</p><p>æ­¤é’©å­å‡½æ•°æ˜¯è§†å›¾æ¸²æŸ“å®Œæ¯•</p><p>ä¸€èˆ¬æ“ä½œmountedä¸­è¿›è¡Œdomæ“ä½œ</p><h1 id="VUECLI-å·¥ç¨‹åŒ–æ„å»º"><a href="#VUECLI-å·¥ç¨‹åŒ–æ„å»º" class="headerlink" title="VUECLI å·¥ç¨‹åŒ–æ„å»º"></a>VUECLI å·¥ç¨‹åŒ–æ„å»º</h1><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230720223909148.png" alt="image-20230720223909148"></p><p><strong>å·¥ç¨‹åŒ–é¡µé¢ä¸åœ¨index.htmlä¸‹å†™ä»£ç </strong></p><p>indexåªæ˜¯å®¹å™¨åŠŸèƒ½  App.vueæ˜¯é¡µé¢ç¼–å†™é¡µé¢ä»£ç </p><p>main.js æ˜¯æ‰“åŒ…çš„å…¥å£æ–‡ä»¶</p><p>index.htmlç¬¬ä¸€ä¸ªindex</p><pre><code class="vue">&lt;!DOCTYPE html&gt;&lt;html lang=&quot;&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;utf-8&quot;&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1.0&quot;&gt;    &lt;link rel=&quot;icon&quot; href=&quot;&lt;%= BASE_URL %&gt;favicon.ico&quot;&gt;    &lt;title&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/title&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;!-- å…¼å®¹ï¼šç»™ä¸æ”¯æŒjsçš„æµè§ˆå™¨ä¸€ä¸ªæç¤º --&gt;    &lt;noscript&gt;      &lt;strong&gt;We&#39;re sorry but &lt;%= htmlWebpackPlugin.options.title %&gt; doesn&#39;t work properly without JavaScript enabled. Please enable it to continue.&lt;/strong&gt;    &lt;/noscript&gt;    &lt;!-- Vueæ‰€ç®¡ç†çš„å®¹å™¨ï¼šå°†æ¥åˆ›å»ºç»“æ„åŠ¨æ€æ¸²æŸ“è¿™ä¸ªå®¹å™¨ --&gt;    &lt;div id=&quot;app&quot;&gt;      &lt;!-- å·¥ç¨‹åŒ–å¼€å‘æ¨¡å¼ä¸­ï¼šè¿™é‡Œä¸å†ç›´æ¥ç¼–å†™æ¨¡æ¿è¯­æ³•ï¼Œé€šè¿‡ App.vue æä¾›ç»“æ„æ¸²æŸ“ --&gt;    &lt;/div&gt;    &lt;!-- built files will be auto injected --&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><p>main.js</p><pre><code></code></pre><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230720233732764.png" alt="image-20230720233732764"></p><h3 id="å±€éƒ¨æ³¨å†Œå’Œå…¨å±€æ³¨å†Œ"><a href="#å±€éƒ¨æ³¨å†Œå’Œå…¨å±€æ³¨å†Œ" class="headerlink" title="å±€éƒ¨æ³¨å†Œå’Œå…¨å±€æ³¨å†Œ"></a>å±€éƒ¨æ³¨å†Œå’Œå…¨å±€æ³¨å†Œ</h3><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230721001822698.png" alt="image-20230721001822698"></p><p>å®ä¾‹åœ¨APp.vueå±€éƒ¨æ³¨å†Œ</p><p>import HmHeader from â€˜.&#x2F;components&#x2F;HmHeader.vueâ€™</p><p>import HmMain from â€˜.&#x2F;components&#x2F;HmMain.vueâ€™</p><p>import HmFooter from â€˜.&#x2F;components&#x2F;HmFooter.vueâ€™</p><p>export default {</p><p> components: {</p><p>  &#x2F;&#x2F; â€˜ç»„ä»¶åâ€™: ç»„ä»¶å¯¹è±¡</p><p>  HmHeader: HmHeader,</p><p>  HmMain,</p><p>  HmFooter</p><p> }</p><p>}</p><pre><code>&lt;template&gt;  &lt;div class=&quot;App&quot;&gt;    &lt;!-- å¤´éƒ¨ç»„ä»¶ --&gt;    &lt;HmHeader&gt;&lt;/HmHeader&gt;    &lt;!-- ä¸»ä½“ç»„ä»¶ --&gt;    &lt;HmMain&gt;&lt;/HmMain&gt;    &lt;!-- åº•éƒ¨ç»„ä»¶ --&gt;    &lt;HmFooter&gt;&lt;/HmFooter&gt;    &lt;!-- å¦‚æœ HmFooter + tab å‡ºä¸æ¥ â†’ éœ€è¦é…ç½® vscode         è®¾ç½®ä¸­æœç´¢ trigger on tab â†’ å‹¾ä¸Š    --&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;import HmHeader from &#39;./components/HmHeader.vue&#39;import HmMain from &#39;./components/HmMain.vue&#39;import HmFooter from &#39;./components/HmFooter.vue&#39;export default &#123;  components: &#123;    // &#39;ç»„ä»¶å&#39;: ç»„ä»¶å¯¹è±¡    HmHeader: HmHeader,    HmMain,    HmFooter  &#125;&#125;&lt;/script&gt;&lt;style&gt;.App &#123;  width: 600px;  height: 700px;  background-color: #87ceeb;  margin: 0 auto;  padding: 20px;&#125;&lt;/style&gt;</code></pre><p>å…¨å±€æ³¨å†Œæ³¨å†Œåˆ°mian.js</p><p>ç”¨Vue.component(â€˜HmButtonâ€™, HmButton)</p><pre><code>// æ–‡ä»¶æ ¸å¿ƒä½œç”¨ï¼šå¯¼å…¥App.vueï¼ŒåŸºäºApp.vueåˆ›å»ºç»“æ„æ¸²æŸ“index.htmlimport Vue from &#39;vue&#39;import App from &#39;./App.vue&#39;// ç¼–å†™å¯¼å…¥çš„ä»£ç ï¼Œå¾€ä»£ç çš„é¡¶éƒ¨ç¼–å†™(è§„èŒƒ)import HmButton from &#39;./components/HmButton&#39;Vue.config.productionTip = false// è¿›è¡Œå…¨å±€æ³¨å†Œ â†’ åœ¨æ‰€æœ‰çš„ç»„ä»¶èŒƒå›´å†…éƒ½èƒ½ç›´æ¥ä½¿ç”¨// Vue.component(ç»„ä»¶åï¼Œç»„ä»¶å¯¹è±¡)Vue.component(&#39;HmButton&#39;, HmButton)// Vueå®ä¾‹åŒ–ï¼Œæä¾›renderæ–¹æ³• â†’ åŸºäºApp.vueåˆ›å»ºç»“æ„æ¸²æŸ“index.htmlnew Vue(&#123;  // render: h =&gt; h(App),  render: (createElement) =&gt; &#123;    // åŸºäºAppåˆ›å»ºå…ƒç´ ç»“æ„    return createElement(App)  &#125;&#125;).$mount(&#39;#app&#39;)</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>javascriptå…³é”®ç‚¹</title>
      <link href="/2023/07/17/javascript%E5%85%B3%E9%94%AE%E7%82%B9/"/>
      <url>/2023/07/17/javascript%E5%85%B3%E9%94%AE%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="javascriptå…³é”®ç‚¹"><a href="#javascriptå…³é”®ç‚¹" class="headerlink" title="javascriptå…³é”®ç‚¹"></a>javascriptå…³é”®ç‚¹</h1><h3 id="objectçš„å±æ€§"><a href="#objectçš„å±æ€§" class="headerlink" title="objectçš„å±æ€§"></a>objectçš„å±æ€§</h3><p>ç»™objectå¯¹è±¡æ‹“å±•ä¸€ä¸ªå±æ€§ dosomeæ–¹æ³•</p><p>è¿™é‡Œæ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥ç”¨è¿™ä¸ªæ‹“å±•æ–¹æ³•</p><pre><code>Object.prototype.dosome=functionï¼ˆï¼‰&#123;        .........&#125;</code></pre><h3 id="jsä¸­æ€æ ·å®šä¹‰ç±»"><a href="#jsä¸­æ€æ ·å®šä¹‰ç±»" class="headerlink" title="jsä¸­æ€æ ·å®šä¹‰ç±»"></a>jsä¸­æ€æ ·å®šä¹‰ç±»</h3><p><strong>æ–¹å¼ä¸€</strong></p><pre><code>function ç±»å(å½¢å‚1ï¼Œå½¢å‚....)&#123;this.å±æ€§=å‚æ•°ï¼›this.å±æ€§=å‚æ•°ï¼›.....&#125;</code></pre><p><strong>æ–¹å¼äºŒ</strong></p><pre><code>ç±»å=function(å½¢å‚1ï¼Œå½¢å‚....)&#123;this.å±æ€§=å‚æ•°ï¼›this.å±æ€§=å‚æ•°ï¼›.....&#125;</code></pre><p>è¿™é‡Œä¸ºä»€ä¹ˆè¿™ä¹ˆç†Ÿæ‚‰ï¼Ÿ</p><p>æ²¡é”™å¾ˆç†Ÿæ‚‰ï¼Œè¿™é‡Œå°±æ˜¯å‡½æ•°çš„å®šä¹‰</p><p>å…³é”®çœ‹å¦‚ä½•è°ƒç”¨</p><p>å¦‚æœç›´æ¥ä½¿ç”¨</p><pre><code>function example(å½¢å‚1ï¼Œå½¢å‚....)&#123;this.å±æ€§=å‚æ•°ï¼›this.å±æ€§=å‚æ•°ï¼›.....&#125;example();</code></pre><p>è¿™ç§å†™æ³•å³æ˜¯ç®€å•å‡½æ•°çš„è°ƒç”¨ä¸ä¼šå†æµè§ˆå™¨å †é‡Œå¼€è¾Ÿç©ºé—´</p><pre><code>function example(å½¢å‚1ï¼Œå½¢å‚....)&#123;this.å±æ€§=å‚æ•°ï¼›this.å±æ€§=å‚æ•°ï¼›.....&#125;var obj=new example();</code></pre><p>è¿™ç§å†™æ³•å³è¡¨ç¤ºåˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡</p><p>example</p><pre><code>function student(å½¢å‚1ï¼Œå½¢å‚....)&#123;this.å±æ€§=å‚æ•°ï¼›this.å±æ€§=å‚æ•°ï¼›this.work=function()&#123;    .......&#125;.....&#125;var student1=new student(x1,x2,x3);</code></pre><h4 id="è®¿é—®ä¸€ä¸ªå¯¹è±¡å±æ€§æ–¹å¼"><a href="#è®¿é—®ä¸€ä¸ªå¯¹è±¡å±æ€§æ–¹å¼" class="headerlink" title="è®¿é—®ä¸€ä¸ªå¯¹è±¡å±æ€§æ–¹å¼"></a>è®¿é—®ä¸€ä¸ªå¯¹è±¡å±æ€§æ–¹å¼</h4><p>object.å±æ€§</p><p>object[å±æ€§]</p><h4 id="null-NaN-undefineçš„åŒºåˆ«"><a href="#null-NaN-undefineçš„åŒºåˆ«" class="headerlink" title="null NaN undefineçš„åŒºåˆ«"></a>null NaN undefineçš„åŒºåˆ«</h4><p><strong>&#x3D;&#x3D;&#x3D; å’Œ&#x3D;&#x3D; å’Œ&#x3D;çš„åŒºåˆ«</strong></p><p>&#x3D;èµ‹å€¼æ“ä½œ èµ‹å€¼æ“ä½œ</p><p>&#x3D;&#x3D;æ¯”è¾ƒå€¼æ˜¯å¦ç›¸ç­‰ ç­‰åŒè¿ç®—ç¬¦</p><p>&#x3D;&#x3D;&#x3D;æ¯”è¾ƒå†…å®¹ä»¥åŠæ•°æ®ç±»å‹æ˜¯å¦ç›¸åŒ å…¨ç­‰è¿ç®—ç¬¦</p><p>typeofï¼ˆnullï¼‰ &#x3D; object</p><p>typeofï¼ˆNaNï¼‰ &#x3D;number</p><p>typeofï¼ˆundefineï¼‰ &#x3D;undefine</p><p>&#x3D;&#x3D;çš„æ—¶å€™ null&#x3D;&#x3D;undefine ä¸ºtrueå…¶ä½™çš†ä¸ºfalse</p><h1 id="jsçš„å¸¸ç”¨äº‹ä»¶æ“ä½œ"><a href="#jsçš„å¸¸ç”¨äº‹ä»¶æ“ä½œ" class="headerlink" title="jsçš„å¸¸ç”¨äº‹ä»¶æ“ä½œ"></a>jsçš„å¸¸ç”¨äº‹ä»¶æ“ä½œ</h1><p><strong>JSçš„å¸¸ç”¨äº‹ä»¶</strong>ï¼š</p><pre><code>                ï¼ˆ1ï¼‰blurå¤±å»ç„¦ç‚¹                ï¼ˆ5ï¼‰focusè·å¾—ç„¦ç‚¹                                ï¼ˆ3ï¼‰clické¼ æ ‡å•å‡»                ï¼ˆ4ï¼‰dblclické¼ æ ‡åŒå‡»                                ï¼ˆ6ï¼‰keydowné”®ç›˜æŒ‰ä¸‹                ï¼ˆ7ï¼‰keyupé”®ç›˜å¼¹èµ·                                ï¼ˆ9ï¼‰mousedowné¼ æ ‡æŒ‰ä¸‹                ï¼ˆ10ï¼‰mouseoveré¼ æ ‡ç»è¿‡                ï¼ˆ11ï¼‰mousemoveé¼ æ ‡ç§»åŠ¨                ï¼ˆ12ï¼‰mouseouté¼ æ ‡ç¦»å¼€                ï¼ˆ13ï¼‰mouseupé¼ æ ‡å¼¹èµ·                                ï¼ˆ16ï¼‰submitè¡¨å•æäº¤                ï¼ˆ14ï¼‰resetè¡¨å•é‡ç½®                                ï¼ˆ15ï¼‰selectæ–‡æœ¬è¢«é€‰å®š                ï¼ˆ2ï¼‰changeä¸‹æ‹‰åˆ—è¡¨é€‰ä¸­é¡¹æ”¹å˜ï¼Œæˆ–æ–‡æœ¬æ¡†å†…å®¹æ”¹å˜                ï¼ˆ8ï¼‰loadé¡µé¢åŠ è½½å®Œæ¯•                            æé†’ï¼šä»»ä½•ä¸€ä¸ªäº‹ä»¶éƒ½æœ‰å¯¹åº”çš„äº‹ä»¶å¥æŸ„ã€‚äº‹ä»¶å¥æŸ„æ˜¯åœ¨äº‹ä»¶åç§°å‰æ·»åŠ onå°±è¡Œã€‚</code></pre><p><strong>æ³¨æ„ï¼šå½“é¡µé¢åŠ è½½çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å®šä¹‰çš„äº‹ä»¶éƒ½ä¼šåŠ è½½ ä½†æ˜¯å¹¶ä¸ä¼šæ‰§è¡Œ</strong></p><p><strong>å½“æˆ‘ä»¬è§¦å‘åˆ°æŸä¸€äº‹ä»¶ä¹‹åä¼šè°ƒç”¨å‡½æ•° æ­¤æ—¶è°ƒç”¨å‡½æ•°çš„æ˜¯æµè§ˆå™¨çš„ç›‘å¬å™¨è°ƒç”¨çš„</strong></p><p><strong>æ­¤æ—¶è¿™äº›å‡½æ•°è¢«ç§°ä¸ºå›è°ƒå‡½æ•°</strong></p><p>BOMæ“ä½œç®€å•æ¥è¯´æ˜¯ä¿®æ”¹æµè§ˆå™¨çš„æ“ä½œæ¯”å¦‚è¿å»ºåé€€ æˆ–è€…â€¦</p><p>é¡¶çº§å¯¹è±¡å³ä¸º window.å±æ€§</p><p><strong>è·å–htmlçš„idå¯¹åº”çš„æ ‡ç­¾</strong> ä¹Ÿå°±æ˜¯DOMæ“ä½œ</p><p>é¡¶çº§å¯¹è±¡ä¸ºDocument.å¯¹è±¡</p><pre><code>alert(&quot;é˜»æ­¢ç¨‹åºçš„æ‰§è¡Œï¼&quot;)            // æ ¹æ®idè·å–å…ƒç´ /èŠ‚ç‚¹å¯¹è±¡            // åœ¨JSå½“ä¸­æœ‰ä¸€ä¸ªå†…ç½®çš„éšå«çš„å¯¹è±¡å«åš:document            // documentä»£è¡¨æ•´ä¸ªHTMLæ–‡æ¡£.            // åœ¨JSå½“ä¸­æœ‰ä¸€ä¸ªå†…ç½®çš„éšå«çš„å¯¹è±¡å«åš:window            // windowä»£è¡¨æ•´ä¸ªæµè§ˆå™¨çª—å£.            // windowå¯¹è±¡æ˜¯BOMçš„é¡¶çº§å¯¹è±¡,BOMä¸­çš„è€å¤§.            // documentå¯¹è±¡æ˜¯DOMçš„é¡¶çº§å¯¹è±¡,DOMä¸­çš„è€å¤§.            // ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´,windowæ˜¯åŒ…å«documentçš„.            var mybtnElt = document.getElementById(&quot;mybtn&quot;);                        //console.log(mybtnElt)            //alert(mybtnElt) //[object HTMLInputElement]                        // é‡ç‚¹:åœ¨JSå½“ä¸­,å½“ä½ è·å–äº†ä¸€ä¸ªèŠ‚ç‚¹ä¹‹å,è¿™ä¸ªèŠ‚ç‚¹ä¸­æœ‰ä»€ä¹ˆå±æ€§ä½ å°±å¯ä»¥&quot;ç‚¹&quot;ä»€ä¹ˆ.            //mybtnElt.type = &quot;checkbox&quot;;            //mybtnElt.type = &quot;text&quot;;            mybtnElt.value = &quot;æˆ‘æ˜¯ä¸€ä¸ªæŒ‰é’®å¯¹è±¡å“¦ï¼&quot;;</code></pre><p><strong>æ³¨å†Œäº‹ä»¶çš„ç¬¬äºŒç§æ–¹å¼</strong></p><pre><code>    /* å®šä¹‰ä¸€ä¸ªå‡½æ•° */            function sum()&#123;                console.log(&quot;sum function invoke!&quot;)            &#125;                        /* æ ¹æ®idè·å–buttonå¯¹è±¡ */            var hellobtnElt = document.getElementById(&quot;hellobtn&quot;);                        // å…ƒç´ ä¸­æœ‰ä»€ä¹ˆå±æ€§,å°±èƒ½&quot;ç‚¹&quot;ä»€ä¹ˆ.            /* è¿™è¡Œä»£ç åœ¨é¡µé¢æ‰“å¼€çš„æ—¶å€™ä¼šæ‰§è¡Œï¼Œè¿™è¡Œä»£ç æ‰§è¡Œçš„æ„ä¹‰æ˜¯ï¼šå°†sumè¿™ä¸ªå›è°ƒå‡½æ•°ç»‘å®šåˆ°hellobtnçš„clickäº‹ä»¶ä¸Š */            /* è¿™ä¸ªå›è°ƒå‡½æ•°sumåœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿclickäº‹ä»¶å‘ç”Ÿä¹‹åæ‰ä¼šè¢«ç›‘å¬å™¨è°ƒç”¨ï¼ */            //hellobtnElt.onclick = sum  //ä¸è¦è¿™æ ·å†™: hellobtnElt.onclick = sum()                        // å›è°ƒå‡½æ•°å¯ä»¥æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°            // è¿™è¡Œä»£ç çš„æ‰§è¡Œåªæ˜¯å®Œæˆäº‹ä»¶clickçš„æ³¨å†Œ,ç»™clickäº‹ä»¶æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°.            // è¿™è¡Œä»£ç æ‰§è¡Œçš„æ—¶å€™ï¼Œå›è°ƒå‡½æ•°å¹¶ä¸ä¼šè¢«æ‰§è¡Œã€‚            // åªæœ‰å½“è¿™ä¸ªæŒ‰é’®å‘ç”Ÿclickäº‹ä»¶ä¹‹å,è¿™ä¸ªå›è°ƒå‡½æ•°ä¼šè‡ªåŠ¨è¢«ç›‘å¬å™¨æ¥è°ƒç”¨.            hellobtnElt.onclick = function()&#123;                console.log(&quot;æˆ‘æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ŒåŒæ—¶æˆ‘æ²¡æœ‰åå­—ï¼Œå«åšåŒ¿åå‡½æ•°ï¼&quot;)            &#125;            </code></pre><h3 id="onloadäº‹ä»¶çš„ç»‘å®š"><a href="#onloadäº‹ä»¶çš„ç»‘å®š" class="headerlink" title="onloadäº‹ä»¶çš„ç»‘å®š"></a>onloadäº‹ä»¶çš„ç»‘å®š</h3><pre><code>&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=&quot;utf-8&quot;&gt;        &lt;title&gt;onloadäº‹ä»¶å¥æŸ„&lt;/title&gt;    &lt;/head&gt;    &lt;!-- é¡µé¢åŠ è½½å®Œæ¯•ä¹‹åç›‘å¬å™¨è°ƒç”¨myfun()å›è°ƒå‡½æ•° --&gt;    &lt;!-- &lt;body onload=&quot;myfun()&quot;&gt; --&gt;    &lt;!-- &lt;body id=&quot;mybody&quot;&gt; --&gt;    &lt;body&gt;                &lt;script type=&quot;text/javascript&quot;&gt;                        /* function myfun()&#123;                console.log(&quot;myfun execute!~~~~~~~~~~~~~~&quot;)            &#125; */                        // è¿™ç§æ–¹å¼å¯ä»¥,å°±æ˜¯ä»£ç æœ‰ç‚¹å¤š,åœ¨JSå½“ä¸­,windowå¯¹è±¡ä¹Ÿå¯ä»¥onload.            //var mybodyElt = document.getElementById(&quot;mybody&quot;);            //mybodyElt.onload = myfun                        /* åœ¨é¡µé¢æ‰“å¼€çš„æ—¶å€™ï¼Œä»¥ä¸‹è¿™è¡Œä»£ç ä¼šæ‰§è¡Œï¼Œè¿™è¡Œä»£ç æ‰§è¡Œçš„ä½œç”¨æ˜¯ï¼šå°†å›è°ƒå‡½æ•°myfunæ³¨å†Œåˆ°loadäº‹ä»¶ä¸Š */            /* å½“é¡µé¢å…¨éƒ¨åŠ è½½å®Œæ¯•ä¹‹åï¼Œä¼šå‘ç”Ÿloadäº‹ä»¶ï¼Œloadäº‹ä»¶å‘ç”Ÿä¹‹åï¼Œç›‘å¬å™¨è´Ÿè´£è°ƒç”¨å›è°ƒå‡½æ•°myfun */            //window.onload = myfun                        // loadäº‹ä»¶å‘ç”Ÿä¹‹å,åé¢çš„â€œåŒ¿åå›è°ƒå‡½æ•°â€ä¼šè¢«ç›‘å¬å™¨è°ƒç”¨.            window.onload = function()&#123;                console.log(&quot;hello world!&quot;)            &#125;                        // é¡µé¢æ‰“å¼€çš„è¿‡ç¨‹ä¸­å®é™…ä¸Šæ˜¯å„ç§äº‹ä»¶çš„ç»‘å®š.            // ç­‰è¿™äº›äº‹ä»¶ä¸€ä¸ªä¸€ä¸ªå‘ç”Ÿä¹‹å,å›è°ƒå‡½æ•°ç»Ÿä¸€éƒ½æ˜¯ç”±ç›‘å¬å™¨æ¥è´Ÿè´£è°ƒç”¨çš„.            /* xxxElt.onclick = function()&#123;&#125;            xxxElt.onblur = function()&#123;&#125; */                    &lt;/script&gt;                    &lt;/body&gt;    &lt;/html&gt;&lt;script type=&quot;text/javascript&quot;&gt;    alert(&quot;é¡µé¢åŠ è½½è¿‡ç¨‹ä¸­ï¼&quot;)&lt;/script&gt;</code></pre><h1 id="æ•æ‰é”®ç›˜å›è½¦è¿›è¡Œç¡®è®¤ç™»é™†"><a href="#æ•æ‰é”®ç›˜å›è½¦è¿›è¡Œç¡®è®¤ç™»é™†" class="headerlink" title="æ•æ‰é”®ç›˜å›è½¦è¿›è¡Œç¡®è®¤ç™»é™†"></a>æ•æ‰é”®ç›˜å›è½¦è¿›è¡Œç¡®è®¤ç™»é™†</h1><pre><code>&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=&quot;utf-8&quot;&gt;        &lt;title&gt;æ•æ‰å›è½¦é”®ï¼ˆæ€ä¹ˆåœ¨JSä¸­æ•æ‰é”®å€¼ã€‚ï¼‰&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;                &lt;script type=&quot;text/javascript&quot;&gt;                        /* function sum(x , y)&#123;                            &#125;                        sum();            sum(1);            sum(1,2);            sum(1,2,3);            */                       /* function myfun()&#123;                console.log(&quot;æ‰§è¡Œäº†myfun....æ²¡æœ‰å‚æ•°çš„ï¼&quot;)            &#125; */                        /* function myfun(fdsafdsafds)&#123;                console.log(&quot;æ‰§è¡Œäº†myfun....æœ‰å‚æ•°çš„ï¼&quot;)            &#125;                        myfun(&quot;abc&quot;) */                                    // x, yéƒ½æ˜¯å˜é‡å,éšæ„çš„,éšä¾¿å†™.åªè¦ç¬¦åˆæ ‡è¯†ç¬¦å‘½åè§„èŒƒå°±è¡Œ.            window.onload = function(x)&#123; // xä»£è¡¨çš„å°±æ˜¯loadäº‹ä»¶å¯¹è±¡.                // ç»™id=&quot;username&quot;çš„èŠ‚ç‚¹ç»‘å®škeydownäº‹ä»¶                // åé¢çš„è¿™ä¸ªå›è°ƒå‡½æ•°æ˜¯æˆ‘ä»¬è´Ÿè´£ç¼–å†™çš„,ä½†æ˜¯è°ƒç”¨è€…æ˜¯ç›‘å¬å™¨.                // ç›‘å¬å™¨è°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°çš„æ—¶å€™ä¼šä¼ è¿‡æ¥ä¸€ä¸ªäº‹ä»¶å¯¹è±¡.                // ä½ å¦‚æœéœ€è¦ä½¿ç”¨è¿™ä¸ªäº‹ä»¶å¯¹è±¡çš„æ—¶å€™,ä½ å¯ä»¥å†™ä¸Š,ä½ ä¸éœ€è¦è¿™ä¸ªäº‹ä»¶å¯¹è±¡çš„æ—¶å€™,å¯ä»¥çœç•¥.                document.getElementById(&quot;username&quot;).onkeydown = function(y)&#123; // yä»£è¡¨çš„å°±æ˜¯ä¸€ä¸ªkeydownäº‹ä»¶å¯¹è±¡.                    //console.log(&quot;keydown.....&quot;)                    // åœ¨è¿™é‡Œæ•æ‰é”®å€¼,å½“ç”¨æˆ·æ•²å›è½¦é”®äº†,åˆ™ç™»å½•                    // æ–°çŸ¥è¯†ç‚¹:æ‰€æœ‰çš„â€œé”®ç›˜äº‹ä»¶å¯¹è±¡â€,æœ‰keyCodeå±æ€§,è¿™ä¸ªkeyCodeå±æ€§å¯ä»¥è·å–é”®å€¼.                    // keyCodeæ˜¯é”®ç›˜äº‹ä»¶å¯¹è±¡çš„å±æ€§.                    // è®°ä½:é”®ç›˜ä¸Šå›è½¦é”®çš„é”®å€¼æ°¸è¿œéƒ½æ˜¯13.ECSé”®çš„é”®å€¼æ°¸è¿œéƒ½æ˜¯27.                    if(y.keyCode == 13) &#123;                        console.log(&quot;ç™»å½•ï¼Œæ­£åœ¨è¿›è¡Œèº«ä»½è®¤è¯ï¼Œè¯·ç¨å...&quot;);                    &#125;else if(y.keyCode == 27)&#123;                        console.log(&quot;ç³»ç»Ÿå®‰å…¨é€€å‡ºäº†ï¼&quot;)                    &#125;                &#125;            &#125;                    &lt;/script&gt;                ç”¨æˆ·åï¼š&lt;input type=&quot;text&quot; id=&quot;username&quot; /&gt;            &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="äº‹ä»¶çš„å®Œç¾æ¡ˆä¾‹"><a href="#äº‹ä»¶çš„å®Œç¾æ¡ˆä¾‹" class="headerlink" title="äº‹ä»¶çš„å®Œç¾æ¡ˆä¾‹"></a>äº‹ä»¶çš„å®Œç¾æ¡ˆä¾‹</h2><pre><code>&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=&quot;utf-8&quot;&gt;        &lt;title&gt;äº‹ä»¶çš„æœ€åä¸€ä¸ªå®Œç¾çš„æ¡ˆä¾‹&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;script type=&quot;text/javascript&quot;&gt;                        /* è¿™æ®µä»£ç æœ‰3ä¸ªå›è°ƒå‡½æ•°ã€‚ */            /* æœ€å¤–å±‚çš„å›è°ƒå‡½æ•°æ˜¯åœ¨loadäº‹ä»¶å‘ç”Ÿä¹‹åæ‰ä¼šæ‰§è¡Œï¼ */            window.onload = function()&#123;                            /* //ç»™id=&quot;btn1&quot;çš„å…ƒç´ ç»‘å®šé¼ æ ‡å•å‡»                var btn1Elt = document.getElementById(&quot;btn1&quot;);                btn1Elt.onclick = function()&#123; // btn1è¢«å•å‡»clickä¹‹å,è¿™ä¸ªäº‹ä»¶å‘ç”Ÿäº†,æ‰ä¼šæ‰§è¡Œè¿™ä¸ªå›è°ƒå‡½æ•°                    console.log(&quot;æŒ‰é’®1è¢«ç‚¹å‡»äº†ï¼&quot;)                &#125;                                //ç»™id=&quot;btn2&quot;çš„å…ƒç´ ç»‘å®šé¼ æ ‡å•å‡»                var btn2Elt = document.getElementById(&quot;btn2&quot;);                btn2Elt.onclick = function()&#123;// btn2è¢«å•å‡»clickä¹‹å,è¿™ä¸ªäº‹ä»¶å‘ç”Ÿäº†,æ‰ä¼šæ‰§è¡Œè¿™ä¸ªå›è°ƒå‡½æ•°                    console.log(&quot;æŒ‰é’®2è¢«ç‚¹å‡»äº†ï¼&quot;)                &#125; */                                document.getElementById(&quot;btn1&quot;).onclick = function()&#123;                    console.log(&quot;æŒ‰é’®1å•å‡»&quot;)                &#125;                                document.getElementById(&quot;btn2&quot;).onclick = function()&#123;                    console.log(&quot;æŒ‰é’®2å•å‡»&quot;)                &#125;                                document.getElementById(&quot;username&quot;).onblur = function()&#123;                    console.log(&quot;å¤±å»ç„¦ç‚¹äº†&quot;)                &#125;                            &#125;                    &lt;/script&gt;                &lt;input type=&quot;button&quot; id=&quot;btn1&quot; value=&quot;æŒ‰é’®1&quot;/&gt;        &lt;br&gt;        &lt;input type=&quot;button&quot; id=&quot;btn2&quot; value=&quot;æŒ‰é’®2&quot;/&gt;        &lt;br&gt;        &lt;input type=&quot;text&quot; id=&quot;username&quot; /&gt;            &lt;/body&gt;&lt;/html&gt;</code></pre><h3 id="jsçš„voidå‡½æ•°"><a href="#jsçš„voidå‡½æ•°" class="headerlink" title="jsçš„voidå‡½æ•°"></a>jsçš„voidå‡½æ•°</h3><p>ä¸€èˆ¬åªç”¨åœ¨hrefåé¢ç”¨äºç‚¹å‡»ä¸è·³è½¬</p><h3 id="jsçš„å¾ªç¯è¯­å¥"><a href="#jsçš„å¾ªç¯è¯­å¥" class="headerlink" title="jsçš„å¾ªç¯è¯­å¥"></a>jsçš„å¾ªç¯è¯­å¥</h3><p>for in è¿™é‡Œé¢çš„å¾ªç¯éå†æ•°ç»„å¾—åˆ°çš„æ˜¯æ•°ç»„çš„ä¸‹æ ‡</p><pre><code>for(var index in arr)&#123;&#125;</code></pre><p>å¾ªç¯éå†ä¸€ä¸ªå¯¹è±¡çš„è¯å°±ä¼šå¾—åˆ°å¯¹è±¡çš„å±æ€§</p><pre><code>for(var å±æ€§ in person)&#123;        &#125;</code></pre><h3 id="jsçš„æ•°ç»„ä¸­çš„åŸºæœ¬æ–¹æ³•"><a href="#jsçš„æ•°ç»„ä¸­çš„åŸºæœ¬æ–¹æ³•" class="headerlink" title="jsçš„æ•°ç»„ä¸­çš„åŸºæœ¬æ–¹æ³•"></a>jsçš„æ•°ç»„ä¸­çš„åŸºæœ¬æ–¹æ³•</h3><pre><code>arr.pushï¼ˆï¼‰æ·»åŠ çš„å…ƒç´ éƒ½æ˜¯åŠ åˆ°æœ€åarr.popï¼ˆï¼‰å¼¹å‡ºæœ«å°¾å…ƒç´ å¼¹å‡ºå¹¶ä¸”æ•°ç»„é•¿åº¦å‡ä¸€å¯ä»¥æ¨¡æ‹Ÿæ ˆçš„æ•°æ®ç»“æ„å…ˆè¿›åå‡ºarr.reverse()åè½¬æ•°ç»„è¿æ¥æ•°ç»„arr.joinï¼ˆ$ï¼‰æ•°ç»„ä¸­çš„å…ƒç´ å°†æŒ‰ç…§ä¸‹æ ‡æ‹¼æ¥arr[0]$arr[1]$......</code></pre><h3 id="jsä¸­çš„æ—¥æœŸç±»å‹"><a href="#jsä¸­çš„æ—¥æœŸç±»å‹" class="headerlink" title="jsä¸­çš„æ—¥æœŸç±»å‹"></a>jsä¸­çš„æ—¥æœŸç±»å‹</h3><p>â€¦â€¦.</p><p><a href="file:///C:/Users/æå¼€æ©/AppData/Roaming/Typora/typora-user-images/image-20230716125505572.png"><img src="file:///C:/Users/%E6%9D%8E%E5%BC%80%E6%81%A9/AppData/Roaming/Typora/typora-user-images/image-20230716125505572.png" alt="image-20230716125505572"></a></p><h3 id="BOMå’ŒDOMåŒºåˆ«"><a href="#BOMå’ŒDOMåŒºåˆ«" class="headerlink" title="BOMå’ŒDOMåŒºåˆ«"></a>BOMå’ŒDOMåŒºåˆ«</h3><h4 id="1-BOMå’ŒDOMçš„åŒºåˆ«ä¸è”ç³»"><a href="#1-BOMå’ŒDOMçš„åŒºåˆ«ä¸è”ç³»" class="headerlink" title="1. BOMå’ŒDOMçš„åŒºåˆ«ä¸è”ç³»"></a>1. <strong>BOMå’ŒDOMçš„åŒºåˆ«ä¸è”ç³»</strong></h4><p>BOM: Browser Object Modelï¼ˆæµè§ˆå™¨å¯¹è±¡æ¨¡å‹ï¼‰ï¼Œé€šè¿‡BOMçš„å¯¹è±¡å’Œæ–¹æ³•å¯ä»¥å®Œæˆæµè§ˆå™¨çª—å£çš„æ“ä½œï¼Œä¾‹å¦‚ï¼šå…³é—­æµè§ˆå™¨ï¼Œå‰è¿›ï¼Œåé€€ï¼Œä¿®æ”¹åœ°å€æ ä¸Šçš„åœ°å€ç­‰ï¼Œè¿™äº›æ“ä½œéƒ½å±äºBOMã€‚BOMçš„é¡¶çº§å†…ç½®å¯¹è±¡æ˜¯windowã€‚</p><p>DOM: Document Object Modelï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰ï¼Œé€šè¿‡DOMçš„å¯¹è±¡å’Œæ–¹æ³•å¯ä»¥å®Œæˆç½‘é¡µä¸­å…ƒç´ çš„å¢åˆ æ”¹ï¼Œè®©ç½‘é¡µäº§ç”ŸåŠ¨æ€æ•ˆæœï¼ŒDOMçš„é¡¶çº§å†…ç½®å¯¹è±¡æ˜¯documentã€‚</p><p><a href="file:///C:/Users/æå¼€æ©/AppData/Local/Temp/ksohtml17920/wps2.png"><img src="file:///C:/Users/%E6%9D%8E%E5%BC%80%E6%81%A9/AppData/Local/Temp/ksohtml17920/wps2.png" alt="img"></a></p><h3 id="BOMæ“ä½œ"><a href="#BOMæ“ä½œ" class="headerlink" title="BOMæ“ä½œ"></a>BOMæ“ä½œ</h3><p>onclick&#x3D; Window.openï¼ˆâ€™ç½‘å€â€™ï¼‰</p><p>å¼€å¯ä¸€ä¸ªæ–°çª—å£</p><p><a href="file:///C:/Users/æå¼€æ©/AppData/Roaming/Typora/typora-user-images/image-20230716150220309.png"><img src="file:///C:/Users/%E6%9D%8E%E5%BC%80%E6%81%A9/AppData/Roaming/Typora/typora-user-images/image-20230716150220309.png" alt="image-20230716150220309"></a></p><p>window.confirmå¼¹çª— ç‚¹å‡»ç¡®è®¤è¿”å›true å–æ¶ˆåˆ™è¿”å›false</p><p>window.alert(å†…å®¹) å¼¹å‡ºå†…å®¹</p><p>è·³è½¬é¡µé¢å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼ï¼šï¼ˆè¿™äº›éƒ½æ˜¯å‘é€è¯·æ±‚ï¼ï¼ï¼ï¼ï¼‰</p><h3 id="JSä¸­å‘é€è¯·æ±‚çš„å‡ ç§æ–¹å¼"><a href="#JSä¸­å‘é€è¯·æ±‚çš„å‡ ç§æ–¹å¼" class="headerlink" title="JSä¸­å‘é€è¯·æ±‚çš„å‡ ç§æ–¹å¼"></a>JSä¸­å‘é€è¯·æ±‚çš„å‡ ç§æ–¹å¼</h3><pre><code>            ç¬¬ä¸€ç§æ–¹å¼ï¼šç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ ä¸Šå†™URLã€‚ï¼ˆé‡ç‚¹ï¼‰                        ç¬¬äºŒç§æ–¹å¼ï¼šå¯ä»¥ç‚¹å‡»è¶…é“¾æ¥ï¼ˆé‡ç‚¹ï¼‰                        ç¬¬ä¸‰ç§æ–¹å¼ï¼šæäº¤è¡¨å•ï¼ˆé‡ç‚¹ï¼‰                        ç¬¬å››ç§æ–¹å¼ï¼šwindow.open(url,target)  ï¼ˆäº†è§£ï¼‰                        ç¬¬äº”ç§æ–¹å¼ï¼šjsä»£ç ï¼ˆé‡ç‚¹ï¼‰                        window.location.href                        window.location                        document.location.href                        document.location                                    é€šè¿‡æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œé€šå¸¸æ˜¯ä»¥ä¸Šçš„äº”ç§æ–¹å¼ã€‚</code></pre><p>evalï¼ˆå­—ç¬¦ä¸²ï¼‰</p><p>è¿™ä¸ªå‡½æ•°å¯ä»¥è§£æå¹¶æ‰§è¡Œä»¥å­—ç¬¦ä¸²æ¥å†™çš„jsä»£ç </p><h3 id="jsä¸­çš„json-å¯¹è±¡è§£æä»¥åŠå­—ç¬¦ä¸²æ‹¼æ¥å®ç°tableä¸­çš„tbodyå†…å®¹"><a href="#jsä¸­çš„json-å¯¹è±¡è§£æä»¥åŠå­—ç¬¦ä¸²æ‹¼æ¥å®ç°tableä¸­çš„tbodyå†…å®¹" class="headerlink" title="jsä¸­çš„json å¯¹è±¡è§£æä»¥åŠå­—ç¬¦ä¸²æ‹¼æ¥å®ç°tableä¸­çš„tbodyå†…å®¹"></a>jsä¸­çš„json å¯¹è±¡è§£æä»¥åŠå­—ç¬¦ä¸²æ‹¼æ¥å®ç°tableä¸­çš„tbodyå†…å®¹</h3><pre><code>&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;    &lt;title&gt;My Cesium.js App&lt;/title&gt;   &lt;/head&gt;&lt;body&gt;            &lt;script type=&quot;text/javascript&quot;&gt;        /* ä»javaè¿‡æ¥ä¸€ä¸ªjsonæ ¼å¼çš„å­—ç¬¦ä¸² */        var fromJava = &quot;&#123;\&quot;total\&quot; : 2, \&quot;students\&quot; : [&#123;\&quot;name\&quot;:\&quot;æå››\&quot;,\&quot;age\&quot;:19&#125;,&#123;\&quot;name\&quot;:\&quot;ç‹äº”\&quot;,\&quot;age\&quot;:18&#125;]&#125;&quot;;                window.onload = function()&#123;            document.getElementById(&quot;displaybtn&quot;).onclick = function()&#123;                // è§£æä¸Šé¢çš„jsonæ ¼å¼çš„å­—ç¬¦ä¸²,å°†è§£æå‡ºæ¥çš„æ•°æ®æ”¾åˆ°tbodyå½“ä¸­.                // è½¬åŒ–jsonå¯¹è±¡                window.eval(&quot;var json = &quot; + fromJava) //jsonå¯¹è±¡æœ‰äº†.                // è®¾ç½®æ€»è®°å½•æ¡æ•°                document.getElementById(&quot;totalSpan&quot;).innerHTML = json.total;                // æ‹¼æ¥HTML                var studentArray = json.students;                var html = &quot;&quot;;                for(var i = 0; i &lt; studentArray.length; i++)&#123;                    var s = studentArray[i]                    html += &quot;&lt;tr&gt;&quot;;                    html += &quot;&lt;td&gt;&quot;+(i+1)+&quot;&lt;/td&gt;&quot;;                    html += &quot;&lt;td&gt;&quot;+s.name+&quot;&lt;/td&gt;&quot;;                    html += &quot;&lt;td&gt;&quot;+s.age+&quot;&lt;/td&gt;&quot;;                    html += &quot;&lt;/tr&gt;&quot;;                &#125;                // å°†ä»¥ä¸Šæ‹¼æ¥çš„HTMLè®¾ç½®åˆ°tbodyå½“ä¸­                document.getElementById(&quot;stutbody&quot;).innerHTML = html;            &#125;        &#125;            &lt;/script&gt;        &lt;input type=&quot;button&quot; value=&quot;æŸ¥çœ‹å­¦ç”Ÿä¿¡æ¯åˆ—è¡¨&quot; id=&quot;displaybtn&quot; /&gt;    &lt;hr &gt;        &lt;table border=&quot;1px&quot; width=&quot;40%&quot;&gt;        &lt;tr&gt;            &lt;th&gt;åºå·&lt;/th&gt;            &lt;th&gt;å­¦ç”Ÿå§“å&lt;/th&gt;            &lt;th&gt;å­¦ç”Ÿå¹´é¾„&lt;/th&gt;        &lt;/tr&gt;        &lt;tbody id=&quot;stutbody&quot;&gt;            &lt;!-- &lt;tr&gt;                &lt;td&gt;1&lt;/td&gt;                &lt;td&gt;å¼ ä¸‰&lt;/td&gt;                &lt;td&gt;20&lt;/td&gt;            &lt;/tr&gt;            &lt;tr&gt;                &lt;td&gt;2&lt;/td&gt;                &lt;td&gt;æå››&lt;/td&gt;                &lt;td&gt;22&lt;/td&gt;            &lt;/tr&gt; --&gt;        &lt;/tbody&gt;    &lt;/table&gt;    æ€»è®°å½•æ¡æ•°ï¼š&lt;span id=&quot;totalSpan&quot;&gt;0&lt;/span&gt;æ¡    &lt;!-- æ€»è®°å½•æ¡æ•°ï¼š2æ¡ --&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="æ­£åˆ™è¡¨è¾¾å¼ä¸œè¥¿"><a href="#æ­£åˆ™è¡¨è¾¾å¼ä¸œè¥¿" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼ä¸œè¥¿"></a>æ­£åˆ™è¡¨è¾¾å¼ä¸œè¥¿</h2><pre><code>&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=&quot;utf-8&quot;&gt;        &lt;title&gt;æ­£åˆ™è¡¨è¾¾å¼&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;script type=&quot;text/javascript&quot;&gt;            /*                 1ã€ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œæœ‰ä»€ä¹ˆç”¨ï¼Ÿ                    æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€é—¨ç‹¬ç«‹çš„å­¦ç§‘ï¼ŒåŸºæœ¬æ¯ä¸ªè¯­è¨€éƒ½æ”¯æŒã€‚                    æ­£åˆ™è¡¨è¾¾å¼ä¸æ˜¯JSä¸“å±çš„ã€‚ä¸è¿‡åœ¨JSä¸­ä½¿ç”¨å±…å¤šã€‚                    é€šå¸¸ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œå­—ç¬¦ä¸²æ ¼å¼åŒ¹é…ã€‚                                        æ­£åˆ™è¡¨è¾¾å¼æ˜¯æœ‰ä¸€å †ç‰¹æ®Šçš„ç¬¦å·ç»„æˆçš„ä¸€ä¸ªè¡¨è¾¾å¼ã€‚                    æ¯ä¸€ä¸ªç‰¹æ®Šçš„ç¬¦å·éƒ½æœ‰ç‰¹æ®Šçš„ä»£è¡¨å«ä¹‰ã€‚                                        ä¾‹å¦‚ï¼š                        qqå·çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚                        é‚®ç®±åœ°å€çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚                                            é‚®ç®±åœ°å€æ ¼å¼éªŒè¯ï¼š                        ç¨‹åºä¸­æœ‰ä¸€ä¸ªé‚®ç®±åœ°å€çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚                        ç”¨æˆ·è¾“å…¥äº†ä¸€ä¸ªé‚®ç®±åœ°å€ã€‚                        é‚£ä¹ˆé‚®ç®±åœ°å€çš„æ­£åˆ™è¡¨è¾¾å¼å’Œé‚®ç®±åœ°å€è¿›è¡ŒåŒ¹é…ï¼Œèƒ½åŒ¹é…æˆåŠŸï¼Œè¡¨ç¤ºåˆæ³•ï¼Œåä¹‹è¡¨ç¤ºä¸åˆæ³•ã€‚                                        2ã€å¯¹äºjavascriptç¨‹åºå‘˜æ¥è¯´ï¼Œæˆ‘ä»¬å¯¹äºæ­£åˆ™è¡¨è¾¾å¼æŒæ¡åˆ°ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Ÿ                    ç¬¬ä¸€ï¼šèƒ½å¤Ÿçœ‹æ‡‚æ­£åˆ™è¡¨è¾¾å¼                    ç¬¬äºŒï¼šç®€å•çš„æ­£åˆ™è¦ä¼šå†™                    ç¬¬ä¸‰ï¼šè¦èƒ½å¤Ÿç‹¬ç«‹çš„ä»ç½‘ç»œå½“ä¸­æœç´¢åˆ°ä½ æƒ³è¦çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæœç´¢èƒ½åŠ›è¦æœ‰ï¼‰                    ç¬¬å››ï¼šè¦ä¼šåˆ›å»ºJSçš„æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ã€‚                    ç¬¬äº”ï¼šè¦ä¼šè°ƒç”¨JSæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡çš„æ–¹æ³•ã€‚                                3ã€å¸¸è§çš„æ­£åˆ™è¡¨è¾¾å¼ç¬¦å·æœ‰å“ªäº›ï¼Ÿ                    . åŒ¹é…é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦                     \w åŒ¹é…å­—æ¯æˆ–æ•°å­—æˆ–ä¸‹åˆ’çº¿æˆ–æ±‰å­—                     \s åŒ¹é…ä»»æ„çš„ç©ºç™½ç¬¦                     \d åŒ¹é…æ•°å­—                     \b åŒ¹é…å•è¯çš„å¼€å§‹æˆ–ç»“æŸ                     ^ åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹                     $ åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸ                                         * é‡å¤é›¶æ¬¡æˆ–æ›´å¤šæ¬¡ 0-Næ¬¡                    + é‡å¤ä¸€æ¬¡æˆ–æ›´å¤šæ¬¡  1-Næ¬¡                    ? é‡å¤é›¶æ¬¡æˆ–ä¸€æ¬¡  0æˆ–1æ¬¡                    &#123;n&#125; é‡å¤næ¬¡  næ¬¡                    &#123;n,&#125; é‡å¤næ¬¡æˆ–æ›´å¤šæ¬¡  n+æ¬¡                    &#123;n,m&#125; é‡å¤nåˆ°mæ¬¡  nåˆ°mæ¬¡                    æ³¨æ„ï¼šæ•°é‡æ°¸è¿œåŒ¹é…çš„éƒ½æ˜¯å‰é¢çš„é‚£ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ã€‚                                        \W åŒ¹é…ä»»æ„ä¸æ˜¯å­—æ¯ï¼Œæ•°å­—ï¼Œä¸‹åˆ’çº¿ï¼Œæ±‰å­—çš„å­—ç¬¦                     \S åŒ¹é…ä»»æ„ä¸æ˜¯ç©ºç™½ç¬¦çš„å­—ç¬¦                     \D åŒ¹é…ä»»æ„éæ•°å­—çš„å­—ç¬¦                     \B åŒ¹é…ä¸æ˜¯å•è¯å¼€å¤´æˆ–ç»“æŸçš„ä½ç½®                     [^x] åŒ¹é…é™¤äº†xä»¥å¤–çš„ä»»æ„å­—ç¬¦                     [^aeiou] åŒ¹é…é™¤äº†aeiouè¿™å‡ ä¸ªå­—æ¯ä»¥å¤–çš„ä»»æ„å­—ç¬¦                                         | è¡¨ç¤ºæˆ–è€…                                        [a-z]&#123;1&#125; aåˆ°zæ‰€æœ‰çš„å­—ç¬¦ä¸­çš„ä»»æ„1ä¸ªã€‚                                        [a-zA-Z0-9]&#123;3,&#125; å‰é¢è¿™å †ä¸­çš„ä»»æ„å­—ç¬¦è‡³å°‘å‡ºç°3ä¸ªã€‚                                        [1-9][0-9]&#123;4,&#125;    qqå·çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæœ€å°çš„qqå·æ˜¯10000                                        [1-9] æ²¡æœ‰æŒ‡å®šæ•°é‡çš„æ—¶å€™ï¼Œé»˜è®¤æ˜¯1ä¸ªã€‚                                    4ã€é‚®ç®±çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š                    ^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$                    è¿™ä¸ªé‚®ç®±åœ°å€ä»ç½‘ä¸Šæ‰¾äº†ä¹‹åä¸ä¸€å®šèƒ½ç”¨ï¼Œä½ éœ€è¦æµ‹è¯•ã€‚åå¤æµ‹è¯•ã€‚                                5ã€åœ¨JSä¸­æ€ä¹ˆåˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡å‘¢ï¼Ÿ                                    åŒ…æ‹¬ä¸¤ç§æ–¹å¼ï¼Œé‡ç‚¹ä½¿ç”¨ç¬¬ä¸€ç§                                        ç¬¬ä¸€ç§æ–¹å¼ï¼šç›´æ¥é‡è¯­æ³•                        var regExp = /æ­£åˆ™è¡¨è¾¾å¼/æ ‡è®°                                            ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨å†…ç½®ç±»RegExpç±»ã€‚                        var regExp = new RegExp(&quot;æ­£åˆ™è¡¨è¾¾å¼&quot;, &quot;æ ‡è®°&quot;)                                        æ ‡è®°æ˜¯å¯é€‰é¡¹ï¼ï¼ï¼ï¼ï¼éƒ½æœ‰å“ªäº›å€¼å¯é€‰å‘¢ï¼Ÿ                        gï¼šå…¨å±€ global                        i: å¿½ç•¥å¤§å°å†™ ignorecase                        gi: å…¨å±€æ‰«æï¼Œå¹¶ä¸”å¿½ç•¥å¤§å°å†™ã€‚                                6ã€æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ–¹æ³•ï¼š                    var emailRegExp = /^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/                    var ok = emailRegExp.test(&quot;ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²&quot;);                    è¿”å›å€¼okæ˜¯trueè¡¨ç¤ºï¼ŒåŒ¹é…æˆåŠŸäº†ã€‚                                        å…¶å®åœ¨JSä¸­ï¼Œå­—ç¬¦ä¸²Stringä¹Ÿæ˜¯æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼çš„ã€‚             */            // å­—ç¬¦ä¸²å¯¹è±¡ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼            console.log(&quot;1980-11-10&quot;.replace(&quot;-&quot;, &quot;/&quot;))            // gè¡¨ç¤ºglobalå…¨å±€çš„,æ‰€æœ‰çš„ - æ›¿æ¢æˆ/            console.log(&quot;1980-11-10&quot;.replace(/-/g, &quot;/&quot;))                        function checkEmail()&#123;                //è·å–é‚®ç®±åœ°å€                var email = document.getElementById(&quot;email&quot;).value;                // åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡                var regExp = /^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;                // éªŒè¯                var ok = regExp.test(email);                if(ok)&#123;                    alert(&quot;é‚®ç®±åœ°å€åˆæ³•&quot;)                &#125;else&#123;                    alert(&quot;é‚®ç®±åœ°å€ä¸åˆæ³•&quot;);                &#125;            &#125;                    &lt;/script&gt;                é‚®ç®±åœ°å€ï¼š&lt;input type=&quot;text&quot; id=&quot;email&quot; /&gt;        &lt;input type=&quot;button&quot; value=&quot;éªŒè¯é‚®ç®±åœ°å€&quot; onclick=&quot;checkEmail()&quot;/&gt;    &lt;/body&gt;&lt;/html&gt;</code></pre><h3 id="è¡¨å•çš„éªŒè¯å®ç°"><a href="#è¡¨å•çš„éªŒè¯å®ç°" class="headerlink" title="è¡¨å•çš„éªŒè¯å®ç°"></a>è¡¨å•çš„éªŒè¯å®ç°</h3><pre><code>&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=&quot;utf-8&quot;&gt;        &lt;title&gt;&lt;/title&gt;                &lt;style type=&quot;text/css&quot;&gt;            span &#123;                font-size: 12px;                color: red;            &#125;        &lt;/style&gt;            &lt;/head&gt;    &lt;body&gt;        &lt;script type=&quot;text/javascript&quot;&gt;            /*             ï¼ˆ1ï¼‰ç”¨æˆ·åä¸èƒ½ä¸ºç©º            ï¼ˆ2ï¼‰ç”¨æˆ·åå¿…é¡»åœ¨6-14ä½ä¹‹é—´            ï¼ˆ3ï¼‰ç”¨æˆ·ååªèƒ½æœ‰æ•°å­—å’Œå­—æ¯ç»„æˆï¼Œä¸èƒ½å«æœ‰å…¶å®ƒç¬¦å·ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰            ï¼ˆ4ï¼‰å¯†ç å’Œç¡®è®¤å¯†ç ä¸€è‡´            ï¼ˆ5ï¼‰ç»Ÿä¸€å¤±å»ç„¦ç‚¹éªŒè¯            ï¼ˆ6ï¼‰é”™è¯¯æç¤ºä¿¡æ¯ç»Ÿä¸€åœ¨spanæ ‡ç­¾ä¸­æç¤ºï¼Œå¹¶ä¸”è¦æ±‚å­—ä½“12å·ï¼Œçº¢è‰²ã€‚            ï¼ˆ7ï¼‰æ–‡æœ¬æ¡†å†æ¬¡è·å¾—ç„¦ç‚¹åï¼Œæ¸…ç©ºé”™è¯¯æç¤ºä¿¡æ¯            ï¼ˆ8ï¼‰æœ€ç»ˆè¡¨å•ä¸­æ‰€æœ‰é¡¹å‡åˆæ³•æ–¹å¯æäº¤             */            window.onload = function()&#123;                                var nameErrorSpan = document.getElementById(&quot;nameError&quot;);                                // ç»™id=&quot;username&quot;çš„èŠ‚ç‚¹ç»‘å®šbluräº‹ä»¶                var usernameElt = document.getElementById(&quot;username&quot;);                usernameElt.onblur = function()&#123;                    // è·å–ç”¨æˆ·å                    var username = usernameElt.value;                    // å»é™¤æ‰å‰åç©ºç™½                    username = username.trim();                    // ç”¨æˆ·åä¸èƒ½ä¸ºç©º,ä¸èƒ½ä¸ºç©ºä¸²                    //if(username.length == 0)&#123;&#125;                    if(username == &quot;&quot;)&#123;                        nameErrorSpan.innerHTML = &quot;ç”¨æˆ·åä¸èƒ½ä¸ºç©º&quot;;                    &#125;else&#123;                        // ç”¨æˆ·åä¸æ˜¯ç©º,ç»§ç»­åˆ¤æ–­é•¿åº¦æ˜¯å¦åˆæ³•                        if(username.length &lt; 6 || username.length &gt; 14)&#123;                            nameErrorSpan.innerHTML = &quot;ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨[6-14]ä¹‹é—´&quot;;                        &#125;else&#123;                            // ç”¨æˆ·åä¸ä¸ºç©º,å¹¶ä¸”é•¿åº¦ä¹Ÿåˆæ³•,æ¥ä¸‹æ¥ç»§ç»­åˆ¤æ–­ç”¨æˆ·åä¸­æ˜¯å¦æœ‰ç‰¹æ®Šç¬¦å·                            var regExp = /^[a-zA-Z0-9]+$/                            var ok = regExp.test(username)                            if(ok)&#123;                                // åˆæ³•                                nameErrorSpan.innerHTML = &quot;&quot;;                            &#125;else&#123;                                // ä¸åˆæ³•                                nameErrorSpan.innerHTML = &quot;ç”¨æˆ·ååªèƒ½ç”±æ•°å­—å’Œå­—æ¯ç»„æˆ&quot;;                            &#125;                        &#125;                    &#125;                &#125;                                // è·å¾—ç„¦ç‚¹:æ¸…ç©ºspançš„é”™è¯¯ä¿¡æ¯.                usernameElt.onfocus = function()&#123;                    nameErrorSpan.innerHTML = &quot;&quot;;                &#125;                                var pwdErrorSpan = document.getElementById(&quot;pwdError&quot;);                // ç¡®è®¤å¯†ç å¤±å»ç„¦ç‚¹å°±éªŒè¯.                document.getElementById(&quot;confirmpwd&quot;).onblur = function()&#123;                    //è·å–å¯†ç                     var userpwd = document.getElementById(&quot;userpwd&quot;).value;                    //è·å–ç¡®è®¤å¯†ç                     var confirmpwd = document.getElementById(&quot;confirmpwd&quot;).value;                    //è¿›è¡Œæ¯”å¯¹                    if(userpwd != confirmpwd)&#123;                        pwdErrorSpan.innerHTML = &quot;å¯†ç å’Œç¡®è®¤å¯†ç ä¸ä¸€è‡´&quot;;                    &#125;else&#123;                        pwdErrorSpan.innerHTML = &quot;&quot;;                    &#125;                &#125;                                                document.getElementById(&quot;confirmpwd&quot;).onfocus = function()&#123;                    pwdErrorSpan.innerHTML = &quot;&quot;;                &#125;                                document.getElementById(&quot;regbtn&quot;).onclick = function()&#123;                                        // éªŒè¯ç”¨æˆ·å,æ€ä¹ˆéªŒè¯ç”¨æˆ·åï¼Ÿè®©ç”¨æˆ·åæ–‡æœ¬æ¡†å¤±å»ç„¦ç‚¹                    // é‡ç‚¹:ä½¿ç”¨JSä»£ç æ€ä¹ˆè§¦å‘äº‹ä»¶ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ                    usernameElt.focus(); //è§¦å‘æ–‡æœ¬æ¡†çš„è·å–ç„¦ç‚¹äº‹ä»¶                    usernameElt.blur();//è§¦å‘æ–‡æœ¬æ¡†çš„å¤±å»ç„¦ç‚¹äº‹ä»¶                                        // éªŒè¯å¯†ç ,æ€ä¹ˆéªŒè¯å¯†ç ï¼Ÿè®©ç¡®è®¤å¯†ç å¤±å»ç„¦ç‚¹                    document.getElementById(&quot;confirmpwd&quot;).focus();                    document.getElementById(&quot;confirmpwd&quot;).blur();                                        // å½“æ‰€æœ‰çš„spanéƒ½æ˜¯ç©ºçš„è¡¨ç¤ºè¡¨å•åˆæ³•                    if(nameErrorSpan.innerHTML == &quot;&quot; &amp;&amp; pwdErrorSpan.innerHTML == &quot;&quot;)&#123;                        //æäº¤                        var formObj = document.getElementById(&quot;userForm&quot;);                        // é€šè¿‡è°ƒç”¨submit()æ–¹æ³•æ¥å®Œæˆè¡¨å•çš„æäº¤                        formObj.submit();                    &#125;                &#125;            &#125;                    &lt;/script&gt;                &lt;form id=&quot;userForm&quot; action=&quot;http://localhost:8080/oa/save&quot;&gt;            ç”¨æˆ·å&lt;input type=&quot;text&quot; name=&quot;username&quot; id=&quot;username&quot;/&gt;&lt;span id=&quot;nameError&quot;&gt;&lt;/span&gt;            &lt;br&gt;            å¯†ç &lt;input type=&quot;password&quot; name=&quot;userpwd&quot; id=&quot;userpwd&quot;/&gt;            &lt;br&gt;            &lt;!-- ç¡®è®¤å¯†ç æ˜¯ä¸éœ€è¦æäº¤ç»™æœåŠ¡å™¨çš„ï¼Œè¿™ä¸ªnameä¸è¦å†™ï¼ --&gt;            ç¡®è®¤å¯†ç &lt;input type=&quot;password&quot; id=&quot;confirmpwd&quot;/&gt; &lt;span id=&quot;pwdError&quot;&gt;&lt;/span&gt;            &lt;br&gt;            &lt;!-- è¡¨å•æ‰€æœ‰é¡¹ç›®éƒ½åˆæ³•æ‰èƒ½æäº¤ --&gt;            &lt;!-- &lt;input type=&quot;submit&quot; value=&quot;æ³¨å†Œ&quot; /&gt; --&gt;            &lt;!-- buttonä¸èƒ½æäº¤è¡¨å•ï¼Œä½†æ˜¯JSä»£ç å¯ä»¥æäº¤è¡¨å• --&gt;            &lt;input type=&quot;button&quot; value=&quot;æ³¨å†Œ&quot; id=&quot;regbtn&quot;/&gt;        &lt;/form&gt;             &lt;/body&gt;&lt;/html&gt;</code></pre><h1 id="AJAXå‘é€å¼‚æ­¥è¯·æ±‚è¿‡ç¨‹"><a href="#AJAXå‘é€å¼‚æ­¥è¯·æ±‚è¿‡ç¨‹" class="headerlink" title="AJAXå‘é€å¼‚æ­¥è¯·æ±‚è¿‡ç¨‹"></a>AJAXå‘é€å¼‚æ­¥è¯·æ±‚è¿‡ç¨‹</h1><p>è¿™ä¸ªè¿‡ç¨‹æ˜¯åˆ©ç”¨äº†</p><p>var xhr &#x3D;new XMLHttpRequest();</p><p>è¿™ä¸ªå¼‚æ­¥è¯·æ±‚å¯¹è±¡</p><p>å¹¶ä¸”å°†è¡¨å•çš„ä½“æ£€æŒ‰é’®æ¢æˆbutton å¹¶ä¸”è®¾ç½®å•å‡»äº‹ä»¶</p><p>æ ¹æ®jsçš„å‡½æ•°å¯ä»¥å‘é€è¯·æ±‚å®ç°æ­¤è¿‡ç¨‹</p><pre><code>function å‡½æ•°ï¼ˆï¼‰&#123;//1.0åˆ›å»ºå¼‚æ­¥å¯¹è±¡var xhr =new XMLHttpRequest();//2.ç»‘å®šäº‹ä»¶xhr.onreadystatechange=function()&#123;    if(xhr.readyState==4&amp;&amp;xhr.status==20)&#123;    //è·å–æ•°æ®    var data =xhr.responseTextï¼›    //æ›´æ–°dom    .......è·å–æ•°æ®ç»‘å®šåˆ°æ ‡ç­¾ä¸Šé¢    &#125;&#125;    //3.åˆå§‹åŒ–è¯·æ±‚å‚æ•°    //queryNameproid=1    xhr.openï¼ˆâ€getâ€œï¼ŒURLï¼Œtrueï¼‰ï¼›        //4.å‘èµ·è¯·æ±‚    xhr.sendï¼›&#125;function å‡½æ•°ï¼ˆï¼‰&#123;//1.0åˆ›å»ºå¼‚æ­¥å¯¹è±¡var xhr =new XMLHttpRequest();//2.ç»‘å®šäº‹ä»¶xhr.onreadystatechange=function()&#123;    if(xhr.readyState==4&amp;&amp;xhr.status==20)&#123;    //è·å–æ•°æ®    var data =xhr.responseTextï¼›    //è¿”å›å¯¹è±¡å¦‚æœæ˜¯jsonæ ¼å¼é‚£ä¹ˆéœ€è¦å»è½¬æ¢ä¸ªæ ¼å¼    var obj=json.parse(data);    //æ›´æ–°dom    .......è·å–æ•°æ®ç»‘å®šåˆ°æ ‡ç­¾ä¸Šé¢    &#125;&#125;    //3.åˆå§‹åŒ–è¯·æ±‚å‚æ•°    //queryNameproid=1    xhr.openï¼ˆâ€getâ€œï¼ŒURLï¼Œtrueï¼‰ï¼›        //4.å‘èµ·è¯·æ±‚    xhr.sendï¼›&#125;</code></pre><h1 id="ç¬¬ä¸€ç« -Ajax-å‰ç«¯æŠ€æœ¯"><a href="#ç¬¬ä¸€ç« -Ajax-å‰ç«¯æŠ€æœ¯" class="headerlink" title="ç¬¬ä¸€ç«  Ajax å‰ç«¯æŠ€æœ¯"></a>ç¬¬ä¸€ç«  Ajax å‰ç«¯æŠ€æœ¯</h1><p>å‰ç«¯æŠ€æœ¯ï¼š åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œçš„ç¨‹åºéƒ½æ˜¯å‰ç«¯ï¼Œ html ï¼Œ cssï¼Œjsç­‰ç­‰</p><p>åç«¯æŠ€æœ¯ï¼šåœ¨æœåŠ¡å™¨ä¸­æ‰§è¡Œçš„ç¨‹åºï¼Œ ä½¿ç”¨javaè¯­è¨€å¼€å‘çš„åç«¯ç¨‹åºã€‚ servlet,jsp, jdbc,mysql,tomcatç­‰ç­‰</p><h1 id="1-å…¨å±€åˆ·æ–°å’Œå±€éƒ¨åˆ·æ–°"><a href="#1-å…¨å±€åˆ·æ–°å’Œå±€éƒ¨åˆ·æ–°" class="headerlink" title="1 å…¨å±€åˆ·æ–°å’Œå±€éƒ¨åˆ·æ–°"></a>1 å…¨å±€åˆ·æ–°å’Œå±€éƒ¨åˆ·æ–°</h1><p>1ï¼‰å…¨å±€åˆ·æ–°ï¼š ä½¿ç”¨formï¼Œ hrefç­‰å‘èµ·çš„è¯·æ±‚æ˜¯å…¨å±€åˆ·æ–°ã€‚</p><p> ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼Œ è§†å›¾æ”¹å˜äº†ï¼Œ è·³è½¬è§†å›¾ï¼Œä½¿ç”¨æ–°çš„æ•°æ®æ·»åŠ åˆ°é¡µé¢ã€‚</p><p>ç¼ºç‚¹ï¼š</p><pre><code> 1. ä¼ é€’æ•°æ®é‡æ¯”è¾ƒå¤§ã€‚ å ç”¨ç½‘ç»œçš„å¸¦å®½    2. æµè§ˆå™¨éœ€è¦é‡æ–°çš„æ¸²æŸ“æ•´ä¸ªé¡µé¢ã€‚     3. ç”¨æˆ·çš„ä½“éªŒä¸æ˜¯é‚£ä¹ˆå¥½</code></pre><p>2ï¼‰å±€éƒ¨åˆ·æ–°ï¼š åœ¨å½“å‰é¡µé¢ä¸­ï¼Œå‘èµ·è¯·æ±‚ï¼Œè·å–æ•°æ®ï¼Œæ›´æ–°å½“å‰é¡µé¢çš„domå¯¹è±¡ã€‚ å¯¹è§†å›¾éƒ¨åˆ†åˆ·æ–°ã€‚</p><p> ç‰¹ç‚¹ï¼š</p><pre><code> 1. æ•°é‡æ¯”è¾ƒå°ï¼Œ åœ¨ç½‘ç»œä¸­ä¼ è¾“é€Ÿåº¦å¿«ã€‚    2. æ›´æ–°é¡µé¢å†…å®¹ï¼Œ æ˜¯éƒ¨åˆ†æ›´æ–°é¡µé¢ï¼Œ æµè§ˆå™¨ä¸ç”¨å…¨éƒ¨æ¸²æŸ“è§†å›¾ã€‚    3. åœ¨ä¸€ä¸ªé¡µé¢ä¸­ï¼Œå¯ä»¥åšå¤šä¸ª å±€éƒ¨åˆ·æ–°    4. ä»æœåŠ¡å™¨è·å–çš„æ˜¯æ•°æ®ï¼Œ æ‹¿åˆ°æ›´æ–°è§†å›¾</code></pre><h1 id="2-å¼‚æ­¥è¯·æ±‚å¯¹è±¡"><a href="#2-å¼‚æ­¥è¯·æ±‚å¯¹è±¡" class="headerlink" title="2 å¼‚æ­¥è¯·æ±‚å¯¹è±¡"></a>2 å¼‚æ­¥è¯·æ±‚å¯¹è±¡</h1><p>åœ¨å±€éƒ¨åˆ·æ–°ä¸­ï¼Œä½¿ç”¨å¼‚æ­¥è¯·æ±‚å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨å†…éƒ¨å‘èµ·è¯·æ±‚ï¼Œè·å–æ•°æ®ã€‚</p><p><a href="file:///E:/BaiduNetdiskDownload/HTML+css+JavaScriptèµ„æ–™/06-ç¬”è®°/Ajax/images/image-20201012092218113.png"><img src="file:///E:/BaiduNetdiskDownload/HTML+css+JavaScript%E8%B5%84%E6%96%99/06-%E7%AC%94%E8%AE%B0/Ajax/images/image-20201012092218113.png" alt="image-20201012092218113"></a></p><p>å¼‚æ­¥å¯¹è±¡æ˜¯åœ¨æµè§ˆå™¨å†…éƒ¨çš„ä¸€ç§ javascriptå¯¹è±¡ã€‚ å„å¤§æµè§ˆå™¨éƒ½èƒ½æ”¯æŒå¼‚æ­¥å¯¹è±¡çš„ä½¿ç”¨ã€‚chrome ,firework, ie, opper ,</p><p>å¼‚æ­¥å¯¹è±¡ XMLHttpRequest</p><h1 id="3-å¼‚æ­¥å¯¹è±¡XMLHttpRequestä»‹ç»"><a href="#3-å¼‚æ­¥å¯¹è±¡XMLHttpRequestä»‹ç»" class="headerlink" title="3. å¼‚æ­¥å¯¹è±¡XMLHttpRequestä»‹ç»"></a>3. å¼‚æ­¥å¯¹è±¡XMLHttpRequestä»‹ç»</h1><p>jsä¸­çš„ä¸€ç§å¯¹è±¡ï¼Œ ä½¿ç”¨jsè¯­æ³•åˆ›å»ºå’Œä½¿ç”¨è¿™ä¸ªå¯¹è±¡ã€‚</p><p>var xhr &#x3D; new XMLHttpRequest();</p><p>ä¹‹åå°±å¯ä»¥ ä½¿ç”¨xhrå¯¹è±¡çš„å±æ€§æˆ–è€…å‡½æ•°ï¼Œè¿›è¡Œå¼‚æ­¥å¯¹è±¡çš„æ“ä½œã€‚</p><p>ä½¿ç”¨å¼‚æ­¥å¯¹è±¡å®ç°å±€éƒ¨åˆ·æ–°ï¼Œ å¼‚æ­¥å¯¹è±¡ä¸»è¦è´Ÿè´£å‘èµ·è¯·æ±‚ï¼Œä¼ é€’è¯·æ±‚çš„å‚æ•°ï¼Œå¹¶ä»æœåŠ¡å™¨æ¥æ”¶æ•°æ®ã€‚</p><p>å±€éƒ¨åˆ·æ–°éœ€è¦ä½¿ç”¨é‚£äº›æŠ€æœ¯ï¼š</p><p>1ï¼‰javascript ï¼š åˆ›å»ºXMLHttpRequestå¯¹è±¡ï¼Œ è°ƒç”¨å®ƒçš„å±æ€§æˆ–è€…æ–¹æ³•</p><p>2ï¼‰domï¼šå¤„ç†domï¼Œæ›´æ–°selectçš„æ•°æ®</p><p>3ï¼‰css: å¤„ç†è§†å›¾ï¼Œ æ›´æ–°ï¼Œç¾åŒ–ã€‚</p><p>4ï¼‰servletï¼šæœåŠ¡å™¨ç«¯æŠ€æœ¯</p><p>5ï¼‰æ•°æ®æ ¼å¼ï¼šjsonã€‚ å®ƒä¹‹å‰æ˜¯xml</p><p>æŠŠä¸Šé¢è¿™äº›æŠ€æœ¯çš„ç»¼åˆä½¿ç”¨å«åšajaxï¼ˆé˜¿è´¾å…‹æ–¯ï¼‰ã€‚</p><h1 id="4-Ajax"><a href="#4-Ajax" class="headerlink" title="4 Ajax"></a>4 Ajax</h1><p>AJAX &#x3D; Asynchronous JavaScript and XMLï¼ˆå¼‚æ­¥çš„ JavaScript å’ŒXMLï¼‰ã€‚<br>AJAX æ˜¯ä¸€ç§åœ¨æ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªç½‘é¡µçš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿæ›´æ–°éƒ¨åˆ†é¡µé¢å†…å®¹çš„æ–°æ–¹æ³•</p><p>AJAXä¸æ˜¯æ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒæ˜¯å¤šç§æŠ€æœ¯çš„ç»¼åˆä½¿ç”¨ã€‚ åŒ…å«äº†javascript, dom</p><p>,css, æœåŠ¡å™¨ç«¯æŠ€æœ¯ï¼Œ servlet ï¼Œjsp ï¼Œjdbcç­‰ç­‰ï¼Œ è¿˜æœ‰ jsonæ•°æ®æ ¼å¼ã€‚</p><p>ä½¿ç”¨AJAXå®ç°å±€éƒ¨åˆ·æ–°ã€‚</p><p>Ajaxæ ¸å¿ƒæ˜¯ javascript å’Œ xml ï¼ˆjsonï¼‰ï¼šä½¿ç”¨javascriptæ“ä½œå¼‚æ­¥å¯¹è±¡XMLHttpRequest. å’ŒæœåŠ¡å™¨äº¤æ¢ä½¿ç”¨jsonæ•°æ®æ ¼å¼ã€‚</p><h1 id="5-å¼‚æ­¥å¯¹è±¡XMLHttpRequestå±æ€§å’Œæ–¹æ³•"><a href="#5-å¼‚æ­¥å¯¹è±¡XMLHttpRequestå±æ€§å’Œæ–¹æ³•" class="headerlink" title="5. å¼‚æ­¥å¯¹è±¡XMLHttpRequestå±æ€§å’Œæ–¹æ³•"></a>5. å¼‚æ­¥å¯¹è±¡XMLHttpRequestå±æ€§å’Œæ–¹æ³•</h1><ol><li><p>åˆ›å»ºå¼‚æ­¥å¯¹è±¡ï¼Œä½¿ç”¨jsçš„è¯­æ³•</p><p>var xhr &#x3D; new XMLHttpRequest();</p></li><li><p>XMLHttpRequestæ–¹æ³•</p><p>â‘ ï¼‰open(è¯·æ±‚æ–¹å¼, æœåŠ¡å™¨ç«¯çš„è®¿é—®åœ°å€ï¼Œå¼‚æ­¥è¿˜æ˜¯åŒæ­¥)</p><p>ä¾‹å¦‚ï¼šxhr.open(â€œgetâ€,â€loginServletâ€,true);</p><p>â‘¡ï¼‰send(): ä½¿ç”¨å¼‚æ­¥å¯¹è±¡å‘é€è¯·æ±‚</p></li><li><p>XMLHttpRequestå±æ€§</p><p>readyStateå±æ€§ï¼šè¯·æ±‚çš„çŠ¶æ€</p><p> 0ï¼šè¡¨ç¤ºåˆ›å»ºå¼‚æ­¥å¯¹è±¡æ—¶ï¼Œnew XMLHttpRequest();</p><p> 1ï¼šè¡¨ç¤ºåˆå§‹å¼‚æ­¥å¯¹è±¡çš„è¯·æ±‚å‚æ•°ã€‚ æ‰§è¡Œopen()æ–¹æ³•</p><p> 2ï¼šä½¿ç”¨send()æ–¹æ³•å‘é€è¯·æ±‚ã€‚</p><p> 3ï¼šä½¿ç”¨å¼‚æ­¥å¯¹è±¡ä»æœåŠ¡å™¨æ¥æ”¶äº†æ•°æ®</p><p> 4ï¼šå¼‚æ­¥å¯¹è±¡æ¥æ”¶äº†æ•°æ®ï¼Œå¹¶åœ¨å¼‚æ­¥å¯¹è±¡å†…éƒ¨å¤„ç†å®Œæˆåã€‚</p><p>statuså±æ€§ï¼šç½‘ç»œçš„çŠ¶æ€ï¼Œå’ŒHttpçš„çŠ¶æ€ç å¯¹åº”</p><p> 200ï¼šè¯·æ±‚æˆåŠŸ</p><p> 404ï¼š æœåŠ¡å™¨èµ„æºæ²¡æœ‰æ‰¾åˆ°</p><p> 500ï¼š æœåŠ¡å™¨å†…éƒ¨ä»£ç æœ‰é”™è¯¯</p><p>responseTextå±æ€§ï¼šè¡¨ç¤ºæœåŠ¡å™¨ç«¯è¿”å›çš„æ•°æ®</p><p> ä¾‹å¦‚ï¼š var data &#x3D; xhr.responseText;</p></li></ol><h1 id="6-å¼‚æ­¥å¯¹è±¡XMLHttpRequestä½¿ç”¨æ­¥éª¤"><a href="#6-å¼‚æ­¥å¯¹è±¡XMLHttpRequestä½¿ç”¨æ­¥éª¤" class="headerlink" title="6. å¼‚æ­¥å¯¹è±¡XMLHttpRequestä½¿ç”¨æ­¥éª¤"></a>6. å¼‚æ­¥å¯¹è±¡XMLHttpRequestä½¿ç”¨æ­¥éª¤</h1><p>1ï¼‰ä½¿ç”¨jsåˆ›å»ºå¼‚æ­¥å¯¹è±¡</p><p> var xhr &#x3D; new XMLHttpRequest();</p><p>2)ç»™å¼‚æ­¥å¯¹è±¡ç»‘å®šäº‹ä»¶ã€‚äº‹ä»¶åç§° onreadystatechange</p><p>ä¾‹å¦‚buttonå¢åŠ å•å‡»äº‹ä»¶ onclick</p><p>xhrç»‘å®šäº‹ä»¶</p><p>xhr.onreadysatechange&#x3D;function() { å½“äº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œçš„ä»£ç  }</p><pre><code>&lt;input type=&quot;button&quot; onclick=&quot;btnClick()&quot; /&gt;&lt;script type=&quot;text/javascript&quot;&gt;    function btnClick()&#123;       æŒ‰é’®å•å‡»çš„å¤„ç†ä»£ç          &#125;&lt;/script&gt;</code></pre><p>åœ¨ç»‘å®šäº‹ä»¶ä¸­åšä»€ä¹ˆï¼Œæ ¹æ®readyStateå€¼åšè¯·æ±‚çš„å¤„ç†</p><pre><code>xhr.readystatechagne=function()&#123;   if( xhr.readyState==4 &amp;&amp; xhr.status==200 )&#123;        ä»æœåŠ¡å™¨è·å–äº†æ•°æ®ï¼Œ æ›´æ–°å½“å‰é¡µé¢çš„domå¯¹è±¡ï¼Œå®Œæˆè¯·æ±‚çš„å¤„ç†        var data = xhr.responseText;        æ›´æ–°domå¯¹è±¡        document.getElementById(&quot;#mydiv&quot;).innertHTML = data;   &#125;&#125;</code></pre><ol><li><p>åˆå§‹è¯·æ±‚çš„å‚æ•°ï¼Œæ‰§è¡Œopen()å‡½æ•°</p><p>xhr.open(â€œgetâ€,â€loginServletâ€,true)</p></li></ol><p>4)å‘é€è¯·æ±‚ï¼Œæ‰§è¡Œsend()</p><p>xhr.send()</p><h1 id="7-ç¬¬ä¸€ä¸ªä¾‹å­"><a href="#7-ç¬¬ä¸€ä¸ªä¾‹å­" class="headerlink" title="7. ç¬¬ä¸€ä¸ªä¾‹å­"></a>7. ç¬¬ä¸€ä¸ªä¾‹å­</h1><p>ä½¿ç”¨å…¨å±€åˆ·æ–°ï¼Œ å®ç°è®¡ç®—bmi</p><p>å¯ä»¥ä½¿ç”¨jspæ˜¾ç¤ºrequestä½œç”¨åŸŸä¸­çš„æ•°æ®ï¼Œä½¿ç”¨elè¡¨è¾¾å¼</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨HttpServletResponseå¯¹è±¡è¾“å‡ºæ•°æ®ï¼Œ æ•°æ®ç»™äº†æµè§ˆå™¨ã€‚ æµè§ˆå™¨å¯ä»¥æ¥æ”¶HttpServletResponseå¯¹è±¡printçš„æ•°æ®</p><h1 id="8-åŒæ­¥è¯·æ±‚å’Œå¼‚æ­¥è¯·æ±‚"><a href="#8-åŒæ­¥è¯·æ±‚å’Œå¼‚æ­¥è¯·æ±‚" class="headerlink" title="8 åŒæ­¥è¯·æ±‚å’Œå¼‚æ­¥è¯·æ±‚"></a>8 åŒæ­¥è¯·æ±‚å’Œå¼‚æ­¥è¯·æ±‚</h1><p>çœ‹open(è¯·æ±‚æ–¹å¼ï¼Œ è®¿é—®uriåœ°å€ï¼Œbooleanæ˜¯ä¸æ˜¯å¼‚æ­¥çš„)</p><p>trueï¼šå¼‚æ­¥è¯·æ±‚</p><p>falseï¼šåŒæ­¥è¯·æ±‚</p><h1 id="ç¬¬äºŒç« -jQuery"><a href="#ç¬¬äºŒç« -jQuery" class="headerlink" title="ç¬¬äºŒç«  jQuery"></a>ç¬¬äºŒç«  jQuery</h1><ol><li><p>jqueryçš„ä»‹ç»</p><p>jqueryå°±æ˜¯jså‡½æ•°åº“ï¼Œ é‡Œé¢æœ‰å¤§é‡çš„jså‡½æ•°ï¼Œ ä½¿ç”¨è¿™äº›å‡½æ•°æ“ä½œdomå¯¹è±¡ï¼Œ åšäº‹ä»¶ï¼ŒåŠ¨ç”»ï¼Œ ajaxå¤„ç†</p><p>åœ°å€ï¼š <a href="https://jquery.com/">https://jquery.com/</a></p></li><li><p>ä¸‹è½½</p><p>ä¸‹è½½åœ°å€ï¼š<a href="https://jquery.com/download/">https://jquery.com/download/</a></p><p>å‹ç¼©ç‰ˆæœ¬ï¼š æ–‡ä»¶ä½“ç§¯æ¯”è¾ƒå°ï¼Œé€‚åˆé¡¹ç›®ä¸Šçº¿åä½¿ç”¨ã€‚ jquery-3.4.1.min.js</p><p>æœªå‹ç¼©ï¼šä½“ç§¯æ¯”è¾ƒå¤§ï¼Œå¯è¯»æ€§æ¯”è¾ƒå¥½ï¼Œé€‚åˆå¼€å‘é˜¶æ®µä½¿ç”¨ jquery-3.4.1.js</p></li></ol><h2 id="2-1-ä½¿ç”¨jquery"><a href="#2-1-ä½¿ç”¨jquery" class="headerlink" title="2.1 ä½¿ç”¨jquery"></a>2.1 ä½¿ç”¨jquery</h2><p>æ­¥éª¤ï¼š</p><ol><li><p>éœ€è¦åœ¨ä½ çš„é¡¹ç›®ä¸­åŠ å…¥jqueryçš„æ–‡ä»¶ï¼Œ ideaä¸­æ˜¯æŠŠjqueryæ”¾åœ¨webappç›®å½•ã€‚ä¸€èˆ¬æ˜¯åˆ›å»ºä¸€ä¸ªjsç›®å½•ã€‚å­˜æ”¾jsæ–‡ä»¶çš„ã€‚ å¯¹äºhbuilderå·¥å…·ï¼Œ æ”¾åœ¨é¡¹ç›®çš„jsç›®å½•ä¸­å°±å¯ä»¥äº†</p></li><li><p>åˆ›å»ºä¸€ä¸ªhtmlæ–‡ä»¶æˆ–è€…jspéƒ½å¯ä»¥ï¼Œ åœ¨æ–‡ä»¶ä¸­ä½¿ç”¨</p><pre><code>&lt;script type=&quot;text/javascript&quot; src=&quot;jqueryçš„æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„&quot; /&gt; è¿™æ ·æ˜¯ä¸è¡Œçš„&lt;script type=&quot;text/javascript&quot; src=&quot;jqueryçš„æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„&quot; /&gt;&lt;/script&gt;è¿™æ ·æ˜¯å¯ä»¥çš„</code></pre></li><li><p>åœ¨jsä»£ç ä¸­ï¼Œè°ƒç”¨jqueryä¸­å‡½æ•°</p></li></ol><pre><code>&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=&quot;utf-8&quot;&gt;        &lt;title&gt;ç¬¬ä¸€ä¸ªjqueryä¾‹å­&lt;/title&gt;        &lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-3.4.1.js&quot;&gt;&lt;/script&gt;        &lt;script type=&quot;text/javascript&quot;&gt;                        /*              $:jqueryä¸­çš„å‡½æ•°å              document:æ˜¯å‚æ•°              $(document): æŠŠjsä¸­çš„documentå¯¹è±¡å˜æˆjqueryå¯ä»¥ä½¿ç”¨çš„å¯¹è±¡ã€‚                           ç„¶åè°ƒç”¨ready()çš„å‡½æ•°ã€‚ è¿™ä¸ªready()æ˜¯jqueryä¸­çš„å‡½æ•°                                                      ready()çš„æ‰§è¡Œæ—¶é—´åœ¨é¡µé¢domå¯¹è±¡åŠ è½½åæ‰§è¡Œçš„ã€‚ç›¸å½“äºjsä¸­onloadäº‹ä»¶                                  ready(å‡½æ•°):è¡¨ç¤ºåœ¨é¡µé¢å¯¹è±¡åŠ è½½åæ‰§è¡Œ è¿™ä¸ªå‡½æ•°            */            /* $(document).ready(function()&#123;                alert(&quot;ä½¿ç”¨jqueryäº†&quot;)            &#125;) */                        /* $(document).ready( myinit() )            function myinit()&#123;                alert(&quot;====ç›¸å½“äºonload==&quot;)            &#125; */                        //jqueryæä¾›äº†ç®€å•æ–¹å¼,ä½¿ç”¨ready()            //$(  å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•° )            $( function()&#123;                alert(&quot;ç®€å•çš„æ–¹å¼ä½¿ç”¨ready&quot;)            &#125; )                    &lt;/script&gt;    &lt;/head&gt;    &lt;body&gt;    &lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="2-2-å¯¹è±¡çš„åˆ†ç±»"><a href="#2-2-å¯¹è±¡çš„åˆ†ç±»" class="headerlink" title="2.2 å¯¹è±¡çš„åˆ†ç±»"></a>2.2 å¯¹è±¡çš„åˆ†ç±»</h2><p>domå¯¹è±¡å’Œjqueryå¯¹è±¡ã€‚ åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­åŒæ—¶å­˜åœ¨ä¸¤ç§å¯¹è±¡</p><p>domå¯¹è±¡ï¼š ä½¿ç”¨jsçš„ä»£ç è·å–ï¼Œåˆ›å»ºçš„å¯¹è±¡ã€‚ htmlä¸­çš„å¯¹è±¡éƒ½æ˜¯domå¯¹è±¡ã€‚</p><p>jqueryå¯¹è±¡ï¼š ä½¿ç”¨jqueryè·å–è·å–çš„å¯¹è±¡ã€‚</p><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨domå¯¹è±¡ï¼Œè¿˜æœ‰jqueryå¯¹è±¡ï¼Ÿ</p><p>ç›®çš„æ˜¯è¦domå¯¹è±¡çš„å‡½æ•°æˆ–è€…å±æ€§ï¼Œ ä»¥åŠä½¿ç”¨ä½¿ç”¨jqueryä¸­æä¾›çš„å‡½æ•°æˆ–è€…å±æ€§ã€‚</p><p>è¦ domä¸­çš„å†…å®¹å°±éœ€è¦ä½¿ç”¨domå¯¹è±¡ï¼Œ è¦ä½¿ç”¨jqueryå‡½æ•°åº“ä¸­çš„å‡½æ•°éœ€è¦ä½¿ç”¨jqueryå¯¹è±¡ã€‚</p><p>domå¯¹è±¡å’Œjqueryå¯¹è±¡å¯ä»¥ç›¸äº’è½¬æ¢çš„</p><h3 id="2-2-1-domå¯¹è±¡è½¬ä¸ºjqueryå¯¹è±¡ã€‚"><a href="#2-2-1-domå¯¹è±¡è½¬ä¸ºjqueryå¯¹è±¡ã€‚" class="headerlink" title="2.2.1. domå¯¹è±¡è½¬ä¸ºjqueryå¯¹è±¡ã€‚"></a>2.2.1. domå¯¹è±¡è½¬ä¸ºjqueryå¯¹è±¡ã€‚</h3><p>è¯­æ³•ï¼š $( domå¯¹è±¡ ) å¾—åˆ°çš„æ˜¯ä¸€ä¸ªjqueryå¯¹è±¡ï¼Œ å¯ä»¥è°ƒç”¨jqueryä¸­æä¾›çš„å‡½æ•°</p><pre><code>&lt;input type=&quot;text&quot; id=&quot;t1&quot; /&gt;//é€šè¿‡jsçš„å‡½æ•°ï¼Œè·å–domå¯¹è±¡var dom= document.getElementById(&quot;t1&quot;);//æŠŠdomè½¬ä¸ºjqueryvar jqueryObj = $(dom);//è°ƒç”¨jqueryä¸­çš„å‡½æ•°jqueryObject.val();//è·å–domå¯¹è±¡çš„valueå±æ€§çš„å€¼æç¤ºï¼šä¸ºäº†åŒºåˆ†domå¯¹è±¡å’Œjqueryå¯¹è±¡ï¼Œå¯ä»¥åœ¨jqueryå¯¹è±¡å˜é‡åä¸Šï¼ŒåŠ ä¸€ä¸ª$ , ä¾‹å¦‚ $obj </code></pre><h3 id="2-2-2-jqueryå¯¹è±¡è½¬ä¸ºdomå¯¹è±¡ã€‚"><a href="#2-2-2-jqueryå¯¹è±¡è½¬ä¸ºdomå¯¹è±¡ã€‚" class="headerlink" title="2.2.2 jqueryå¯¹è±¡è½¬ä¸ºdomå¯¹è±¡ã€‚"></a>2.2.2 jqueryå¯¹è±¡è½¬ä¸ºdomå¯¹è±¡ã€‚</h3><p>è¯­æ³•ï¼š jqueryå¯¹è±¡æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ æ•°ç»„æˆå‘˜æ˜¯domå¯¹è±¡ã€‚ ä½¿ç”¨ [ä¸‹æ ‡] æˆ– get(ä¸‹æ ‡)</p><pre><code>&lt;input type=&quot;text&quot; id=&quot;txt1&quot;/&gt;ä½¿ç”¨jqueryçš„æ–¹å¼è¡¨ç¤ºè¿™ä¸ªdomå¯¹è±¡$(&quot;#txt1&quot;):è·å–idæ˜¯txt1çš„domå¯¹è±¡ã€‚ var  obj = $(&quot;#txt1&quot;); //objæ˜¯ä¸€ä¸ªjqueryå¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªåŒ…å«äº†ä¸€ä¸ªæˆå‘˜çš„domæ•°ç»„ã€‚  obj[0]å°±æ˜¯domå¯¹è±¡var dom = obj[0]; æˆ–è€… obj.get(0)//ä½¿ç”¨domå¯¹è±¡çš„å‡½æ•°æˆ–è€…å±æ€§alert(dom.value)</code></pre><h2 id="2-3-é€‰æ‹©å™¨"><a href="#2-3-é€‰æ‹©å™¨" class="headerlink" title="2.3 é€‰æ‹©å™¨"></a>2.3 é€‰æ‹©å™¨</h2><p>ä»€ä¹ˆæ˜¯é€‰æ‹©å™¨ï¼š é€‰æ‹©å™¨å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ æ˜¯ä¸€ä¸ªå®šä½domå¯¹è±¡çš„å­—ç¬¦ä¸²ã€‚ ä½¿ç”¨è¿™ä¸ªå­—ç¬¦ä¸²ä½œä¸ºæ¡ä»¶å®šä½domå¯¹è±¡ã€‚ å¯ä»¥ä½¿ç”¨ id ï¼Œclassæ ·å¼åç§°ï¼Œ æ ‡ç­¾åç§°ç­‰ä½œä¸ºé€‰æ‹©å™¨ä½¿ç”¨ï¼Œå®šä½domå¯¹è±¡</p><h3 id="2-3-1-åŸºæœ¬é€‰æ‹©å™¨"><a href="#2-3-1-åŸºæœ¬é€‰æ‹©å™¨" class="headerlink" title="2.3.1 åŸºæœ¬é€‰æ‹©å™¨"></a>2.3.1 åŸºæœ¬é€‰æ‹©å™¨</h3><p>ä½¿ç”¨domå¯¹è±¡çš„idï¼Œ classåç§°ï¼Œ æ ‡ç­¾åç§°ç­‰ä½œä¸ºæ¡ä»¶å®šä½domå¯¹è±¡ã€‚</p><ol><li><p>ä½¿ç”¨domå¯¹è±¡çš„idä½œä¸ºæ¡ä»¶</p><p>è¯­æ³•ï¼š $(â€œ#idâ€) document.getElementById(â€œidâ€)</p></li><li><p>classé€‰æ‹©å™¨ï¼Œä½¿ç”¨å¯¹è±¡çš„classåç§°å®šä½domå¯¹è±¡</p><p>è¯­æ³•ï¼š$(â€œ.classåç§°â€) document.getElementsByClassName()</p></li><li><p>æ ‡ç­¾é€‰æ‹©å™¨ï¼Œä½¿ç”¨æ ‡ç­¾åç§°ä½œä¸ºæ¡ä»¶å®šä½domå¯¹è±¡</p><p>è¯­æ³•ï¼š$(â€œæ ‡ç­¾åç§°â€) document.getElementsByTagName()</p></li><li><p>æ‰€æœ‰é€‰æ‹©å™¨</p><p>è¯­æ³•ï¼š $(â€œ*â€)</p></li><li><p>ç»„åˆé€‰æ‹©å™¨</p><p>è¯­æ³•ï¼š$(â€œ#id,.class,æ ‡ç­¾åç§°â€)</p><p>ç»„åˆé€‰æ‹©å™¨ä½¿ç”¨ id æˆ–è€…classåç§°æˆ–è€…æ ‡ç­¾åç§°å®šä½domå¯¹è±¡ï¼Œ idï¼Œclassï¼Œæ ‡ç­¾åç§°å¯ä»¥ä»»æ„ç»„åˆã€‚</p></li></ol><h3 id="2-3-2-è¡¨å•é€‰æ‹©å™¨"><a href="#2-3-2-è¡¨å•é€‰æ‹©å™¨" class="headerlink" title="2.3.2 è¡¨å•é€‰æ‹©å™¨"></a>2.3.2 è¡¨å•é€‰æ‹©å™¨</h3><p>è¡¨å•é€‰æ‹©å™¨ä½¿ç”¨ domå¯¹è±¡çš„typeå±æ€§å€¼å®šä½domå¯¹è±¡çš„ï¼Œ å’Œformæ ‡ç­¾æ— å…³ã€‚</p><p>è¯­æ³•ï¼š $(â€œ:typeå±æ€§å€¼â€)</p><p>ä¾‹å¦‚ï¼š</p><pre><code>&lt;input type=&quot;text&quot; /&gt;&lt;input type=&quot;text&quot; /&gt;    ä½¿ç”¨è¡¨å•é€‰æ‹©å™¨ï¼š $(&quot;:text&quot;)</code></pre><h2 id="2-4-è¿‡æ»¤å™¨"><a href="#2-4-è¿‡æ»¤å™¨" class="headerlink" title="2.4 è¿‡æ»¤å™¨"></a>2.4 è¿‡æ»¤å™¨</h2><p>è¿‡æ»¤å™¨æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨äº†ç­›é€‰domå¯¹è±¡çš„ï¼Œ è¿‡æ»¤å™¨æ˜¯å’Œé€‰æ‹©å™¨ä¸€èµ·ä½¿ç”¨çš„ã€‚ åœ¨é€‰æ‹©äº†domå¯¹è±¡åï¼Œåœ¨è¿›è¡Œè¿‡æ»¤ç­›é€‰ã€‚</p><h3 id="2-4-1-åŸºæœ¬è¿‡æ»¤å™¨"><a href="#2-4-1-åŸºæœ¬è¿‡æ»¤å™¨" class="headerlink" title="2.4.1 åŸºæœ¬è¿‡æ»¤å™¨"></a>2.4.1 åŸºæœ¬è¿‡æ»¤å™¨</h3><p>ä½¿ç”¨domå¯¹è±¡åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œä½œä¸ºè¿‡æ»¤æ¡ä»¶çš„ã€‚</p><p>1ï¼‰é€‰æ‹©æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªdomæˆå‘˜</p><p>è¯­æ³•ï¼š$(â€œé€‰æ‹©å™¨:firstâ€)</p><ol><li>é€‰æ‹©æ•°ç»„ä¸­æœ€åä¸€ä¸ªæˆå‘˜</li></ol><p>è¯­æ³•ï¼š$(â€œé€‰æ‹©å™¨:lastâ€)</p><ol><li>é€‰æ‹©ç­‰äºæŒ‡å®šä¸‹æ ‡çš„domæˆå‘˜</li></ol><p>è¯­æ³•ï¼š$(â€œé€‰æ‹©å™¨:eq(ä¸‹æ ‡)â€)</p><p>4ï¼‰é€‰æ‹©å¤§äºæŸä¸ªä¸‹æ ‡çš„æ‰€æœ‰æˆå‘˜</p><p>è¯­æ³•ï¼š$(â€œé€‰æ‹©å™¨:gt(ä¸‹æ ‡)â€)</p><p>5ï¼‰é€‰æ‹©å°äºæŸä¸ªä¸‹æ ‡çš„æ‰€æœ‰æˆå‘˜</p><p>è¯­æ³•ï¼š$(â€œé€‰æ‹©å™¨:lt(ä¸‹æ ‡)â€)</p><h3 id="2-4-2-è¡¨å•è¿‡æ»¤å™¨"><a href="#2-4-2-è¡¨å•è¿‡æ»¤å™¨" class="headerlink" title="2.4.2 è¡¨å•è¿‡æ»¤å™¨"></a>2.4.2 è¡¨å•è¿‡æ»¤å™¨</h3><p>æ ¹æ®å¯¹è±¡çš„çŠ¶æ€ä½œä¸ºæ¡ä»¶ï¼Œç­›é€‰domå¯¹è±¡</p><p>1ï¼‰è·å–å¯ç”¨çš„æ–‡æœ¬æ¡†</p><p>è¯­æ³•ï¼š$(â€œ:text:enabledâ€)</p><ol><li>è·å–ä¸å¯ç”¨çš„æ–‡æœ¬æ¡†</li></ol><p>è¯­æ³•ï¼š $(â€œ:text:disabledâ€)</p><p>3ï¼‰è·å–é€‰ä¸­çš„å¤é€‰æ¡†</p><p>è¯­æ³•ï¼š$(â€œ:checkbox:checkedâ€)</p><ol><li>è·å–é€‰ä¸­ä¸‹æ‹‰åˆ—è¡¨æ¡†</li></ol><p>è¯­æ³•ï¼š $(â€œé€‰æ‹©å™¨ &gt; option:selectedâ€)</p><pre><code>&lt;select id=&quot;lang&quot;&gt;    &lt;option value=&quot;java&quot;&gt;java&lt;/option&gt;    &lt;option value=&quot;sql&quot;&gt;sql&lt;/option&gt;&lt;/select&gt;</code></pre><h2 id="2-5-å‡½æ•°"><a href="#2-5-å‡½æ•°" class="headerlink" title="2.5 å‡½æ•°"></a>2.5 å‡½æ•°</h2><h3 id="2-5-1-ç¬¬ä¸€ç»„å‡½æ•°"><a href="#2-5-1-ç¬¬ä¸€ç»„å‡½æ•°" class="headerlink" title="2.5.1 ç¬¬ä¸€ç»„å‡½æ•°"></a>2.5.1 ç¬¬ä¸€ç»„å‡½æ•°</h3><p>1ï¼‰val()ï¼šæ“ä½œdomå¯¹è±¡çš„valueå€¼</p><p>val(): æ²¡æœ‰å‚æ•°ï¼Œ è·å–domæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªdomå¯¹è±¡çš„valueå€¼</p><p>val(å‚æ•°)ï¼š æœ‰å‚æ•°ï¼Œ ç»™domæ•°ç»„ä¸­æ‰€æœ‰domå¯¹è±¡çš„valueå±æ€§èµ‹å€¼</p><p>2ï¼‰text() : æ“ä½œæ ‡ç­¾çš„æ–‡æœ¬å†…å®¹ï¼Œæ ‡ç­¾å¼€å§‹å’Œç»“æŸä¹‹é—´çš„å†…å®¹</p><p>text(): æ²¡æœ‰å‚æ•°ï¼Œ æŠŠdomæ•°ç»„ä¸­æ‰€æœ‰domå¯¹è±¡çš„æ–‡æœ¬å†…å®¹é“¾æ¥èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›è¿™ä¸ªè¿™ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>text(å‚æ•°)ï¼šç»™domæ•°ç»„ä¸­çš„æ‰€æœ‰æˆå‘˜ç»Ÿä¸€èµ‹äºˆæ–°çš„æ–‡æœ¬</p><p>3ï¼‰attr(): æ“ä½œvalue ï¼Œæ–‡æœ¬ä»¥å¤–çš„å±æ€§æ—¶ã€‚</p><p>attr(â€œå±æ€§åâ€)ï¼šè·å–domæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªdomæˆå‘˜çš„æ­¤å±æ€§å€¼</p><p>attr(â€œå±æ€§åâ€,â€å±æ€§å€¼â€)ï¼šç»™domæ•°ç»„ä¸­æ‰€æœ‰domæˆå‘˜æ­¤å±æ€§èµ‹å€¼</p><h3 id="2-5-2-ç¬¬äºŒç»„å‡½æ•°"><a href="#2-5-2-ç¬¬äºŒç»„å‡½æ•°" class="headerlink" title="2.5.2 ç¬¬äºŒç»„å‡½æ•°"></a>2.5.2 ç¬¬äºŒç»„å‡½æ•°</h3><p>1ï¼‰ remove()</p><p>åˆ é™¤é€‰æ‹©çš„domå¯¹è±¡å’Œä»–çš„å­å¯¹è±¡</p><p>è¯­æ³•ï¼š $(â€é€‰æ‹©å™¨â€œ).remove()</p><p>2ï¼‰ empty()</p><p>åˆ é™¤domå¯¹è±¡çš„å­å¯¹è±¡</p><p>è¯­æ³•ï¼š $(â€œé€‰æ‹©å™¨â€).empty()</p><ol><li>append()</li></ol><p>ç»™domå¯¹è±¡åœ¨ä»–çš„åé¢å¢åŠ æ–°çš„domå¯¹è±¡</p><p>è¯­æ³•ï¼š $(â€œé€‰æ‹©å™¨â€).append( å­dom å¯¹è±¡ )</p><ol><li>html()</li></ol><p>html(): è·å–domæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªdomå¯¹è±¡çš„æ–‡æœ¬å€¼ï¼ˆ html()è¿”å›ç»“æœç›¸å½“äºinnertHTML ï¼‰</p><p>html(å‚æ•°)ï¼šç»™domæ•°ç»„ä¸­æ‰€æœ‰æˆå‘˜è®¾ç½®æ–°çš„æ–‡æœ¬å†…å®¹ã€‚ ï¼ˆhtml()è¿”å›ç»“æœç›¸å½“äºinnertHTML ï¼‰</p><p>5)each()</p><p>eachæ˜¯å¾ªç¯å‡½æ•°ï¼Œ å¯ä»¥å¾ªç¯æ•°ç»„ï¼Œ json ï¼Œ domå¯¹è±¡æ•°ç»„</p><p>â‘  $.each( è¦å¾ªç¯çš„å†…å®¹ï¼Œ function(index,element ){ å¤„ç†å‡½æ•°} )</p><p>è¦å¾ªç¯çš„å†…å®¹: å¯ä»¥æ˜¯æ•°ç»„ï¼Œ jsonå¯¹è±¡ï¼Œ domå¯¹è±¡æ•°ç»„ã€‚</p><p>functionï¼š å¾ªç¯çš„å¤„ç†å‡½æ•°ï¼Œ æ¯ä¸ªæˆå‘˜éƒ½ä¼šæ‰§è¡Œå‡½æ•°ä¸€æ¬¡ã€‚</p><p> indexï¼šæ˜¯å¾ªç¯å˜é‡çš„å€¼ï¼Œ åç§°è‡ªå®šä¹‰</p><p> elementï¼š å’Œindexå¯¹åº”çš„æˆå‘˜ï¼Œ elementåç§°æ˜¯è‡ªå®šä¹‰çš„</p><p>ä¾‹å¦‚</p><p>doArrayContentï¼š function(index,element ){ å¤„ç†å‡½æ•°} )</p><p>â‘¡ $(â€œé€‰æ‹©å™¨â€).each(function(index,element){ å¤„ç†å‡½æ•°} )</p><p>å¯ä»¥å¯¹jqueryå¯¹è±¡è¿›è¡Œå¾ªç¯å¤„ç†ã€‚ jqueryå¯¹è±¡å°±æ˜¯domæ•°ç»„</p><h2 id="2-6-äº‹ä»¶"><a href="#2-6-äº‹ä»¶" class="headerlink" title="2.6 äº‹ä»¶"></a>2.6 äº‹ä»¶</h2><p>jqueryå¯ä»¥ç»™domå¯¹è±¡ç»‘å®šäº‹ä»¶ï¼Œåœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´åŠ¨æ€çš„å¤„ç†äº‹ä»¶</p><h3 id="2-6-1-ç¬¬ä¸€ç§äº‹ä»¶ç»‘å®šè¯­æ³•"><a href="#2-6-1-ç¬¬ä¸€ç§äº‹ä»¶ç»‘å®šè¯­æ³•" class="headerlink" title="2.6.1 ç¬¬ä¸€ç§äº‹ä»¶ç»‘å®šè¯­æ³•"></a>2.6.1 ç¬¬ä¸€ç§äº‹ä»¶ç»‘å®šè¯­æ³•</h3><p>è¯­æ³•ï¼š $(â€œé€‰æ‹©å™¨â€).äº‹ä»¶åç§°(äº‹ä»¶çš„å¤„ç†å‡½æ•°)</p><p>$(â€œé€‰æ‹©å™¨â€)ï¼šé€‰æ‹©0æˆ–å¤šä¸ªdomå¯¹è±¡ã€‚ç»™ä»–ä»¬ç»‘å®šäº‹ä»¶</p><p>äº‹ä»¶åç§°ï¼š å°±æ˜¯jsä¸­çš„ å»æ‰onçš„éƒ¨åˆ†ã€‚ ä¾‹å¦‚å•å‡»äº‹ä»¶onclick, è¿™é‡Œçš„äº‹ä»¶åç§°å°±æ˜¯ click</p><p>äº‹ä»¶çš„å¤„ç†å‡½æ•°: å‡½æ•°å®šä¹‰ï¼Œ å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚</p><pre><code>ä¾‹å¦‚ï¼š&lt;input type=&quot;button&quot; id=&quot;btn&quot; value=&quot;ç»‘å®šäº‹ä»¶&quot;/&gt; ç»‘å®šäº‹ä»¶$(&quot;#btn&quot;).click( function()&#123; å•å‡»çš„å¤„ç†ä»£ç  &#125; )$(&quot;:button&quot;).click(function()&#123; å•å‡»å¤„ç†ä»£ç &#125;)&lt;script type=&quot;text/javascript&quot;&gt;                        $(function()&#123;                //é¡µé¢domå¯¹è±¡åŠ è½½åæ‰§è¡Œ, ç›¸å½“äºonloadäº‹ä»¶                //ç»‘å®šäº‹ä»¶                $(&quot;#btn&quot;).click(function()&#123;                    alert(&quot;==buttonå•å‡»äº†ï¼Œæ‰§è¡Œå¤„ç†å‡½æ•°==&quot;)                &#125;)            &#125;)                            &lt;/script&gt;&lt;body&gt;    &lt;input type=&quot;button&quot; id=&quot;btn&quot; value=&quot;ç»‘å®šäº‹ä»¶&quot; /&gt;&lt;br/&gt;&lt;/body&gt;</code></pre><h3 id="2-6-2-ç¬¬äºŒç§äº‹ä»¶ç»‘å®šæ–¹å¼ï¼Œ-on"><a href="#2-6-2-ç¬¬äºŒç§äº‹ä»¶ç»‘å®šæ–¹å¼ï¼Œ-on" class="headerlink" title="2.6.2 ç¬¬äºŒç§äº‹ä»¶ç»‘å®šæ–¹å¼ï¼Œ on"></a>2.6.2 ç¬¬äºŒç§äº‹ä»¶ç»‘å®šæ–¹å¼ï¼Œ on</h3><p>è¯­æ³•ï¼š $(â€œé€‰æ‹©å™¨â€).on( äº‹ä»¶åç§°, function(){äº‹ä»¶å¤„ç†å‡½æ•°})</p><p>äº‹ä»¶ï¼š å°±æ˜¯jsä¸­å»æ‰onçš„éƒ¨åˆ†ã€‚</p><p>functionï¼š äº‹ä»¶å¤„ç†å‡½æ•°</p><pre><code>&lt;body&gt;    &lt;input type=&quot;button&quot; id=&quot;btn&quot; value=&quot;ç»‘å®šäº‹ä»¶&quot; /&gt;&lt;br/&gt;&lt;/body&gt;&lt;script&gt;    $(&quot;#btn&quot;).on(&quot;click&quot;,function()&#123; alert(&quot;æŒ‰é’®å•å‡»äº†&quot;)&#125;)&lt;/script&gt;        </code></pre><h2 id="2-7-Ajax"><a href="#2-7-Ajax" class="headerlink" title="2.7 Ajax"></a>2.7 Ajax</h2><p>ä½¿ç”¨jqueryæä¾›çš„å‡½æ•°å®ç°ajaxè¯·æ±‚çš„å¤„ç†ã€‚ ä»£æ›¿ç›´æ¥ä½¿ç”¨XMLHttpRequest. ä½†æ˜¯jqueryå®é™…è¿˜æ˜¯ä½¿ç”¨çš„å¼‚æ­¥å¯¹è±¡ã€‚</p><h3 id="2-7-1-ajax-æ ¸å¿ƒçš„å‡½æ•°"><a href="#2-7-1-ajax-æ ¸å¿ƒçš„å‡½æ•°" class="headerlink" title="2.7.1 $.ajax() æ ¸å¿ƒçš„å‡½æ•°"></a>2.7.1 $.ajax() æ ¸å¿ƒçš„å‡½æ•°</h3><p>è¯­æ³•ï¼š $.ajax( { jsonæ ¼å¼çš„å‚æ•°} )</p><p>jsonæ ¼å¼çš„å‚æ•°ï¼škeyæ˜¯å®šä¹‰å¥½çš„ï¼Œ éœ€è¦å¼€å‘äººå‘˜ç»™keyèµ‹å€¼ã€‚ è¿™äº›keyæ˜¯ç”¨æ¥è¡¨ç¤ºajaxè¯·æ±‚å¿…é¡»çš„å‚æ•°</p><p>ä¾‹å¦‚ï¼Œè¯·æ±‚çš„uriåœ°å€ï¼Œ æ˜¯ä¸æ˜¯å¼‚æ­¥è¯·æ±‚ï¼Œ è¯·æ±‚çš„æ–¹å¼ç­‰ç­‰ã€‚</p><pre><code>$.ajax(  &#123;      url:&quot;queryProvinceServlet&quot;,      type:&quot;get&quot;,      data:&#123;&quot;name&quot;:&quot;æå››&quot;,&quot;age&quot;:20&#125;,      dataType:&quot;json&quot;,      success:function(resp) &#123; å¼€å‘äººå‘˜è·å–æ•°æ®ï¼Œæ›´æ–°domå¯¹è±¡ &#125;,      error:function()&#123; alert(&quot;è¯·æ±‚é”™è¯¯&quot;)&#125;  &#125;)</code></pre><p>urlï¼šæœåŠ¡å™¨çš„åœ°å€ï¼Œä¾‹å¦‚æŸä¸ªservletçš„è®¿é—®åœ°å€ã€‚ queryProvinceServlet</p><p>type:è¡¨ç¤ºè¯·æ±‚çš„æ–¹å¼ï¼Œgetï¼Œpostã€‚ é»˜è®¤æ˜¯getã€‚ è¿™ä¸ªå€¼ä¸ç”¨åŒºåˆ†å¤§å°å†™</p><p>dataï¼šè¡¨ç¤ºæäº¤çš„è¯·æ±‚å‚æ•°ã€‚ å¯ä»¥æ˜¯stringï¼Œ æ•°ç»„ï¼Œ jsonç±»å‹çš„ã€‚ æ¨èä½¿ç”¨jsonæ ¼å¼ã€‚</p><p> ä¾‹å¦‚ï¼š data: {â€œnameâ€:â€æå››â€,â€ageâ€:20}</p><p> jqueryåœ¨å‘é€è¯·æ±‚æ—¶ï¼Œä¼šæŠŠjsonä¸­çš„keyä½œä¸ºè¯·æ±‚çš„å‚æ•°ä½¿ç”¨ï¼Œ keyå¯¹åº”çš„å€¼ä½œä¸ºå‚æ•°æ•°æ®ã€‚</p><p> è½¬ä¸ºçš„ç»“æœï¼š <a href="http://localhost:8080/myweb/queryProvinceServlet?name=%E6%9D%8E%E5%9B%9B&age=20">http://localhost:8080/myweb/queryProvinceServlet?name=æå››&amp;age=20</a></p><p>dataType: æ•°æ®æ ¼å¼ï¼Œ å¯ä»¥æ˜¯ htmlï¼Œ text ï¼Œ xml ï¼Œjsonç­‰ç­‰ã€‚ è¡¨ç¤ºå‘èµ·è¯·æ±‚åï¼Œå¸Œæœ›æœåŠ¡å™¨ç«¯è¿”å›çš„æ•°æ®æ ¼å¼ã€‚ jqueryå¯ä»¥å°è¯•ä½¿ç”¨å¯¹åº”æ ¼å¼å¤„ç†è¿”å›çš„æ•°æ®ã€‚ æ¯”å¦‚ä½ æŒ‡å®šäº† dataType:json,è¡¨ç¤ºå¸Œæœ›æœåŠ¡å™¨è¿”å›çš„æ˜¯jsonæ ¼å¼æ•°æ®ã€‚ ç„¶åjqueryæŠŠjsonæ•°æ®è½¬ä¸ºjsonå¯¹è±¡ã€‚æœåŠ¡å™¨ä»£ç å¯ä»¥è·å–åˆ° dataTypeçš„å†…å®¹ã€‚</p><p> ä¾‹å¦‚ï¼š è¯·æ±‚ä¸­ dataType:â€jsonâ€, jqueryå‘èµ·è¯·æ±‚åï¼Œ</p><p> åœ¨è¯·æ±‚å¤´ä¸­ Accept: application&#x2F;json, text&#x2F;javascript, <em>&#x2F;</em>; q&#x3D;0.01</p><p> å¦‚æœdataType:â€textâ€, è¯·æ±‚ä¸­</p><p> Accept: text&#x2F;plain, <em>&#x2F;</em>; q&#x3D;0.01</p><p>success: å‡½æ•°functionã€‚ å½“æœåŠ¡å™¨ç«¯è¿”å›äº†æ•°æ®ï¼Œjqueryå¤„ç†å®Œæ•°æ®åï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚ ç­‰åŒäºå¼‚æ­¥å¯¹è±¡çš„ readyState&#x3D;&#x3D;4 $$ status&#x3D;200çš„æƒ…å†µ</p><p> ä¾‹å¦‚ï¼š success:function( data){ å¼€å‘äººå‘˜å¤„ç†æœåŠ¡å™¨è¿”å›çš„æ•°æ® }</p><p> dataæ˜¯è‡ªå®šä¹‰å½¢å‚ï¼Œ ç›¸å½“äº data&#x3D; xhr.responseText</p><p>error:function(), å½“è¯·æ±‚é”™è¯¯æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚</p><p>contentType:è¡¨ç¤ºè¯·æ±‚çš„å‚æ•°æ•°æ®æ ¼å¼ã€‚ä¾‹å¦‚ application&#x2F;json , è¿™ä¸ªå†…å®¹å¯ä»¥ä¸å†™ã€‚</p><p>async: æ˜¯ä¸€ä¸ªbooleanè¡¨ç¤ºè¯·æ±‚æ˜¯åŒæ­¥çš„è¿˜æ˜¯å¼‚æ­¥çš„ã€‚ trueæ˜¯å¼‚æ­¥çš„ï¼Œé»˜è®¤æ˜¯trueï¼› falseåŒæ­¥çš„.</p><h3 id="2-7-2-get"><a href="#2-7-2-get" class="headerlink" title="2.7.2 $.get()"></a>2.7.2 $.get()</h3><p>$.get()è¿™ä¸ªå‡½æ•°å°±æ˜¯æ‰§è¡Œgetè¯·æ±‚æ–¹å¼çš„ajax</p><p>è¯­æ³•ï¼š $.get(url, è¯·æ±‚å‚æ•°ï¼Œ successå‡½æ•°ï¼Œ dataType)</p><p>ä¾‹å¦‚ï¼š</p><pre><code>$.get(&quot;queryName&quot;,&#123;&quot;proid&quot;:1&#125;, function(resp)&#123; è·å–çœä»½åç§° &#125;, &quot;text&quot;)</code></pre><h3 id="2-7-3-post"><a href="#2-7-3-post" class="headerlink" title="2.7.3 $.post()"></a>2.7.3 $.post()</h3><p>$.post() æ‰§è¡Œpostè¯·æ±‚çš„ajaxã€‚</p><p>è¯­æ³•ï¼š $.post(url, è¯·æ±‚å‚æ•°ï¼Œ successå‡½æ•°ï¼Œ dataType)</p><p>ä¾‹å¦‚ï¼š</p><pre><code>$.post(&quot;queryName&quot;,&#123;&quot;proid&quot;:1&#125;, function(resp)&#123; è·å–çœä»½åç§° &#125;, &quot;text&quot;)</code></pre><h2 id="2-8-çº§è”æŸ¥è¯¢"><a href="#2-8-çº§è”æŸ¥è¯¢" class="headerlink" title="2.8 çº§è”æŸ¥è¯¢"></a>2.8 çº§è”æŸ¥è¯¢</h2><p>æ€è·¯ï¼šæœ‰ä¸¤ä¸ªæ•°æ®åº“çš„æŸ¥è¯¢ 1ï¼š æŸ¥è¯¢æ‰€æœ‰çš„çœä»½åç§°å’Œid ï¼› 2 æ ¹æ®æäº¤çš„çœä»½id ï¼ŒæŸ¥è¯¢cityè¡¨ï¼Œå¾—åˆ°åŸå¸‚åˆ—è¡¨</p><p> æœ‰ä¸¤ä¸ªservletæ¥æ”¶è¯·æ±‚ï¼Œ ä¸€ä¸ªæŸ¥è¯¢æ‰€æœ‰çš„çœä»½ ï¼›ä¸€ä¸ªæ˜¯æ¥æ”¶çœä»½idçš„å‚æ•°ï¼ŒæŸ¥è¯¢çœä»½å¯¹åº”çš„åŸå¸‚åˆ—è¡¨ã€‚</p><p> æ•°æ®æ ¼å¼ä½¿ç”¨ json</p><p> å‘èµ·è¯·æ±‚ä½¿ç”¨ $.ajax, $.get, $.post</p><p> äº‹ä»¶ï¼š onChange()</p><p>å®ç°æ­¥éª¤ï¼š</p><p>1.æ•°æ®è¡¨province( è·å–å…¨éƒ¨çš„idå’Œnameåˆ—çš„å€¼)ï¼Œ</p><p>cityè¡¨æ ¹æ®provinceidçš„å€¼ï¼Œå¾—åˆ°idï¼Œnameåˆ—</p><p>2.åˆ›å»ºwebåº”ç”¨ã€‚ åŠ å…¥mysqlé©±åŠ¨çš„jar å’Œjacksonçš„jar</p><p>3.åˆ›å»ºå®ä½“ç±»ï¼Œ Province , City</p><p>4.åˆ›å»ºDaoç±»ï¼Œ QueryDaoç±»ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•</p><p>5.åˆ›å»ºServletï¼Œ ä¸¤ä¸ªservlet ï¼Œä¸€ä¸ªæ˜¯æŸ¥è¯¢æ‰€æœ‰çš„çœä»½åç§°ï¼Œ ä¸€ä¸ªæ˜¯æŸ¥è¯¢åŸå¸‚åˆ—è¡¨</p><p>6.åˆ›å»ºjspï¼Œ å‘èµ·ä¸¤ä¸ªajaxè¯·æ±‚ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬02ç«  MySQLçš„æ•°æ®ç›®å½•</title>
      <link href="/2023/07/15/%E7%AC%AC02%E7%AB%A0%20MySQL%E7%9A%84%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95/"/>
      <url>/2023/07/15/%E7%AC%AC02%E7%AB%A0%20MySQL%E7%9A%84%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬02ç« -MySQLçš„æ•°æ®ç›®å½•"><a href="#ç¬¬02ç« -MySQLçš„æ•°æ®ç›®å½•" class="headerlink" title="ç¬¬02ç«  MySQLçš„æ•°æ®ç›®å½•"></a>ç¬¬02ç«  MySQLçš„æ•°æ®ç›®å½•</h3><h4 id="1-MySQL8çš„ä¸»è¦ç›®å½•ç»“æ„"><a href="#1-MySQL8çš„ä¸»è¦ç›®å½•ç»“æ„" class="headerlink" title="1. MySQL8çš„ä¸»è¦ç›®å½•ç»“æ„"></a><strong>1. MySQL8çš„ä¸»è¦ç›®å½•ç»“æ„</strong></h4><pre><code class="shell">find / -name mysql</code></pre><h5 id="1-1-æ•°æ®åº“æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„"><a href="#1-1-æ•°æ®åº“æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„" class="headerlink" title="1.1 æ•°æ®åº“æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„"></a><strong>1.1</strong> <strong>æ•°æ®åº“æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„</strong></h5><pre><code class="mysql">show variables like &#39;datadir&#39;; # /var/lib/mysql/</code></pre><h5 id="1-2-ç›¸å…³å‘½ä»¤ç›®å½•"><a href="#1-2-ç›¸å…³å‘½ä»¤ç›®å½•" class="headerlink" title="1.2 ç›¸å…³å‘½ä»¤ç›®å½•"></a><strong>1.2</strong> <strong>ç›¸å…³å‘½ä»¤ç›®å½•</strong></h5><p><strong>ç›¸å…³å‘½ä»¤ç›®å½•ï¼š&#x2F;usr&#x2F;bin å’Œ&#x2F;usr&#x2F;sbinã€‚</strong></p><h5 id="1-3-é…ç½®æ–‡ä»¶ç›®å½•"><a href="#1-3-é…ç½®æ–‡ä»¶ç›®å½•" class="headerlink" title="1.3 é…ç½®æ–‡ä»¶ç›®å½•"></a><strong>1.3</strong> <strong>é…ç½®æ–‡ä»¶ç›®å½•</strong></h5><p><strong>é…ç½®æ–‡ä»¶ç›®å½•ï¼š&#x2F;usr&#x2F;share&#x2F;mysql-8.0ï¼ˆå‘½ä»¤åŠé…ç½®æ–‡ä»¶ï¼‰ï¼Œ&#x2F;etc&#x2F;mysqlï¼ˆå¦‚my.cnfï¼‰</strong></p><h4 id="2-æ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿçš„å…³ç³»"><a href="#2-æ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿçš„å…³ç³»" class="headerlink" title="2. æ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿçš„å…³ç³»"></a><strong>2.</strong> <strong>æ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿçš„å…³ç³»</strong></h4><h5 id="2-1-è¡¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„è¡¨ç¤º"><a href="#2-1-è¡¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„è¡¨ç¤º" class="headerlink" title="2.1 è¡¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„è¡¨ç¤º"></a><strong>2.1</strong> <strong>è¡¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„è¡¨ç¤º</strong></h5><h6 id="2-3-1-InnoDBå­˜å‚¨å¼•æ“æ¨¡å¼"><a href="#2-3-1-InnoDBå­˜å‚¨å¼•æ“æ¨¡å¼" class="headerlink" title="2.3.1 InnoDBå­˜å‚¨å¼•æ“æ¨¡å¼"></a><strong>2.3.1 InnoDBå­˜å‚¨å¼•æ“æ¨¡å¼</strong></h6><p><strong>1.</strong> <strong>è¡¨ç»“æ„</strong></p><p>ä¸ºäº†ä¿å­˜è¡¨ç»“æ„ï¼Œ<code>InnoDB</code>åœ¨<code>æ•°æ®ç›®å½•</code>ä¸‹å¯¹åº”çš„æ•°æ®åº“å­ç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸“é—¨ç”¨äº<code>æè¿°è¡¨ç»“æ„çš„æ–‡ä»¶</code></p><pre><code>è¡¨å.frm</code></pre><p><strong>2.</strong> <strong>è¡¨ä¸­æ•°æ®å’Œç´¢å¼•</strong></p><p><strong>â‘  ç³»ç»Ÿè¡¨ç©ºé—´ï¼ˆsystem tablespaceï¼‰</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒInnoDBä¼šåœ¨æ•°æ®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>ibdata1</code>ã€å¤§å°ä¸º<code>12M</code>çš„<code>è‡ªæ‹“å±•</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯å¯¹åº”çš„<code>ç³»ç»Ÿè¡¨ç©ºé—´</code>åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„è¡¨ç¤ºã€‚</p><p><strong>â‘¡ ç‹¬ç«‹è¡¨ç©ºé—´(file-per-table tablespace)</strong> </p><p>åœ¨MySQL5.6.6ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼ŒInnoDBå¹¶ä¸ä¼šé»˜è®¤çš„æŠŠå„ä¸ªè¡¨çš„æ•°æ®å­˜å‚¨åˆ°ç³»ç»Ÿè¡¨ç©ºé—´ä¸­ï¼Œè€Œæ˜¯ä¸º<code>æ¯ä¸€ä¸ªè¡¨å»ºç«‹ä¸€ä¸ªç‹¬ç«‹è¡¨ç©ºé—´</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åˆ›å»ºäº†å¤šå°‘ä¸ªè¡¨ï¼Œå°±æœ‰å¤šå°‘ä¸ªç‹¬ç«‹è¡¨ç©ºé—´ã€‚ä½¿ç”¨<code>ç‹¬ç«‹è¡¨ç©ºé—´</code>æ¥å­˜å‚¨è¡¨æ•°æ®çš„è¯ï¼Œä¼šåœ¨è¯¥è¡¨æ‰€å±æ•°æ®åº“å¯¹åº”çš„å­ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºè¯¥ç‹¬ç«‹è¡¨ç©ºé—´çš„æ–‡ä»¶ï¼Œæ–‡ä»¶åå’Œè¡¨åç›¸åŒã€‚</p><pre><code>è¡¨å.ibd</code></pre><blockquote><p>MySQL8.0ä¸­ä¸å†å•ç‹¬æä¾›<code>è¡¨å.frm</code>ï¼Œè€Œæ˜¯åˆå¹¶åœ¨<code>è¡¨å.ibd</code>æ–‡ä»¶ä¸­ã€‚</p></blockquote><p><strong>â‘¢ ç³»ç»Ÿè¡¨ç©ºé—´ä¸ç‹¬ç«‹è¡¨ç©ºé—´çš„è®¾ç½®</strong></p><p>æˆ‘ä»¬å¯ä»¥è‡ªå·±æŒ‡å®šä½¿ç”¨<code>ç³»ç»Ÿè¡¨ç©ºé—´</code>è¿˜æ˜¯<code>ç‹¬ç«‹è¡¨ç©ºé—´</code>æ¥å­˜å‚¨æ•°æ®ï¼Œè¿™ä¸ªåŠŸèƒ½ç”±å¯åŠ¨å‚æ•°<code>innodb_file_per_table</code>æ§åˆ¶</p><pre><code class="ini">[server] innodb_file_per_table=0 # 0ï¼šä»£è¡¨ä½¿ç”¨ç³»ç»Ÿè¡¨ç©ºé—´ï¼› 1ï¼šä»£è¡¨ä½¿ç”¨ç‹¬ç«‹è¡¨ç©ºé—´</code></pre><p><strong>â‘£ å…¶ä»–ç±»å‹çš„è¡¨ç©ºé—´</strong></p><p>éšç€MySQLçš„å‘å±•ï¼Œé™¤äº†ä¸Šè¿°ä¸¤ç§è€ç‰Œè¡¨ç©ºé—´ä¹‹å¤–ï¼Œç°åœ¨è¿˜æ–°æå‡ºäº†ä¸€äº›ä¸åŒç±»å‹çš„è¡¨ç©ºé—´ï¼Œæ¯”å¦‚é€šç”¨è¡¨ç©ºé—´ï¼ˆgeneral tablespaceï¼‰ã€ä¸´æ—¶è¡¨ç©ºé—´ï¼ˆtemporary tablespaceï¼‰ç­‰ã€‚</p><h6 id="2-3-2-MyISAMå­˜å‚¨å¼•æ“æ¨¡å¼"><a href="#2-3-2-MyISAMå­˜å‚¨å¼•æ“æ¨¡å¼" class="headerlink" title="2.3.2 MyISAMå­˜å‚¨å¼•æ“æ¨¡å¼"></a><strong>2.3.2 MyISAMå­˜å‚¨å¼•æ“æ¨¡å¼</strong></h6><p><strong>1.</strong> <strong>è¡¨ç»“æ„</strong></p><p>åœ¨å­˜å‚¨è¡¨ç»“æ„æ–¹é¢ï¼Œ MyISAM å’Œ InnoDB ä¸€æ ·ï¼Œä¹Ÿæ˜¯åœ¨<code>æ•°æ®ç›®å½•</code>ä¸‹å¯¹åº”çš„æ•°æ®åº“å­ç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸“é—¨ç”¨äºæè¿°è¡¨ç»“æ„çš„æ–‡ä»¶</p><pre><code>è¡¨å.frm</code></pre><p><strong>2.</strong> <strong>è¡¨ä¸­æ•°æ®å’Œç´¢å¼•</strong></p><p>åœ¨MyISAMä¸­çš„ç´¢å¼•å…¨éƒ¨éƒ½æ˜¯<code>äºŒçº§ç´¢å¼•</code>ï¼Œè¯¥å­˜å‚¨å¼•æ“çš„<code>æ•°æ®å’Œç´¢å¼•æ˜¯åˆ†å¼€å­˜æ”¾</code>çš„ã€‚æ‰€ä»¥åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä¹Ÿæ˜¯ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æ¥å­˜å‚¨æ•°æ®æ–‡ä»¶å’Œç´¢å¼•æ–‡ä»¶ï¼ŒåŒæ—¶è¡¨æ•°æ®éƒ½å­˜æ”¾åœ¨å¯¹åº”çš„æ•°æ®åº“å­ç›®å½•ä¸‹ã€‚</p><pre><code>test.frm å­˜å‚¨è¡¨ç»“æ„ #MySQL8.0 æ”¹ä¸ºäº† b.xxx.sditest.MYD å­˜å‚¨æ•°æ® (MYData) test.MYI å­˜å‚¨ç´¢å¼• (MYIndex</code></pre><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>hexoåŸºæœ¬æ“ä½œ</title>
      <link href="/2023/07/15/hexo%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/"/>
      <url>/2023/07/15/hexo%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="Hexoçš„å¸¸ç”¨æŒ‡ä»¤åˆé›†"><a href="#Hexoçš„å¸¸ç”¨æŒ‡ä»¤åˆé›†" class="headerlink" title="Hexoçš„å¸¸ç”¨æŒ‡ä»¤åˆé›†"></a>Hexoçš„å¸¸ç”¨æŒ‡ä»¤åˆé›†</h1><p>xoæœ‰è®¸å¤šä¸»é¢˜ï¼Œå…¶å®æœ€ç«çˆ†çš„æ˜¯NexTã€Materyç­‰ï¼Œå¤åˆ¶å…³é”®è¯åˆ°GitHubæˆ–è€…baiduéƒ½èƒ½æœåˆ°ã€‚æƒè¡¡åˆ©å¼Šæœ€ç»ˆæˆ‘è¿˜æ˜¯é€‰æ‹©äº†å¤§å¤šæ•°äººä½¿ç”¨çš„nextã€‚æˆ‘è¿™è¾¹å…ˆç”¨çš„buttflyåæœŸæœ‰æ—¶é—´å†è¿›è¡Œä¼˜åŒ–</p><h2 id="å…³äºéƒ¨ç½²å‘½ä»¤"><a href="#å…³äºéƒ¨ç½²å‘½ä»¤" class="headerlink" title="å…³äºéƒ¨ç½²å‘½ä»¤"></a>å…³äºéƒ¨ç½²å‘½ä»¤</h2><h4 id="ï¼ˆ1ï¼‰hexo-gæˆ–hexo-generate"><a href="#ï¼ˆ1ï¼‰hexo-gæˆ–hexo-generate" class="headerlink" title="ï¼ˆ1ï¼‰hexo gæˆ–hexo generate"></a>ï¼ˆ1ï¼‰<code>hexo g</code>æˆ–<code>hexo generate</code></h4><p>è¯¥å‘½ä»¤æ‰§è¡Œååœ¨hexoç«™ç‚¹æ ¹ç›®å½•ä¸‹ç”Ÿæˆpublicæ–‡ä»¶å¤¹</p><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230715194722355.png" alt="image-20230715194722355"></p><h4 id="ï¼ˆ2ï¼‰hexo-clean"><a href="#ï¼ˆ2ï¼‰hexo-clean" class="headerlink" title="ï¼ˆ2ï¼‰hexo clean"></a>ï¼ˆ2ï¼‰<code>hexo clean</code></h4><p>æŠŠï¼ˆ1ï¼‰ä¸­çš„<code>public</code>æ–‡ä»¶å¤¹åˆ é™¤</p><h4 id="ï¼ˆ3ï¼‰hexo-sæˆ–hexo-server"><a href="#ï¼ˆ3ï¼‰hexo-sæˆ–hexo-server" class="headerlink" title="ï¼ˆ3ï¼‰hexo sæˆ–hexo server"></a>ï¼ˆ3ï¼‰<code>hexo s</code>æˆ–<code>hexo server</code></h4><p>å¯åŠ¨æœåŠ¡ï¼Œé»˜è®¤åœ°å€ä¸º<a href="http://localhost:4000/%EF%BC%8C4000%E7%AB%AF%E5%8F%A3">http://localhost:4000/ï¼Œ4000ç«¯å£</a></p><p><img src="C:\Users\æå¼€æ©\AppData\Roaming\Typora\typora-user-images\image-20230715194810602.png" alt="image-20230715194810602"></p><h4 id="4ï¼‰hexo-dæˆ–hexo-deploy"><a href="#4ï¼‰hexo-dæˆ–hexo-deploy" class="headerlink" title="4ï¼‰hexo dæˆ–hexo deploy"></a>4ï¼‰<code>hexo d</code>æˆ–<code>hexo deploy</code></h4><p>éƒ¨ç½²ç«™ç‚¹ï¼Œåœ¨æœ¬åœ°ç”Ÿæˆ<code>.deploy_git</code>æ–‡ä»¶å¤¹ï¼Œå¹¶å°†ç¼–è¯‘åçš„æ–‡ä»¶ä¸Šä¼ è‡³ GitHubã€‚</p><h4 id="5ï¼‰hexo-new"><a href="#5ï¼‰hexo-new" class="headerlink" title="5ï¼‰hexo new"></a>5ï¼‰hexo new</h4><p>ä¾‹å¦‚ï¼š hexo new photo â€œmy-first-blogâ€<br>ä¸Šè¿°æŒ‡ä»¤æ‰§è¡Œæ—¶ï¼ŒHexo ä¼šå°è¯•åœ¨ scaffolds ä¸­å¯»æ‰¾photo.mdå¸ƒå±€ï¼Œè‹¥æ‰¾åˆ°ï¼Œåˆ™æ ¹æ®è¯¥å¸ƒå±€æ–°å»ºæ–‡ç« ï¼›è‹¥æœªæ‰¾åˆ°æˆ–æŒ‡ä»¤ä¸­æœªæŒ‡å®šè¯¥å‚æ•°ï¼Œåˆ™ä½¿ç”¨post.mdæ–°å»ºæ–‡ç« ã€‚æ–°å»ºæ–‡ç« çš„åç§°åœ¨_config.ymlä¸­é…ç½®ã€‚</p><h4 id="ï¼ˆ6ï¼‰åˆ é™¤æ–‡ç« "><a href="#ï¼ˆ6ï¼‰åˆ é™¤æ–‡ç« " class="headerlink" title="ï¼ˆ6ï¼‰åˆ é™¤æ–‡ç« "></a>ï¼ˆ6ï¼‰åˆ é™¤æ–‡ç« </h4><p>åªéœ€åœ¨æœ¬åœ°æŠŠ<code>source/_posts</code>æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ç« æºæ–‡ä»¶åˆ é™¤åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°éƒ¨ç½²å³å¯ã€‚</p><pre><code class="hexo">hexo clean &amp;&amp; hexo g &amp;&amp; hexo s // ä¸€å®šè¦å…ˆ cleanï¼Œé˜²æ­¢çµå¼‚äº‹ä»¶å‘ç”Ÿ</code></pre><h4 id="7ï¼‰é‡æ–°æ‰“åŒ…å‘å¸ƒåˆ°æœ¬åœ°"><a href="#7ï¼‰é‡æ–°æ‰“åŒ…å‘å¸ƒåˆ°æœ¬åœ°" class="headerlink" title="7ï¼‰é‡æ–°æ‰“åŒ…å‘å¸ƒåˆ°æœ¬åœ°"></a>7ï¼‰é‡æ–°æ‰“åŒ…å‘å¸ƒåˆ°æœ¬åœ°</h4><pre><code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo s</code></pre><h4 id="8ï¼‰é‡æ–°æ‰“åŒ…å‘å¸ƒåˆ°GItHub"><a href="#8ï¼‰é‡æ–°æ‰“åŒ…å‘å¸ƒåˆ°GItHub" class="headerlink" title="8ï¼‰é‡æ–°æ‰“åŒ…å‘å¸ƒåˆ°GItHub"></a>8ï¼‰é‡æ–°æ‰“åŒ…å‘å¸ƒåˆ°GItHub</h4><pre><code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</code></pre><h1 id="Hexoå†™æ–‡ç« åŸºæœ¬æ“ä½œ"><a href="#Hexoå†™æ–‡ç« åŸºæœ¬æ“ä½œ" class="headerlink" title="Hexoå†™æ–‡ç« åŸºæœ¬æ“ä½œ"></a>Hexoå†™æ–‡ç« åŸºæœ¬æ“ä½œ</h1><h2 id="æ­¥éª¤1"><a href="#æ­¥éª¤1" class="headerlink" title="æ­¥éª¤1"></a>æ­¥éª¤1</h2><p>æ‰“å¼€hexoçš„æ ¹ç›®å½•ï¼Œä¹Ÿå°±æ˜¯é‡Œé¢æœ‰_config.yml, source, themesç­‰ç­‰çš„é‚£ä¸ªï¼Œå¯¹äºæˆ‘ä¸ªäººæˆ‘æŠŠä»–å«åšmyblog</p><h2 id="æ­¥éª¤2"><a href="#æ­¥éª¤2" class="headerlink" title="æ­¥éª¤2"></a>æ­¥éª¤2</h2><p>åœ¨è¯¥ç›®å½•ä¸‹æ‰“å¼€git bashï¼Œæ‰§è¡Œè¯¥ä»£ç ï¼Œå¯åœ¨æµè§ˆå™¨æ‰“å¼€<code>http://localhost:4000/</code>è¿›è¡Œå®æ—¶æŸ¥çœ‹è‡ªå·±çš„ç½‘ç«™ã€‚ï¼ˆæ³¨æ„ï¼šæ­¤æ—¶å¤–ç½‘è¿˜ä¸èƒ½è®¿é—®æœ¬åœ°çš„ä¿®æ”¹ï¼Œåªæœ‰æäº¤ä¹‹åæ‰èƒ½è®¿é—®ã€‚ï¼‰</p><pre><code>hexo server</code></pre><h2 id="æ­¥éª¤3ï¼ˆæ­¤æ—¶è¿˜æ˜¯åœ¨æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼‰"><a href="#æ­¥éª¤3ï¼ˆæ­¤æ—¶è¿˜æ˜¯åœ¨æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼‰" class="headerlink" title="æ­¥éª¤3ï¼ˆæ­¤æ—¶è¿˜æ˜¯åœ¨æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼‰"></a>æ­¥éª¤3ï¼ˆæ­¤æ—¶è¿˜æ˜¯åœ¨æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼‰</h2><h3 id="æ–°å»ºå‘å¸ƒæ–‡ç« ï¼ˆpost-pageï¼‰"><a href="#æ–°å»ºå‘å¸ƒæ–‡ç« ï¼ˆpost-pageï¼‰" class="headerlink" title="æ–°å»ºå‘å¸ƒæ–‡ç« ï¼ˆpost pageï¼‰"></a>æ–°å»ºå‘å¸ƒæ–‡ç« ï¼ˆpost pageï¼‰</h3><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åä¼šè‡ªåŠ¨åœ¨<code>\myblog\source\_posts</code>ä¸‹æ–°å»ºä¸€ä¸ª<code>a.md</code>å¹¶ä¸”æ ‡é¢˜æ˜¯â€œaâ€ï¼Œæ­¤æ—¶åˆ·æ–°<code>http://localhost:4000/</code>å¯ä»¥çœ‹åˆ°æœ¬åœ°å·²ç»æ›´æ–°å‡ºæ ‡é¢˜ä¸ºaçš„è¿™ç¯‡æ–‡ç« ã€‚</p><pre><code>hexo new a</code></pre><h3 id="æ–°å»ºè‰ç¨¿ï¼ˆdraft-pageï¼‰"><a href="#æ–°å»ºè‰ç¨¿ï¼ˆdraft-pageï¼‰" class="headerlink" title="æ–°å»ºè‰ç¨¿ï¼ˆdraft pageï¼‰"></a>æ–°å»ºè‰ç¨¿ï¼ˆdraft pageï¼‰</h3><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åä¼šè‡ªåŠ¨åœ¨<code>\myblog\source\_drafts</code>ä¸‹æ–°å»ºä¸€ä¸ª<code>b.md</code>å¹¶ä¸”æ ‡é¢˜æ˜¯â€œbâ€ï¼Œæ­¤æ—¶åˆ·æ–°<code>http://localhost:4000/</code>æœ¬åœ°å¹¶æ²¡æœ‰æ›´æ–°å‡ºè¿™ç¯‡æ–‡ç« ã€‚</p><pre><code>hexo new draft b</code></pre><h3 id="å‘å¸ƒè‰ç¨¿"><a href="#å‘å¸ƒè‰ç¨¿" class="headerlink" title="å‘å¸ƒè‰ç¨¿"></a>å‘å¸ƒè‰ç¨¿</h3><p>è‰ç¨¿å¯ä»¥é€šè¿‡å‘½ä»¤å˜æˆå‘å¸ƒæ–‡ç« ï¼Œä»ç„¶æ˜¯éœ€è¦åœ¨æ ¹ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><pre><code>hexo publish b</code></pre><p>è¿™ä¸ªæ—¶å€™ä½ ä¼šå‘ç°_draftsé‡Œçš„b.mdä¸è§äº†ï¼Œè·‘åˆ°äº†_postsé‡Œé¢,ä¹Ÿå°±è¯´æ˜ä½ çš„è‰ç¨¿å‘å¸ƒæˆåŠŸäº†ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬03ç«  ç”¨æˆ·ä¸æƒé™ç®¡ç†</title>
      <link href="/2023/07/15/%E7%AC%AC03%E7%AB%A0%20%E7%94%A8%E6%88%B7%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/"/>
      <url>/2023/07/15/%E7%AC%AC03%E7%AB%A0%20%E7%94%A8%E6%88%B7%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬03ç« -ç”¨æˆ·ä¸æƒé™ç®¡ç†"><a href="#ç¬¬03ç« -ç”¨æˆ·ä¸æƒé™ç®¡ç†" class="headerlink" title="ç¬¬03ç«  ç”¨æˆ·ä¸æƒé™ç®¡ç†"></a>ç¬¬03ç«  ç”¨æˆ·ä¸æƒé™ç®¡ç†</h3><h4 id="1-ç”¨æˆ·ç®¡ç†"><a href="#1-ç”¨æˆ·ç®¡ç†" class="headerlink" title="1. ç”¨æˆ·ç®¡ç†"></a><strong>1.</strong> <strong>ç”¨æˆ·ç®¡ç†</strong></h4><h5 id="1-1-ç™»å½•MySQLæœåŠ¡å™¨"><a href="#1-1-ç™»å½•MySQLæœåŠ¡å™¨" class="headerlink" title="1.1 ç™»å½•MySQLæœåŠ¡å™¨"></a><strong>1.1</strong> <strong>ç™»å½•MySQLæœåŠ¡å™¨</strong></h5><p>å¯åŠ¨MySQLæœåŠ¡åï¼Œå¯ä»¥é€šè¿‡mysqlå‘½ä»¤æ¥ç™»å½•MySQLæœåŠ¡å™¨ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code class="mysql">mysql â€“h hostname|hostIP â€“P port â€“u username â€“p DatabaseName â€“e &quot;SQLè¯­å¥&quot;</code></pre><ul><li><code>-hå‚æ•°</code>åé¢æ¥ä¸»æœºåæˆ–è€…ä¸»æœºIPï¼Œhostnameä¸ºä¸»æœºï¼ŒhostIPä¸ºä¸»æœºIPã€‚ </li><li><code>-På‚æ•°</code>åé¢æ¥MySQLæœåŠ¡çš„ç«¯å£ï¼Œé€šè¿‡è¯¥å‚æ•°è¿æ¥åˆ°æŒ‡å®šçš„ç«¯å£ã€‚MySQLæœåŠ¡çš„é»˜è®¤ç«¯å£æ˜¯3306ï¼Œä¸ä½¿ç”¨è¯¥å‚æ•°æ—¶è‡ªåŠ¨è¿æ¥åˆ°3306ç«¯å£ï¼Œportä¸ºè¿æ¥çš„ç«¯å£å·ã€‚</li><li><code>-uå‚æ•°</code>åé¢æ¥ç”¨æˆ·åï¼Œusernameä¸ºç”¨æˆ·åã€‚</li><li><code>-på‚æ•°</code>ä¼šæç¤ºè¾“å…¥å¯†ç ã€‚</li><li><code>DatabaseNameå‚æ•°</code>æŒ‡æ˜ç™»å½•åˆ°å“ªä¸€ä¸ªæ•°æ®åº“ä¸­ã€‚å¦‚æœæ²¡æœ‰è¯¥å‚æ•°ï¼Œå°±ä¼šç›´æ¥ç™»å½•åˆ°MySQLæ•°æ®åº“ä¸­ï¼Œç„¶åå¯ä»¥ä½¿ç”¨USEå‘½ä»¤æ¥é€‰æ‹©æ•°æ®åº“ã€‚</li><li><code>-eå‚æ•°</code>åé¢å¯ä»¥ç›´æ¥åŠ SQLè¯­å¥ã€‚ç™»å½•MySQLæœåŠ¡å™¨ä»¥åå³å¯æ‰§è¡Œè¿™ä¸ªSQLè¯­å¥ï¼Œç„¶åé€€å‡ºMySQLæœåŠ¡å™¨ã€‚</li></ul><pre><code class="mysql">mysql -uroot -p -hlocalhost -P3306 mysql -e &quot;select host,user from user&quot;</code></pre><h5 id="1-2-åˆ›å»ºç”¨æˆ·"><a href="#1-2-åˆ›å»ºç”¨æˆ·" class="headerlink" title="1.2 åˆ›å»ºç”¨æˆ·"></a><strong>1.2</strong> <strong>åˆ›å»ºç”¨æˆ·</strong></h5><pre><code class="mysql">CREATE USER ç”¨æˆ·å [IDENTIFIED BY &#39;å¯†ç &#39;][,ç”¨æˆ·å [IDENTIFIED BY &#39;å¯†ç &#39;]];</code></pre><p>ä¸¾ä¾‹ï¼š</p><pre><code class="mysql">CREATE USER zhang3 IDENTIFIED BY &#39;123123&#39;; # é»˜è®¤hostæ˜¯ %CREATE USER &#39;kangshifu&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;123456&#39;;</code></pre><h5 id="1-3-ä¿®æ”¹ç”¨æˆ·"><a href="#1-3-ä¿®æ”¹ç”¨æˆ·" class="headerlink" title="1.3 ä¿®æ”¹ç”¨æˆ·"></a><strong>1.3</strong> <strong>ä¿®æ”¹ç”¨æˆ·</strong></h5><pre><code class="mysql">UPDATE mysql.user SET USER=&#39;li4&#39; WHERE USER=&#39;wang5&#39;; FLUSH PRIVILEGES;</code></pre><h5 id="1-4-åˆ é™¤ç”¨æˆ·"><a href="#1-4-åˆ é™¤ç”¨æˆ·" class="headerlink" title="1.4 åˆ é™¤ç”¨æˆ·"></a><strong>1.4</strong> <strong>åˆ é™¤ç”¨æˆ·</strong></h5><p><strong>æ–¹å¼1ï¼šä½¿ç”¨DROPæ–¹å¼åˆ é™¤ï¼ˆæ¨èï¼‰</strong></p><pre><code class="mysql">DROP USER user[,user]â€¦;</code></pre><p>ä¸¾ä¾‹ï¼š</p><pre><code class="mysql">DROP USER li4 ; # é»˜è®¤åˆ é™¤hostä¸º%çš„ç”¨æˆ·DROP USER &#39;kangshifu&#39;@&#39;localhost&#39;;</code></pre><p><strong>æ–¹å¼2ï¼šä½¿ç”¨DELETEæ–¹å¼åˆ é™¤ï¼ˆä¸æ¨èï¼Œæœ‰æ®‹ç•™ä¿¡æ¯ï¼‰</strong></p><pre><code class="mysql">DELETE FROM mysql.user WHERE Host=â€™hostnameâ€™ AND User=â€™usernameâ€™;FLUSH PRIVILEGES;</code></pre><h5 id="1-5-è®¾ç½®å½“å‰ç”¨æˆ·å¯†ç "><a href="#1-5-è®¾ç½®å½“å‰ç”¨æˆ·å¯†ç " class="headerlink" title="1.5 è®¾ç½®å½“å‰ç”¨æˆ·å¯†ç "></a><strong>1.5</strong> <strong>è®¾ç½®å½“å‰ç”¨æˆ·å¯†ç </strong></h5><p><strong>1.</strong> <strong>ä½¿ç”¨ALTER USERå‘½ä»¤æ¥ä¿®æ”¹å½“å‰ç”¨æˆ·å¯†ç </strong></p><pre><code class="mysql">ALTER USER USER() IDENTIFIED BY &#39;new_password&#39;;</code></pre><p><strong>2.</strong> <strong>ä½¿ç”¨SETè¯­å¥æ¥ä¿®æ”¹å½“å‰ç”¨æˆ·å¯†ç </strong></p><pre><code class="mysql">SET PASSWORD=&#39;new_password&#39;;</code></pre><h5 id="1-6-ä¿®æ”¹å…¶å®ƒç”¨æˆ·å¯†ç "><a href="#1-6-ä¿®æ”¹å…¶å®ƒç”¨æˆ·å¯†ç " class="headerlink" title="1.6 ä¿®æ”¹å…¶å®ƒç”¨æˆ·å¯†ç "></a><strong>1.6</strong> <strong>ä¿®æ”¹å…¶å®ƒç”¨æˆ·å¯†ç </strong></h5><p><strong>1.</strong> <strong>ä½¿ç”¨ALTERè¯­å¥æ¥ä¿®æ”¹æ™®é€šç”¨æˆ·çš„å¯†ç </strong></p><pre><code class="mysql">ALTER USER user [IDENTIFIED BY &#39;æ–°å¯†ç &#39;] [,user[IDENTIFIED BY &#39;æ–°å¯†ç &#39;]]â€¦;</code></pre><p><strong>2.</strong> <strong>ä½¿ç”¨SETå‘½ä»¤æ¥ä¿®æ”¹æ™®é€šç”¨æˆ·çš„å¯†ç </strong></p><pre><code class="mysql">SET PASSWORD FOR &#39;username&#39;@&#39;hostname&#39;=&#39;new_password&#39;;</code></pre><h4 id="2-æƒé™ç®¡ç†"><a href="#2-æƒé™ç®¡ç†" class="headerlink" title="2. æƒé™ç®¡ç†"></a><strong>2.</strong> <strong>æƒé™ç®¡ç†</strong></h4><h5 id="2-1-æƒé™åˆ—è¡¨"><a href="#2-1-æƒé™åˆ—è¡¨" class="headerlink" title="2.1 æƒé™åˆ—è¡¨"></a><strong>2.1</strong> <strong>æƒé™åˆ—è¡¨</strong></h5><pre><code class="mysql">show privileges;</code></pre><ul><li><code>CREATEå’ŒDROPæƒé™</code>ï¼Œå¯ä»¥åˆ›å»ºæ–°çš„æ•°æ®åº“å’Œè¡¨ï¼Œæˆ–åˆ é™¤ï¼ˆç§»æ‰ï¼‰å·²æœ‰çš„æ•°æ®åº“å’Œè¡¨ã€‚å¦‚æœå°†MySQLæ•°æ®åº“ä¸­çš„DROPæƒé™æˆäºˆæŸç”¨æˆ·ï¼Œç”¨æˆ·å°±å¯ä»¥åˆ é™¤MySQLè®¿é—®æƒé™ä¿å­˜çš„æ•°æ®åº“ã€‚</li><li><code>SELECTã€INSERTã€UPDATEå’ŒDELETEæƒé™</code>å…è®¸åœ¨ä¸€ä¸ªæ•°æ®åº“ç°æœ‰çš„è¡¨ä¸Šå®æ–½æ“ä½œã€‚</li><li><code>SELECTæƒé™</code>åªæœ‰åœ¨å®ƒä»¬çœŸæ­£ä»ä¸€ä¸ªè¡¨ä¸­æ£€ç´¢è¡Œæ—¶æ‰è¢«ç”¨åˆ°ã€‚</li><li><code>INDEXæƒé™</code>å…è®¸åˆ›å»ºæˆ–åˆ é™¤ç´¢å¼•ï¼ŒINDEXé€‚ç”¨äºå·²æœ‰çš„è¡¨ã€‚å¦‚æœå…·æœ‰æŸä¸ªè¡¨çš„CREATEæƒé™ï¼Œå°±å¯ä»¥åœ¨CREATE TABLEè¯­å¥ä¸­åŒ…æ‹¬ç´¢å¼•å®šä¹‰ã€‚</li><li><code>ALTERæƒé™</code>å¯ä»¥ä½¿ç”¨ALTER TABLEæ¥æ›´æ”¹è¡¨çš„ç»“æ„å’Œé‡æ–°å‘½åè¡¨ã€‚</li><li><code>CREATE ROUTINEæƒé™</code>ç”¨æ¥åˆ›å»ºä¿å­˜çš„ç¨‹åºï¼ˆå‡½æ•°å’Œç¨‹åºï¼‰ï¼Œ<code>ALTER ROUTINEæƒé™</code>ç”¨æ¥æ›´æ”¹å’Œåˆ é™¤ä¿å­˜çš„ç¨‹åºï¼Œ<code>EXECUTEæƒé™</code>ç”¨æ¥æ‰§è¡Œä¿å­˜çš„ç¨‹åºã€‚</li><li><code>GRANTæƒé™</code>å…è®¸æˆæƒç»™å…¶ä»–ç”¨æˆ·ï¼Œå¯ç”¨äºæ•°æ®åº“ã€è¡¨å’Œä¿å­˜çš„ç¨‹åºã€‚</li><li><code>FILEæƒé™</code>ä½¿ç”¨æˆ·å¯ä»¥ä½¿ç”¨LOAD DATA INFILEå’ŒSELECT â€¦ INTO OUTFILEè¯­å¥è¯»æˆ–å†™æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œä»»ä½•è¢«æˆäºˆFILEæƒé™çš„ç”¨æˆ·éƒ½èƒ½è¯»æˆ–å†™MySQLæœåŠ¡å™¨ä¸Šçš„ä»»ä½•æ–‡ä»¶ï¼ˆè¯´æ˜ç”¨æˆ·å¯ä»¥è¯»ä»»ä½•æ•°æ®åº“ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå› ä¸ºæœåŠ¡å™¨å¯ä»¥è®¿é—®è¿™äº›æ–‡ä»¶ï¼‰ã€‚</li></ul><h5 id="2-2-æˆäºˆæƒé™çš„åŸåˆ™"><a href="#2-2-æˆäºˆæƒé™çš„åŸåˆ™" class="headerlink" title="2.2 æˆäºˆæƒé™çš„åŸåˆ™"></a><strong>2.2</strong> <strong>æˆäºˆæƒé™çš„åŸåˆ™</strong></h5><p>æƒé™æ§åˆ¶ä¸»è¦æ˜¯å‡ºäºå®‰å…¨å› ç´ ï¼Œå› æ­¤éœ€è¦éµå¾ªä»¥ä¸‹å‡ ä¸ª<code>ç»éªŒåŸåˆ™</code>ï¼š</p><p>1ã€åªæˆäºˆèƒ½<code>æ»¡è¶³éœ€è¦çš„æœ€å°æƒé™</code>ï¼Œé˜²æ­¢ç”¨æˆ·å¹²åäº‹ã€‚æ¯”å¦‚ç”¨æˆ·åªæ˜¯éœ€è¦æŸ¥è¯¢ï¼Œé‚£å°±åªç»™selectæƒé™å°±å¯ä»¥äº†ï¼Œä¸è¦ç»™ç”¨æˆ·èµ‹äºˆupdateã€insertæˆ–è€…deleteæƒé™ã€‚</p><p>2ã€åˆ›å»ºç”¨æˆ·çš„æ—¶å€™<code>é™åˆ¶ç”¨æˆ·çš„ç™»å½•ä¸»æœº</code>ï¼Œä¸€èˆ¬æ˜¯é™åˆ¶æˆæŒ‡å®šIPæˆ–è€…å†…ç½‘IPæ®µã€‚</p><p>3ã€ä¸ºæ¯ä¸ªç”¨æˆ·<code>è®¾ç½®æ»¡è¶³å¯†ç å¤æ‚åº¦çš„å¯†ç </code>ã€‚ </p><p>4ã€<code>å®šæœŸæ¸…ç†ä¸éœ€è¦çš„ç”¨æˆ·</code>ï¼Œå›æ”¶æƒé™æˆ–è€…åˆ é™¤ç”¨æˆ·ã€‚</p><h5 id="2-3-æˆäºˆæƒé™"><a href="#2-3-æˆäºˆæƒé™" class="headerlink" title="2.3 æˆäºˆæƒé™"></a><strong>2.3</strong> <strong>æˆäºˆæƒé™</strong></h5><pre><code class="mysql">GRANT æƒé™1,æƒé™2,â€¦æƒé™n ON æ•°æ®åº“åç§°.è¡¨åç§° TO ç”¨æˆ·å@ç”¨æˆ·åœ°å€ [IDENTIFIED BY â€˜å¯†ç å£ä»¤â€™];</code></pre><ul><li>è¯¥æƒé™å¦‚æœå‘ç°æ²¡æœ‰è¯¥ç”¨æˆ·ï¼Œåˆ™ä¼šç›´æ¥æ–°å»ºä¸€ä¸ªç”¨æˆ·ã€‚</li><li>ç»™li4ç”¨æˆ·ç”¨æœ¬åœ°å‘½ä»¤è¡Œæ–¹å¼ï¼Œæˆäºˆatguigudbè¿™ä¸ªåº“ä¸‹çš„æ‰€æœ‰è¡¨çš„æ’åˆ æ”¹æŸ¥çš„æƒé™ã€‚</li></ul><pre><code class="mysql">GRANT SELECT,INSERT,DELETE,UPDATE ON atguigudb.* TO li4@localhost;</code></pre><ul><li>æˆäºˆé€šè¿‡ç½‘ç»œæ–¹å¼ç™»å½•çš„joeç”¨æˆ· ï¼Œå¯¹æ‰€æœ‰åº“æ‰€æœ‰è¡¨çš„å…¨éƒ¨æƒé™ï¼Œå¯†ç è®¾ä¸º123ã€‚æ³¨æ„è¿™é‡Œå”¯ç‹¬ä¸åŒ…æ‹¬grantçš„æƒé™</li></ul><pre><code class="mysql">GRANT ALL PRIVILEGES ON *.* TO joe@&#39;%&#39; IDENTIFIED BY &#39;123&#39;;</code></pre><h5 id="2-4-æŸ¥çœ‹æƒé™"><a href="#2-4-æŸ¥çœ‹æƒé™" class="headerlink" title="2.4 æŸ¥çœ‹æƒé™"></a><strong>2.4</strong> <strong>æŸ¥çœ‹æƒé™</strong></h5><ul><li>æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™</li></ul><pre><code class="mysql">SHOW GRANTS; # æˆ– SHOW GRANTS FOR CURRENT_USER; # æˆ– SHOW GRANTS FOR CURRENT_USER();</code></pre><ul><li>æŸ¥çœ‹æŸç”¨æˆ·çš„å…¨å±€æƒé™</li></ul><pre><code class="mysql">SHOW GRANTS FOR &#39;user&#39;@&#39;ä¸»æœºåœ°å€&#39;;</code></pre><h5 id="2-5-æ”¶å›æƒé™"><a href="#2-5-æ”¶å›æƒé™" class="headerlink" title="2.5 æ”¶å›æƒé™"></a><strong>2.5</strong> <strong>æ”¶å›æƒé™</strong></h5><p><strong>æ³¨æ„ï¼šåœ¨å°†ç”¨æˆ·è´¦æˆ·ä»userè¡¨åˆ é™¤ä¹‹å‰ï¼Œåº”è¯¥æ”¶å›ç›¸åº”ç”¨æˆ·çš„æ‰€æœ‰æƒé™ã€‚</strong></p><ul><li>æ”¶å›æƒé™å‘½ä»¤</li></ul><pre><code class="mysql">REVOKE æƒé™1,æƒé™2,â€¦æƒé™n ON æ•°æ®åº“åç§°.è¡¨åç§° FROM ç”¨æˆ·å@ç”¨æˆ·åœ°å€;</code></pre><ul><li>ä¸¾ä¾‹</li></ul><pre><code class="mysql">#æ”¶å›å…¨åº“å…¨è¡¨çš„æ‰€æœ‰æƒé™ REVOKE ALL PRIVILEGES ON *.* FROM joe@&#39;%&#39;; #æ”¶å›mysqlåº“ä¸‹çš„æ‰€æœ‰è¡¨çš„æ’åˆ æ”¹æŸ¥æƒé™ REVOKE SELECT,INSERT,UPDATE,DELETE ON mysql.* FROM joe@localhost;</code></pre><ul><li>æ³¨æ„ï¼š<code>é¡»ç”¨æˆ·é‡æ–°ç™»å½•åæ‰èƒ½ç”Ÿæ•ˆ</code></li></ul><h4 id="3-è§’è‰²ç®¡ç†"><a href="#3-è§’è‰²ç®¡ç†" class="headerlink" title="3. è§’è‰²ç®¡ç†"></a><strong>3.</strong> <strong>è§’è‰²ç®¡ç†</strong></h4><h5 id="3-1-åˆ›å»ºè§’è‰²"><a href="#3-1-åˆ›å»ºè§’è‰²" class="headerlink" title="3.1 åˆ›å»ºè§’è‰²"></a><strong>3.1</strong> <strong>åˆ›å»ºè§’è‰²</strong></h5><pre><code class="mysql">CREATE ROLE &#39;role_name&#39;[@&#39;host_name&#39;] [,&#39;role_name&#39;[@&#39;host_name&#39;]]...</code></pre><p>è§’è‰²åç§°çš„å‘½åè§„åˆ™å’Œç”¨æˆ·åç±»ä¼¼ã€‚å¦‚æœ<code>host_nameçœç•¥ï¼Œé»˜è®¤ä¸º%</code>ï¼Œ<code>role_nameä¸å¯çœç•¥</code>ï¼Œä¸å¯ä¸ºç©ºã€‚</p><h5 id="3-2-ç»™è§’è‰²èµ‹äºˆæƒé™"><a href="#3-2-ç»™è§’è‰²èµ‹äºˆæƒé™" class="headerlink" title="3.2 ç»™è§’è‰²èµ‹äºˆæƒé™"></a><strong>3.2</strong> <strong>ç»™è§’è‰²èµ‹äºˆæƒé™</strong></h5><pre><code class="mysql">GRANT privileges ON table_name TO &#39;role_name&#39;[@&#39;host_name&#39;];</code></pre><p>ä¸Šè¿°è¯­å¥ä¸­privilegesä»£è¡¨æƒé™çš„åç§°ï¼Œå¤šä¸ªæƒé™ä»¥é€—å·éš”å¼€ã€‚å¯ä½¿ç”¨SHOWè¯­å¥æŸ¥è¯¢æƒé™åç§°</p><pre><code class="mysql">SHOW PRIVILEGES\G</code></pre><h5 id="3-3-æŸ¥çœ‹è§’è‰²çš„æƒé™"><a href="#3-3-æŸ¥çœ‹è§’è‰²çš„æƒé™" class="headerlink" title="3.3 æŸ¥çœ‹è§’è‰²çš„æƒé™"></a><strong>3.3</strong> <strong>æŸ¥çœ‹è§’è‰²çš„æƒé™</strong></h5><pre><code class="mysql">SHOW GRANTS FOR &#39;role_name&#39;;</code></pre><p>åªè¦ä½ åˆ›å»ºäº†ä¸€ä¸ªè§’è‰²ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨ç»™ä½ ä¸€ä¸ªâ€œ<code>USAGE</code>â€æƒé™ï¼Œæ„æ€æ˜¯<code>è¿æ¥ç™»å½•æ•°æ®åº“çš„æƒé™</code>ã€‚</p><h5 id="3-4-å›æ”¶è§’è‰²çš„æƒé™"><a href="#3-4-å›æ”¶è§’è‰²çš„æƒé™" class="headerlink" title="3.4 å›æ”¶è§’è‰²çš„æƒé™"></a><strong>3.4</strong> <strong>å›æ”¶è§’è‰²çš„æƒé™</strong></h5><pre><code class="mysql">REVOKE privileges ON tablename FROM &#39;rolename&#39;;</code></pre><h5 id="3-5-åˆ é™¤è§’è‰²"><a href="#3-5-åˆ é™¤è§’è‰²" class="headerlink" title="3.5 åˆ é™¤è§’è‰²"></a><strong>3.5</strong> <strong>åˆ é™¤è§’è‰²</strong></h5><pre><code class="mysql">DROP ROLE role [,role2]...</code></pre><p>æ³¨æ„ï¼Œ<code>å¦‚æœä½ åˆ é™¤äº†è§’è‰²ï¼Œé‚£ä¹ˆç”¨æˆ·ä¹Ÿå°±å¤±å»äº†é€šè¿‡è¿™ä¸ªè§’è‰²æ‰€è·å¾—çš„æ‰€æœ‰æƒé™</code>ã€‚</p><h5 id="3-6-ç»™ç”¨æˆ·èµ‹äºˆè§’è‰²"><a href="#3-6-ç»™ç”¨æˆ·èµ‹äºˆè§’è‰²" class="headerlink" title="3.6 ç»™ç”¨æˆ·èµ‹äºˆè§’è‰²"></a><strong>3.6</strong> <strong>ç»™ç”¨æˆ·èµ‹äºˆè§’è‰²</strong></h5><p>è§’è‰²åˆ›å»ºå¹¶æˆæƒåï¼Œè¦èµ‹ç»™ç”¨æˆ·å¹¶å¤„äº<code>æ¿€æ´»çŠ¶æ€</code>æ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚</p><pre><code class="mysql">GRANT role [,role2,...] TO user [,user2,...];</code></pre><p>æŸ¥è¯¢å½“å‰å·²æ¿€æ´»çš„è§’è‰²</p><pre><code class="mysql">SELECT CURRENT_ROLE();</code></pre><h5 id="3-7-æ¿€æ´»è§’è‰²"><a href="#3-7-æ¿€æ´»è§’è‰²" class="headerlink" title="3.7 æ¿€æ´»è§’è‰²"></a><strong>3.7</strong> <strong>æ¿€æ´»è§’è‰²</strong></h5><p><strong>æ–¹å¼1ï¼šä½¿ç”¨set default role å‘½ä»¤æ¿€æ´»è§’è‰²</strong></p><pre><code class="mysql">SET DEFAULT ROLE ALL TO &#39;kangshifu&#39;@&#39;localhost&#39;;</code></pre><p><strong>æ–¹å¼2ï¼šå°†activate_all_roles_on_loginè®¾ç½®ä¸ºON</strong></p><pre><code class="mysql">SET GLOBAL activate_all_roles_on_login=ON;</code></pre><p>è¿™æ¡ SQL è¯­å¥çš„æ„æ€æ˜¯ï¼Œå¯¹<code>æ‰€æœ‰è§’è‰²æ°¸ä¹…æ¿€æ´»</code>ã€‚</p><h5 id="3-8-æ’¤é”€ç”¨æˆ·çš„è§’è‰²"><a href="#3-8-æ’¤é”€ç”¨æˆ·çš„è§’è‰²" class="headerlink" title="3.8 æ’¤é”€ç”¨æˆ·çš„è§’è‰²"></a><strong>3.8</strong> <strong>æ’¤é”€ç”¨æˆ·çš„è§’è‰²</strong></h5><pre><code class="mysql">REVOKE role FROM user;</code></pre><h5 id="3-9-è®¾ç½®å¼ºåˆ¶è§’è‰²-mandatory-role"><a href="#3-9-è®¾ç½®å¼ºåˆ¶è§’è‰²-mandatory-role" class="headerlink" title="3.9 è®¾ç½®å¼ºåˆ¶è§’è‰²(mandatory role)"></a><strong>3.9</strong> <strong>è®¾ç½®å¼ºåˆ¶è§’è‰²(mandatory role)</strong></h5><p>æ–¹å¼1ï¼šæœåŠ¡å¯åŠ¨å‰è®¾ç½®</p><pre><code class="ini">[mysqld] mandatory_roles=&#39;role1,role2@localhost,r3@%.atguigu.com&#39;</code></pre><p>æ–¹å¼2ï¼šè¿è¡Œæ—¶è®¾ç½®</p><pre><code class="mysql">SET PERSIST mandatory_roles = &#39;role1,role2@localhost,r3@%.example.com&#39;; #ç³»ç»Ÿé‡å¯åä»ç„¶æœ‰æ•ˆSET GLOBAL mandatory_roles = &#39;role1,role2@localhost,r3@%.example.com&#39;; #ç³»ç»Ÿé‡å¯åå¤±æ•ˆ</code></pre><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬05ç«  å­˜å‚¨å¼•æ“</title>
      <link href="/2023/07/15/%E7%AC%AC05%E7%AB%A0%20%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/"/>
      <url>/2023/07/15/%E7%AC%AC05%E7%AB%A0%20%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬05ç« -å­˜å‚¨å¼•æ“"><a href="#ç¬¬05ç« -å­˜å‚¨å¼•æ“" class="headerlink" title="ç¬¬05ç«  å­˜å‚¨å¼•æ“"></a>ç¬¬05ç«  å­˜å‚¨å¼•æ“</h3><h4 id="1-æŸ¥çœ‹å­˜å‚¨å¼•æ“"><a href="#1-æŸ¥çœ‹å­˜å‚¨å¼•æ“" class="headerlink" title="1. æŸ¥çœ‹å­˜å‚¨å¼•æ“"></a><strong>1.</strong> <strong>æŸ¥çœ‹å­˜å‚¨å¼•æ“</strong></h4><pre><code class="mysql">show engines;# æˆ–show engines\G</code></pre><h4 id="2-è®¾ç½®ç³»ç»Ÿé»˜è®¤çš„å­˜å‚¨å¼•æ“"><a href="#2-è®¾ç½®ç³»ç»Ÿé»˜è®¤çš„å­˜å‚¨å¼•æ“" class="headerlink" title="2. è®¾ç½®ç³»ç»Ÿé»˜è®¤çš„å­˜å‚¨å¼•æ“"></a><strong>2.</strong> <strong>è®¾ç½®ç³»ç»Ÿé»˜è®¤çš„å­˜å‚¨å¼•æ“</strong></h4><ul><li>æŸ¥çœ‹é»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼š</li></ul><pre><code class="mysql">show variables like &#39;%storage_engine%&#39;; #æˆ–SELECT @@default_storage_engine;</code></pre><ul><li>ä¿®æ”¹é»˜è®¤çš„å­˜å‚¨å¼•æ“</li></ul><p>å¦‚æœåœ¨åˆ›å»ºè¡¨çš„è¯­å¥ä¸­æ²¡æœ‰æ˜¾å¼æŒ‡å®šè¡¨çš„å­˜å‚¨å¼•æ“çš„è¯ï¼Œé‚£å°±ä¼šé»˜è®¤ä½¿ç”¨<code>InnoDB</code>ä½œä¸ºè¡¨çš„å­˜å‚¨å¼•æ“ã€‚</p><pre><code class="mysql">SET DEFAULT_STORAGE_ENGINE=MyISAM;</code></pre><p>æˆ–è€…ä¿®æ”¹<code>my.cnf</code>æ–‡ä»¶ï¼š</p><pre><code class="ini">default-storage-engine=MyISAM </code></pre><pre><code class="shell"># é‡å¯æœåŠ¡ systemctl restart mysqld.service</code></pre><h4 id="3-è®¾ç½®è¡¨çš„å­˜å‚¨å¼•æ“"><a href="#3-è®¾ç½®è¡¨çš„å­˜å‚¨å¼•æ“" class="headerlink" title="3. è®¾ç½®è¡¨çš„å­˜å‚¨å¼•æ“"></a><strong>3.</strong> <strong>è®¾ç½®è¡¨çš„å­˜å‚¨å¼•æ“</strong></h4><p>å­˜å‚¨å¼•æ“æ˜¯è´Ÿè´£å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œæå–å’Œå†™å…¥å·¥ä½œçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º<code>ä¸åŒçš„è¡¨è®¾ç½®ä¸åŒçš„å­˜å‚¨å¼•æ“</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒçš„è¡¨å¯ä»¥æœ‰ä¸åŒçš„ç‰©ç†å­˜å‚¨ç»“æ„ï¼Œä¸åŒçš„æå–å’Œå†™å…¥æ–¹å¼ã€‚</p><h5 id="3-1-åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“"><a href="#3-1-åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“" class="headerlink" title="3.1 åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“"></a><strong>3.1</strong> <strong>åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“</strong></h5><pre><code class="mysql">CREATE TABLE è¡¨å(    å»ºè¡¨è¯­å¥; ) ENGINE = å­˜å‚¨å¼•æ“åç§°;</code></pre><h5 id="3-2-ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“"><a href="#3-2-ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“" class="headerlink" title="3.2 ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“"></a><strong>3.2</strong> <strong>ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“</strong></h5><pre><code class="mysql">ALTER TABLE è¡¨å ENGINE = å­˜å‚¨å¼•æ“åç§°;</code></pre><h4 id="4-å¼•æ“ä»‹ç»"><a href="#4-å¼•æ“ä»‹ç»" class="headerlink" title="4. å¼•æ“ä»‹ç»"></a><strong>4.</strong> <strong>å¼•æ“ä»‹ç»</strong></h4><h5 id="4-1-InnoDB-å¼•æ“ï¼šå…·å¤‡å¤–é”®æ”¯æŒåŠŸèƒ½çš„äº‹åŠ¡å­˜å‚¨å¼•æ“"><a href="#4-1-InnoDB-å¼•æ“ï¼šå…·å¤‡å¤–é”®æ”¯æŒåŠŸèƒ½çš„äº‹åŠ¡å­˜å‚¨å¼•æ“" class="headerlink" title="4.1 InnoDB å¼•æ“ï¼šå…·å¤‡å¤–é”®æ”¯æŒåŠŸèƒ½çš„äº‹åŠ¡å­˜å‚¨å¼•æ“"></a><strong>4.1 InnoDB</strong> <strong>å¼•æ“ï¼šå…·å¤‡å¤–é”®æ”¯æŒåŠŸèƒ½çš„äº‹åŠ¡å­˜å‚¨å¼•æ“</strong></h5><ul><li>MySQLä»3.23.34aå¼€å§‹å°±åŒ…å«InnoDBå­˜å‚¨å¼•æ“ã€‚<code>å¤§äºç­‰äº5.5ä¹‹åï¼Œé»˜è®¤é‡‡ç”¨InnoDBå¼•æ“</code>ã€‚ </li><li>InnoDBæ˜¯MySQLçš„<code>é»˜è®¤äº‹åŠ¡å‹å¼•æ“</code>ï¼Œå®ƒè¢«è®¾è®¡ç”¨æ¥å¤„ç†å¤§é‡çš„çŸ­æœŸ(short-lived)äº‹åŠ¡ã€‚å¯ä»¥ç¡®ä¿äº‹åŠ¡çš„å®Œæ•´æäº¤(Commit)å’Œå›æ»š(Rollback)ã€‚</li><li>é™¤äº†å¢åŠ å’ŒæŸ¥è¯¢å¤–ï¼Œè¿˜éœ€è¦æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆï¼Œåº”ä¼˜å…ˆé€‰æ‹©InnoDBå­˜å‚¨å¼•æ“ã€‚</li><li><strong>é™¤éæœ‰éå¸¸ç‰¹åˆ«çš„åŸå› éœ€è¦ä½¿ç”¨å…¶ä»–çš„å­˜å‚¨å¼•æ“ï¼Œå¦åˆ™åº”è¯¥ä¼˜å…ˆè€ƒè™‘InnoDBå¼•æ“ã€‚</strong></li><li>æ•°æ®æ–‡ä»¶ç»“æ„ï¼š<ul><li>è¡¨å.frm å­˜å‚¨è¡¨ç»“æ„ï¼ˆMySQL8.0æ—¶ï¼Œåˆå¹¶åœ¨è¡¨å.ibdä¸­ï¼‰</li><li>è¡¨å.ibd å­˜å‚¨æ•°æ®å’Œç´¢å¼•</li></ul></li><li>InnoDBæ˜¯<code>ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡</code>ã€‚<ul><li>åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå­—å…¸æ•°æ®ä»¥å…ƒæ•°æ®æ–‡ä»¶ã€éäº‹åŠ¡è¡¨ç­‰æ¥å­˜å‚¨ã€‚ç°åœ¨è¿™äº›å…ƒæ•°æ®æ–‡ä»¶è¢«åˆ é™¤äº†ã€‚æ¯”å¦‚ï¼š<code>.frm</code>ï¼Œ<code>.par</code>ï¼Œ<code>.trn</code>ï¼Œ<code>.isl</code>ï¼Œ<code>.db.opt</code>ç­‰éƒ½åœ¨MySQL8.0ä¸­ä¸å­˜åœ¨äº†ã€‚</li></ul></li><li>å¯¹æ¯”MyISAMçš„å­˜å‚¨å¼•æ“ï¼Œ<code>InnoDBå†™çš„å¤„ç†æ•ˆç‡å·®ä¸€äº›</code>ï¼Œå¹¶ä¸”ä¼šå ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ä»¥ä¿å­˜æ•°æ®å’Œç´¢å¼•ã€‚</li><li>MyISAMåªç¼“å­˜ç´¢å¼•ï¼Œä¸ç¼“å­˜çœŸå®æ•°æ®ï¼›InnoDBä¸ä»…ç¼“å­˜ç´¢å¼•è¿˜è¦ç¼“å­˜çœŸå®æ•°æ®ï¼Œ<code>å¯¹å†…å­˜è¦æ±‚è¾ƒé«˜</code>ï¼Œè€Œä¸”å†…å­˜å¤§å°å¯¹æ€§èƒ½æœ‰å†³å®šæ€§çš„å½±å“ã€‚</li></ul><h5 id="4-2-MyISAM-å¼•æ“ï¼šä¸»è¦çš„éäº‹åŠ¡å¤„ç†å­˜å‚¨å¼•æ“"><a href="#4-2-MyISAM-å¼•æ“ï¼šä¸»è¦çš„éäº‹åŠ¡å¤„ç†å­˜å‚¨å¼•æ“" class="headerlink" title="4.2 MyISAM å¼•æ“ï¼šä¸»è¦çš„éäº‹åŠ¡å¤„ç†å­˜å‚¨å¼•æ“"></a><strong>4.2 MyISAM</strong> <strong>å¼•æ“ï¼šä¸»è¦çš„éäº‹åŠ¡å¤„ç†å­˜å‚¨å¼•æ“</strong></h5><ul><li>MyISAMæä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ï¼Œä½†MyISAM<code>ä¸æ”¯æŒäº‹åŠ¡ã€è¡Œçº§é”ã€å¤–é”®</code>ï¼Œæœ‰ä¸€ä¸ªæ¯«æ— ç–‘é—®çš„ç¼ºé™·å°±æ˜¯<code>å´©æºƒåæ— æ³•å®‰å…¨æ¢å¤</code>ã€‚ </li><li><code>5.5ä¹‹å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“</code></li><li>ä¼˜åŠ¿æ˜¯è®¿é—®çš„<code>é€Ÿåº¦å¿«</code>ï¼Œå¯¹äº‹åŠ¡å®Œæ•´æ€§æ²¡æœ‰è¦æ±‚æˆ–è€…ä»¥SELECTã€INSERTä¸ºä¸»çš„åº”ç”¨</li><li>é’ˆå¯¹æ•°æ®ç»Ÿè®¡æœ‰é¢å¤–çš„å¸¸æ•°å­˜å‚¨ã€‚æ•…è€Œ count(*) çš„æŸ¥è¯¢æ•ˆç‡å¾ˆé«˜</li><li>æ•°æ®æ–‡ä»¶ç»“æ„ï¼š<ul><li>è¡¨å.frm å­˜å‚¨è¡¨ç»“æ„</li><li>è¡¨å.MYD å­˜å‚¨æ•°æ® (MYData)</li><li>è¡¨å.MYI å­˜å‚¨ç´¢å¼• (MYIndex)</li></ul></li><li>åº”ç”¨åœºæ™¯ï¼šåªè¯»åº”ç”¨æˆ–è€…ä»¥è¯»ä¸ºä¸»çš„ä¸šåŠ¡</li></ul><h5 id="4-3-Archive-å¼•æ“ï¼šç”¨äºæ•°æ®å­˜æ¡£"><a href="#4-3-Archive-å¼•æ“ï¼šç”¨äºæ•°æ®å­˜æ¡£" class="headerlink" title="4.3 Archive å¼•æ“ï¼šç”¨äºæ•°æ®å­˜æ¡£"></a><strong>4.3 Archive</strong> <strong>å¼•æ“ï¼šç”¨äºæ•°æ®å­˜æ¡£</strong></h5><h5 id="4-4-Blackhole-å¼•æ“ï¼šä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹"><a href="#4-4-Blackhole-å¼•æ“ï¼šä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹" class="headerlink" title="4.4 Blackhole å¼•æ“ï¼šä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹"></a><strong>4.4 Blackhole</strong> <strong>å¼•æ“ï¼šä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹</strong></h5><h5 id="4-5-CSV-å¼•æ“ï¼šå­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹"><a href="#4-5-CSV-å¼•æ“ï¼šå­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹" class="headerlink" title="4.5 CSV å¼•æ“ï¼šå­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹"></a><strong>4.5 CSV</strong> <strong>å¼•æ“ï¼šå­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹</strong></h5><h5 id="4-6-Memory-å¼•æ“ï¼šç½®äºå†…å­˜çš„è¡¨"><a href="#4-6-Memory-å¼•æ“ï¼šç½®äºå†…å­˜çš„è¡¨" class="headerlink" title="4.6 Memory å¼•æ“ï¼šç½®äºå†…å­˜çš„è¡¨"></a><strong>4.6 Memory</strong> <strong>å¼•æ“ï¼šç½®äºå†…å­˜çš„è¡¨</strong></h5><h5 id="4-7-Federated-å¼•æ“ï¼šè®¿é—®è¿œç¨‹è¡¨"><a href="#4-7-Federated-å¼•æ“ï¼šè®¿é—®è¿œç¨‹è¡¨" class="headerlink" title="4.7 Federated å¼•æ“ï¼šè®¿é—®è¿œç¨‹è¡¨"></a><strong>4.7 Federated</strong> <strong>å¼•æ“ï¼šè®¿é—®è¿œç¨‹è¡¨</strong></h5><h5 id="4-8-Mergeå¼•æ“ï¼šç®¡ç†å¤šä¸ªMyISAMè¡¨æ„æˆçš„è¡¨é›†åˆ"><a href="#4-8-Mergeå¼•æ“ï¼šç®¡ç†å¤šä¸ªMyISAMè¡¨æ„æˆçš„è¡¨é›†åˆ" class="headerlink" title="4.8 Mergeå¼•æ“ï¼šç®¡ç†å¤šä¸ªMyISAMè¡¨æ„æˆçš„è¡¨é›†åˆ"></a><strong>4.8 Mergeå¼•æ“ï¼šç®¡ç†å¤šä¸ªMyISAMè¡¨æ„æˆçš„è¡¨é›†åˆ</strong></h5><h5 id="4-9-NDBå¼•æ“ï¼šMySQLé›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“"><a href="#4-9-NDBå¼•æ“ï¼šMySQLé›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“" class="headerlink" title="4.9 NDBå¼•æ“ï¼šMySQLé›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“"></a><strong>4.9 NDBå¼•æ“ï¼šMySQLé›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“</strong></h5><h4 id="5-MyISAMå’ŒInnoDB"><a href="#5-MyISAMå’ŒInnoDB" class="headerlink" title="5. MyISAMå’ŒInnoDB"></a><strong>5. MyISAMå’ŒInnoDB</strong></h4><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th><strong>MyISAM</strong></th><th><strong>InnoDB</strong></th></tr></thead><tbody><tr><td>å¤–é”®</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>äº‹åŠ¡</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>è¡Œè¡¨é”</td><td>è¡¨é”ï¼Œå³ä½¿æ“ä½œä¸€æ¡è®°å½•ä¹Ÿä¼šé”ä½æ•´ä¸ªè¡¨ï¼Œä¸é€‚åˆé«˜å¹¶å‘çš„æ“ä½œ</td><td>è¡Œé”ï¼Œæ“ä½œæ—¶åªé”æŸä¸€è¡Œï¼Œä¸å¯¹å…¶å®ƒè¡Œæœ‰å½±å“ï¼Œé€‚åˆé«˜å¹¶å‘çš„æ“ä½œ</td></tr><tr><td>ç¼“å­˜</td><td>åªç¼“å­˜ç´¢å¼•ï¼Œä¸ç¼“å­˜çœŸå®æ•°æ®</td><td>ä¸ä»…ç¼“å­˜ç´¢å¼•è¿˜è¦ç¼“å­˜çœŸå®æ•°æ®ï¼Œå¯¹å†…å­˜è¦æ±‚è¾ƒé«˜ï¼Œè€Œä¸”å†…å­˜å¤§å°å¯¹æ€§èƒ½æœ‰å†³å®šæ€§çš„å½±å“</td></tr><tr><td>è‡ªå¸¦ç³»ç»Ÿè¡¨ä½¿ç”¨</td><td>Y</td><td>N</td></tr><tr><td>å…³æ³¨ç‚¹</td><td>æ€§èƒ½ï¼šèŠ‚çœèµ„æºã€æ¶ˆè€—å°‘ã€ç®€å•ä¸šåŠ¡</td><td>äº‹åŠ¡ï¼šå¹¶å‘å†™ã€äº‹åŠ¡ã€æ›´å¤§èµ„æº</td></tr><tr><td>é»˜è®¤å®‰è£…</td><td>Y</td><td>Y</td></tr><tr><td>é»˜è®¤ä½¿ç”¨</td><td>N</td><td>Y</td></tr></tbody></table><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬04ç«  é€»è¾‘æ¶æ„</title>
      <link href="/2023/07/15/%E7%AC%AC04%E7%AB%A0%20%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84/"/>
      <url>/2023/07/15/%E7%AC%AC04%E7%AB%A0%20%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬04ç« -é€»è¾‘æ¶æ„"><a href="#ç¬¬04ç« -é€»è¾‘æ¶æ„" class="headerlink" title="ç¬¬04ç«  é€»è¾‘æ¶æ„"></a>ç¬¬04ç«  é€»è¾‘æ¶æ„</h3><h4 id="1-é€»è¾‘æ¶æ„å‰–æ"><a href="#1-é€»è¾‘æ¶æ„å‰–æ" class="headerlink" title="1. é€»è¾‘æ¶æ„å‰–æ"></a><strong>1.</strong> <strong>é€»è¾‘æ¶æ„å‰–æ</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203291130782.png" alt="MySQLæœåŠ¡å™¨ç«¯çš„é€»è¾‘æ¶æ„è¯´æ˜"></p><h5 id="1-1-ç¬¬1å±‚ï¼šè¿æ¥å±‚"><a href="#1-1-ç¬¬1å±‚ï¼šè¿æ¥å±‚" class="headerlink" title="1.1 ç¬¬1å±‚ï¼šè¿æ¥å±‚"></a><strong>1.1</strong> <strong>ç¬¬1å±‚ï¼šè¿æ¥å±‚</strong></h5><p>ç³»ç»Ÿï¼ˆå®¢æˆ·ç«¯ï¼‰è®¿é—®<code>MySQL</code>æœåŠ¡å™¨å‰ï¼Œåšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯å»ºç«‹<code>TCP</code>è¿æ¥ã€‚</p><p>ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥æˆåŠŸåï¼Œ<code>MySQL</code>æœåŠ¡å™¨å¯¹<code>TCP</code>ä¼ è¾“è¿‡æ¥çš„è´¦å·å¯†ç åšèº«ä»½è®¤è¯ã€æƒé™è·å–ã€‚</p><ul><li><strong>ç”¨æˆ·åæˆ–å¯†ç ä¸å¯¹ï¼Œä¼šæ”¶åˆ°ä¸€ä¸ªAccess denied for useré”™è¯¯ï¼Œå®¢æˆ·ç«¯ç¨‹åºç»“æŸæ‰§è¡Œ</strong></li><li><strong>ç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡ï¼Œä¼šä»æƒé™è¡¨æŸ¥å‡ºè´¦å·æ‹¥æœ‰çš„æƒé™ä¸è¿æ¥å…³è”ï¼Œä¹‹åçš„æƒé™åˆ¤æ–­é€»è¾‘ï¼Œéƒ½å°†ä¾èµ–äºæ­¤æ—¶è¯»åˆ°çš„æƒé™</strong></li></ul><p><code>TCP</code>è¿æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¿…é¡»è¦åˆ†é…ç»™ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨ä¸è¿™ä¸ªå®¢æˆ·ç«¯çš„äº¤äº’ã€‚æ‰€ä»¥è¿˜ä¼šæœ‰ä¸ªçº¿ç¨‹æ± ï¼Œå»èµ°åé¢çš„æµç¨‹ã€‚æ¯ä¸€ä¸ªè¿æ¥ä»çº¿ç¨‹æ± ä¸­è·å–çº¿ç¨‹ï¼Œçœå»äº†åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„å¼€é”€ã€‚</p><h5 id="1-2-ç¬¬2å±‚ï¼šæœåŠ¡å±‚"><a href="#1-2-ç¬¬2å±‚ï¼šæœåŠ¡å±‚" class="headerlink" title="1.2 ç¬¬2å±‚ï¼šæœåŠ¡å±‚"></a><strong>1.2</strong> <strong>ç¬¬2å±‚ï¼šæœåŠ¡å±‚</strong></h5><ul><li><p><strong>SQL Interface: SQLæ¥å£</strong></p><ul><li>æ¥æ”¶ç”¨æˆ·çš„SQLå‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›ç”¨æˆ·éœ€è¦æŸ¥è¯¢çš„ç»“æœã€‚æ¯”å¦‚SELECT â€¦ FROMå°±æ˜¯è°ƒç”¨SQL Interface </li><li>MySQLæ”¯æŒDMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰ã€DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰ã€å­˜å‚¨è¿‡ç¨‹ã€è§†å›¾ã€è§¦å‘å™¨ã€è‡ªå®šä¹‰å‡½æ•°ç­‰å¤šç§SQLè¯­è¨€æ¥å£</li></ul></li><li><p><strong>Parser:</strong> <strong>è§£æå™¨</strong></p><ul><li>åœ¨è§£æå™¨ä¸­å¯¹ SQL è¯­å¥è¿›è¡Œè¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€‚å°†SQLè¯­å¥åˆ†è§£æˆæ•°æ®ç»“æ„ï¼Œå¹¶å°†è¿™ä¸ªç»“æ„ä¼ é€’åˆ°åç»­æ­¥éª¤ï¼Œä»¥åSQLè¯­å¥çš„ä¼ é€’å’Œå¤„ç†å°±æ˜¯åŸºäºè¿™ä¸ªç»“æ„çš„ã€‚å¦‚æœåœ¨åˆ†è§£æ„æˆä¸­é‡åˆ°é”™è¯¯ï¼Œé‚£ä¹ˆå°±è¯´æ˜è¿™ä¸ªSQLè¯­å¥æ˜¯ä¸åˆç†çš„ã€‚</li><li>åœ¨SQLå‘½ä»¤ä¼ é€’åˆ°è§£æå™¨çš„æ—¶å€™ä¼šè¢«è§£æå™¨éªŒè¯å’Œè§£æï¼Œå¹¶ä¸ºå…¶åˆ›å»º<code>è¯­æ³•æ ‘</code>ï¼Œå¹¶æ ¹æ®æ•°æ®å­—å…¸ä¸°å¯ŒæŸ¥è¯¢è¯­æ³•æ ‘ï¼Œä¼š<code>éªŒè¯è¯¥å®¢æˆ·ç«¯æ˜¯å¦å…·æœ‰æ‰§è¡Œè¯¥æŸ¥è¯¢çš„æƒé™</code>ã€‚åˆ›å»ºå¥½è¯­æ³•æ ‘åï¼ŒMySQLè¿˜ä¼šå¯¹SQLæŸ¥è¯¢è¿›è¡Œè¯­æ³•ä¸Šçš„ä¼˜åŒ–ï¼Œè¿›è¡ŒæŸ¥è¯¢é‡å†™ã€‚</li></ul></li><li><p><strong>Optimizer:</strong> <strong>æŸ¥è¯¢ä¼˜åŒ–å™¨</strong></p><ul><li>SQLè¯­å¥åœ¨è¯­æ³•è§£æä¹‹åã€æŸ¥è¯¢ä¹‹å‰ä¼šä½¿ç”¨æŸ¥è¯¢ä¼˜åŒ–å™¨ç¡®å®š SQL è¯­å¥çš„æ‰§è¡Œè·¯å¾„ï¼Œç”Ÿæˆä¸€ä¸ª<code>æ‰§è¡Œè®¡åˆ’</code>ã€‚</li><li>è¿™ä¸ªæ‰§è¡Œè®¡åˆ’è¡¨æ˜åº”è¯¥<code>ä½¿ç”¨å“ªäº›ç´¢å¼•</code>è¿›è¡ŒæŸ¥è¯¢ï¼ˆå…¨è¡¨æ£€ç´¢è¿˜æ˜¯ä½¿ç”¨ç´¢å¼•æ£€ç´¢ï¼‰ï¼Œè¡¨ä¹‹é—´çš„è¿æ¥é¡ºåºå¦‚ä½•ï¼Œæœ€åä¼šæŒ‰ç…§æ‰§è¡Œè®¡åˆ’ä¸­çš„æ­¥éª¤è°ƒç”¨å­˜å‚¨å¼•æ“æä¾›çš„æ–¹æ³•æ¥çœŸæ­£çš„æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚</li><li>å®ƒä½¿ç”¨â€œ<code>é€‰å–-æŠ•å½±-è¿æ¥</code>â€ç­–ç•¥è¿›è¡ŒæŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼š</li></ul><pre><code class="mysql">SELECT id,name FROM student WHERE gender = &#39;å¥³&#39;;</code></pre><p>è¿™ä¸ªSELECTæŸ¥è¯¢å…ˆæ ¹æ®WHEREè¯­å¥è¿›è¡Œ<code>é€‰å–</code>ï¼Œè€Œä¸æ˜¯å°†è¡¨å…¨éƒ¨æŸ¥è¯¢å‡ºæ¥ä»¥åå†è¿›è¡Œgenderè¿‡æ»¤ã€‚ è¿™ä¸ªSELECTæŸ¥è¯¢å…ˆæ ¹æ®idå’Œnameè¿›è¡Œå±æ€§<code>æŠ•å½±</code>ï¼Œè€Œä¸æ˜¯å°†å±æ€§å…¨éƒ¨å–å‡ºä»¥åå†è¿›è¡Œè¿‡æ»¤ï¼Œå°†è¿™ä¸¤ä¸ªæŸ¥è¯¢æ¡ä»¶<code>è¿æ¥</code>èµ·æ¥ç”Ÿæˆæœ€ç»ˆæŸ¥è¯¢ç»“æœã€‚</p></li><li><p><strong>Caches &amp; Buffersï¼š æŸ¥è¯¢ç¼“å­˜ç»„ä»¶</strong></p><ul><li>MySQLå†…éƒ¨ç»´æŒç€ä¸€äº›Cacheå’ŒBufferï¼Œæ¯”å¦‚Query Cacheç”¨æ¥ç¼“å­˜ä¸€æ¡SELECTè¯­å¥çš„æ‰§è¡Œç»“æœï¼Œå¦‚æœèƒ½å¤Ÿåœ¨å…¶ä¸­æ‰¾åˆ°å¯¹åº”çš„æŸ¥è¯¢ç»“æœï¼Œé‚£ä¹ˆå°±ä¸å¿…å†è¿›è¡ŒæŸ¥è¯¢è§£æã€ä¼˜åŒ–å’Œæ‰§è¡Œçš„æ•´ä¸ªè¿‡ç¨‹äº†ï¼Œç›´æ¥å°†ç»“æœåé¦ˆç»™å®¢æˆ·ç«¯ã€‚</li><li>è¿™ä¸ªç¼“å­˜æœºåˆ¶æ˜¯ç”±ä¸€ç³»åˆ—å°ç¼“å­˜ç»„æˆçš„ã€‚æ¯”å¦‚è¡¨ç¼“å­˜ï¼Œè®°å½•ç¼“å­˜ï¼Œkeyç¼“å­˜ï¼Œæƒé™ç¼“å­˜ç­‰ ã€‚</li><li>è¿™ä¸ªæŸ¥è¯¢ç¼“å­˜å¯ä»¥åœ¨<code>ä¸åŒå®¢æˆ·ç«¯ä¹‹é—´å…±äº«</code>ã€‚ </li><li>ä»MySQL 5.7.20å¼€å§‹ï¼Œä¸æ¨èä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶åœ¨<code>MySQL 8.0ä¸­åˆ é™¤</code>ã€‚</li></ul></li></ul><h5 id="1-3-ç¬¬3å±‚ï¼šå¼•æ“å±‚"><a href="#1-3-ç¬¬3å±‚ï¼šå¼•æ“å±‚" class="headerlink" title="1.3 ç¬¬3å±‚ï¼šå¼•æ“å±‚"></a><strong>1.3</strong> <strong>ç¬¬3å±‚ï¼šå¼•æ“å±‚</strong></h5><p>æ’ä»¶å¼å­˜å‚¨å¼•æ“å±‚ï¼ˆ Storage Enginesï¼‰ï¼Œ<strong>çœŸæ­£çš„è´Ÿè´£äº†MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼Œå¯¹ç‰©ç†æœåŠ¡å™¨çº§åˆ«ç»´æŠ¤çš„åº•å±‚æ•°æ®æ‰§è¡Œæ“ä½œ</strong>ï¼ŒæœåŠ¡å±‚é€šè¿‡APIä¸å­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ã€‚</p><h5 id="1-4-å°ç»“"><a href="#1-4-å°ç»“" class="headerlink" title="1.4 å°ç»“"></a><strong>1.4</strong> <strong>å°ç»“</strong></h5><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203291131321.png" alt="image-20220329113126234"></p><p>ç®€åŒ–ä¸ºä¸‰å±‚ç»“æ„ï¼š</p><ol><li><p>è¿æ¥å±‚ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯å‘é€ SQL è‡³æœåŠ¡å™¨ç«¯ï¼›</p></li><li><p>SQL å±‚ï¼ˆæœåŠ¡å±‚ï¼‰ï¼šå¯¹ SQL è¯­å¥è¿›è¡ŒæŸ¥è¯¢å¤„ç†ï¼›ä¸æ•°æ®åº“æ–‡ä»¶çš„å­˜å‚¨æ–¹å¼æ— å…³ï¼›</p></li><li><p>å­˜å‚¨å¼•æ“å±‚ï¼šä¸æ•°æ®åº“æ–‡ä»¶æ‰“äº¤é“ï¼Œè´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè¯»å–ã€‚</p></li></ol><h4 id="2-SQLæ‰§è¡Œæµç¨‹"><a href="#2-SQLæ‰§è¡Œæµç¨‹" class="headerlink" title="2. SQLæ‰§è¡Œæµç¨‹"></a><strong>2. SQLæ‰§è¡Œæµç¨‹</strong></h4><h5 id="2-1-MySQL-ä¸­çš„-SQLæ‰§è¡Œæµç¨‹"><a href="#2-1-MySQL-ä¸­çš„-SQLæ‰§è¡Œæµç¨‹" class="headerlink" title="2.1 MySQL ä¸­çš„ SQLæ‰§è¡Œæµç¨‹"></a><strong>2.1 MySQL</strong> <strong>ä¸­çš„</strong> <strong>SQLæ‰§è¡Œæµç¨‹</strong></h5><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203291133116.png" alt="image-20220329113337008"></p><p><strong>MySQLçš„æŸ¥è¯¢æµç¨‹ï¼š</strong></p><p><strong>1.</strong> <strong>æŸ¥è¯¢ç¼“å­˜</strong>ï¼šServer å¦‚æœåœ¨æŸ¥è¯¢ç¼“å­˜ä¸­å‘ç°äº†è¿™æ¡ SQL è¯­å¥ï¼Œå°±ä¼šç›´æ¥å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±è¿›å…¥åˆ°è§£æå™¨é˜¶æ®µã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå› ä¸ºæŸ¥è¯¢ç¼“å­˜å¾€å¾€æ•ˆç‡ä¸é«˜ï¼Œæ‰€ä»¥åœ¨ MySQL8.0 ä¹‹åå°±æŠ›å¼ƒäº†è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>æŸ¥è¯¢ç¼“å­˜æ˜¯æå‰æŠŠæŸ¥è¯¢ç»“æœç¼“å­˜èµ·æ¥ï¼Œè¿™æ ·ä¸‹æ¬¡ä¸éœ€è¦æ‰§è¡Œå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°ç»“æœã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨MySQL ä¸­çš„æŸ¥è¯¢ç¼“å­˜ï¼Œä¸æ˜¯ç¼“å­˜æŸ¥è¯¢è®¡åˆ’ï¼Œè€Œæ˜¯æŸ¥è¯¢å¯¹åº”çš„ç»“æœã€‚è¿™å°±æ„å‘³ç€æŸ¥è¯¢åŒ¹é…çš„<code>é²æ£’æ€§å¤§å¤§é™ä½</code>ï¼Œåªæœ‰<code>ç›¸åŒçš„æŸ¥è¯¢æ“ä½œæ‰ä¼šå‘½ä¸­æŸ¥è¯¢ç¼“å­˜</code>ã€‚ä¸¤ä¸ªæŸ¥è¯¢è¯·æ±‚åœ¨ä»»ä½•å­—ç¬¦ä¸Šçš„ä¸åŒï¼ˆä¾‹å¦‚ï¼šç©ºæ ¼ã€æ³¨é‡Šã€å¤§å°å†™ï¼‰ï¼Œéƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸ä¼šå‘½ä¸­ã€‚å› æ­¤ MySQL çš„ æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡ä¸é«˜ ã€‚</p><p>åŒæ—¶ï¼Œå¦‚æœæŸ¥è¯¢è¯·æ±‚ä¸­åŒ…å«æŸäº›ç³»ç»Ÿå‡½æ•°ã€ç”¨æˆ·è‡ªå®šä¹‰å˜é‡å’Œå‡½æ•°ã€ä¸€äº›ç³»ç»Ÿè¡¨ï¼Œå¦‚ mysqlã€ information_schemaã€ performance_schema æ•°æ®åº“ä¸­çš„è¡¨ï¼Œé‚£è¿™ä¸ªè¯·æ±‚å°±ä¸ä¼šè¢«ç¼“å­˜ã€‚</p><p>æ­¤å¤–ï¼Œæ—¢ç„¶æ˜¯ç¼“å­˜ï¼Œé‚£å°±æœ‰å®ƒ<code>ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™</code>ã€‚MySQLçš„ç¼“å­˜ç³»ç»Ÿä¼šç›‘æµ‹æ¶‰åŠåˆ°çš„æ¯å¼ è¡¨ï¼Œåªè¦è¯¥è¡¨çš„ç»“æ„æˆ–è€…æ•°æ®è¢«ä¿®æ”¹ï¼Œå¦‚å¯¹è¯¥è¡¨ä½¿ç”¨äº†<code>INSERT</code>ã€<code>UPDATE</code>ã€<code>DELETE</code>ã€<code>TRUNCATE TABLE</code>ã€<code>ALTER TABLE</code>ã€<code>DROP TABLE</code>æˆ–<code>DROP DATABASE</code>è¯­å¥ï¼Œé‚£ä½¿ç”¨è¯¥è¡¨çš„æ‰€æœ‰é«˜é€Ÿç¼“å­˜æŸ¥è¯¢éƒ½å°†å˜ä¸ºæ— æ•ˆå¹¶ä»é«˜é€Ÿç¼“å­˜ä¸­åˆ é™¤ï¼å¯¹äº<code>æ›´æ–°å‹åŠ›å¤§çš„æ•°æ®åº“</code>æ¥è¯´ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­ç‡ä¼šéå¸¸ä½ã€‚</p><p><strong>2.</strong> <strong>è§£æå™¨</strong>ï¼šåœ¨è§£æå™¨ä¸­å¯¹ SQL è¯­å¥è¿›è¡Œè¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€‚</p><p>åˆ†æå™¨å…ˆåšâ€œ<code>è¯æ³•åˆ†æ</code>â€ã€‚ä½ è¾“å…¥çš„æ˜¯ç”±å¤šä¸ªå­—ç¬¦ä¸²å’Œç©ºæ ¼ç»„æˆçš„ä¸€æ¡ SQL è¯­å¥ï¼ŒMySQL éœ€è¦è¯†åˆ«å‡ºé‡Œé¢çš„å­—ç¬¦ä¸²åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œä»£è¡¨ä»€ä¹ˆã€‚ MySQL ä»ä½ è¾“å…¥çš„â€selectâ€è¿™ä¸ªå…³é”®å­—è¯†åˆ«å‡ºæ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚å®ƒä¹Ÿè¦æŠŠå­—ç¬¦ä¸²â€œTâ€è¯†åˆ«æˆâ€œè¡¨å Tâ€ï¼ŒæŠŠå­—ç¬¦ä¸²â€œIDâ€è¯†åˆ«æˆâ€œåˆ— IDâ€ã€‚</p><p>æ¥ç€ï¼Œè¦åšâ€œ<code>è¯­æ³•åˆ†æ</code>â€ã€‚æ ¹æ®è¯æ³•åˆ†æçš„ç»“æœï¼Œè¯­æ³•åˆ†æå™¨ï¼ˆæ¯”å¦‚ï¼šBisonï¼‰ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­ä½ è¾“å…¥çš„è¿™ä¸ª SQL è¯­å¥æ˜¯å¦<code>æ»¡è¶³ MySQL è¯­æ³•</code>ã€‚å¦‚æœSQLè¯­å¥æ­£ç¡®ï¼Œåˆ™ä¼šç”Ÿæˆä¸€ä¸ªè¯­æ³•æ ‘ã€‚</p><p><strong>3.</strong> <strong>ä¼˜åŒ–å™¨</strong>ï¼šåœ¨ä¼˜åŒ–å™¨ä¸­ä¼šç¡®å®š SQL è¯­å¥çš„æ‰§è¡Œè·¯å¾„ï¼Œæ¯”å¦‚æ˜¯æ ¹æ®<code>å…¨è¡¨æ£€ç´¢</code>ï¼Œè¿˜æ˜¯æ ¹æ®<code>ç´¢å¼•æ£€ç´¢</code>ç­‰ã€‚åœ¨æŸ¥è¯¢ä¼˜åŒ–å™¨ä¸­ï¼Œå¯ä»¥åˆ†ä¸º<code>é€»è¾‘æŸ¥è¯¢</code>ä¼˜åŒ–é˜¶æ®µå’Œ<code>ç‰©ç†æŸ¥è¯¢</code>ä¼˜åŒ–é˜¶æ®µã€‚</p><p><strong>4.</strong> <strong>æ‰§è¡Œå™¨</strong>ï¼šåœ¨æ‰§è¡Œä¹‹å‰éœ€è¦åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦<code>å…·å¤‡æƒé™</code>ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±ä¼šè¿”å›æƒé™é”™è¯¯ã€‚å¦‚æœå…·å¤‡æƒé™ï¼Œå°±æ‰§è¡Œ SQLæŸ¥è¯¢å¹¶è¿”å›ç»“æœã€‚åœ¨ MySQL8.0 ä»¥ä¸‹çš„ç‰ˆæœ¬ï¼Œå¦‚æœè®¾ç½®äº†æŸ¥è¯¢ç¼“å­˜ï¼Œè¿™æ—¶ä¼šå°†æŸ¥è¯¢ç»“æœè¿›è¡Œç¼“å­˜ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203291145074.png" alt="image-20220329114541991"></p><p>SQL è¯­å¥åœ¨ MySQL ä¸­çš„æµç¨‹æ˜¯ï¼š SQLè¯­å¥â†’æŸ¥è¯¢ç¼“å­˜â†’è§£æå™¨â†’ä¼˜åŒ–å™¨â†’æ‰§è¡Œå™¨ ã€‚</p><h4 id="3-æ•°æ®åº“ç¼“å†²æ± -buffer-pool"><a href="#3-æ•°æ®åº“ç¼“å†²æ± -buffer-pool" class="headerlink" title="3. æ•°æ®åº“ç¼“å†²æ± (buffer pool)"></a><strong>3.</strong> <strong>æ•°æ®åº“ç¼“å†²æ± (buffer pool)</strong></h4><p><code>InnoDB</code>å­˜å‚¨å¼•æ“æ˜¯ä»¥é¡µä¸ºå•ä½æ¥ç®¡ç†å­˜å‚¨ç©ºé—´çš„ï¼Œæˆ‘ä»¬è¿›è¡Œçš„å¢åˆ æ”¹æŸ¥æ“ä½œå…¶å®æœ¬è´¨ä¸Šéƒ½æ˜¯åœ¨è®¿é—®é¡µé¢ï¼ˆåŒ…æ‹¬è¯»é¡µé¢ã€å†™é¡µé¢ã€åˆ›å»ºæ–°é¡µé¢ç­‰æ“ä½œï¼‰ã€‚è€Œç£ç›˜ I&#x2F;O éœ€è¦æ¶ˆè€—çš„æ—¶é—´å¾ˆå¤šï¼Œè€Œåœ¨å†…å­˜ä¸­è¿›è¡Œæ“ä½œï¼Œæ•ˆç‡åˆ™ä¼šé«˜å¾ˆå¤šï¼Œä¸ºäº†èƒ½è®©æ•°æ®è¡¨æˆ–è€…ç´¢å¼•ä¸­çš„æ•°æ®éšæ—¶è¢«æˆ‘ä»¬æ‰€ç”¨ï¼ŒDBMS ä¼šç”³è¯·<code>å ç”¨å†…å­˜æ¥ä½œä¸ºæ•°æ®ç¼“å†²æ± </code>ï¼Œåœ¨çœŸæ­£è®¿é—®é¡µé¢ä¹‹å‰ï¼Œéœ€è¦æŠŠåœ¨ç£ç›˜ä¸Šçš„é¡µç¼“å­˜åˆ°å†…å­˜ä¸­çš„<code>Buffer Pool</code>ä¹‹åæ‰å¯ä»¥è®¿é—®ã€‚</p><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥è®©ç£ç›˜æ´»åŠ¨æœ€å°åŒ–ï¼Œä»è€Œ<code>å‡å°‘ä¸ç£ç›˜ç›´æ¥è¿›è¡Œ I/O çš„æ—¶é—´</code>ã€‚è¦çŸ¥é“ï¼Œè¿™ç§ç­–ç•¥å¯¹æå‡ SQL è¯­å¥çš„æŸ¥è¯¢æ€§èƒ½æ¥è¯´è‡³å…³é‡è¦ã€‚å¦‚æœç´¢å¼•çš„æ•°æ®åœ¨ç¼“å†²æ± é‡Œï¼Œé‚£ä¹ˆè®¿é—®çš„æˆæœ¬å°±ä¼šé™ä½å¾ˆå¤šã€‚</p><h5 id="3-1-ç¼“å†²æ± -vs-æŸ¥è¯¢ç¼“å­˜"><a href="#3-1-ç¼“å†²æ± -vs-æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="3.1 ç¼“å†²æ±  vs æŸ¥è¯¢ç¼“å­˜"></a><strong>3.1</strong> <strong>ç¼“å†²æ± </strong> <strong>vs</strong> <strong>æŸ¥è¯¢ç¼“å­˜</strong></h5><p><strong>1.</strong> <strong>ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203291155004.png" alt="image-20220329115517901"></p><p>ä»å›¾ä¸­ï¼Œä½ èƒ½çœ‹åˆ° InnoDB ç¼“å†²æ± åŒ…æ‹¬äº†æ•°æ®é¡µã€ç´¢å¼•é¡µã€æ’å…¥ç¼“å†²ã€é”ä¿¡æ¯ã€è‡ªé€‚åº” Hash å’Œæ•°æ®å­—å…¸ä¿¡æ¯ç­‰ã€‚</p><p><strong>ç¼“å­˜åŸåˆ™ï¼š</strong></p><p>â€œ<code>ä½ç½® * é¢‘æ¬¡</code>â€è¿™ä¸ªåŸåˆ™ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å¯¹ I&#x2F;O è®¿é—®æ•ˆç‡è¿›è¡Œä¼˜åŒ–ã€‚</p><p>é¦–å…ˆï¼Œä½ç½®å†³å®šæ•ˆç‡ï¼Œæä¾›ç¼“å†²æ± å°±æ˜¯ä¸ºäº†åœ¨å†…å­˜ä¸­å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®ã€‚</p><p>å…¶æ¬¡ï¼Œé¢‘æ¬¡å†³å®šä¼˜å…ˆçº§é¡ºåºã€‚å› ä¸ºç¼“å†²æ± çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œæ¯”å¦‚ç£ç›˜æœ‰ 200Gï¼Œä½†æ˜¯å†…å­˜åªæœ‰ 16Gï¼Œç¼“å†²æ± å¤§å°åªæœ‰ 1Gï¼Œå°±æ— æ³•å°†æ‰€æœ‰æ•°æ®éƒ½åŠ è½½åˆ°ç¼“å†²æ± é‡Œï¼Œè¿™æ—¶å°±æ¶‰åŠåˆ°ä¼˜å…ˆçº§é¡ºåºï¼Œä¼š<code>ä¼˜å…ˆå¯¹ä½¿ç”¨é¢‘æ¬¡é«˜çš„çƒ­æ•°æ®è¿›è¡ŒåŠ è½½</code>ã€‚</p><p><strong>2.</strong> <strong>æŸ¥è¯¢ç¼“å­˜</strong></p><p>æŸ¥è¯¢ç¼“å­˜æ˜¯æå‰æŠŠ<code>æŸ¥è¯¢ç»“æœç¼“å­˜</code>èµ·æ¥ï¼Œè¿™æ ·ä¸‹æ¬¡ä¸éœ€è¦æ‰§è¡Œå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°ç»“æœã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨MySQL ä¸­çš„æŸ¥è¯¢ç¼“å­˜ï¼Œä¸æ˜¯ç¼“å­˜æŸ¥è¯¢è®¡åˆ’ï¼Œè€Œæ˜¯æŸ¥è¯¢å¯¹åº”çš„ç»“æœã€‚å› ä¸ºå‘½ä¸­æ¡ä»¶è‹›åˆ»ï¼Œè€Œä¸”åªè¦æ•°æ®è¡¨å‘ç”Ÿå˜åŒ–ï¼ŒæŸ¥è¯¢ç¼“å­˜å°±ä¼šå¤±æ•ˆï¼Œå› æ­¤å‘½ä¸­ç‡ä½ã€‚</p><h5 id="3-2-ç¼“å†²æ± å¦‚ä½•è¯»å–æ•°æ®"><a href="#3-2-ç¼“å†²æ± å¦‚ä½•è¯»å–æ•°æ®" class="headerlink" title="3.2 ç¼“å†²æ± å¦‚ä½•è¯»å–æ•°æ®"></a><strong>3.2</strong> <strong>ç¼“å†²æ± å¦‚ä½•è¯»å–æ•°æ®</strong></h5><p>ç¼“å†²æ± ç®¡ç†å™¨ä¼šå°½é‡å°†ç»å¸¸ä½¿ç”¨çš„æ•°æ®ä¿å­˜èµ·æ¥ï¼Œåœ¨æ•°æ®åº“è¿›è¡Œé¡µé¢è¯»æ“ä½œçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šåˆ¤æ–­è¯¥é¡µé¢æ˜¯å¦åœ¨ç¼“å†²æ± ä¸­ï¼Œå¦‚æœå­˜åœ¨å°±ç›´æ¥è¯»å–ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¼šé€šè¿‡å†…å­˜æˆ–ç£ç›˜å°†é¡µé¢å­˜æ”¾åˆ°ç¼“å†²æ± ä¸­å†è¿›è¡Œè¯»å–ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203291159111.png" alt="image-20220329115958009"></p><h5 id="3-3-æŸ¥çœ‹-x2F-è®¾ç½®ç¼“å†²æ± çš„å¤§å°"><a href="#3-3-æŸ¥çœ‹-x2F-è®¾ç½®ç¼“å†²æ± çš„å¤§å°" class="headerlink" title="3.3 æŸ¥çœ‹&#x2F;è®¾ç½®ç¼“å†²æ± çš„å¤§å°"></a><strong>3.3</strong> <strong>æŸ¥çœ‹&#x2F;è®¾ç½®ç¼“å†²æ± çš„å¤§å°</strong></h5><p>æŸ¥çœ‹ç¼“å†²æ± çš„å¤§å°</p><pre><code class="mysql">show variables like &#39;innodb_buffer_pool_size&#39;;</code></pre><p>è®¾ç½®ç¼“å†²æ± çš„å¤§å°</p><pre><code class="mysql">set global innodb_buffer_pool_size = 268435456;</code></pre><p>æˆ–è€…</p><pre><code class="ini">[server] innodb_buffer_pool_size = 268435456</code></pre><h5 id="3-4-å¤šä¸ªBuffer-Poolå®ä¾‹"><a href="#3-4-å¤šä¸ªBuffer-Poolå®ä¾‹" class="headerlink" title="3.4 å¤šä¸ªBuffer Poolå®ä¾‹"></a><strong>3.4</strong> <strong>å¤šä¸ªBuffer Poolå®ä¾‹</strong></h5><pre><code class="ini">[server] innodb_buffer_pool_instances = 2</code></pre><p>ä½•æŸ¥çœ‹ç¼“å†²æ± çš„ä¸ªæ•°</p><pre><code class="mysql">show variables like &#39;innodb_buffer_pool_instances&#39;;</code></pre><p>æ¯ä¸ª<code>Buffer Pool</code>å®ä¾‹å®é™…å å†…å­˜ç©ºé—´</p><pre><code>innodb_buffer_pool_size/innodb_buffer_pool_instances</code></pre><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬08ç«  ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™</title>
      <link href="/2023/07/15/%E7%AC%AC08%E7%AB%A0%20%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/"/>
      <url>/2023/07/15/%E7%AC%AC08%E7%AB%A0%20%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬08ç« -ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™"><a href="#ç¬¬08ç« -ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™" class="headerlink" title="ç¬¬08ç«  ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™"></a>ç¬¬08ç«  ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™</h3><h4 id="1-ç´¢å¼•çš„å£°æ˜ä¸ä½¿ç”¨"><a href="#1-ç´¢å¼•çš„å£°æ˜ä¸ä½¿ç”¨" class="headerlink" title="1. ç´¢å¼•çš„å£°æ˜ä¸ä½¿ç”¨"></a><strong>1.</strong> <strong>ç´¢å¼•çš„å£°æ˜ä¸ä½¿ç”¨</strong></h4><h5 id="1-1-ç´¢å¼•çš„åˆ†ç±»"><a href="#1-1-ç´¢å¼•çš„åˆ†ç±»" class="headerlink" title="1.1 ç´¢å¼•çš„åˆ†ç±»"></a><strong>1.1</strong> <strong>ç´¢å¼•çš„åˆ†ç±»</strong></h5><ul><li>ä»<code>åŠŸèƒ½é€»è¾‘</code>ä¸Šè¯´ï¼Œç´¢å¼•ä¸»è¦æœ‰ 4 ç§ï¼Œåˆ†åˆ«æ˜¯æ™®é€šç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€ä¸»é”®ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ã€‚</li><li>æŒ‰ç…§<code>ç‰©ç†å®ç°æ–¹å¼</code>ï¼Œç´¢å¼•å¯ä»¥åˆ†ä¸º 2 ç§ï¼šèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ã€‚</li><li>æŒ‰ç…§<code>ä½œç”¨å­—æ®µä¸ªæ•°</code>è¿›è¡Œåˆ’åˆ†ï¼Œåˆ†æˆå•åˆ—ç´¢å¼•å’Œè”åˆç´¢å¼•ã€‚</li></ul><h5 id="1-2-åˆ›å»ºç´¢å¼•"><a href="#1-2-åˆ›å»ºç´¢å¼•" class="headerlink" title="1.2 åˆ›å»ºç´¢å¼•"></a><strong>1.2</strong> <strong>åˆ›å»ºç´¢å¼•</strong></h5><pre><code class="mysql">CREATE TABLE table_name [col_name data_type] [UNIQUE | FULLTEXT | SPATIAL] [INDEX | KEY] [index_name] (col_name [length]) [ASC | DESC]</code></pre><ul><li><code>UNIQUE</code>ã€<code>FULLTEXT</code>å’Œ<code>SPATIAL</code>ä¸ºå¯é€‰å‚æ•°ï¼Œåˆ†åˆ«è¡¨ç¤ºå”¯ä¸€ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•å’Œç©ºé—´ç´¢å¼•ï¼›</li><li><code>INDEX</code>ä¸<code>KEY</code>ä¸ºåŒä¹‰è¯ï¼Œä¸¤è€…çš„ä½œç”¨ç›¸åŒï¼Œç”¨æ¥æŒ‡å®šåˆ›å»ºç´¢å¼•ï¼›</li><li><code>index_name</code>æŒ‡å®šç´¢å¼•çš„åç§°ï¼Œä¸ºå¯é€‰å‚æ•°ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé‚£ä¹ˆMySQLé»˜è®¤col_nameä¸ºç´¢å¼•åï¼›</li><li><code>col_name</code>ä¸ºéœ€è¦åˆ›å»ºç´¢å¼•çš„å­—æ®µåˆ—ï¼Œè¯¥åˆ—å¿…é¡»ä»æ•°æ®è¡¨ä¸­å®šä¹‰çš„å¤šä¸ªåˆ—ä¸­é€‰æ‹©ï¼›</li><li><code>length</code>ä¸ºå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºç´¢å¼•çš„é•¿åº¦ï¼Œåªæœ‰å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µæ‰èƒ½æŒ‡å®šç´¢å¼•é•¿åº¦ï¼›</li><li><code>ASC</code>æˆ–<code>DESC</code>æŒ‡å®šå‡åºæˆ–è€…é™åºçš„ç´¢å¼•å€¼å­˜å‚¨ã€‚</li></ul><p><strong>1.</strong> <strong>åˆ›å»ºæ™®é€šç´¢å¼•</strong></p><pre><code class="mysql">CREATE TABLE book(     book_id INT ,     book_name VARCHAR(100),     authors VARCHAR(100),     info VARCHAR(100) ,     comment VARCHAR(100),     year_publication YEAR,     INDEX(year_publication) );</code></pre><p><strong>2.</strong> <strong>åˆ›å»ºå”¯ä¸€ç´¢å¼•</strong></p><pre><code class="mysql">CREATE TABLE test1(     id INT NOT NULL,     name varchar(30) NOT NULL,     UNIQUE INDEX uk_idx_id(id) );</code></pre><p><strong>3.</strong> <strong>ä¸»é”®ç´¢å¼•</strong></p><pre><code class="mysql">CREATE TABLE student (     id INT(10) UNSIGNED AUTO_INCREMENT,     student_no VARCHAR(200),    student_name VARCHAR(200),     PRIMARY KEY(id) );</code></pre><pre><code class="mysql"># åˆ é™¤ä¸»é”®ç´¢å¼•ALTER TABLE student drop PRIMARY KEY ;</code></pre><p><strong>4.</strong> <strong>åˆ›å»ºå•åˆ—ç´¢å¼•</strong></p><pre><code class="mysql">CREATE TABLE test2(     id INT NOT NULL,     name CHAR(50) NULL,     INDEX single_idx_name(name(20)) );</code></pre><p><strong>5.</strong> <strong>åˆ›å»ºç»„åˆç´¢å¼•</strong></p><pre><code class="mysql">CREATE TABLE test3(     id INT(11) NOT NULL,     name CHAR(30) NOT NULL,     age INT(11) NOT NULL,     info VARCHAR(255),     INDEX multi_idx(id,name,age) );</code></pre><p><strong>6.</strong> <strong>åˆ›å»ºå…¨æ–‡ç´¢å¼•</strong></p><pre><code class="mysql">CREATE TABLE `papers` (     id` int(10) unsigned NOT NULL AUTO_INCREMENT,     `title` varchar(200) DEFAULT NULL,     `content` text, PRIMARY KEY (`id`),     FULLTEXT KEY `title` (`title`,`content`) ) ENGINE=MyISAM DEFAULT CHARSET=utf8;</code></pre><pre><code class="mysql">SELECT * FROM papers WHERE MATCH(title,content) AGAINST (â€˜æŸ¥è¯¢å­—ç¬¦ä¸²â€™);</code></pre><p><strong>7.</strong> <strong>åˆ›å»ºç©ºé—´ç´¢å¼•</strong></p><pre><code class="mysql">CREATE TABLE test5(     geo GEOMETRY NOT NULL,     SPATIAL INDEX spa_idx_geo(geo) ) ENGINE=MyISAM;</code></pre><p><strong>2.</strong> <strong>åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•</strong></p><p><strong>1.</strong> <strong>ä½¿ç”¨ALTER TABLEè¯­å¥åˆ›å»ºç´¢å¼•</strong></p><pre><code class="mysql">ALTER TABLE table_name ADD [UNIQUE | FULLTEXT | SPATIAL] [INDEX | KEY] [index_name] (col_name[length],...) [ASC | DESC]</code></pre><p><strong>2.</strong> <strong>ä½¿ç”¨CREATE INDEXåˆ›å»ºç´¢å¼•</strong></p><pre><code class="mysql">CREATE [UNIQUE | FULLTEXT | SPATIAL] INDEX index_name ON table_name (col_name[length],...) [ASC | DESC]</code></pre><h5 id="1-3-åˆ é™¤ç´¢å¼•"><a href="#1-3-åˆ é™¤ç´¢å¼•" class="headerlink" title="1.3 åˆ é™¤ç´¢å¼•"></a><strong>1.3</strong> <strong>åˆ é™¤ç´¢å¼•</strong></h5><p><strong>1.</strong> <strong>ä½¿ç”¨ALTER TABLEåˆ é™¤ç´¢å¼•</strong></p><pre><code class="mysql">ALTER TABLE table_name DROP INDEX index_name;</code></pre><p><strong>2.</strong> <strong>ä½¿ç”¨DROP INDEXè¯­å¥åˆ é™¤ç´¢å¼•</strong></p><pre><code class="mysql">DROP INDEX index_name ON table_name;</code></pre><h4 id="2-MySQL8-0ç´¢å¼•æ–°ç‰¹æ€§"><a href="#2-MySQL8-0ç´¢å¼•æ–°ç‰¹æ€§" class="headerlink" title="2. MySQL8.0ç´¢å¼•æ–°ç‰¹æ€§"></a><strong>2. MySQL8.0ç´¢å¼•æ–°ç‰¹æ€§</strong></h4><h5 id="2-1-æ”¯æŒé™åºç´¢å¼•"><a href="#2-1-æ”¯æŒé™åºç´¢å¼•" class="headerlink" title="2.1 æ”¯æŒé™åºç´¢å¼•"></a><strong>2.1</strong> <strong>æ”¯æŒé™åºç´¢å¼•</strong></h5><pre><code class="mysql">CREATE TABLE ts1(a int,b int,index idx_a_b(a,b desc));</code></pre><h5 id="2-2-éšè—ç´¢å¼•"><a href="#2-2-éšè—ç´¢å¼•" class="headerlink" title="2.2 éšè—ç´¢å¼•"></a><strong>2.2</strong> <strong>éšè—ç´¢å¼•</strong></h5><p>ä»MySQL 8.xå¼€å§‹æ”¯æŒ<code>éšè—ç´¢å¼•ï¼ˆinvisible indexesï¼‰</code>ï¼Œåªéœ€è¦å°†å¾…åˆ é™¤çš„ç´¢å¼•è®¾ç½®ä¸ºéšè—ç´¢å¼•ï¼Œä½¿æŸ¥è¯¢ä¼˜åŒ–å™¨ä¸å†ä½¿ç”¨è¿™ä¸ªç´¢å¼•ï¼ˆå³ä½¿ä½¿ç”¨force indexï¼ˆå¼ºåˆ¶ä½¿ç”¨ç´¢å¼•ï¼‰ï¼Œä¼˜åŒ–å™¨ä¹Ÿä¸ä¼šä½¿ç”¨è¯¥ç´¢å¼•ï¼‰ï¼Œç¡®è®¤å°†ç´¢å¼•è®¾ç½®ä¸ºéšè—ç´¢å¼•åç³»ç»Ÿä¸å—ä»»ä½•å“åº”ï¼Œå°±å¯ä»¥å½»åº•åˆ é™¤ç´¢å¼•ã€‚<code>è¿™ç§é€šè¿‡å…ˆå°†ç´¢å¼•è®¾ç½®ä¸ºéšè—ç´¢å¼•ï¼Œå†åˆ é™¤ç´¢å¼•çš„æ–¹å¼å°±æ˜¯è½¯åˆ é™¤</code>ã€‚</p><p><strong>1.</strong> <strong>åˆ›å»ºè¡¨æ—¶ç›´æ¥åˆ›å»º</strong> </p><pre><code class="mysql">CREATE TABLE tablename(     propname1 type1[CONSTRAINT1],     propname2 type2[CONSTRAINT2],     â€¦â€¦    propnamen typen,     INDEX [indexname](propname1 [(length)]) INVISIBLE );</code></pre><p><strong>2.</strong> <strong>åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»º</strong></p><pre><code class="mysql">CREATE INDEX indexname ON tablename(propname[(length)]) INVISIBLE;</code></pre><p><strong>3.</strong> <strong>é€šè¿‡ALTER TABLEè¯­å¥åˆ›å»º</strong></p><pre><code class="mysql">ALTER TABLE tablename ADD INDEX indexname (propname [(length)]) INVISIBLE;</code></pre><p><strong>4.</strong> <strong>åˆ‡æ¢ç´¢å¼•å¯è§çŠ¶æ€</strong></p><pre><code class="mysql">ALTER TABLE tablename ALTER INDEX index_name INVISIBLE; #åˆ‡æ¢æˆéšè—ç´¢å¼• ALTER TABLE tablename ALTER INDEX index_name VISIBLE; #åˆ‡æ¢æˆééšè—ç´¢å¼•</code></pre><h4 id="3-ç´¢å¼•çš„è®¾è®¡åŸåˆ™"><a href="#3-ç´¢å¼•çš„è®¾è®¡åŸåˆ™" class="headerlink" title="3. ç´¢å¼•çš„è®¾è®¡åŸåˆ™"></a><strong>3.</strong> <strong>ç´¢å¼•çš„è®¾è®¡åŸåˆ™</strong></h4><h5 id="3-1-å“ªäº›æƒ…å†µé€‚åˆåˆ›å»ºç´¢å¼•"><a href="#3-1-å“ªäº›æƒ…å†µé€‚åˆåˆ›å»ºç´¢å¼•" class="headerlink" title="3.1 å“ªäº›æƒ…å†µé€‚åˆåˆ›å»ºç´¢å¼•"></a><strong>3.1</strong> <strong>å“ªäº›æƒ…å†µé€‚åˆåˆ›å»ºç´¢å¼•</strong></h5><p><strong>1.</strong> <strong>å­—æ®µçš„æ•°å€¼æœ‰å”¯ä¸€æ€§çš„é™åˆ¶</strong></p><p>ç´¢å¼•æœ¬èº«å¯ä»¥èµ·åˆ°çº¦æŸçš„ä½œç”¨ï¼Œæ¯”å¦‚å”¯ä¸€ç´¢å¼•ã€ä¸»é”®ç´¢å¼•éƒ½å¯ä»¥èµ·åˆ°å”¯ä¸€æ€§çº¦æŸçš„ï¼Œå› æ­¤åœ¨æˆ‘ä»¬çš„æ•°æ®è¡¨ä¸­ï¼Œå¦‚æœ<code>æŸä¸ªå­—æ®µæ˜¯å”¯ä¸€çš„</code>ï¼Œå°±å¯ä»¥ç›´æ¥<code>åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•</code>ï¼Œæˆ–è€…<code>ä¸»é”®ç´¢å¼•</code>ã€‚è¿™æ ·å¯ä»¥æ›´å¿«é€Ÿåœ°é€šè¿‡è¯¥ç´¢å¼•æ¥ç¡®å®šæŸæ¡è®°å½•ã€‚</p><blockquote><p>ä¸šåŠ¡ä¸Šå…·æœ‰å”¯ä¸€ç‰¹æ€§çš„å­—æ®µï¼Œå³ä½¿æ˜¯ç»„åˆå­—æ®µï¼Œä¹Ÿå¿…é¡»å»ºæˆå”¯ä¸€ç´¢å¼•ã€‚ï¼ˆæ¥æºï¼šAlibabaï¼‰</p><p>è¯´æ˜ï¼šä¸è¦ä»¥ä¸ºå”¯ä¸€ç´¢å¼•å½±å“äº†inserté€Ÿåº¦ï¼Œè¿™ä¸ªé€Ÿåº¦æŸè€—å¯ä»¥å¿½ç•¥ï¼Œä½†æé«˜æŸ¥æ‰¾é€Ÿåº¦æ˜¯æ˜æ˜¾çš„ã€‚</p></blockquote><p><strong>2.</strong> <strong>é¢‘ç¹ä½œä¸º</strong> <strong>WHERE</strong> <strong>æŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ</strong></p><p>æŸä¸ªå­—æ®µåœ¨SELECTè¯­å¥çš„ WHERE æ¡ä»¶ä¸­ç»å¸¸è¢«ä½¿ç”¨åˆ°ï¼Œé‚£ä¹ˆå°±éœ€è¦ç»™è¿™ä¸ªå­—æ®µåˆ›å»ºç´¢å¼•äº†ã€‚å°¤å…¶æ˜¯åœ¨æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹ï¼Œåˆ›å»ºæ™®é€šç´¢å¼•å°±å¯ä»¥å¤§å¹…æå‡æ•°æ®æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p><p><strong>3.</strong> <strong>ç»å¸¸</strong> <strong>GROUP BY</strong> <strong>å’Œ</strong> <strong>ORDER BY</strong> <strong>çš„åˆ—</strong></p><p>ç´¢å¼•å°±æ˜¯è®©æ•°æ®æŒ‰ç…§æŸç§é¡ºåºè¿›è¡Œå­˜å‚¨æˆ–æ£€ç´¢ï¼Œå› æ­¤å½“æˆ‘ä»¬ä½¿ç”¨ GROUP BY å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„æŸ¥è¯¢ï¼Œæˆ–è€…ä½¿ç”¨ ORDER BY å¯¹æ•°æ®è¿›è¡Œæ’åºçš„æ—¶å€™ï¼Œå°±éœ€è¦<code>å¯¹åˆ†ç»„æˆ–è€…æ’åºçš„å­—æ®µè¿›è¡Œç´¢å¼•</code>ã€‚å¦‚æœå¾…æ’åºçš„åˆ—æœ‰å¤šä¸ªï¼Œé‚£ä¹ˆå¯ä»¥åœ¨è¿™äº›åˆ—ä¸Šå»ºç«‹<code>ç»„åˆç´¢å¼•</code>ã€‚</p><p><strong>4. UPDATEã€DELETE</strong> <strong>çš„</strong> <strong>WHERE</strong> <strong>æ¡ä»¶åˆ—</strong></p><p>å¯¹æ•°æ®æŒ‰ç…§æŸä¸ªæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢åå†è¿›è¡Œ UPDATE æˆ– DELETE çš„æ“ä½œï¼Œå¦‚æœå¯¹ WHERE å­—æ®µåˆ›å»ºäº†ç´¢å¼•ï¼Œå°±èƒ½å¤§å¹…æå‡æ•ˆç‡ã€‚åŸç†æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦å…ˆæ ¹æ® WHERE æ¡ä»¶åˆ—æ£€ç´¢å‡ºæ¥è¿™æ¡è®°å½•ï¼Œç„¶åå†å¯¹å®ƒè¿›è¡Œæ›´æ–°æˆ–åˆ é™¤ã€‚<strong>å¦‚æœè¿›è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œæ›´æ–°çš„å­—æ®µæ˜¯éç´¢å¼•å­—æ®µï¼Œæå‡çš„æ•ˆç‡ä¼šæ›´æ˜æ˜¾ï¼Œè¿™æ˜¯å› ä¸ºéç´¢å¼•å­—æ®µæ›´æ–°ä¸éœ€è¦å¯¹ç´¢å¼•è¿›è¡Œç»´æŠ¤ã€‚</strong></p><p><strong>5.DISTINCT</strong> <strong>å­—æ®µéœ€è¦åˆ›å»ºç´¢å¼•</strong></p><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹æŸä¸ªå­—æ®µè¿›è¡Œå»é‡ï¼Œä½¿ç”¨ DISTINCTï¼Œé‚£ä¹ˆå¯¹è¿™ä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ï¼Œä¹Ÿä¼šæå‡æŸ¥è¯¢æ•ˆç‡ã€‚</p><p><strong>6.</strong> <strong>å¤šè¡¨</strong> <strong>JOIN</strong> <strong>è¿æ¥æ“ä½œæ—¶ï¼Œåˆ›å»ºç´¢å¼•æ³¨æ„äº‹é¡¹</strong></p><p>é¦–å…ˆï¼Œ<code>è¿æ¥è¡¨çš„æ•°é‡å°½é‡ä¸è¦è¶…è¿‡ 3 å¼ </code>ï¼Œå› ä¸ºæ¯å¢åŠ ä¸€å¼ è¡¨å°±ç›¸å½“äºå¢åŠ äº†ä¸€æ¬¡åµŒå¥—çš„å¾ªç¯ï¼Œæ•°é‡çº§å¢é•¿ä¼šéå¸¸å¿«ï¼Œä¸¥é‡å½±å“æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p><p>å…¶æ¬¡ï¼Œ<code>å¯¹ WHERE æ¡ä»¶åˆ›å»ºç´¢å¼•</code>ï¼Œå› ä¸º WHERE æ‰æ˜¯å¯¹æ•°æ®æ¡ä»¶çš„è¿‡æ»¤ã€‚å¦‚æœåœ¨æ•°æ®é‡éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰ WHERE æ¡ä»¶è¿‡æ»¤æ˜¯éå¸¸å¯æ€•çš„ã€‚</p><p>æœ€åï¼Œ<code>å¯¹ç”¨äºè¿æ¥çš„å­—æ®µåˆ›å»ºç´¢å¼•</code>ï¼Œå¹¶ä¸”è¯¥å­—æ®µåœ¨å¤šå¼ è¡¨ä¸­çš„<code>ç±»å‹å¿…é¡»ä¸€è‡´</code>ã€‚</p><p><strong>7.</strong> <strong>ä½¿ç”¨åˆ—çš„ç±»å‹å°çš„åˆ›å»ºç´¢å¼•</strong> </p><p>æˆ‘ä»¬è¿™é‡Œæ‰€è¯´çš„<code>ç±»å‹å¤§å°</code>æŒ‡çš„å°±æ˜¯è¯¥ç±»å‹è¡¨ç¤ºçš„æ•°æ®èŒƒå›´çš„å¤§å°ã€‚</p><ul><li>æ•°æ®ç±»å‹è¶Šå°ï¼Œåœ¨æŸ¥è¯¢æ—¶è¿›è¡Œçš„æ¯”è¾ƒæ“ä½œè¶Šå¿«</li><li>æ•°æ®ç±»å‹è¶Šå°ï¼Œç´¢å¼•å ç”¨çš„å­˜å‚¨ç©ºé—´å°±è¶Šå°‘ï¼Œåœ¨ä¸€ä¸ªæ•°æ®é¡µå†…å°±å¯ä»¥<code>æ”¾ä¸‹æ›´å¤šçš„è®°å½•</code>ï¼Œä»è€Œå‡å°‘ç£ç›˜<code>I/O</code>å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥æŠŠæ›´å¤šçš„æ•°æ®é¡µç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä»è€ŒåŠ å¿«è¯»å†™æ•ˆç‡ã€‚</li></ul><p>è¿™ä¸ªå»ºè®®å¯¹äºè¡¨çš„<code>ä¸»é”®æ¥è¯´æ›´åŠ é€‚ç”¨</code>ï¼Œå› ä¸ºä¸ä»…æ˜¯èšç°‡ç´¢å¼•ä¸­ä¼šå­˜å‚¨ä¸»é”®å€¼ï¼Œå…¶ä»–æ‰€æœ‰çš„äºŒçº§ç´¢å¼•çš„èŠ‚ç‚¹å¤„éƒ½ä¼šå­˜å‚¨ä¸€ä»½è®°å½•çš„ä¸»é”®å€¼ï¼Œå¦‚æœä¸»é”®ä½¿ç”¨æ›´å°çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ„å‘³ç€èŠ‚çœæ›´å¤šçš„å­˜å‚¨ç©ºé—´å’Œæ›´é«˜æ•ˆçš„I&#x2F;Oã€‚</p><p><strong>8.</strong> <strong>ä½¿ç”¨å­—ç¬¦ä¸²å‰ç¼€åˆ›å»ºç´¢å¼•</strong></p><p>åŒºåˆ†åº¦è®¡ç®—å…¬å¼ï¼š</p><pre><code class="mysql">count(distinct left(åˆ—å, ç´¢å¼•é•¿åº¦))/count(*)</code></pre><p><strong>æ‹“å±•ï¼šAlibabaã€ŠJavaå¼€å‘æ‰‹å†Œã€‹</strong></p><p>ã€<code>å¼ºåˆ¶</code>ã€‘åœ¨ varchar å­—æ®µä¸Šå»ºç«‹ç´¢å¼•æ—¶ï¼Œå¿…é¡»æŒ‡å®šç´¢å¼•é•¿åº¦ï¼Œæ²¡å¿…è¦å¯¹å…¨å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œæ ¹æ®å®é™…æ–‡æœ¬åŒºåˆ†åº¦å†³å®šç´¢å¼•é•¿åº¦ã€‚</p><p>è¯´æ˜ï¼šç´¢å¼•çš„é•¿åº¦ä¸åŒºåˆ†åº¦æ˜¯ä¸€å¯¹çŸ›ç›¾ä½“ï¼Œä¸€èˆ¬å¯¹å­—ç¬¦ä¸²ç±»å‹æ•°æ®ï¼Œé•¿åº¦ä¸º 20 çš„ç´¢å¼•ï¼ŒåŒºåˆ†åº¦ä¼š<code>é«˜è¾¾ 90% ä»¥ä¸Š</code>ã€‚</p><p><strong>9.</strong> <strong>åŒºåˆ†åº¦é«˜(æ•£åˆ—æ€§é«˜)çš„åˆ—é€‚åˆä½œä¸ºç´¢å¼•</strong></p><p><code>åˆ—çš„åŸºæ•°</code>æŒ‡çš„æ˜¯æŸä¸€åˆ—ä¸­ä¸é‡å¤æ•°æ®çš„ä¸ªæ•°ï¼Œæ¯”æ–¹è¯´æŸä¸ªåˆ—åŒ…å«å€¼<code>2,5,8,2,5,8,2,5,8</code>ï¼Œè™½ç„¶æœ‰<code>9</code>æ¡è®°å½•ï¼Œä½†è¯¥åˆ—çš„åŸºæ•°å´æ˜¯<code>3</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>åœ¨è®°å½•è¡Œæ•°ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œåˆ—çš„åŸºæ•°è¶Šå¤§ï¼Œè¯¥åˆ—ä¸­çš„å€¼è¶Šåˆ†æ•£ï¼›åˆ—çš„åŸºæ•°è¶Šå°ï¼Œè¯¥åˆ—ä¸­çš„å€¼è¶Šé›†ä¸­ã€‚</strong>è¿™ä¸ªåˆ—çš„åŸºæ•°æŒ‡æ ‡éå¸¸é‡è¦ï¼Œç›´æ¥å½±å“æˆ‘ä»¬æ˜¯å¦èƒ½æœ‰æ•ˆçš„åˆ©ç”¨ç´¢å¼•ã€‚æœ€å¥½ä¸ºåˆ—çš„åŸºæ•°å¤§çš„åˆ—å»ºç«‹ç´¢å¼•ï¼Œä¸ºåŸºæ•°å¤ªå°çš„åˆ—å»ºç«‹ç´¢å¼•æ•ˆæœå¯èƒ½ä¸å¥½ã€‚</p><p>å¯ä»¥ä½¿ç”¨å…¬å¼<code>select count(distinct a)/count(*) from t1</code>è®¡ç®—åŒºåˆ†åº¦ï¼Œè¶Šæ¥è¿‘1è¶Šå¥½ï¼Œä¸€èˆ¬è¶…è¿‡<code>33%</code>å°±ç®—æ˜¯æ¯”è¾ƒé«˜æ•ˆçš„ç´¢å¼•äº†ã€‚</p><p>æ‹“å±•ï¼šè”åˆç´¢å¼•æŠŠåŒºåˆ†åº¦é«˜ï¼ˆæ•£åˆ—æ€§é«˜ï¼‰çš„åˆ—æ”¾åœ¨å‰é¢ã€‚</p><p><strong>10.</strong> <strong>ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§</strong></p><p><strong>11.</strong> <strong>åœ¨å¤šä¸ªå­—æ®µéƒ½è¦åˆ›å»ºç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œè”åˆç´¢å¼•ä¼˜äºå•å€¼ç´¢å¼•</strong></p><h5 id="3-2-é™åˆ¶ç´¢å¼•çš„æ•°ç›®"><a href="#3-2-é™åˆ¶ç´¢å¼•çš„æ•°ç›®" class="headerlink" title="3.2 é™åˆ¶ç´¢å¼•çš„æ•°ç›®"></a><strong>3.2</strong> <strong>é™åˆ¶ç´¢å¼•çš„æ•°ç›®</strong></h5><p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æ³¨æ„å¹³è¡¡ï¼Œç´¢å¼•çš„æ•°ç›®ä¸æ˜¯è¶Šå¤šè¶Šå¥½ã€‚æˆ‘ä»¬éœ€è¦é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡ï¼Œå»ºè®®å•å¼ è¡¨ç´¢å¼•æ•°é‡<code>ä¸è¶…è¿‡6ä¸ª</code>ã€‚åŸå› ï¼š</p><ul><li>æ¯ä¸ªç´¢å¼•éƒ½éœ€è¦å ç”¨<code>ç£ç›˜ç©ºé—´</code>ï¼Œç´¢å¼•è¶Šå¤šï¼Œéœ€è¦çš„ç£ç›˜ç©ºé—´å°±è¶Šå¤§ã€‚</li><li>ç´¢å¼•ä¼šå½±å“<code>INSERTã€DELETEã€UPDATEç­‰è¯­å¥çš„æ€§èƒ½</code>ï¼Œå› ä¸ºè¡¨ä¸­çš„æ•°æ®æ›´æ”¹çš„åŒæ—¶ï¼Œç´¢å¼•ä¹Ÿä¼šè¿›è¡Œè°ƒæ•´å’Œæ›´æ–°ï¼Œä¼šé€ æˆè´Ÿæ‹…ã€‚</li><li>ä¼˜åŒ–å™¨åœ¨é€‰æ‹©å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢æ—¶ï¼Œä¼šæ ¹æ®ç»Ÿä¸€ä¿¡æ¯ï¼Œå¯¹æ¯ä¸€ä¸ªå¯ä»¥ç”¨åˆ°çš„<code>ç´¢å¼•æ¥è¿›è¡Œè¯„ä¼°</code>ï¼Œä»¥ç”Ÿæˆå‡ºä¸€ä¸ªæœ€å¥½çš„æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚æœåŒæ—¶æœ‰å¾ˆå¤šä¸ªç´¢å¼•éƒ½å¯ä»¥ç”¨äºæŸ¥è¯¢ï¼Œä¼šå¢åŠ MySQLä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’æ—¶é—´ï¼Œé™ä½æŸ¥è¯¢æ€§èƒ½ã€‚</li></ul><h5 id="3-3-å“ªäº›æƒ…å†µä¸é€‚åˆåˆ›å»ºç´¢å¼•"><a href="#3-3-å“ªäº›æƒ…å†µä¸é€‚åˆåˆ›å»ºç´¢å¼•" class="headerlink" title="3.3 å“ªäº›æƒ…å†µä¸é€‚åˆåˆ›å»ºç´¢å¼•"></a><strong>3.3</strong> <strong>å“ªäº›æƒ…å†µä¸é€‚åˆåˆ›å»ºç´¢å¼•</strong></h5><p><strong>1.</strong> <strong>åœ¨whereä¸­ä½¿ç”¨ä¸åˆ°çš„å­—æ®µï¼Œä¸è¦è®¾ç½®ç´¢å¼•</strong></p><p><strong>2.</strong> <strong>æ•°æ®é‡å°çš„è¡¨æœ€å¥½ä¸è¦ä½¿ç”¨ç´¢å¼•</strong></p><p><strong>3.</strong> <strong>æœ‰å¤§é‡é‡å¤æ•°æ®çš„åˆ—ä¸Šä¸è¦å»ºç«‹ç´¢å¼•</strong></p><p><strong>4.</strong> <strong>é¿å…å¯¹ç»å¸¸æ›´æ–°çš„è¡¨åˆ›å»ºè¿‡å¤šçš„ç´¢å¼•</strong> </p><p><strong>5.</strong> <strong>ä¸å»ºè®®ç”¨æ— åºçš„å€¼ä½œä¸ºç´¢å¼•</strong></p><p>ä¾‹å¦‚èº«ä»½è¯ã€UUID(åœ¨ç´¢å¼•æ¯”è¾ƒæ—¶éœ€è¦è½¬ä¸ºASCIIï¼Œå¹¶ä¸”æ’å…¥æ—¶å¯èƒ½é€ æˆé¡µåˆ†è£‚)ã€MD5ã€HASHã€æ— åºé•¿å­—ç¬¦ä¸²ç­‰ã€‚</p><p><strong>6.</strong> <strong>åˆ é™¤ä¸å†ä½¿ç”¨æˆ–è€…å¾ˆå°‘ä½¿ç”¨çš„ç´¢å¼•</strong></p><p><strong>7.</strong> <strong>ä¸è¦å®šä¹‰å†—ä½™æˆ–é‡å¤çš„ç´¢å¼•</strong></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬09ç«  æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨</title>
      <link href="/2023/07/15/%E7%AC%AC09%E7%AB%A0%20%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2023/07/15/%E7%AC%AC09%E7%AB%A0%20%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬09ç« -æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨"><a href="#ç¬¬09ç« -æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨" class="headerlink" title="ç¬¬09ç«  æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨"></a>ç¬¬09ç«  æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨</h3><h4 id="1-ç»Ÿè®¡SQLçš„æŸ¥è¯¢æˆæœ¬ï¼šlast-query-cost"><a href="#1-ç»Ÿè®¡SQLçš„æŸ¥è¯¢æˆæœ¬ï¼šlast-query-cost" class="headerlink" title="1. ç»Ÿè®¡SQLçš„æŸ¥è¯¢æˆæœ¬ï¼šlast_query_cost"></a><strong>1.</strong> <strong>ç»Ÿè®¡SQLçš„æŸ¥è¯¢æˆæœ¬ï¼šlast_query_cost</strong></h4><pre><code class="mysql">SHOW STATUS LIKE &#39;last_query_cost&#39;;</code></pre><p>ä½¿ç”¨åœºæ™¯ï¼šå®ƒå¯¹äºæ¯”è¾ƒå¼€é”€æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œç‰¹åˆ«æ˜¯æˆ‘ä»¬æœ‰å¥½å‡ ç§æŸ¥è¯¢æ–¹å¼å¯é€‰çš„æ—¶å€™ã€‚</p><blockquote><p>SQL æŸ¥è¯¢æ˜¯ä¸€ä¸ªåŠ¨æ€çš„è¿‡ç¨‹ï¼Œä»é¡µåŠ è½½çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¸¤ç‚¹ç»“è®ºï¼š</p><ol><li><code>ä½ç½®å†³å®šæ•ˆç‡</code>ã€‚å¦‚æœé¡µå°±åœ¨æ•°æ®åº“<code>ç¼“å†²æ± </code>ä¸­ï¼Œé‚£ä¹ˆæ•ˆç‡æ˜¯æœ€é«˜çš„ï¼Œå¦åˆ™è¿˜éœ€è¦ä»<code>å†…å­˜</code>æˆ–è€…<code>ç£ç›˜</code>ä¸­è¿›è¡Œè¯»å–ï¼Œå½“ç„¶é’ˆå¯¹å•ä¸ªé¡µçš„è¯»å–æ¥è¯´ï¼Œå¦‚æœé¡µå­˜åœ¨äºå†…å­˜ä¸­ï¼Œä¼šæ¯”åœ¨ç£ç›˜ä¸­è¯»å–æ•ˆç‡é«˜å¾ˆå¤šã€‚</li><li><code>æ‰¹é‡å†³å®šæ•ˆç‡</code>ã€‚å¦‚æœæˆ‘ä»¬ä»ç£ç›˜ä¸­å¯¹å•ä¸€é¡µè¿›è¡Œéšæœºè¯»ï¼Œé‚£ä¹ˆæ•ˆç‡æ˜¯å¾ˆä½çš„ï¼ˆå·®ä¸å¤š10msï¼‰ï¼Œè€Œé‡‡ç”¨é¡ºåºè¯»å–çš„æ–¹å¼ï¼Œæ‰¹é‡å¯¹é¡µè¿›è¡Œè¯»å–ï¼Œå¹³å‡ä¸€é¡µçš„è¯»å–æ•ˆç‡å°±ä¼šæå‡å¾ˆå¤šï¼Œç”šè‡³è¦å¿«äºå•ä¸ªé¡µé¢åœ¨å†…å­˜ä¸­çš„éšæœºè¯»å–ã€‚</li></ol><p>æ‰€ä»¥è¯´ï¼Œé‡åˆ°I&#x2F;Oå¹¶ä¸ç”¨æ‹…å¿ƒï¼Œæ–¹æ³•æ‰¾å¯¹äº†ï¼Œæ•ˆç‡è¿˜æ˜¯å¾ˆé«˜çš„ã€‚æˆ‘ä»¬é¦–å…ˆè¦è€ƒè™‘æ•°æ®å­˜æ”¾çš„ä½ç½®ï¼Œå¦‚æœæ˜¯ç»å¸¸ä½¿ç”¨çš„æ•°æ®å°±è¦å°½é‡æ”¾åˆ°<code>ç¼“å†²æ± </code>ä¸­ï¼Œå…¶æ¬¡æˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨ç£ç›˜çš„ååèƒ½åŠ›ï¼Œä¸€æ¬¡æ€§æ‰¹é‡è¯»å–æ•°æ®ï¼Œè¿™æ ·å•ä¸ªé¡µçš„è¯»å–æ•ˆç‡ä¹Ÿå°±å¾—åˆ°äº†æå‡ã€‚</p></blockquote><h4 id="2-å®šä½æ‰§è¡Œæ…¢çš„SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#2-å®šä½æ‰§è¡Œæ…¢çš„SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="2. å®šä½æ‰§è¡Œæ…¢çš„SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—"></a><strong>2.</strong> <strong>å®šä½æ‰§è¡Œæ…¢çš„SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—</strong></h4><p>MySQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œç”¨æ¥è®°å½•åœ¨MySQLä¸­<code>å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼</code>çš„è¯­å¥ï¼Œå…·ä½“æŒ‡è¿è¡Œæ—¶é—´è¶…è¿‡<code>long_query_time</code>çš„å€¼çš„SQLï¼Œåˆ™ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚long_query_timeçš„é»˜è®¤å€¼ä¸º<code>10</code>ï¼Œæ„æ€æ˜¯è¿è¡Œ10ç§’ä»¥ä¸Šï¼ˆä¸å«10ç§’ï¼‰çš„è¯­å¥ï¼Œè®¤ä¸ºæ˜¯è¶…å‡ºäº†æˆ‘ä»¬çš„æœ€å¤§å¿è€æ—¶é—´å€¼ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQLæ•°æ®åº“<code>æ²¡æœ‰å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</code>ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥è®¾ç½®è¿™ä¸ªå‚æ•°ã€‚<code>å¦‚æœä¸æ˜¯è°ƒä¼˜éœ€è¦çš„è¯ï¼Œä¸€èˆ¬ä¸å»ºè®®å¯åŠ¨è¯¥å‚æ•°</code>ï¼Œå› ä¸ºå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ä¼šæˆ–å¤šæˆ–å°‘å¸¦æ¥ä¸€å®šçš„æ€§èƒ½å½±å“ã€‚</p><h5 id="2-1-å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å‚æ•°"><a href="#2-1-å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å‚æ•°" class="headerlink" title="2.1 å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å‚æ•°"></a><strong>2.1</strong> <strong>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å‚æ•°</strong></h5><p><strong>1.</strong> <strong>å¼€å¯slow_query_log</strong></p><pre><code class="mysql">set global slow_query_log=&#39;ON&#39;;</code></pre><p>æŸ¥çœ‹ä¸‹æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯ï¼Œä»¥åŠæ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„ä½ç½®ï¼š</p><pre><code class="mysql">show variables like `%slow_query_log%`;</code></pre><p><strong>2.</strong> <strong>ä¿®æ”¹long_query_timeé˜ˆå€¼</strong></p><pre><code class="mysql">show variables like &#39;%long_query_time%&#39;;</code></pre><pre><code class="mysql">#æµ‹è¯•å‘ç°ï¼šè®¾ç½®globalçš„æ–¹å¼å¯¹å½“å‰sessionçš„long_query_timeå¤±æ•ˆã€‚å¯¹æ–°è¿æ¥çš„å®¢æˆ·ç«¯æœ‰æ•ˆã€‚æ‰€ä»¥å¯ä»¥ä¸€å¹¶ æ‰§è¡Œä¸‹è¿°è¯­å¥ mysql &gt; set global long_query_time = 1; mysql&gt; show global variables like &#39;%long_query_time%&#39;; mysql&gt; set long_query_time=1; mysql&gt; show variables like &#39;%long_query_time%&#39;;</code></pre><h5 id="2-2-æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°ç›®"><a href="#2-2-æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°ç›®" class="headerlink" title="2.2 æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°ç›®"></a><strong>2.2</strong> <strong>æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°ç›®</strong></h5><pre><code class="mysql">SHOW GLOBAL STATUS LIKE &#39;%Slow_queries%&#39;;</code></pre><h5 id="2-3-æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šmysqldumpslow"><a href="#2-3-æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šmysqldumpslow" class="headerlink" title="2.3 æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šmysqldumpslow"></a><strong>2.3</strong> <strong>æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šmysqldumpslow</strong></h5><pre><code class="shell">#å¾—åˆ°è¿”å›è®°å½•é›†æœ€å¤šçš„10ä¸ªSQL mysqldumpslow -s r -t 10 /var/lib/mysql/atguigu-slow.log #å¾—åˆ°è®¿é—®æ¬¡æ•°æœ€å¤šçš„10ä¸ªSQL mysqldumpslow -s c -t 10 /var/lib/mysql/atguigu-slow.log#å¾—åˆ°æŒ‰ç…§æ—¶é—´æ’åºçš„å‰10æ¡é‡Œé¢å«æœ‰å·¦è¿æ¥çš„æŸ¥è¯¢è¯­å¥ mysqldumpslow -s t -t 10 -g &quot;left join&quot; /var/lib/mysql/atguigu-slow.log #å¦å¤–å»ºè®®åœ¨ä½¿ç”¨è¿™äº›å‘½ä»¤æ—¶ç»“åˆ | å’Œmore ä½¿ç”¨ ï¼Œå¦åˆ™æœ‰å¯èƒ½å‡ºç°çˆ†å±æƒ…å†µ mysqldumpslow -s r -t 10 /var/lib/mysql/atguigu-slow.log | more</code></pre><h5 id="2-4-å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#2-4-å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="2.4 å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—"></a><strong>2.4</strong> <strong>å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—</strong></h5><p><strong>æ–¹å¼1ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p><pre><code class="ini">[mysqld] slow_query_log=OFF#æˆ–[mysqld] #slow_query_log =OFF</code></pre><p><strong>æ–¹å¼2ï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p><pre><code class="mysql">SET GLOBAL slow_query_log=off;</code></pre><h4 id="3-æŸ¥çœ‹-SQL-æ‰§è¡Œæˆæœ¬ï¼šSHOW-PROFILE"><a href="#3-æŸ¥çœ‹-SQL-æ‰§è¡Œæˆæœ¬ï¼šSHOW-PROFILE" class="headerlink" title="3. æŸ¥çœ‹ SQL æ‰§è¡Œæˆæœ¬ï¼šSHOW PROFILE"></a><strong>3.</strong> <strong>æŸ¥çœ‹</strong> <strong>SQL</strong> <strong>æ‰§è¡Œæˆæœ¬ï¼šSHOW PROFILE</strong></h4><pre><code class="mysql">show variables like &#39;profiling&#39;;#å¼€å¯set profiling = &#39;ON&#39;;#æŸ¥çœ‹show profiles;show profile cpu,block io for query 2;</code></pre><h4 id="4-åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAIN"><a href="#4-åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAIN" class="headerlink" title="4. åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAIN"></a><strong>4.</strong> <strong>åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAIN</strong></h4><h5 id="4-1-åŸºæœ¬è¯­æ³•"><a href="#4-1-åŸºæœ¬è¯­æ³•" class="headerlink" title="4.1 åŸºæœ¬è¯­æ³•"></a><strong>4.1</strong> <strong>åŸºæœ¬è¯­æ³•</strong></h5><pre><code class="mysql">EXPLAIN SELECT select_options #æˆ–è€…DESCRIBE SELECT select_options</code></pre><p>EXPLAIN è¯­å¥è¾“å‡ºçš„å„ä¸ªåˆ—çš„ä½œç”¨å¦‚ä¸‹ï¼š</p><table><thead><tr><th>åˆ—å</th><th>æè¿°</th></tr></thead><tbody><tr><td>id</td><td>åœ¨ä¸€ä¸ªå¤§çš„æŸ¥è¯¢è¯­å¥ä¸­æ¯ä¸ªSELECTå…³é”®å­—éƒ½å¯¹åº”ä¸€ä¸ª<code>å”¯ä¸€çš„id</code></td></tr><tr><td>select_type</td><td>SELECTå…³é”®å­—å¯¹åº”çš„é‚£ä¸ªæŸ¥è¯¢çš„ç±»å‹</td></tr><tr><td>table</td><td>è¡¨å</td></tr><tr><td>partitions</td><td>åŒ¹é…çš„åˆ†åŒºä¿¡æ¯</td></tr><tr><td>type</td><td>é’ˆå¯¹å•è¡¨çš„è®¿é—®æ–¹æ³•</td></tr><tr><td>possible_keys</td><td>å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•</td></tr><tr><td>key</td><td>å®é™…ä¸Šä½¿ç”¨çš„ç´¢å¼•</td></tr><tr><td>key_len</td><td>å®é™…ä½¿ç”¨åˆ°çš„ç´¢å¼•é•¿åº¦</td></tr><tr><td>ref</td><td>å½“ä½¿ç”¨ç´¢å¼•åˆ—ç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œä¸ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼åŒ¹é…çš„å¯¹è±¡ä¿¡æ¯</td></tr><tr><td>rows</td><td>é¢„ä¼°çš„éœ€è¦è¯»å–çš„è®°å½•æ¡æ•°</td></tr><tr><td>filtered</td><td>æŸä¸ªè¡¨ç»è¿‡æœç´¢æ¡ä»¶è¿‡æ»¤åå‰©ä½™è®°å½•æ¡æ•°çš„ç™¾åˆ†æ¯”</td></tr><tr><td>Extra</td><td>ä¸€äº›é¢å¤–çš„ä¿¡æ¯</td></tr></tbody></table><h5 id="4-2-EXPLAINå„åˆ—ä½œç”¨"><a href="#4-2-EXPLAINå„åˆ—ä½œç”¨" class="headerlink" title="4.2 EXPLAINå„åˆ—ä½œç”¨"></a><strong>4.2 EXPLAINå„åˆ—ä½œç”¨</strong></h5><p><strong>1. table</strong></p><p>ä¸è®ºæˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥æœ‰å¤šå¤æ‚ï¼ŒåŒ…å«äº†å¤šå°‘ä¸ªè¡¨ ï¼Œåˆ°æœ€åä¹Ÿæ˜¯éœ€è¦å¯¹æ¯ä¸ªè¡¨è¿›è¡Œ<code>å•è¡¨è®¿é—®</code>çš„ï¼Œæ‰€ä»¥MySQLè§„å®š<strong>EXPLAINè¯­å¥è¾“å‡ºçš„æ¯æ¡è®°å½•éƒ½å¯¹åº”ç€æŸä¸ªå•è¡¨çš„è®¿é—®æ–¹æ³•</strong>ï¼Œè¯¥æ¡è®°å½•çš„tableåˆ—ä»£è¡¨ç€è¯¥è¡¨çš„è¡¨åï¼ˆæœ‰æ—¶ä¸æ˜¯çœŸå®çš„è¡¨åå­—ï¼Œå¯èƒ½æ˜¯ç®€ç§°ï¼‰ã€‚</p><p><strong>2. id</strong></p><ul><li><strong>idå¦‚æœç›¸åŒï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç»„ï¼Œä»ä¸Šå¾€ä¸‹é¡ºåºæ‰§è¡Œ</strong></li><li><strong>åœ¨æ‰€æœ‰ç»„ä¸­ï¼Œidå€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œ</strong></li><li><strong>å…³æ³¨ç‚¹ï¼šidå·æ¯ä¸ªå·ç ï¼Œè¡¨ç¤ºä¸€è¶Ÿç‹¬ç«‹çš„æŸ¥è¯¢,ä¸€ä¸ªsqlçš„æŸ¥è¯¢è¶Ÿæ•°è¶Šå°‘è¶Šå¥½</strong></li></ul><p><strong>3. select_type</strong></p><p><strong>4. partitions</strong></p><p><strong>5. typeï¼ˆé‡ç‚¹ï¼‰</strong></p><p><strong>ç»“æœå€¼ä»æœ€å¥½åˆ°æœ€åä¾æ¬¡æ˜¯ï¼š</strong> <strong>system &gt; const &gt; eq_ref &gt; ref</strong> <strong>&gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt;</strong> <strong>range &gt; index &gt; ALL</strong> </p><p><strong>SQLæ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡ï¼šè‡³å°‘è¦è¾¾åˆ° rangeçº§åˆ«ï¼Œè¦æ±‚æ˜¯refçº§åˆ«ï¼Œæœ€å¥½æ˜¯constsçº§åˆ«ã€‚ï¼ˆé˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œè¦æ±‚ï¼‰</strong></p><p><strong>6. possible_keyså’Œkey</strong></p><p><strong>7. key_lenï¼ˆé‡ç‚¹ï¼‰</strong></p><p><strong>key_lençš„é•¿åº¦è®¡ç®—å…¬å¼ï¼š</strong></p><pre><code>varchar(10)å˜é•¿å­—æ®µä¸”å…è®¸NULL = 10 * ( character setï¼š utf8=3,gbk=2,latin1=1)+1(NULL)+2(å˜é•¿å­—æ®µ) varchar(10)å˜é•¿å­—æ®µä¸”ä¸å…è®¸NULL = 10 * ( character setï¼šutf8=3,gbk=2,latin1=1)+2(å˜é•¿å­—æ®µ)char(10)å›ºå®šå­—æ®µä¸”å…è®¸NULL = 10 * ( character setï¼šutf8=3,gbk=2,latin1=1)+1(NULL) char(10)å›ºå®šå­—æ®µä¸”ä¸å…è®¸NULL = 10 * ( character setï¼šutf8=3,gbk=2,latin1=1)</code></pre><p><strong>8. ref</strong> </p><p><strong>9. rowsï¼ˆé‡ç‚¹ï¼‰</strong></p><p>é¢„ä¼°çš„éœ€è¦è¯»å–çš„è®°å½•æ¡æ•°</p><p><strong>10. filtered</strong></p><p><strong>11. Extra</strong></p><h4 id="5-EXPLAINçš„è¿›ä¸€æ­¥ä½¿ç”¨"><a href="#5-EXPLAINçš„è¿›ä¸€æ­¥ä½¿ç”¨" class="headerlink" title="5. EXPLAINçš„è¿›ä¸€æ­¥ä½¿ç”¨"></a><strong>5. EXPLAINçš„è¿›ä¸€æ­¥ä½¿ç”¨</strong></h4><h5 id="5-1-EXPLAINå››ç§è¾“å‡ºæ ¼å¼"><a href="#5-1-EXPLAINå››ç§è¾“å‡ºæ ¼å¼" class="headerlink" title="5.1 EXPLAINå››ç§è¾“å‡ºæ ¼å¼"></a><strong>5.1 EXPLAINå››ç§è¾“å‡ºæ ¼å¼</strong></h5><p>è¿™é‡Œè°ˆè°ˆEXPLAINçš„è¾“å‡ºæ ¼å¼ã€‚EXPLAINå¯ä»¥è¾“å‡ºå››ç§æ ¼å¼ï¼š<code>ä¼ ç»Ÿæ ¼å¼</code>ï¼Œ<code>JSONæ ¼å¼</code>ï¼Œ<code>TREEæ ¼å¼</code>ä»¥åŠ<code>å¯è§†åŒ–è¾“å‡º</code>ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©é€‚ç”¨äºè‡ªå·±çš„æ ¼å¼ã€‚</p><p><strong>1.</strong> <strong>ä¼ ç»Ÿæ ¼å¼</strong></p><p><strong>2. JSONæ ¼å¼</strong> </p><p>JSONæ ¼å¼ï¼šåœ¨EXPLAINå•è¯å’ŒçœŸæ­£çš„æŸ¥è¯¢è¯­å¥ä¸­é—´åŠ ä¸Š<code>FORMAT=JSON</code>ã€‚ç”¨äºæŸ¥çœ‹æ‰§è¡Œæˆæœ¬<code>cost_info</code></p><p><strong>3. TREEæ ¼å¼</strong></p><p>TREEæ ¼å¼æ˜¯8.0.16ç‰ˆæœ¬ä¹‹åå¼•å…¥çš„æ–°æ ¼å¼ï¼Œä¸»è¦æ ¹æ®æŸ¥è¯¢çš„<code>å„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„å…³ç³»</code>å’Œ<code>å„éƒ¨åˆ†çš„æ‰§è¡Œé¡ºåº</code>æ¥æè¿°å¦‚ä½•æŸ¥è¯¢ã€‚</p><p><strong>4.</strong> <strong>å¯è§†åŒ–è¾“å‡º</strong></p><p>å¯è§†åŒ–è¾“å‡ºï¼Œå¯ä»¥é€šè¿‡MySQL Workbenchå¯è§†åŒ–æŸ¥çœ‹MySQLçš„æ‰§è¡Œè®¡åˆ’ã€‚</p><h5 id="5-2-SHOW-WARNINGSçš„ä½¿ç”¨"><a href="#5-2-SHOW-WARNINGSçš„ä½¿ç”¨" class="headerlink" title="5.2 SHOW WARNINGSçš„ä½¿ç”¨"></a><strong>5.2 SHOW WARNINGSçš„ä½¿ç”¨</strong></h5><pre><code class="mysql">mysql&gt; EXPLAIN SELECT s1.key1, s2.key1 FROM s1 LEFT JOIN s2 ON s1.key1 = s2.key1 WHERE s2.common_field IS NOT NULL;# æŸ¥çœ‹ä¼˜åŒ–åçš„æ‰§è¡Œè¯­å¥mysql&gt; SHOW WARNINGS\G</code></pre><h4 id="6-åˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’ï¼štrace"><a href="#6-åˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’ï¼štrace" class="headerlink" title="6. åˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’ï¼štrace"></a><strong>6.</strong> <strong>åˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’ï¼štrace</strong></h4><pre><code class="mysql"># å¼€å¯SET optimizer_trace=&quot;enabled=on&quot;,end_markers_in_json=on; # è®¾ç½®å¤§å°set optimizer_trace_max_mem_size=1000000;# ä½¿ç”¨select * from student where id &lt; 10;select * from information_schema.optimizer_trace\G</code></pre><h4 id="7-MySQLç›‘æ§åˆ†æè§†å›¾-sys-schema"><a href="#7-MySQLç›‘æ§åˆ†æè§†å›¾-sys-schema" class="headerlink" title="7. MySQLç›‘æ§åˆ†æè§†å›¾-sys schema"></a><strong>7. MySQLç›‘æ§åˆ†æè§†å›¾-sys schema</strong></h4><p><strong>7.1 Sys schemaè§†å›¾ä½¿ç”¨åœºæ™¯</strong></p><p><strong>ç´¢å¼•æƒ…å†µ</strong></p><pre><code class="mysql">#1. æŸ¥è¯¢å†—ä½™ç´¢å¼• select * from sys.schema_redundant_indexes; #2. æŸ¥è¯¢æœªä½¿ç”¨è¿‡çš„ç´¢å¼• select * from sys.schema_unused_indexes; #3. æŸ¥è¯¢ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ select index_name,rows_selected,rows_inserted,rows_updated,rows_deleted from sys.schema_index_statistics where table_schema=&#39;dbname&#39; ;</code></pre><p><strong>è¡¨ç›¸å…³</strong></p><pre><code class="mysql"># 1. æŸ¥è¯¢è¡¨çš„è®¿é—®é‡ select table_schema,table_name,sum(io_read_requests+io_write_requests) as io from sys.schema_table_statistics group by table_schema,table_name order by io desc; # 2. æŸ¥è¯¢å ç”¨bufferpoolè¾ƒå¤šçš„è¡¨ select object_schema,object_name,allocated,datafrom sys.innodb_buffer_stats_by_table order by allocated limit 10; # 3. æŸ¥çœ‹è¡¨çš„å…¨è¡¨æ‰«ææƒ…å†µ select * from sys.statements_with_full_table_scans where db=&#39;dbname&#39;;</code></pre><p><strong>è¯­å¥ç›¸å…³</strong></p><pre><code class="mysql">#1. ç›‘æ§SQLæ‰§è¡Œçš„é¢‘ç‡ select db,exec_count,query from sys.statement_analysis order by exec_count desc; #2. ç›‘æ§ä½¿ç”¨äº†æ’åºçš„SQL select db,exec_count,first_seen,last_seen,queryfrom sys.statements_with_sorting limit 1; #3. ç›‘æ§ä½¿ç”¨äº†ä¸´æ—¶è¡¨æˆ–è€…ç£ç›˜ä¸´æ—¶è¡¨çš„SQL select db,exec_count,tmp_tables,tmp_disk_tables,queryfrom sys.statement_analysis where tmp_tables&gt;0 or tmp_disk_tables &gt;0 order by (tmp_tables+tmp_disk_tables) desc;</code></pre><p><strong>IOç›¸å…³</strong></p><pre><code class="mysql">#1. æŸ¥çœ‹æ¶ˆè€—ç£ç›˜IOçš„æ–‡ä»¶ select file,avg_read,avg_write,avg_read+avg_write as avg_iofrom sys.io_global_by_file_by_bytes order by avg_read limit 10;</code></pre><p><strong>Innodb</strong> <strong>ç›¸å…³</strong></p><pre><code class="mysql">#1. è¡Œé”é˜»å¡æƒ…å†µ select * from sys.innodb_lock_waits;</code></pre><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬10ç«  ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–</title>
      <link href="/2023/07/15/%E7%AC%AC10%E7%AB%A0%20%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E4%B8%8E%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/"/>
      <url>/2023/07/15/%E7%AC%AC10%E7%AB%A0%20%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E4%B8%8E%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬10ç« -ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–"><a href="#ç¬¬10ç« -ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="ç¬¬10ç«  ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–"></a>ç¬¬10ç«  ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–</h3><h4 id="1-ç´¢å¼•å¤±æ•ˆæ¡ˆä¾‹"><a href="#1-ç´¢å¼•å¤±æ•ˆæ¡ˆä¾‹" class="headerlink" title="1. ç´¢å¼•å¤±æ•ˆæ¡ˆä¾‹"></a><strong>1.</strong> <strong>ç´¢å¼•å¤±æ•ˆæ¡ˆä¾‹</strong></h4><p>MySQLä¸­<code>æé«˜æ€§èƒ½</code>çš„ä¸€ä¸ªæœ€æœ‰æ•ˆçš„æ–¹å¼æ˜¯å¯¹æ•°æ®è¡¨<code>è®¾è®¡åˆç†çš„ç´¢å¼•</code>ã€‚ç´¢å¼•æä¾›äº†è®¿é—®é«˜æ•ˆæ•°æ®çš„æ–¹æ³•ï¼Œå¹¶ä¸”åŠ å¿«æŸ¥è¯¢çš„é€Ÿåº¦ï¼Œå› æ­¤ç´¢å¼•å¯¹æŸ¥è¯¢çš„é€Ÿåº¦æœ‰ç€è‡³å…³é‡è¦çš„å½±å“ã€‚</p><ul><li>ä½¿ç”¨ç´¢å¼•å¯ä»¥<code>å¿«é€Ÿåœ°å®šä½</code>è¡¨ä¸­çš„æŸæ¡è®°å½•ï¼Œä»è€Œæé«˜æ•°æ®åº“æŸ¥è¯¢çš„é€Ÿåº¦ï¼Œæé«˜æ•°æ®åº“çš„æ€§èƒ½ã€‚</li><li>å¦‚æœæŸ¥è¯¢æ—¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼ŒæŸ¥è¯¢è¯­å¥å°±ä¼š<code>æ‰«æè¡¨ä¸­çš„æ‰€æœ‰è®°å½•</code>ã€‚åœ¨æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹ï¼Œè¿™æ ·æŸ¥è¯¢çš„é€Ÿåº¦ä¼šå¾ˆæ…¢ã€‚</li></ul><p>å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ï¼ˆé»˜è®¤ï¼‰é‡‡ç”¨<code>B+æ ‘</code>æ¥æ„å»ºç´¢å¼•ã€‚åªæ˜¯ç©ºé—´åˆ—ç±»å‹çš„ç´¢å¼•ä½¿ç”¨<code>R-æ ‘</code>ï¼Œå¹¶ä¸”MEMORYè¡¨è¿˜æ”¯æŒ<code>hashç´¢å¼•</code>ã€‚</p><p>å…¶å®ï¼Œç”¨ä¸ç”¨ç´¢å¼•ï¼Œæœ€ç»ˆéƒ½æ˜¯ä¼˜åŒ–å™¨è¯´äº†ç®—ã€‚ä¼˜åŒ–å™¨æ˜¯åŸºäºä»€ä¹ˆçš„ä¼˜åŒ–å™¨ï¼ŸåŸºäº<code>costå¼€é”€(CostBaseOptimizer)</code>ï¼Œå®ƒä¸æ˜¯åŸºäº<code>è§„åˆ™(Rule-BasedOptimizer)</code>ï¼Œä¹Ÿä¸æ˜¯åŸºäº<code>è¯­ä¹‰</code>ã€‚æ€ä¹ˆæ ·å¼€é”€å°å°±æ€ä¹ˆæ¥ã€‚å¦å¤–ï¼Œ<strong>SQLè¯­å¥æ˜¯å¦ä½¿ç”¨ç´¢å¼•ï¼Œè·Ÿæ•°æ®åº“ç‰ˆæœ¬ã€æ•°æ®é‡ã€æ•°æ®é€‰æ‹©åº¦éƒ½æœ‰å…³ç³»ã€‚</strong></p><h5 id="1-1-å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±"><a href="#1-1-å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±" class="headerlink" title="1.1 å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±"></a><strong>1.1</strong> <strong>å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±</strong></h5><h5 id="1-2-æœ€ä½³å·¦å‰ç¼€æ³•åˆ™"><a href="#1-2-æœ€ä½³å·¦å‰ç¼€æ³•åˆ™" class="headerlink" title="1.2 æœ€ä½³å·¦å‰ç¼€æ³•åˆ™"></a><strong>1.2</strong> <strong>æœ€ä½³å·¦å‰ç¼€æ³•åˆ™</strong></h5><p>åœ¨MySQLå»ºç«‹è”åˆç´¢å¼•æ—¶ä¼šéµå®ˆæœ€ä½³å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œå³æœ€å·¦ä¼˜å…ˆï¼Œåœ¨æ£€ç´¢æ•°æ®æ—¶ä»è”åˆç´¢å¼•çš„æœ€å·¦è¾¹å¼€å§‹åŒ¹é…ã€‚</p><p>ç»“è®ºï¼šMySQLå¯ä»¥ä¸ºå¤šä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ï¼Œä¸€ä¸ªç´¢å¼•å¯ä»¥åŒ…æ‹¬16ä¸ªå­—æ®µã€‚å¯¹äºå¤šåˆ—ç´¢å¼•ï¼Œ<strong>è¿‡æ»¤æ¡ä»¶è¦ä½¿ç”¨ç´¢å¼•å¿…é¡»æŒ‰ç…§ç´¢å¼•å»ºç«‹æ—¶çš„é¡ºåºï¼Œä¾æ¬¡æ»¡è¶³ï¼Œä¸€æ—¦è·³è¿‡æŸä¸ªå­—æ®µï¼Œç´¢å¼•åé¢çš„å­—æ®µéƒ½æ— æ³•è¢«ä½¿ç”¨ã€‚</strong>å¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­æ²¡æœ‰ä½¿ç”¨è¿™äº›å­—æ®µä¸­ç¬¬1ä¸ªå­—æ®µæ—¶ï¼Œå¤šåˆ—ï¼ˆæˆ–è”åˆï¼‰ç´¢å¼•ä¸ä¼šè¢«ä½¿ç”¨ã€‚</p><h5 id="1-3-ä¸»é”®æ’å…¥é¡ºåº"><a href="#1-3-ä¸»é”®æ’å…¥é¡ºåº" class="headerlink" title="1.3 ä¸»é”®æ’å…¥é¡ºåº"></a><strong>1.3</strong> <strong>ä¸»é”®æ’å…¥é¡ºåº</strong></h5><p>å¯¹äºä¸€ä¸ªä½¿ç”¨<code>InnoDB</code>å­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œåœ¨æˆ‘ä»¬æ²¡æœ‰æ˜¾ç¤ºçš„åˆ›å»ºç´¢å¼•æ—¶ï¼Œè¡¨ä¸­çš„æ•°æ®å®é™…ä¸Šéƒ½æ˜¯å­˜å‚¨åœ¨<code>èšç°‡ç´¢å¼•</code>çš„å¶å­èŠ‚ç‚¹çš„ã€‚è€Œè®°å½•åˆå­˜å‚¨åœ¨æ•°æ®é¡µä¸­çš„ï¼Œæ•°æ®é¡µå’Œè®°å½•åˆæ˜¯æŒ‰ç…§è®°å½•<code>ä¸»é”®å€¼ä»å°åˆ°å¤§</code>çš„é¡ºåºè¿›è¡Œæ’åºï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬<code>æ’å…¥</code>çš„è®°å½•çš„<code>ä¸»é”®å€¼æ˜¯ä¾æ¬¡å¢å¤§</code>çš„è¯ï¼Œé‚£æˆ‘ä»¬æ¯æ’æ»¡ä¸€ä¸ªæ•°æ®é¡µå°±æ¢åˆ°ä¸‹ä¸€ä¸ªæ•°æ®é¡µç»§ç»­æ’ï¼Œè€Œå¦‚æœæˆ‘ä»¬æ’å…¥çš„<code>ä¸»é”®å€¼å¿½å°å¿½å¤§</code>çš„è¯ï¼Œåˆ™å¯èƒ½ä¼šé€ æˆ<code>é¡µé¢åˆ†è£‚</code>å’Œ<code>è®°å½•ç§»ä½</code>ã€‚</p><h5 id="1-4-è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢-è‡ªåŠ¨æˆ–æ‰‹åŠ¨-å¯¼è‡´ç´¢å¼•å¤±æ•ˆ"><a href="#1-4-è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢-è‡ªåŠ¨æˆ–æ‰‹åŠ¨-å¯¼è‡´ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="1.4 è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢(è‡ªåŠ¨æˆ–æ‰‹åŠ¨)å¯¼è‡´ç´¢å¼•å¤±æ•ˆ"></a><strong>1.4</strong> <strong>è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢(è‡ªåŠ¨æˆ–æ‰‹åŠ¨)å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</strong></h5><h5 id="1-5-ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ"><a href="#1-5-ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="1.5 ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ"></a><strong>1.5</strong> <strong>ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</strong></h5><h5 id="1-6-èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—ç´¢å¼•å¤±æ•ˆ"><a href="#1-6-èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="1.6 èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—ç´¢å¼•å¤±æ•ˆ"></a><strong>1.6</strong> <strong>èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—ç´¢å¼•å¤±æ•ˆ</strong></h5><blockquote><p>åº”ç”¨å¼€å‘ä¸­èŒƒå›´æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼šé‡‘é¢æŸ¥è¯¢ï¼Œæ—¥æœŸæŸ¥è¯¢å¾€å¾€éƒ½æ˜¯èŒƒå›´æŸ¥è¯¢ã€‚åº”å°†æŸ¥è¯¢æ¡ä»¶æ”¾ç½®whereè¯­å¥æœ€åã€‚ï¼ˆåˆ›å»ºçš„è”åˆç´¢å¼•ä¸­ï¼ŒåŠ¡å¿…æŠŠèŒƒå›´æ¶‰åŠåˆ°çš„å­—æ®µå†™åœ¨æœ€åï¼‰</p></blockquote><h5 id="1-7-ä¸ç­‰äº-x3D-æˆ–è€…-lt-gt-ç´¢å¼•å¤±æ•ˆ"><a href="#1-7-ä¸ç­‰äº-x3D-æˆ–è€…-lt-gt-ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="1.7 ä¸ç­‰äº(!&#x3D; æˆ–è€…&lt;&gt;)ç´¢å¼•å¤±æ•ˆ"></a><strong>1.7</strong> <strong>ä¸ç­‰äº(!&#x3D; æˆ–è€…&lt;&gt;)ç´¢å¼•å¤±æ•ˆ</strong></h5><h5 id="1-8-is-nullå¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œis-not-nullæ— æ³•ä½¿ç”¨ç´¢å¼•"><a href="#1-8-is-nullå¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œis-not-nullæ— æ³•ä½¿ç”¨ç´¢å¼•" class="headerlink" title="1.8 is nullå¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œis not nullæ— æ³•ä½¿ç”¨ç´¢å¼•"></a><strong>1.8 is nullå¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œis not nullæ— æ³•ä½¿ç”¨ç´¢å¼•</strong></h5><blockquote><p>ç»“è®ºï¼šæœ€å¥½åœ¨è®¾è®¡æ•°æ®è¡¨çš„æ—¶å€™å°±å°†<code>å­—æ®µè®¾ç½®ä¸º NOT NULL çº¦æŸ</code>ï¼Œæ¯”å¦‚ä½ å¯ä»¥å°†INTç±»å‹çš„å­—æ®µï¼Œé»˜è®¤å€¼è®¾ç½®ä¸º0ã€‚å°†å­—ç¬¦ç±»å‹çš„é»˜è®¤å€¼è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²(â€˜â€™)</p><p>æ‹“å±•ï¼šåŒç†ï¼Œåœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨<code>not like</code>ä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œå¯¼è‡´å…¨è¡¨æ‰«æ</p></blockquote><h5 id="1-9-likeä»¥é€šé…ç¬¦-å¼€å¤´ç´¢å¼•å¤±æ•ˆ"><a href="#1-9-likeä»¥é€šé…ç¬¦-å¼€å¤´ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="1.9 likeä»¥é€šé…ç¬¦%å¼€å¤´ç´¢å¼•å¤±æ•ˆ"></a><strong>1.9 likeä»¥é€šé…ç¬¦%å¼€å¤´ç´¢å¼•å¤±æ•ˆ</strong></h5><blockquote><p>æ‹“å±•ï¼šAlibabaã€ŠJavaå¼€å‘æ‰‹å†Œã€‹</p><p>ã€å¼ºåˆ¶ã€‘é¡µé¢æœç´¢ä¸¥ç¦å·¦æ¨¡ç³Šæˆ–è€…å…¨æ¨¡ç³Šï¼Œå¦‚æœéœ€è¦è¯·èµ°æœç´¢å¼•æ“æ¥è§£å†³ã€‚</p></blockquote><h5 id="1-10-OR-å‰åå­˜åœ¨éç´¢å¼•çš„åˆ—ï¼Œç´¢å¼•å¤±æ•ˆ"><a href="#1-10-OR-å‰åå­˜åœ¨éç´¢å¼•çš„åˆ—ï¼Œç´¢å¼•å¤±æ•ˆ" class="headerlink" title="1.10 OR å‰åå­˜åœ¨éç´¢å¼•çš„åˆ—ï¼Œç´¢å¼•å¤±æ•ˆ"></a><strong>1.10 OR</strong> <strong>å‰åå­˜åœ¨éç´¢å¼•çš„åˆ—ï¼Œç´¢å¼•å¤±æ•ˆ</strong></h5><p>åœ¨WHEREå­å¥ä¸­ï¼Œå¦‚æœåœ¨ORå‰çš„æ¡ä»¶åˆ—è¿›è¡Œäº†ç´¢å¼•ï¼Œè€Œåœ¨ORåçš„æ¡ä»¶åˆ—æ²¡æœ‰è¿›è¡Œç´¢å¼•ï¼Œé‚£ä¹ˆç´¢å¼•ä¼šå¤±æ•ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ORå‰åçš„ä¸¤ä¸ªæ¡ä»¶ä¸­çš„åˆ—éƒ½æ˜¯ç´¢å¼•æ—¶ï¼ŒæŸ¥è¯¢ä¸­æ‰ä½¿ç”¨ç´¢å¼•ã€‚</strong></p><h5 id="1-11-æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨utf8mb4"><a href="#1-11-æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨utf8mb4" class="headerlink" title="1.11 æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨utf8mb4"></a><strong>1.11</strong> <strong>æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨utf8mb4</strong></h5><p>ç»Ÿä¸€ä½¿ç”¨utf8mb4( 5.5.3ç‰ˆæœ¬ä»¥ä¸Šæ”¯æŒ)å…¼å®¹æ€§æ›´å¥½ï¼Œç»Ÿä¸€å­—ç¬¦é›†å¯ä»¥é¿å…ç”±äºå­—ç¬¦é›†è½¬æ¢äº§ç”Ÿçš„ä¹±ç ã€‚ä¸åŒçš„<code>å­—ç¬¦é›†</code>è¿›è¡Œæ¯”è¾ƒå‰éœ€è¦è¿›è¡Œ<code>è½¬æ¢</code>ä¼šé€ æˆç´¢å¼•å¤±æ•ˆã€‚</p><h4 id="2-å…³è”æŸ¥è¯¢ä¼˜åŒ–"><a href="#2-å…³è”æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="2. å…³è”æŸ¥è¯¢ä¼˜åŒ–"></a><strong>2.</strong> <strong>å…³è”æŸ¥è¯¢ä¼˜åŒ–</strong></h4><blockquote><p>ç»“è®º1ï¼šå¯¹äºå†…è¿æ¥æ¥è¯´ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨å¯ä»¥å†³å®šè°æ¥ä½œä¸ºé©±åŠ¨è¡¨ï¼Œè°ä½œä¸ºè¢«é©±åŠ¨è¡¨å‡ºç°</p><p>ç»“è®º2ï¼šå¯¹äºå†…è¿æ¥æ¥è®²ï¼Œå¦‚æœè¡¨çš„è¿æ¥æ¡ä»¶ä¸­åªèƒ½æœ‰ä¸€ä¸ªå­—æ®µæœ‰ç´¢å¼•ï¼Œåˆ™æœ‰ç´¢å¼•çš„å­—æ®µæ‰€åœ¨çš„è¡¨ä¼šè¢«ä½œä¸ºè¢«é©±åŠ¨è¡¨</p><p>ç»“è®º3ï¼šå¯¹äºå†…è¿æ¥æ¥è¯´ï¼Œåœ¨ä¸¤ä¸ªè¡¨çš„è¿æ¥æ¡ä»¶éƒ½å­˜åœ¨ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œä¼šé€‰æ‹©å°è¡¨ä½œä¸ºé©±åŠ¨è¡¨ã€‚<code>å°è¡¨é©±åŠ¨å¤§è¡¨</code></p></blockquote><h5 id="2-1-Index-Nested-Loop-Joinï¼ˆç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰"><a href="#2-1-Index-Nested-Loop-Joinï¼ˆç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰" class="headerlink" title="2.1 Index Nested-Loop Joinï¼ˆç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰"></a>2.1 Index Nested-Loop Joinï¼ˆç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰</h5><p>Index Nested-Loop Joinå…¶ä¼˜åŒ–çš„æ€è·¯ä¸»è¦æ˜¯ä¸ºäº†<code>å‡å°‘å†…å±‚è¡¨æ•°æ®çš„åŒ¹é…æ¬¡æ•°</code>ï¼Œæ‰€ä»¥è¦æ±‚è¢«é©±åŠ¨è¡¨ä¸Šå¿…é¡»<code>æœ‰ç´¢å¼•</code>æ‰è¡Œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204011826671.png" alt="image-20220401182649509"></p><h5 id="2-2-Block-Nested-Loop-Joinï¼ˆå—åµŒå¥—å¾ªç¯è¿æ¥ï¼‰"><a href="#2-2-Block-Nested-Loop-Joinï¼ˆå—åµŒå¥—å¾ªç¯è¿æ¥ï¼‰" class="headerlink" title="2.2 Block Nested-Loop Joinï¼ˆå—åµŒå¥—å¾ªç¯è¿æ¥ï¼‰"></a>2.2 Block Nested-Loop Joinï¼ˆå—åµŒå¥—å¾ªç¯è¿æ¥ï¼‰</h5><p>å¦‚æœå­˜åœ¨ç´¢å¼•ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨indexçš„æ–¹å¼è¿›è¡Œjoinï¼Œå¦‚æœjoinçš„åˆ—æ²¡æœ‰ç´¢å¼•ï¼Œè¢«é©±åŠ¨è¡¨è¦æ‰«æçš„æ¬¡æ•°å¤ªå¤šäº†ã€‚æ¯æ¬¡è®¿é—®è¢«é©±åŠ¨è¡¨ï¼Œå…¶è¡¨ä¸­çš„è®°å½•éƒ½ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åå†ä»é©±åŠ¨è¡¨ä¸­å–ä¸€æ¡ä¸å…¶åŒ¹é…ï¼ŒåŒ¹é…ç»“æŸåæ¸…é™¤å†…å­˜ï¼Œç„¶åå†ä»é©±åŠ¨è¡¨ä¸­åŠ è½½ä¸€æ¡è®°å½•ï¼Œç„¶åæŠŠè¢«é©±åŠ¨è¡¨çš„è®°å½•å†åŠ è½½åˆ°å†…å­˜åŒ¹é…ï¼Œè¿™æ ·å‘¨è€Œå¤å§‹ï¼Œå¤§å¤§å¢åŠ äº†IOçš„æ¬¡æ•°ã€‚ä¸ºäº†å‡å°‘è¢«é©±åŠ¨è¡¨çš„IOæ¬¡æ•°ï¼Œå°±å‡ºç°äº†Block Nested-Loop Joinçš„æ–¹å¼ã€‚</p><p>ä¸å†æ˜¯é€æ¡è·å–é©±åŠ¨è¡¨çš„æ•°æ®ï¼Œè€Œæ˜¯ä¸€å—ä¸€å—çš„è·å–ï¼Œå¼•å…¥äº†<code>join bufferç¼“å†²åŒº</code>ï¼Œå°†é©±åŠ¨è¡¨joinç›¸å…³çš„éƒ¨åˆ†æ•°æ®åˆ—ï¼ˆå¤§å°å—join bufferçš„é™åˆ¶ï¼‰ç¼“å­˜åˆ°join bufferä¸­ï¼Œç„¶åå…¨è¡¨æ‰«æè¢«é©±åŠ¨è¡¨ï¼Œè¢«é©±åŠ¨è¡¨çš„æ¯ä¸€æ¡è®°å½•ä¸€æ¬¡æ€§å’Œjoin bufferä¸­çš„æ‰€æœ‰é©±åŠ¨è¡¨è®°å½•è¿›è¡ŒåŒ¹é…ï¼ˆå†…å­˜ä¸­æ“ä½œï¼‰ï¼Œå°†ç®€å•åµŒå¥—å¾ªç¯ä¸­çš„å¤šæ¬¡æ¯”è¾ƒåˆå¹¶æˆä¸€æ¬¡ï¼Œé™ä½äº†è¢«é©±åŠ¨è¡¨çš„è®¿é—®é¢‘ç‡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204011833000.png" alt="image-20220401183344880"></p><h5 id="2-3-Hash-Join"><a href="#2-3-Hash-Join" class="headerlink" title="2.3 Hash Join"></a>2.3 Hash Join</h5><p><strong>ä»MySQLçš„8.0.20ç‰ˆæœ¬å¼€å§‹å°†åºŸå¼ƒBNLJï¼Œå› ä¸ºä»MySQL8.0.18ç‰ˆæœ¬å¼€å§‹å°±åŠ å…¥äº†hash joiné»˜è®¤éƒ½ä¼šä½¿ç”¨hash join</strong></p><ul><li>Nested Loopï¼šå¯¹äºè¢«è¿æ¥çš„æ•°æ®å­é›†è¾ƒå°çš„æƒ…å†µä¸‹ï¼ŒNested Loopæ˜¯ä¸ªè¾ƒå¥½çš„é€‰æ‹©ã€‚</li><li>Hash Joinæ˜¯åš<code>å¤§æ•°æ®é›†è¿æ¥</code>æ—¶çš„å¸¸ç”¨æ–¹å¼ï¼Œä¼˜åŒ–å™¨ä½¿ç”¨ä¸¤ä¸ªè¡¨ä¸­è¾ƒå°ï¼ˆç›¸å¯¹è¾ƒå°ï¼‰çš„è¡¨åˆ©ç”¨Join Keyåœ¨å†…å­˜ä¸­å»ºç«‹<code>æ•£åˆ—å€¼</code>ï¼Œç„¶åæ‰«æè¾ƒå¤§çš„è¡¨å¹¶æ¢æµ‹æ•£åˆ—å€¼ï¼Œæ‰¾å‡ºä¸Hashè¡¨åŒ¹é…çš„è¡Œã€‚<ul><li>è¿™ç§æ–¹å¼é€‚ç”¨äºè¾ƒå°çš„è¡¨å®Œå…¨å¯ä»¥æ”¾å…¥å†…å­˜ä¸­çš„æƒ…å†µï¼Œè¿™æ ·æ€»æˆæœ¬å°±æ˜¯è®¿é—®ä¸¤ä¸ªè¡¨çš„æˆæœ¬ä¹‹å’Œã€‚</li><li>åœ¨è¡¨å¾ˆå¤§çš„æƒ…å†µä¸‹å¹¶ä¸èƒ½å®Œå…¨æ”¾å…¥å†…å­˜ï¼Œè¿™æ—¶ä¼˜åŒ–å™¨ä¼šå°†å®ƒåˆ†å‰²æˆ<code>è‹¥å¹²ä¸åŒçš„åˆ†åŒº</code>ï¼Œä¸èƒ½æ”¾å…¥å†…å­˜çš„éƒ¨åˆ†å°±æŠŠè¯¥åˆ†åŒºå†™å…¥ç£ç›˜çš„ä¸´æ—¶æ®µï¼Œæ­¤æ—¶è¦æ±‚æœ‰è¾ƒå¤§çš„ä¸´æ—¶æ®µä»è€Œå°½é‡æé«˜I&#x2F;Oçš„æ€§èƒ½ã€‚</li><li>å®ƒèƒ½å¤Ÿå¾ˆå¥½çš„å·¥ä½œäºæ²¡æœ‰ç´¢å¼•çš„å¤§è¡¨å’Œå¹¶è¡ŒæŸ¥è¯¢çš„ç¯å¢ƒä¸­ï¼Œå¹¶æä¾›æœ€å¥½çš„æ€§èƒ½ã€‚Hash Joinåªèƒ½åº”ç”¨äºç­‰å€¼è¿æ¥ï¼Œè¿™æ˜¯ç”±Hashçš„ç‰¹ç‚¹å†³å®šçš„ã€‚</li></ul></li></ul><h4 id="3-å­æŸ¥è¯¢ä¼˜åŒ–"><a href="#3-å­æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="3. å­æŸ¥è¯¢ä¼˜åŒ–"></a><strong>3.</strong> <strong>å­æŸ¥è¯¢ä¼˜åŒ–</strong></h4><p><strong>å­æŸ¥è¯¢æ˜¯</strong> <strong>MySQL</strong> <strong>çš„ä¸€é¡¹é‡è¦çš„åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª</strong> <strong>SQL</strong> <strong>è¯­å¥å®ç°æ¯”è¾ƒå¤æ‚çš„æŸ¥è¯¢ã€‚ä½†æ˜¯ï¼Œå­æŸ¥è¯¢çš„æ‰§è¡Œæ•ˆç‡ä¸é«˜ã€‚</strong>åŸå› ï¼š</p><p>â‘  æ‰§è¡Œå­æŸ¥è¯¢æ—¶ï¼ŒMySQLéœ€è¦ä¸ºå†…å±‚æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢ç»“æœ<code>å»ºç«‹ä¸€ä¸ªä¸´æ—¶è¡¨</code>ï¼Œç„¶åå¤–å±‚æŸ¥è¯¢è¯­å¥ä»ä¸´æ—¶è¡¨ä¸­æŸ¥è¯¢è®°å½•ã€‚æŸ¥è¯¢å®Œæ¯•åï¼Œå†<code>æ’¤é”€è¿™äº›ä¸´æ—¶è¡¨</code>ã€‚è¿™æ ·ä¼šæ¶ˆè€—è¿‡å¤šçš„CPUå’ŒIOèµ„æºï¼Œäº§ç”Ÿå¤§é‡çš„æ…¢æŸ¥è¯¢ã€‚</p><p>â‘¡ å­æŸ¥è¯¢çš„ç»“æœé›†å­˜å‚¨çš„ä¸´æ—¶è¡¨ï¼Œä¸è®ºæ˜¯å†…å­˜ä¸´æ—¶è¡¨è¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨éƒ½<code>ä¸ä¼šå­˜åœ¨ç´¢å¼•</code>ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ä¼šå—åˆ°ä¸€å®šçš„å½±å“ã€‚</p><p>â‘¢ å¯¹äºè¿”å›ç»“æœé›†æ¯”è¾ƒå¤§çš„å­æŸ¥è¯¢ï¼Œå…¶å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ä¹Ÿå°±è¶Šå¤§ã€‚</p><p><strong>åœ¨MySQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨è¿æ¥ï¼ˆJOINï¼‰æŸ¥è¯¢æ¥æ›¿ä»£å­æŸ¥è¯¢ã€‚</strong>è¿æ¥æŸ¥è¯¢<code>ä¸éœ€è¦å»ºç«‹ä¸´æ—¶è¡¨</code>ï¼Œå…¶<code>é€Ÿåº¦æ¯”å­æŸ¥è¯¢è¦å¿«</code>ï¼Œå¦‚æœæŸ¥è¯¢ä¸­ä½¿ç”¨ç´¢å¼•çš„è¯ï¼Œæ€§èƒ½å°±ä¼šæ›´å¥½ã€‚</p><blockquote><p>ç»“è®ºï¼šå°½é‡ä¸è¦ä½¿ç”¨NOT IN æˆ–è€… NOT EXISTSï¼Œç”¨LEFT JOIN xxx ON xx WHERE xx IS NULLæ›¿ä»£</p></blockquote><h4 id="4-æ’åºä¼˜åŒ–"><a href="#4-æ’åºä¼˜åŒ–" class="headerlink" title="4. æ’åºä¼˜åŒ–"></a><strong>4.</strong> <strong>æ’åºä¼˜åŒ–</strong></h4><ol><li><p>SQL ä¸­ï¼Œå¯ä»¥åœ¨ WHERE å­å¥å’Œ ORDER BY å­å¥ä¸­ä½¿ç”¨ç´¢å¼•ï¼Œç›®çš„æ˜¯åœ¨ WHERE å­å¥ä¸­ <code>é¿å…å…¨è¡¨æ‰«æ</code>ï¼Œåœ¨ ORDER BY å­å¥<code>é¿å…ä½¿ç”¨ FileSort æ’åº</code>ã€‚å½“ç„¶ï¼ŒæŸäº›æƒ…å†µä¸‹å…¨è¡¨æ‰«æï¼Œæˆ–è€… FileSort æ’åºä¸ä¸€å®šæ¯”ç´¢å¼•æ…¢ã€‚ä½†æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦é¿å…ï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p></li><li><p>å°½é‡ä½¿ç”¨ Index å®Œæˆ ORDER BY æ’åºã€‚å¦‚æœ WHERE å’Œ ORDER BY åé¢æ˜¯ç›¸åŒçš„åˆ—å°±ä½¿ç”¨å•ç´¢å¼•åˆ—ï¼›å¦‚æœä¸åŒå°±ä½¿ç”¨è”åˆç´¢å¼•ã€‚</p></li><li><p>æ— æ³•ä½¿ç”¨ Index æ—¶ï¼Œéœ€è¦å¯¹ FileSort æ–¹å¼è¿›è¡Œè°ƒä¼˜ã€‚</p></li></ol><h4 id="5-GROUP-BYä¼˜åŒ–"><a href="#5-GROUP-BYä¼˜åŒ–" class="headerlink" title="5. GROUP BYä¼˜åŒ–"></a><strong>5. GROUP BYä¼˜åŒ–</strong></h4><ul><li>group by ä½¿ç”¨ç´¢å¼•çš„åŸåˆ™å‡ ä¹è·Ÿorder byä¸€è‡´ ï¼Œgroup by å³ä½¿æ²¡æœ‰è¿‡æ»¤æ¡ä»¶ç”¨åˆ°ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ç´¢å¼•ã€‚</li><li>group by å…ˆæ’åºå†åˆ†ç»„ï¼Œéµç…§ç´¢å¼•å»ºçš„æœ€ä½³å·¦å‰ç¼€æ³•åˆ™</li><li>å½“æ— æ³•ä½¿ç”¨ç´¢å¼•åˆ—ï¼Œå¯ä»¥å¢å¤§<code>max_length_for_sort_data</code>å’Œ<code>sort_buffer_size</code>å‚æ•°çš„è®¾ç½®</li><li>whereæ•ˆç‡é«˜äºhavingï¼Œèƒ½å†™åœ¨whereé™å®šçš„æ¡ä»¶å°±ä¸è¦å†™åœ¨havingä¸­äº†</li><li>å‡å°‘ä½¿ç”¨order byï¼Œå’Œä¸šåŠ¡æ²Ÿé€šèƒ½ä¸æ’åºå°±ä¸æ’åºï¼Œæˆ–å°†æ’åºæ”¾åˆ°ç¨‹åºç«¯å»åšã€‚Order byã€group byã€distinctè¿™äº›è¯­å¥è¾ƒä¸ºè€—è´¹CPUï¼Œæ•°æ®åº“çš„CPUèµ„æºæ˜¯æå…¶å®è´µçš„ã€‚</li><li>åŒ…å«äº†order byã€group byã€distinctè¿™äº›æŸ¥è¯¢çš„è¯­å¥ï¼Œwhereæ¡ä»¶è¿‡æ»¤å‡ºæ¥çš„ç»“æœé›†è¯·ä¿æŒåœ¨1000è¡Œä»¥å†…ï¼Œå¦åˆ™SQLä¼šå¾ˆæ…¢ã€‚</li></ul><h4 id="6-ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢"><a href="#6-ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="6. ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢"></a><strong>6.</strong> <strong>ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢</strong></h4><p><strong>ä¼˜åŒ–æ€è·¯ä¸€</strong></p><p>åœ¨ç´¢å¼•ä¸Šå®Œæˆæ’åºåˆ†é¡µæ“ä½œï¼Œæœ€åæ ¹æ®ä¸»é”®å…³è”å›åŸè¡¨æŸ¥è¯¢æ‰€éœ€è¦çš„å…¶ä»–åˆ—å†…å®¹ã€‚</p><pre><code class="mysql">EXPLAIN SELECT * FROM student t,(SELECT id FROM student ORDER BY id LIMIT 2000000,10) aWHERE t.id = a.id;</code></pre><p><strong>ä¼˜åŒ–æ€è·¯äºŒ</strong></p><p>è¯¥æ–¹æ¡ˆé€‚ç”¨äºä¸»é”®è‡ªå¢çš„è¡¨ï¼Œå¯ä»¥æŠŠLimit æŸ¥è¯¢è½¬æ¢æˆæŸä¸ªä½ç½®çš„æŸ¥è¯¢ã€‚</p><pre><code class="mysql">EXPLAIN SELECT * FROM student WHERE id &gt; 2000000 LIMIT 10;</code></pre><h4 id="7-ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼•"><a href="#7-ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼•" class="headerlink" title="7. ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼•"></a><strong>7.</strong> <strong>ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼•</strong></h4><h5 id="7-1-ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ"><a href="#7-1-ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ" class="headerlink" title="7.1 ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ"></a><strong>7.1</strong> <strong>ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ</strong></h5><p><strong>ç†è§£æ–¹å¼ä¸€</strong>ï¼šç´¢å¼•æ˜¯é«˜æ•ˆæ‰¾åˆ°è¡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ä¸€èˆ¬æ•°æ®åº“ä¹Ÿèƒ½ä½¿ç”¨ç´¢å¼•æ‰¾åˆ°ä¸€ä¸ªåˆ—çš„æ•°æ®ï¼Œå› æ­¤å®ƒä¸å¿…è¯»å–æ•´ä¸ªè¡Œã€‚æ¯•ç«Ÿç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†å®ƒä»¬ç´¢å¼•çš„æ•°æ®ï¼›å½“èƒ½é€šè¿‡è¯»å–ç´¢å¼•å°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„æ•°æ®ï¼Œé‚£å°±ä¸éœ€è¦è¯»å–è¡Œäº†ã€‚<strong>ä¸€ä¸ªç´¢å¼•åŒ…å«äº†æ»¡è¶³æŸ¥è¯¢ç»“æœçš„æ•°æ®å°±å«åšè¦†ç›–ç´¢å¼•ã€‚</strong></p><p><strong>ç†è§£æ–¹å¼äºŒ</strong>ï¼šéèšç°‡å¤åˆç´¢å¼•çš„ä¸€ç§å½¢å¼ï¼Œå®ƒåŒ…æ‹¬åœ¨æŸ¥è¯¢é‡Œçš„SELECTã€JOINå’ŒWHEREå­å¥ç”¨åˆ°çš„æ‰€æœ‰åˆ—ï¼ˆå³å»ºç´¢å¼•çš„å­—æ®µæ­£å¥½æ˜¯è¦†ç›–æŸ¥è¯¢æ¡ä»¶ä¸­æ‰€æ¶‰åŠçš„å­—æ®µï¼‰ã€‚</p><p>ç®€å•è¯´å°±æ˜¯ï¼Œ<code>ç´¢å¼•åˆ—+ä¸»é”®</code>åŒ…å«<code>SELECT åˆ° FROMä¹‹é—´æŸ¥è¯¢çš„åˆ—</code>ã€‚</p><h5 id="7-2-è¦†ç›–ç´¢å¼•çš„åˆ©å¼Š"><a href="#7-2-è¦†ç›–ç´¢å¼•çš„åˆ©å¼Š" class="headerlink" title="7.2 è¦†ç›–ç´¢å¼•çš„åˆ©å¼Š"></a><strong>7.2</strong> <strong>è¦†ç›–ç´¢å¼•çš„åˆ©å¼Š</strong></h5><p><strong>å¥½å¤„ï¼š</strong></p><p><strong>1.</strong> <strong>é¿å…Innodbè¡¨è¿›è¡Œç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢ï¼ˆå›è¡¨ï¼‰</strong></p><p><strong>2.</strong> <strong>å¯ä»¥æŠŠéšæœºIOå˜æˆé¡ºåºIOåŠ å¿«æŸ¥è¯¢æ•ˆç‡</strong></p><p><strong>å¼Šç«¯ï¼š</strong></p><p><code>ç´¢å¼•å­—æ®µçš„ç»´æŠ¤</code>æ€»æ˜¯æœ‰ä»£ä»·çš„ã€‚å› æ­¤ï¼Œåœ¨å»ºç«‹å†—ä½™ç´¢å¼•æ¥æ”¯æŒè¦†ç›–ç´¢å¼•æ—¶å°±éœ€è¦æƒè¡¡è€ƒè™‘äº†ã€‚è¿™æ˜¯ä¸šåŠ¡DBAï¼Œæˆ–è€…ç§°ä¸ºä¸šåŠ¡æ•°æ®æ¶æ„å¸ˆçš„å·¥ä½œã€‚</p><h4 id="8-ç´¢å¼•æ¡ä»¶ä¸‹æ¨"><a href="#8-ç´¢å¼•æ¡ä»¶ä¸‹æ¨" class="headerlink" title="8. ç´¢å¼•æ¡ä»¶ä¸‹æ¨"></a><strong>8.</strong> <strong>ç´¢å¼•æ¡ä»¶ä¸‹æ¨</strong></h4><h5 id="8-1-ä½¿ç”¨å‰åçš„æ‰«æè¿‡ç¨‹"><a href="#8-1-ä½¿ç”¨å‰åçš„æ‰«æè¿‡ç¨‹" class="headerlink" title="8.1 ä½¿ç”¨å‰åçš„æ‰«æè¿‡ç¨‹"></a><strong>8.1</strong> <strong>ä½¿ç”¨å‰åçš„æ‰«æè¿‡ç¨‹</strong></h5><p><strong>åœ¨ä¸ä½¿ç”¨ICPç´¢å¼•æ‰«æçš„è¿‡ç¨‹ï¼š</strong></p><p>storageå±‚ï¼šåªå°†æ»¡è¶³index keyæ¡ä»¶çš„ç´¢å¼•è®°å½•å¯¹åº”çš„æ•´è¡Œè®°å½•å–å‡ºï¼Œè¿”å›ç»™serverå±‚ </p><p>server å±‚ï¼šå¯¹è¿”å›çš„æ•°æ®ï¼Œä½¿ç”¨åé¢çš„whereæ¡ä»¶è¿‡æ»¤ï¼Œç›´è‡³è¿”å›æœ€åä¸€è¡Œã€‚</p><p><strong>ä½¿ç”¨ICPæ‰«æçš„è¿‡ç¨‹ï¼š</strong></p><p>storageå±‚ï¼šé¦–å…ˆå°†index keyæ¡ä»¶æ»¡è¶³çš„ç´¢å¼•è®°å½•åŒºé—´ç¡®å®šï¼Œç„¶ååœ¨ç´¢å¼•ä¸Šä½¿ç”¨index filterè¿›è¡Œè¿‡æ»¤ã€‚å°†æ»¡è¶³çš„index filteræ¡ä»¶çš„ç´¢å¼•è®°å½•æ‰å»å›è¡¨å–å‡ºæ•´è¡Œè®°å½•è¿”å›serverå±‚ã€‚ä¸æ»¡è¶³index filteræ¡ä»¶çš„ç´¢å¼•è®°å½•ä¸¢å¼ƒï¼Œä¸å›è¡¨ã€ä¹Ÿä¸ä¼šè¿”å›serverå±‚ã€‚</p><p>server å±‚ï¼šå¯¹è¿”å›çš„æ•°æ®ï¼Œä½¿ç”¨table filteræ¡ä»¶åšæœ€åçš„è¿‡æ»¤ã€‚</p><h4 id="9-å…¶å®ƒæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥"><a href="#9-å…¶å®ƒæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="9. å…¶å®ƒæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥"></a><strong>9.</strong> <strong>å…¶å®ƒæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥</strong></h4><h5 id="9-1-EXISTS-å’Œ-IN-çš„åŒºåˆ†"><a href="#9-1-EXISTS-å’Œ-IN-çš„åŒºåˆ†" class="headerlink" title="9.1 EXISTS å’Œ IN çš„åŒºåˆ†"></a><strong>9.1 EXISTS</strong> <strong>å’Œ</strong> <strong>IN</strong> <strong>çš„åŒºåˆ†</strong></h5><p>ç´¢å¼•æ˜¯ä¸ªå‰æï¼Œå…¶å®é€‰æ‹©ä¸å¦è¿˜ä¼šè¦çœ‹è¡¨çš„å¤§å°ã€‚ä½ å¯ä»¥å°†é€‰æ‹©çš„æ ‡å‡†ç†è§£ä¸º<code>å°è¡¨é©±åŠ¨å¤§è¡¨</code>ã€‚</p><h5 id="9-2-COUNT-ä¸COUNT-å…·ä½“å­—æ®µ-æ•ˆç‡"><a href="#9-2-COUNT-ä¸COUNT-å…·ä½“å­—æ®µ-æ•ˆç‡" class="headerlink" title="9.2 COUNT(*)ä¸COUNT(å…·ä½“å­—æ®µ)æ•ˆç‡"></a><strong>9.2 COUNT(*)ä¸COUNT(å…·ä½“å­—æ®µ)æ•ˆç‡</strong></h5><p><strong>ç¯èŠ‚1ï¼š</strong><code>COUNT(*)</code>å’Œ<code>COUNT(1)</code>éƒ½æ˜¯å¯¹æ‰€æœ‰ç»“æœè¿›è¡Œ<code>COUNT</code>ï¼Œ<code>COUNT(*)</code>å’Œ<code>COUNT(1)</code>æœ¬è´¨ä¸Šå¹¶æ²¡æœ‰åŒºåˆ«ï¼ˆäºŒè€…æ‰§è¡Œæ—¶é—´å¯èƒ½ç•¥æœ‰å·®åˆ«ï¼Œä¸è¿‡ä½ è¿˜æ˜¯å¯ä»¥æŠŠå®ƒä¿©çš„æ‰§è¡Œæ•ˆç‡çœ‹æˆæ˜¯ç›¸ç­‰çš„ï¼‰ã€‚å¦‚æœæœ‰WHEREå­å¥ï¼Œåˆ™æ˜¯å¯¹æ‰€æœ‰ç¬¦åˆç­›é€‰æ¡ä»¶çš„æ•°æ®è¡Œè¿›è¡Œç»Ÿè®¡ï¼›å¦‚æœæ²¡æœ‰WHEREå­å¥ï¼Œåˆ™æ˜¯å¯¹æ•°æ®è¡¨çš„æ•°æ®è¡Œæ•°è¿›è¡Œç»Ÿè®¡ã€‚</p><p><strong>ç¯èŠ‚2ï¼š</strong>å¦‚æœæ˜¯MyISAMå­˜å‚¨å¼•æ“ï¼Œç»Ÿè®¡æ•°æ®è¡¨çš„è¡Œæ•°åªéœ€è¦<code>O(1)</code>çš„å¤æ‚åº¦ï¼Œè¿™æ˜¯å› ä¸ºæ¯å¼ MyISAMçš„æ•°æ®è¡¨éƒ½æœ‰ä¸€ä¸ªmetaä¿¡æ¯å­˜å‚¨äº†<code>row_count</code>å€¼ï¼Œè€Œä¸€è‡´æ€§åˆ™æ˜¯ç”±è¡¨çº§é”æ¥ä¿è¯çš„ã€‚</p><p>å¦‚æœæ˜¯InnoDBå­˜å‚¨å¼•æ“ï¼Œå› ä¸ºInnoDBæ”¯æŒäº‹åŠ¡ï¼Œé‡‡ç”¨è¡Œçº§é”å’ŒMVCCæœºåˆ¶ï¼Œæ‰€ä»¥æ— æ³•åƒMyISAMä¸€æ ·ï¼Œç»´æŠ¤ä¸€ä¸ªrow_countå˜é‡ï¼Œå› æ­¤éœ€è¦é‡‡ç”¨<code>æ‰«æå…¨è¡¨</code>ï¼Œæ˜¯<code>O(n)</code>çš„å¤æ‚åº¦ï¼Œè¿›è¡Œå¾ªç¯+è®¡æ•°çš„æ–¹å¼æ¥å®Œæˆç»Ÿè®¡ã€‚</p><p><strong>ç¯èŠ‚3ï¼š</strong>åœ¨InnoDBå¼•æ“ä¸­ï¼Œå¦‚æœé‡‡ç”¨<code>COUNT(å…·ä½“å­—æ®µ)</code>æ¥ç»Ÿè®¡æ•°æ®è¡Œæ•°ï¼Œè¦å°½é‡é‡‡ç”¨äºŒçº§ç´¢å¼•ã€‚å› ä¸ºä¸»é”®é‡‡ç”¨çš„ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼Œèšç°‡ç´¢å¼•åŒ…å«çš„ä¿¡æ¯å¤šï¼Œæ˜æ˜¾ä¼šå¤§äºäºŒçº§ç´¢å¼•ï¼ˆéèšç°‡ç´¢å¼•ï¼‰ã€‚å¯¹äº<code>COUNT(*)</code>å’Œ<code>COUNT(1)</code>æ¥è¯´ï¼Œå®ƒä»¬ä¸éœ€è¦æŸ¥æ‰¾å…·ä½“çš„è¡Œï¼Œåªæ˜¯ç»Ÿè®¡è¡Œæ•°ï¼Œç³»ç»Ÿä¼š<code>è‡ªåŠ¨</code>é‡‡ç”¨å ç”¨ç©ºé—´æ›´å°çš„äºŒçº§ç´¢å¼•æ¥è¿›è¡Œç»Ÿè®¡ã€‚</p><p>å¦‚æœæœ‰å¤šä¸ªäºŒçº§ç´¢å¼•ï¼Œä¼šä½¿ç”¨key_lenå°çš„äºŒçº§ç´¢å¼•è¿›è¡Œæ‰«æã€‚å½“æ²¡æœ‰äºŒçº§ç´¢å¼•çš„æ—¶å€™ï¼Œæ‰ä¼šé‡‡ç”¨ä¸»é”®ç´¢å¼•æ¥è¿›è¡Œç»Ÿè®¡ã€‚</p><h5 id="9-3-å…³äºSELECT"><a href="#9-3-å…³äºSELECT" class="headerlink" title="9.3 å…³äºSELECT(*)"></a><strong>9.3</strong> <strong>å…³äºSELECT(*)</strong></h5><p>åœ¨è¡¨æŸ¥è¯¢ä¸­ï¼Œå»ºè®®æ˜ç¡®å­—æ®µï¼Œä¸è¦ä½¿ç”¨ * ä½œä¸ºæŸ¥è¯¢çš„å­—æ®µåˆ—è¡¨ï¼Œæ¨èä½¿ç”¨SELECT &lt;å­—æ®µåˆ—è¡¨&gt; æŸ¥è¯¢ã€‚åŸå› ï¼š</p><p>â‘  MySQL åœ¨è§£æçš„è¿‡ç¨‹ä¸­ï¼Œä¼šé€šè¿‡<code>æŸ¥è¯¢æ•°æ®å­—å…¸</code>å°†â€*â€æŒ‰åºè½¬æ¢æˆæ‰€æœ‰åˆ—åï¼Œè¿™ä¼šå¤§å¤§çš„è€—è´¹èµ„æºå’Œæ—¶é—´ã€‚</p><p>â‘¡ æ— æ³•ä½¿ç”¨<code>è¦†ç›–ç´¢å¼•</code></p><h5 id="9-4-LIMIT-1-å¯¹ä¼˜åŒ–çš„å½±å“"><a href="#9-4-LIMIT-1-å¯¹ä¼˜åŒ–çš„å½±å“" class="headerlink" title="9.4 LIMIT 1 å¯¹ä¼˜åŒ–çš„å½±å“"></a><strong>9.4 LIMIT 1</strong> <strong>å¯¹ä¼˜åŒ–çš„å½±å“</strong></h5><p>é’ˆå¯¹çš„æ˜¯ä¼šæ‰«æå…¨è¡¨çš„ SQL è¯­å¥ï¼Œå¦‚æœä½ å¯ä»¥ç¡®å®šç»“æœé›†åªæœ‰ä¸€æ¡ï¼Œé‚£ä¹ˆåŠ ä¸Š<code>LIMIT 1</code>çš„æ—¶å€™ï¼Œå½“æ‰¾åˆ°ä¸€æ¡ç»“æœçš„æ—¶å€™å°±ä¸ä¼šç»§ç»­æ‰«æäº†ï¼Œè¿™æ ·ä¼šåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚</p><p>å¦‚æœæ•°æ®è¡¨å·²ç»å¯¹å­—æ®µå»ºç«‹äº†å”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ï¼Œä¸ä¼šå…¨è¡¨æ‰«æçš„è¯ï¼Œå°±ä¸éœ€è¦åŠ ä¸Š<code>LIMIT 1</code>äº†ã€‚</p><h5 id="9-5-å¤šä½¿ç”¨COMMIT"><a href="#9-5-å¤šä½¿ç”¨COMMIT" class="headerlink" title="9.5 å¤šä½¿ç”¨COMMIT"></a><strong>9.5</strong> <strong>å¤šä½¿ç”¨COMMIT</strong></h5><p>åªè¦æœ‰å¯èƒ½ï¼Œåœ¨ç¨‹åºä¸­å°½é‡å¤šä½¿ç”¨ COMMITï¼Œè¿™æ ·ç¨‹åºçš„æ€§èƒ½å¾—åˆ°æé«˜ï¼Œéœ€æ±‚ä¹Ÿä¼šå› ä¸º COMMIT æ‰€é‡Šæ”¾çš„èµ„æºè€Œå‡å°‘ã€‚</p><p>COMMIT æ‰€é‡Šæ”¾çš„èµ„æºï¼š</p><ul><li><p>å›æ»šæ®µä¸Šç”¨äºæ¢å¤æ•°æ®çš„ä¿¡æ¯</p></li><li><p>è¢«ç¨‹åºè¯­å¥è·å¾—çš„é”</p></li><li><p>redo &#x2F; undo log buffer ä¸­çš„ç©ºé—´</p></li><li><p>ç®¡ç†ä¸Šè¿° 3 ç§èµ„æºä¸­çš„å†…éƒ¨èŠ±è´¹</p></li></ul><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬12ç«  æ•°æ®åº“å…¶å®ƒè°ƒä¼˜ç­–ç•¥</title>
      <link href="/2023/07/15/%E7%AC%AC12%E7%AB%A0%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%B6%E5%AE%83%E8%B0%83%E4%BC%98%E7%AD%96%E7%95%A5/"/>
      <url>/2023/07/15/%E7%AC%AC12%E7%AB%A0%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%B6%E5%AE%83%E8%B0%83%E4%BC%98%E7%AD%96%E7%95%A5/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬12ç« -æ•°æ®åº“å…¶å®ƒè°ƒä¼˜ç­–ç•¥"><a href="#ç¬¬12ç« -æ•°æ®åº“å…¶å®ƒè°ƒä¼˜ç­–ç•¥" class="headerlink" title="ç¬¬12ç«  æ•°æ®åº“å…¶å®ƒè°ƒä¼˜ç­–ç•¥"></a>ç¬¬12ç«  æ•°æ®åº“å…¶å®ƒè°ƒä¼˜ç­–ç•¥</h3><h4 id="1-æ•°æ®åº“è°ƒä¼˜çš„æªæ–½"><a href="#1-æ•°æ®åº“è°ƒä¼˜çš„æªæ–½" class="headerlink" title="1. æ•°æ®åº“è°ƒä¼˜çš„æªæ–½"></a><strong>1.</strong> <strong>æ•°æ®åº“è°ƒä¼˜çš„æªæ–½</strong></h4><h5 id="1-1-è°ƒä¼˜çš„ç›®æ ‡"><a href="#1-1-è°ƒä¼˜çš„ç›®æ ‡" class="headerlink" title="1.1 è°ƒä¼˜çš„ç›®æ ‡"></a><strong>1.1</strong> <strong>è°ƒä¼˜çš„ç›®æ ‡</strong></h5><ul><li>å°½å¯èƒ½<code>èŠ‚çœç³»ç»Ÿèµ„æº</code>ï¼Œä»¥ä¾¿ç³»ç»Ÿå¯ä»¥æä¾›æ›´å¤§è´Ÿè·çš„æœåŠ¡ã€‚ï¼ˆååé‡æ›´å¤§ï¼‰</li><li>åˆç†çš„ç»“æ„è®¾è®¡å’Œå‚æ•°è°ƒæ•´ï¼Œä»¥æé«˜ç”¨æˆ·æ“<code> å“åº”çš„é€Ÿåº¦</code>ã€‚ï¼ˆå“åº”é€Ÿåº¦æ›´å¿«ï¼‰</li><li>å‡å°‘ç³»ç»Ÿçš„ç“¶é¢ˆï¼Œæé«˜MySQLæ•°æ®åº“æ•´ä½“çš„æ€§èƒ½ã€‚</li></ul><h5 id="1-2-å¦‚ä½•å®šä½è°ƒä¼˜é—®é¢˜"><a href="#1-2-å¦‚ä½•å®šä½è°ƒä¼˜é—®é¢˜" class="headerlink" title="1.2 å¦‚ä½•å®šä½è°ƒä¼˜é—®é¢˜"></a><strong>1.2</strong> <strong>å¦‚ä½•å®šä½è°ƒä¼˜é—®é¢˜</strong></h5><ul><li><strong>ç”¨æˆ·çš„åé¦ˆï¼ˆä¸»è¦ï¼‰</strong></li><li><strong>æ—¥å¿—åˆ†æï¼ˆä¸»è¦ï¼‰</strong></li><li><strong>æœåŠ¡å™¨èµ„æºä½¿ç”¨ç›‘æ§</strong></li><li><strong>æ•°æ®åº“å†…éƒ¨çŠ¶å†µç›‘æ§</strong></li><li><strong>å…¶å®ƒ</strong></li></ul><h5 id="1-3-è°ƒä¼˜çš„ç»´åº¦å’Œæ­¥éª¤"><a href="#1-3-è°ƒä¼˜çš„ç»´åº¦å’Œæ­¥éª¤" class="headerlink" title="1.3 è°ƒä¼˜çš„ç»´åº¦å’Œæ­¥éª¤"></a><strong>1.3</strong> <strong>è°ƒä¼˜çš„ç»´åº¦å’Œæ­¥éª¤</strong></h5><p><strong>ç¬¬1æ­¥ï¼šé€‰æ‹©é€‚åˆçš„</strong> <strong>DBMS</strong> </p><p><strong>ç¬¬2æ­¥ï¼šä¼˜åŒ–è¡¨è®¾è®¡</strong> </p><p><strong>ç¬¬3æ­¥ï¼šä¼˜åŒ–é€»è¾‘æŸ¥è¯¢</strong></p><p><strong>ç¬¬4æ­¥ï¼šä¼˜åŒ–ç‰©ç†æŸ¥è¯¢</strong></p><p>ç‰©ç†æŸ¥è¯¢ä¼˜åŒ–æ˜¯åœ¨ç¡®å®šäº†é€»è¾‘æŸ¥è¯¢ä¼˜åŒ–ä¹‹åï¼Œé‡‡ç”¨ç‰©ç†ä¼˜åŒ–æŠ€æœ¯ï¼ˆæ¯”å¦‚ç´¢å¼•ç­‰ï¼‰ï¼Œé€šè¿‡è®¡ç®—ä»£ä»·æ¨¡å‹å¯¹å„ç§å¯èƒ½çš„è®¿é—®è·¯å¾„è¿›è¡Œä¼°ç®—ï¼Œä»è€Œæ‰¾åˆ°æ‰§è¡Œæ–¹å¼ä¸­ä»£ä»·æœ€å°çš„ä½œä¸ºæ‰§è¡Œè®¡åˆ’ã€‚</p><p><strong>ç¬¬5æ­¥ï¼šä½¿ç”¨</strong> <strong>Redis</strong> <strong>æˆ–</strong> <strong>Memcached</strong> <strong>ä½œä¸ºç¼“å­˜</strong></p><p><strong>ç¬¬6æ­¥ï¼šåº“çº§ä¼˜åŒ–</strong> </p><p><strong>1ã€è¯»å†™åˆ†ç¦»</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204031025279.png" alt="image-20220403102536170"></p><p><strong>2ã€æ•°æ®åˆ†ç‰‡</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204031026743.png" alt="image-20220403102618627"></p><h4 id="2-ä¼˜åŒ–MySQLæœåŠ¡å™¨"><a href="#2-ä¼˜åŒ–MySQLæœåŠ¡å™¨" class="headerlink" title="2. ä¼˜åŒ–MySQLæœåŠ¡å™¨"></a><strong>2.</strong> <strong>ä¼˜åŒ–MySQLæœåŠ¡å™¨</strong></h4><h5 id="2-1-ä¼˜åŒ–æœåŠ¡å™¨ç¡¬ä»¶"><a href="#2-1-ä¼˜åŒ–æœåŠ¡å™¨ç¡¬ä»¶" class="headerlink" title="2.1 ä¼˜åŒ–æœåŠ¡å™¨ç¡¬ä»¶"></a><strong>2.1</strong> <strong>ä¼˜åŒ–æœåŠ¡å™¨ç¡¬ä»¶</strong></h5><p><strong>æœåŠ¡å™¨çš„ç¡¬ä»¶æ€§èƒ½ç›´æ¥å†³å®šç€MySQLæ•°æ®åº“çš„æ€§èƒ½ã€‚</strong>ç¡¬ä»¶çš„æ€§èƒ½ç“¶é¢ˆç›´æ¥å†³å®šMySQLæ•°æ®åº“çš„è¿è¡Œé€Ÿåº¦å’Œæ•ˆç‡ã€‚é’ˆå¯¹æ€§èƒ½ç“¶é¢ˆæé«˜ç¡¬ä»¶é…ç½®ï¼Œå¯ä»¥æé«˜MySQLæ•°æ®åº“æŸ¥è¯¢ã€æ›´æ–°çš„é€Ÿåº¦ã€‚ </p><p>ï¼ˆ1ï¼‰<code>é…ç½®è¾ƒå¤§çš„å†…å­˜</code></p><p>ï¼ˆ2ï¼‰<code>é…ç½®é«˜é€Ÿç£ç›˜ç³»ç»Ÿ</code></p><p>ï¼ˆ3ï¼‰<code>åˆç†åˆ†å¸ƒç£ç›˜I/O</code></p><p>ï¼ˆ4ï¼‰<code>é…ç½®å¤šå¤„ç†å™¨</code></p><h5 id="2-2-ä¼˜åŒ–MySQLçš„å‚æ•°"><a href="#2-2-ä¼˜åŒ–MySQLçš„å‚æ•°" class="headerlink" title="2.2 ä¼˜åŒ–MySQLçš„å‚æ•°"></a><strong>2.2</strong> <strong>ä¼˜åŒ–MySQLçš„å‚æ•°</strong></h5><ul><li><code>innodb_buffer_pool_size</code>ï¼šè¿™ä¸ªå‚æ•°æ˜¯Mysqlæ•°æ®åº“æœ€é‡è¦çš„å‚æ•°ä¹‹ä¸€ï¼Œè¡¨ç¤ºInnoDBç±»å‹çš„<code>è¡¨å’Œç´¢å¼•çš„æœ€å¤§ç¼“å­˜</code>ã€‚å®ƒä¸ä»…ä»…ç¼“å­˜<code>ç´¢å¼•æ•°æ®</code>ï¼Œè¿˜ä¼šç¼“å­˜<code>è¡¨çš„æ•°æ®</code>ã€‚è¿™ä¸ªå€¼è¶Šå¤§ï¼ŒæŸ¥è¯¢çš„é€Ÿåº¦å°±ä¼šè¶Šå¿«ã€‚ä½†æ˜¯è¿™ä¸ªå€¼å¤ªå¤§ä¼šå½±å“æ“ä½œç³»ç»Ÿçš„æ€§èƒ½ã€‚</li><li><code>key_buffer_size</code>ï¼šè¡¨ç¤º<code>ç´¢å¼•ç¼“å†²åŒºçš„å¤§å°</code>ã€‚ç´¢å¼•ç¼“å†²åŒºæ˜¯æ‰€æœ‰çš„<code>çº¿ç¨‹å…±äº«</code>ã€‚å¢åŠ ç´¢å¼•ç¼“å†²åŒºå¯ä»¥å¾—åˆ°æ›´å¥½å¤„ç†çš„ç´¢å¼•ï¼ˆå¯¹æ‰€æœ‰è¯»å’Œå¤šé‡å†™ï¼‰ã€‚å½“ç„¶ï¼Œè¿™ä¸ªå€¼ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œå®ƒçš„å¤§å°å–å†³äºå†…å­˜çš„å¤§å°ã€‚å¦‚æœè¿™ä¸ªå€¼å¤ªå¤§ï¼Œå°±ä¼šå¯¼è‡´æ“ä½œç³»ç»Ÿé¢‘ç¹æ¢é¡µï¼Œä¹Ÿä¼šé™ä½ç³»ç»Ÿæ€§èƒ½ã€‚å¯¹äºå†…å­˜åœ¨<code>4GB</code>å·¦å³çš„æœåŠ¡å™¨è¯¥å‚æ•°å¯è®¾ç½®ä¸º<code>256M</code>æˆ–<code>384M</code>ã€‚</li><li><code>table_cache</code>ï¼šè¡¨ç¤º<code>åŒæ—¶æ‰“å¼€çš„è¡¨çš„ä¸ªæ•°</code>ã€‚è¿™ä¸ªå€¼è¶Šå¤§ï¼Œèƒ½å¤ŸåŒæ—¶æ‰“å¼€çš„è¡¨çš„ä¸ªæ•°è¶Šå¤šã€‚ç‰©ç†å†…å­˜è¶Šå¤§ï¼Œè®¾ç½®å°±è¶Šå¤§ã€‚é»˜è®¤ä¸º2402ï¼Œè°ƒåˆ°512-1024æœ€ä½³ã€‚è¿™ä¸ªå€¼ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œå› ä¸ºåŒæ—¶æ‰“å¼€çš„è¡¨å¤ªå¤šä¼šå½±å“æ“ä½œç³»ç»Ÿçš„æ€§èƒ½ã€‚</li><li><code>query_cache_size</code>ï¼šè¡¨ç¤º<code>æŸ¥è¯¢ç¼“å†²åŒºçš„å¤§å°</code>ã€‚å¯ä»¥é€šè¿‡åœ¨MySQLæ§åˆ¶å°è§‚å¯Ÿï¼Œå¦‚æœQcache_lowmem_prunesçš„å€¼éå¸¸å¤§ï¼Œåˆ™è¡¨æ˜ç»å¸¸å‡ºç°ç¼“å†²ä¸å¤Ÿçš„æƒ…å†µï¼Œå°±è¦å¢åŠ Query_cache_sizeçš„å€¼ï¼›å¦‚æœQcache_hitsçš„å€¼éå¸¸å¤§ï¼Œåˆ™è¡¨æ˜æŸ¥è¯¢ç¼“å†²ä½¿ç”¨éå¸¸é¢‘ç¹ï¼Œå¦‚æœè¯¥å€¼è¾ƒå°åè€Œä¼šå½±å“æ•ˆç‡ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä¸ç”¨æŸ¥è¯¢ç¼“å­˜ï¼›Qcache_free_blocksï¼Œå¦‚æœè¯¥å€¼éå¸¸å¤§ï¼Œåˆ™è¡¨æ˜ç¼“å†²åŒºä¸­ç¢ç‰‡å¾ˆå¤šã€‚MySQL8.0ä¹‹åå¤±æ•ˆã€‚è¯¥å‚æ•°éœ€è¦å’Œquery_cache_typeé…åˆä½¿ç”¨ã€‚</li><li><code>query_cache_type</code>çš„å€¼æ˜¯0æ—¶ï¼Œæ‰€æœ‰çš„æŸ¥è¯¢éƒ½ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜åŒºã€‚ä½†æ˜¯query_cache_type&#x3D;0å¹¶ä¸ä¼šå¯¼è‡´MySQLé‡Šæ”¾query_cache_sizeæ‰€é…ç½®çš„ç¼“å­˜åŒºå†…å­˜ã€‚<ul><li>å½“query_cache_type&#x3D;1æ—¶ï¼Œæ‰€æœ‰çš„æŸ¥è¯¢éƒ½å°†ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜åŒºï¼Œé™¤éåœ¨æŸ¥è¯¢è¯­å¥ä¸­æŒ‡å®š<code>SQL_NO_CACHE</code>ï¼Œå¦‚SELECT SQL_NO_CACHE * FROM tbl_nameã€‚ </li><li>å½“query_cache_type&#x3D;2æ—¶ï¼Œåªæœ‰åœ¨æŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨<code>SQL_CACHE</code>å…³é”®å­—ï¼ŒæŸ¥è¯¢æ‰ä¼šä½¿ç”¨æŸ¥è¯¢ç¼“å­˜åŒºã€‚ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜åŒºå¯ä»¥æé«˜æŸ¥è¯¢çš„é€Ÿåº¦ï¼Œè¿™ç§æ–¹å¼åªé€‚ç”¨äºä¿®æ”¹æ“ä½œå°‘ä¸”ç»å¸¸æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢æ“ä½œçš„æƒ…å†µã€‚</li></ul></li><li><code>sort_buffer_size</code>ï¼šè¡¨ç¤ºæ¯ä¸ª<code>éœ€è¦è¿›è¡Œæ’åºçš„çº¿ç¨‹åˆ†é…çš„ç¼“å†²åŒºçš„å¤§å°</code>ã€‚å¢åŠ è¿™ä¸ªå‚æ•°çš„å€¼å¯ä»¥æé«˜<code>ORDER BY</code>æˆ–<code>GROUP BY</code>æ“ä½œçš„é€Ÿåº¦ã€‚é»˜è®¤æ•°å€¼æ˜¯2 097 144å­—èŠ‚ï¼ˆçº¦2MBï¼‰ã€‚å¯¹äºå†…å­˜åœ¨4GBå·¦å³çš„æœåŠ¡å™¨æ¨èè®¾ç½®ä¸º6-8Mï¼Œå¦‚æœæœ‰100ä¸ªè¿æ¥ï¼Œé‚£ä¹ˆå®é™…åˆ†é…çš„æ€»å…±æ’åºç¼“å†²åŒºå¤§å°ä¸º100 Ã— 6 ï¼ 600MBã€‚ </li><li><code>join_buffer_size = 8M</code>ï¼šè¡¨ç¤º<code>è”åˆæŸ¥è¯¢æ“ä½œæ‰€èƒ½ä½¿ç”¨çš„ç¼“å†²åŒºå¤§å°</code>ï¼Œå’Œsort_buffer_sizeä¸€æ ·ï¼Œè¯¥å‚æ•°å¯¹åº”çš„åˆ†é…å†…å­˜ä¹Ÿæ˜¯æ¯ä¸ªè¿æ¥ç‹¬äº«ã€‚</li><li><code>read_buffer_size</code>ï¼šè¡¨ç¤º<code>æ¯ä¸ªçº¿ç¨‹è¿ç»­æ‰«ææ—¶ä¸ºæ‰«æçš„æ¯ä¸ªè¡¨åˆ†é…çš„ç¼“å†²åŒºçš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰</code>ã€‚å½“çº¿ç¨‹ä»è¡¨ä¸­è¿ç»­è¯»å–è®°å½•æ—¶éœ€è¦ç”¨åˆ°è¿™ä¸ªç¼“å†²åŒºã€‚SET SESSION read_buffer_size&#x3D;nå¯ä»¥ä¸´æ—¶è®¾ç½®è¯¥å‚æ•°çš„å€¼ã€‚é»˜è®¤ä¸º64Kï¼Œå¯ä»¥è®¾ç½®ä¸º4Mã€‚ </li><li><code>innodb_flush_log_at_trx_commit</code>ï¼šè¡¨ç¤º<code>ä½•æ—¶å°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥æ—¥å¿—æ–‡ä»¶</code>ï¼Œå¹¶ä¸”å°†æ—¥å¿—æ–‡ä»¶å†™å…¥ç£ç›˜ä¸­ã€‚è¯¥å‚æ•°å¯¹äºinnoDBå¼•æ“éå¸¸é‡è¦ã€‚è¯¥å‚æ•°æœ‰3ä¸ªå€¼ï¼Œåˆ†åˆ«ä¸º0ã€1å’Œ2ã€‚è¯¥å‚æ•°çš„é»˜è®¤å€¼ä¸º1ã€‚<ul><li>å€¼ä¸º<code>0</code>æ—¶ï¼Œè¡¨ç¤º<code>æ¯ç§’1æ¬¡</code>çš„é¢‘ç‡å°†æ•°æ®å†™å…¥æ—¥å¿—æ–‡ä»¶å¹¶å°†æ—¥å¿—æ–‡ä»¶å†™å…¥ç£ç›˜ã€‚æ¯ä¸ªäº‹åŠ¡çš„commitå¹¶ä¸ä¼šè§¦å‘å‰é¢çš„ä»»ä½•æ“ä½œã€‚è¯¥æ¨¡å¼é€Ÿåº¦æœ€å¿«ï¼Œä½†ä¸å¤ªå®‰å…¨ï¼Œmysqldè¿›ç¨‹çš„å´©æºƒä¼šå¯¼è‡´ä¸Šä¸€ç§’é’Ÿæ‰€æœ‰äº‹åŠ¡æ•°æ®çš„ä¸¢å¤±ã€‚</li><li>å€¼ä¸º<code>1</code>æ—¶ï¼Œè¡¨ç¤º<code>æ¯æ¬¡æäº¤äº‹åŠ¡æ—¶</code>å°†æ•°æ®å†™å…¥æ—¥å¿—æ–‡ä»¶å¹¶å°†æ—¥å¿—æ–‡ä»¶å†™å…¥ç£ç›˜è¿›è¡ŒåŒæ­¥ã€‚è¯¥æ¨¡å¼æ˜¯æœ€å®‰å…¨çš„ï¼Œä½†ä¹Ÿæ˜¯æœ€æ…¢çš„ä¸€ç§æ–¹å¼ã€‚å› ä¸ºæ¯æ¬¡äº‹åŠ¡æäº¤æˆ–äº‹åŠ¡å¤–çš„æŒ‡ä»¤éƒ½éœ€è¦æŠŠæ—¥å¿—å†™å…¥ï¼ˆflushï¼‰ç¡¬ç›˜ã€‚</li><li>å€¼ä¸º<code>2</code>æ—¶ï¼Œè¡¨ç¤º<code>æ¯æ¬¡æäº¤äº‹åŠ¡æ—¶</code>å°†æ•°æ®å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œ<code>æ¯éš”1ç§’</code>å°†æ—¥å¿—æ–‡ä»¶å†™å…¥ç£ç›˜ã€‚è¯¥æ¨¡å¼é€Ÿåº¦è¾ƒå¿«ï¼Œä¹Ÿæ¯”0å®‰å…¨ï¼Œåªæœ‰åœ¨æ“ä½œç³»ç»Ÿå´©æºƒæˆ–è€…ç³»ç»Ÿæ–­ç”µçš„æƒ…å†µä¸‹ï¼Œä¸Šä¸€ç§’é’Ÿæ‰€æœ‰äº‹åŠ¡æ•°æ®æ‰å¯èƒ½ä¸¢å¤±ã€‚</li></ul></li><li><code>innodb_log_buffer_size</code>ï¼šè¿™æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„<code>äº‹åŠ¡æ—¥å¿—æ‰€ä½¿ç”¨çš„ç¼“å†²åŒº</code>ã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼Œä¹Ÿæ˜¯å…ˆå°†ä¿¡æ¯å†™å…¥ Innodb Log Buffer ä¸­ï¼Œå½“æ»¡è¶³ innodb_flush_log_trx_commit å‚æ•°æ‰€è®¾ç½®çš„ç›¸åº”æ¡ä»¶ï¼ˆæˆ–è€…æ—¥å¿—ç¼“å†²åŒºå†™æ»¡ï¼‰ä¹‹åï¼Œæ‰ä¼šå°†æ—¥å¿—å†™åˆ°æ–‡ä»¶ï¼ˆæˆ–è€…åŒæ­¥åˆ°ç£ç›˜ï¼‰ä¸­ã€‚</li><li><code>max_connections</code>ï¼šè¡¨ç¤º å…è®¸è¿æ¥åˆ°MySQLæ•°æ®åº“çš„æœ€å¤§æ•°é‡ ï¼Œé»˜è®¤å€¼æ˜¯ 151 ã€‚å¦‚æœçŠ¶æ€å˜é‡connection_errors_max_connections ä¸ä¸ºé›¶ï¼Œå¹¶ä¸”ä¸€ç›´å¢é•¿ï¼Œåˆ™è¯´æ˜ä¸æ–­æœ‰è¿æ¥è¯·æ±‚å› æ•°æ®åº“è¿æ¥æ•°å·²è¾¾åˆ°å…è®¸æœ€å¤§å€¼è€Œå¤±è´¥ï¼Œè¿™æ˜¯å¯ä»¥è€ƒè™‘å¢å¤§max_connections çš„å€¼ã€‚åœ¨Linux å¹³å°ä¸‹ï¼Œæ€§èƒ½å¥½çš„æœåŠ¡å™¨ï¼Œæ”¯æŒ 500-1000 ä¸ªè¿æ¥ä¸æ˜¯éš¾äº‹ï¼Œéœ€è¦æ ¹æ®æœåŠ¡å™¨æ€§èƒ½è¿›è¡Œè¯„ä¼°è®¾å®šã€‚è¿™ä¸ªè¿æ¥æ•° ä¸æ˜¯è¶Šå¤§ è¶Šå¥½ ï¼Œå› ä¸ºè¿™äº›è¿æ¥ä¼šæµªè´¹å†…å­˜çš„èµ„æºã€‚è¿‡å¤šçš„è¿æ¥å¯èƒ½ä¼šå¯¼è‡´MySQLæœåŠ¡å™¨åƒµæ­»ã€‚</li><li><code>back_log</code>ï¼šç”¨äº<code>æ§åˆ¶MySQLç›‘å¬TCPç«¯å£æ—¶è®¾ç½®çš„ç§¯å‹è¯·æ±‚æ ˆå¤§å°</code>ã€‚å¦‚æœMySqlçš„è¿æ¥æ•°è¾¾åˆ°max_connectionsæ—¶ï¼Œæ–°æ¥çš„è¯·æ±‚å°†ä¼šè¢«å­˜åœ¨å †æ ˆä¸­ï¼Œä»¥ç­‰å¾…æŸä¸€è¿æ¥é‡Šæ”¾èµ„æºï¼Œè¯¥å †æ ˆçš„æ•°é‡å³back_logï¼Œå¦‚æœç­‰å¾…è¿æ¥çš„æ•°é‡è¶…è¿‡back_logï¼Œå°†ä¸è¢«æˆäºˆè¿æ¥èµ„æºï¼Œå°†ä¼šæŠ¥é”™ã€‚5.6.6 ç‰ˆæœ¬ä¹‹å‰é»˜è®¤å€¼ä¸º 50 ï¼Œ ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤ä¸º 50 + ï¼ˆmax_connections &#x2F; 5ï¼‰ï¼Œ å¯¹äºLinuxç³»ç»Ÿæ¨èè®¾ç½®ä¸ºå°äº512çš„æ•´æ•°ï¼Œä½†æœ€å¤§ä¸è¶…è¿‡900ã€‚å¦‚æœéœ€è¦æ•°æ®åº“åœ¨è¾ƒçŸ­çš„æ—¶é—´å†…å¤„ç†å¤§é‡è¿æ¥è¯·æ±‚ï¼Œ å¯ä»¥è€ƒè™‘é€‚å½“å¢å¤§back_log çš„å€¼ã€‚</li><li><code>thread_cache_size</code>ï¼š<code>çº¿ç¨‹æ± ç¼“å­˜çº¿ç¨‹æ•°é‡çš„å¤§å°</code>ï¼Œå½“å®¢æˆ·ç«¯æ–­å¼€è¿æ¥åå°†å½“å‰çº¿ç¨‹ç¼“å­˜èµ·æ¥ï¼Œå½“åœ¨æ¥åˆ°æ–°çš„è¿æ¥è¯·æ±‚æ—¶å¿«é€Ÿå“åº”æ— éœ€åˆ›å»ºæ–°çš„çº¿ç¨‹ ã€‚è¿™å°¤å…¶å¯¹é‚£äº›ä½¿ç”¨çŸ­è¿æ¥çš„åº”ç”¨ç¨‹åºæ¥è¯´å¯ä»¥æå¤§çš„æé«˜åˆ›å»ºè¿æ¥çš„æ•ˆç‡ã€‚é‚£ä¹ˆä¸ºäº†æé«˜æ€§èƒ½å¯ä»¥å¢å¤§è¯¥å‚æ•°çš„å€¼ã€‚é»˜è®¤ä¸º60ï¼Œå¯ä»¥è®¾ç½®ä¸º120ã€‚</li><li><code>wait_timeout</code>ï¼šæŒ‡å®š<code>ä¸€ä¸ªè¯·æ±‚çš„æœ€å¤§è¿æ¥æ—¶é—´</code>ï¼Œå¯¹äº4GBå·¦å³å†…å­˜çš„æœåŠ¡å™¨å¯ä»¥è®¾ç½®ä¸º5-10ã€‚ </li><li><code>interactive_timeout</code>ï¼šè¡¨ç¤ºæœåŠ¡å™¨åœ¨å…³é—­è¿æ¥å‰ç­‰å¾…è¡ŒåŠ¨çš„ç§’æ•°ã€‚</li></ul><h4 id="3-ä¼˜åŒ–æ•°æ®åº“ç»“æ„"><a href="#3-ä¼˜åŒ–æ•°æ®åº“ç»“æ„" class="headerlink" title="3. ä¼˜åŒ–æ•°æ®åº“ç»“æ„"></a><strong>3.</strong> <strong>ä¼˜åŒ–æ•°æ®åº“ç»“æ„</strong></h4><h5 id="3-1-æ‹†åˆ†è¡¨ï¼šå†·çƒ­æ•°æ®åˆ†ç¦»"><a href="#3-1-æ‹†åˆ†è¡¨ï¼šå†·çƒ­æ•°æ®åˆ†ç¦»" class="headerlink" title="3.1 æ‹†åˆ†è¡¨ï¼šå†·çƒ­æ•°æ®åˆ†ç¦»"></a><strong>3.1</strong> <strong>æ‹†åˆ†è¡¨ï¼šå†·çƒ­æ•°æ®åˆ†ç¦»</strong></h5><h5 id="3-2-å¢åŠ ä¸­é—´è¡¨"><a href="#3-2-å¢åŠ ä¸­é—´è¡¨" class="headerlink" title="3.2 å¢åŠ ä¸­é—´è¡¨"></a><strong>3.2</strong> <strong>å¢åŠ ä¸­é—´è¡¨</strong></h5><h5 id="3-3-å¢åŠ å†—ä½™å­—æ®µ"><a href="#3-3-å¢åŠ å†—ä½™å­—æ®µ" class="headerlink" title="3.3 å¢åŠ å†—ä½™å­—æ®µ"></a><strong>3.3</strong> <strong>å¢åŠ å†—ä½™å­—æ®µ</strong></h5><h5 id="3-4-ä¼˜åŒ–æ•°æ®ç±»å‹"><a href="#3-4-ä¼˜åŒ–æ•°æ®ç±»å‹" class="headerlink" title="3.4 ä¼˜åŒ–æ•°æ®ç±»å‹"></a><strong>3.4</strong> <strong>ä¼˜åŒ–æ•°æ®ç±»å‹</strong></h5><p><strong>æƒ…å†µ1ï¼šå¯¹æ•´æ•°ç±»å‹æ•°æ®è¿›è¡Œä¼˜åŒ–ã€‚</strong></p><p>é‡åˆ°æ•´æ•°ç±»å‹çš„å­—æ®µå¯ä»¥ç”¨<code>INT å‹</code>ã€‚è¿™æ ·åšçš„ç†ç”±æ˜¯ï¼ŒINT å‹æ•°æ®æœ‰è¶³å¤Ÿå¤§çš„å–å€¼èŒƒå›´ï¼Œä¸ç”¨æ‹…å¿ƒæ•°æ®è¶…å‡ºå–å€¼èŒƒå›´çš„é—®é¢˜ã€‚åˆšå¼€å§‹åšé¡¹ç›®çš„æ—¶å€™ï¼Œé¦–å…ˆè¦ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œè¿™æ ·è®¾è®¡å­—æ®µç±»å‹æ˜¯å¯ä»¥çš„ã€‚ä½†åœ¨æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œæ•°æ®ç±»å‹çš„å®šä¹‰ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¼šå½±å“åˆ°ç³»ç»Ÿæ•´ä½“çš„æ‰§è¡Œæ•ˆç‡ã€‚</p><p>å¯¹äº<code>éè´Ÿå‹</code>çš„æ•°æ®ï¼ˆå¦‚è‡ªå¢IDã€æ•´å‹IPï¼‰æ¥è¯´ï¼Œè¦ä¼˜å…ˆä½¿ç”¨æ— ç¬¦å·æ•´å‹<code>UNSIGNED</code>æ¥å­˜å‚¨ã€‚å› ä¸ºæ— ç¬¦å·ç›¸å¯¹äºæœ‰ç¬¦å·ï¼ŒåŒæ ·çš„å­—èŠ‚æ•°ï¼Œå­˜å‚¨çš„æ•°å€¼èŒƒå›´æ›´å¤§ã€‚å¦‚tinyintæœ‰ç¬¦å·ä¸º-128-127ï¼Œæ— ç¬¦å·ä¸º0-255ï¼Œå¤šå‡ºä¸€å€çš„å­˜å‚¨ç©ºé—´ã€‚</p><p><strong>æƒ…å†µ2ï¼šæ—¢å¯ä»¥ä½¿ç”¨æ–‡æœ¬ç±»å‹ä¹Ÿå¯ä»¥ä½¿ç”¨æ•´æ•°ç±»å‹çš„å­—æ®µï¼Œè¦é€‰æ‹©ä½¿ç”¨æ•´æ•°ç±»å‹</strong>ã€‚</p><p>è·Ÿæ–‡æœ¬ç±»å‹æ•°æ®ç›¸æ¯”ï¼Œå¤§æ•´æ•°å¾€å¾€å ç”¨<code>æ›´å°‘çš„å­˜å‚¨ç©ºé—´</code>ï¼Œå› æ­¤ï¼Œåœ¨å­˜å–å’Œæ¯”å¯¹çš„æ—¶å€™ï¼Œå¯ä»¥å ç”¨æ›´å°‘çš„å†…å­˜ç©ºé—´ã€‚æ‰€ä»¥ï¼Œåœ¨äºŒè€…çš†å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œå°½é‡ä½¿ç”¨æ•´æ•°ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜æŸ¥è¯¢çš„æ•ˆç‡ã€‚å¦‚ï¼šå°†IPåœ°å€è½¬æ¢æˆæ•´å‹æ•°æ®ã€‚</p><p><strong>æƒ…å†µ3ï¼šé¿å…ä½¿ç”¨TEXTã€BLOBæ•°æ®ç±»å‹</strong></p><p><strong>æƒ…å†µ4ï¼šé¿å…ä½¿ç”¨ENUMç±»å‹</strong></p><p><strong>æƒ…å†µ5ï¼šä½¿ç”¨TIMESTAMPå­˜å‚¨æ—¶é—´</strong></p><p><strong>æƒ…å†µ6ï¼šç”¨DECIMALä»£æ›¿FLOATå’ŒDOUBLEå­˜å‚¨ç²¾ç¡®æµ®ç‚¹æ•°</strong></p><p><strong>æ€»ä¹‹ï¼Œé‡åˆ°æ•°æ®é‡å¤§çš„é¡¹ç›®æ—¶ï¼Œä¸€å®šè¦åœ¨å……åˆ†äº†è§£ä¸šåŠ¡éœ€æ±‚çš„å‰æä¸‹ï¼Œåˆç†ä¼˜åŒ–æ•°æ®ç±»å‹ï¼Œè¿™æ ·æ‰èƒ½å……åˆ†å‘æŒ¥èµ„æºçš„æ•ˆç‡ï¼Œä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ä¼˜</strong>ã€‚</p><h5 id="3-5-ä¼˜åŒ–æ’å…¥è®°å½•çš„é€Ÿåº¦"><a href="#3-5-ä¼˜åŒ–æ’å…¥è®°å½•çš„é€Ÿåº¦" class="headerlink" title="3.5 ä¼˜åŒ–æ’å…¥è®°å½•çš„é€Ÿåº¦"></a><strong>3.5</strong> <strong>ä¼˜åŒ–æ’å…¥è®°å½•çš„é€Ÿåº¦</strong></h5><p><strong>1. MyISAMå¼•æ“çš„è¡¨ï¼š</strong></p><p><strong>â‘  ç¦ç”¨ç´¢å¼•</strong></p><p><strong>â‘¡ ç¦ç”¨å”¯ä¸€æ€§æ£€æŸ¥</strong></p><p><strong>â‘¢ ä½¿ç”¨æ‰¹é‡æ’å…¥</strong></p><p><strong>â‘£ ä½¿ç”¨LOAD DATA INFILE æ‰¹é‡å¯¼å…¥</strong></p><p><strong>2. InnoDBå¼•æ“çš„è¡¨ï¼š</strong></p><p> <strong>â‘  ç¦ç”¨å”¯ä¸€æ€§æ£€æŸ¥</strong></p><p><strong>â‘¡ ç¦ç”¨å¤–é”®æ£€æŸ¥</strong></p><p><strong>â‘¢ ç¦æ­¢è‡ªåŠ¨æäº¤</strong></p><h5 id="3-6-ä½¿ç”¨éç©ºçº¦æŸ"><a href="#3-6-ä½¿ç”¨éç©ºçº¦æŸ" class="headerlink" title="3.6 ä½¿ç”¨éç©ºçº¦æŸ"></a><strong>3.6</strong> <strong>ä½¿ç”¨éç©ºçº¦æŸ</strong></h5><p><strong>åœ¨è®¾è®¡å­—æ®µçš„æ—¶å€™ï¼Œå¦‚æœä¸šåŠ¡å…è®¸ï¼Œå»ºè®®å°½é‡ä½¿ç”¨éç©ºçº¦æŸ</strong></p><h5 id="3-7-åˆ†æè¡¨ã€æ£€æŸ¥è¡¨ä¸ä¼˜åŒ–è¡¨"><a href="#3-7-åˆ†æè¡¨ã€æ£€æŸ¥è¡¨ä¸ä¼˜åŒ–è¡¨" class="headerlink" title="3.7 åˆ†æè¡¨ã€æ£€æŸ¥è¡¨ä¸ä¼˜åŒ–è¡¨"></a><strong>3.7</strong> <strong>åˆ†æè¡¨ã€æ£€æŸ¥è¡¨ä¸ä¼˜åŒ–è¡¨</strong></h5><p><strong>1.</strong> <strong>åˆ†æè¡¨</strong></p><pre><code class="mysql">ANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name[,tbl_name]â€¦</code></pre><p>é»˜è®¤çš„ï¼ŒMySQLæœåŠ¡ä¼šå°† ANALYZE TABLEè¯­å¥å†™åˆ°binlogä¸­ï¼Œä»¥ä¾¿åœ¨ä¸»ä»æ¶æ„ä¸­ï¼Œä»æœåŠ¡èƒ½å¤ŸåŒæ­¥æ•°æ®ã€‚å¯ä»¥æ·»åŠ å‚æ•°LOCAL æˆ–è€… NO_WRITE_TO_BINLOGå–æ¶ˆå°†è¯­å¥å†™åˆ°binlogä¸­ã€‚</p><p>ä½¿ç”¨<code>ANALYZE TABLE</code>åˆ†æè¡¨çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®åº“ç³»ç»Ÿä¼šè‡ªåŠ¨å¯¹è¡¨åŠ ä¸€ä¸ª<code>åªè¯»é”</code>ã€‚åœ¨åˆ†ææœŸé—´ï¼Œåªèƒ½è¯»å–è¡¨ä¸­çš„è®°å½•ï¼Œä¸èƒ½æ›´æ–°å’Œæ’å…¥è®°å½•ã€‚ANALYZE TABLEè¯­å¥èƒ½å¤Ÿåˆ†æInnoDBå’ŒMyISAMç±»å‹çš„è¡¨ï¼Œä½†æ˜¯ä¸èƒ½ä½œç”¨äºè§†å›¾ã€‚</p><p>ANALYZE TABLEåˆ†æåçš„ç»Ÿè®¡ç»“æœä¼šååº”åˆ°<code>cardinality</code>çš„å€¼ï¼Œè¯¥å€¼ç»Ÿè®¡äº†è¡¨ä¸­æŸä¸€é”®æ‰€åœ¨çš„åˆ—ä¸é‡å¤çš„å€¼çš„ä¸ªæ•°ã€‚<strong>è¯¥å€¼è¶Šæ¥è¿‘è¡¨ä¸­çš„æ€»è¡Œæ•°ï¼Œåˆ™åœ¨è¡¨è¿æ¥æŸ¥è¯¢æˆ–è€…ç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œå°±è¶Šä¼˜å…ˆè¢«ä¼˜åŒ–å™¨é€‰æ‹©ä½¿ç”¨ã€‚</strong></p><p><strong>2.</strong> <strong>æ£€æŸ¥è¡¨</strong> </p><pre><code class="mysql">CHECK TABLE tbl_name [, tbl_name] ... [option] ... option = &#123;QUICK | FAST | MEDIUM | EXTENDED | CHANGED&#125;</code></pre><p>MySQLä¸­å¯ä»¥ä½¿ç”¨<code>CHECK TABLE</code>è¯­å¥æ¥æ£€æŸ¥è¡¨ã€‚CHECK TABLEè¯­å¥èƒ½å¤Ÿæ£€æŸ¥InnoDBå’ŒMyISAMç±»å‹çš„è¡¨æ˜¯å¦å­˜åœ¨é”™è¯¯ã€‚CHECK TABLEè¯­å¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¹Ÿä¼šç»™è¡¨åŠ ä¸Š<code>åªè¯»é”</code>ã€‚</p><p><strong>3.</strong> <strong>ä¼˜åŒ–è¡¨</strong></p><pre><code class="mysql">OPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...</code></pre><p>MySQLä¸­ä½¿ç”¨<code>OPTIMIZE TABLE</code>è¯­å¥æ¥ä¼˜åŒ–è¡¨ã€‚ä½†æ˜¯ï¼ŒOPTILMIZE TABLEè¯­å¥åªèƒ½ä¼˜åŒ–è¡¨ä¸­çš„<code>VARCHAR</code>ã€<code>BLOB</code>æˆ–<code>TEXT</code>ç±»å‹çš„å­—æ®µã€‚ä¸€ä¸ªè¡¨ä½¿ç”¨äº†è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹ï¼Œè‹¥å·²ç»<code>åˆ é™¤</code>äº†è¡¨çš„ä¸€å¤§éƒ¨åˆ†æ•°æ®ï¼Œæˆ–è€…å·²ç»å¯¹å«æœ‰å¯å˜é•¿åº¦è¡Œçš„è¡¨ï¼ˆå«æœ‰VARCHARã€BLOBæˆ–TEXTåˆ—çš„è¡¨ï¼‰è¿›è¡Œäº†å¾ˆå¤š<code>æ›´æ–°</code>ï¼Œåˆ™åº”ä½¿ç”¨OPTIMIZE TABLEæ¥é‡æ–°åˆ©ç”¨æœªä½¿ç”¨çš„ç©ºé—´ï¼Œå¹¶æ•´ç†æ•°æ®æ–‡ä»¶çš„<code>ç¢ç‰‡</code>ã€‚ </p><p>OPTIMIZE TABLE è¯­å¥å¯¹InnoDBå’ŒMyISAMç±»å‹çš„è¡¨éƒ½æœ‰æ•ˆã€‚è¯¥è¯­å¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¹Ÿä¼šç»™è¡¨åŠ ä¸Š<code>åªè¯»é”</code>ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬13ç«  äº‹åŠ¡åŸºç¡€çŸ¥è¯†</title>
      <link href="/2023/07/15/%E7%AC%AC13%E7%AB%A0%20%E4%BA%8B%E5%8A%A1%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
      <url>/2023/07/15/%E7%AC%AC13%E7%AB%A0%20%E4%BA%8B%E5%8A%A1%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬13ç« -äº‹åŠ¡åŸºç¡€çŸ¥è¯†"><a href="#ç¬¬13ç« -äº‹åŠ¡åŸºç¡€çŸ¥è¯†" class="headerlink" title="ç¬¬13ç«  äº‹åŠ¡åŸºç¡€çŸ¥è¯†"></a>ç¬¬13ç«  äº‹åŠ¡åŸºç¡€çŸ¥è¯†</h3><h4 id="1-æ•°æ®åº“äº‹åŠ¡æ¦‚è¿°"><a href="#1-æ•°æ®åº“äº‹åŠ¡æ¦‚è¿°" class="headerlink" title="1. æ•°æ®åº“äº‹åŠ¡æ¦‚è¿°"></a><strong>1.</strong> <strong>æ•°æ®åº“äº‹åŠ¡æ¦‚è¿°</strong></h4><h5 id="1-1-åŸºæœ¬æ¦‚å¿µ"><a href="#1-1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1.1 åŸºæœ¬æ¦‚å¿µ"></a><strong>1.1</strong> <strong>åŸºæœ¬æ¦‚å¿µ</strong></h5><p><strong>äº‹åŠ¡ï¼š</strong>ä¸€ç»„é€»è¾‘æ“ä½œå•å…ƒï¼Œä½¿æ•°æ®ä»ä¸€ç§çŠ¶æ€å˜æ¢åˆ°å¦ä¸€ç§çŠ¶æ€ã€‚</p><p><strong>äº‹åŠ¡å¤„ç†çš„åŸåˆ™ï¼š</strong>ä¿è¯æ‰€æœ‰äº‹åŠ¡éƒ½ä½œä¸º<code>ä¸€ä¸ªå·¥ä½œå•å…ƒ</code>æ¥æ‰§è¡Œï¼Œå³ä½¿å‡ºç°äº†æ•…éšœï¼Œéƒ½ä¸èƒ½æ”¹å˜è¿™ç§æ‰§è¡Œæ–¹å¼ã€‚å½“åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œå¤šä¸ªæ“ä½œæ—¶ï¼Œè¦ä¹ˆæ‰€æœ‰çš„äº‹åŠ¡éƒ½è¢«æäº¤(<code>commit</code>)ï¼Œé‚£ä¹ˆè¿™äº›ä¿®æ”¹å°±<code>æ°¸ä¹…</code>åœ°ä¿å­˜ä¸‹æ¥ï¼›è¦ä¹ˆæ•°æ®åº“ç®¡ç†ç³»ç»Ÿå°†<code>æ”¾å¼ƒ</code>æ‰€ä½œçš„æ‰€æœ‰<code>ä¿®æ”¹</code>ï¼Œæ•´ä¸ªäº‹åŠ¡å›æ»š(<code>rollback</code>)åˆ°æœ€åˆçŠ¶æ€ã€‚</p><h5 id="1-2-äº‹åŠ¡çš„ACIDç‰¹æ€§"><a href="#1-2-äº‹åŠ¡çš„ACIDç‰¹æ€§" class="headerlink" title="1.2 äº‹åŠ¡çš„ACIDç‰¹æ€§"></a><strong>1.2</strong> <strong>äº‹åŠ¡çš„ACIDç‰¹æ€§</strong></h5><ul><li><strong>åŸå­æ€§ï¼ˆatomicityï¼‰ï¼š</strong></li></ul><p>åŸå­æ€§æ˜¯æŒ‡äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œè¦ä¹ˆå…¨éƒ¨æäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚</p><ul><li><strong>ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ï¼š</strong></li></ul><p>ä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®ä»ä¸€ä¸ª<code>åˆæ³•æ€§çŠ¶æ€</code>å˜æ¢åˆ°å¦å¤–ä¸€ä¸ª<code>åˆæ³•æ€§çŠ¶æ€</code>ã€‚è¿™ç§çŠ¶æ€æ˜¯<code>è¯­ä¹‰ä¸Š</code>çš„è€Œä¸æ˜¯è¯­æ³•ä¸Šçš„ï¼Œè·Ÿå…·ä½“çš„ä¸šåŠ¡æœ‰å…³ã€‚</p><ul><li><strong>éš”ç¦»å‹ï¼ˆisolationï¼‰ï¼š</strong></li></ul><p>äº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œ<code>ä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°</code>ï¼Œå³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹<code>å¹¶å‘</code>çš„å…¶ä»–äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°ã€‚</p><ul><li><strong>æŒä¹…æ€§ï¼ˆdurabilityï¼‰ï¼š</strong></li></ul><p>æŒä¹…æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±æ˜¯<code>æ°¸ä¹…æ€§çš„</code>ï¼Œæ¥ä¸‹æ¥çš„å…¶ä»–æ“ä½œå’Œæ•°æ®åº“æ•…éšœä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</p><p>æŒä¹…æ€§æ˜¯é€šè¿‡<code>äº‹åŠ¡æ—¥å¿—</code>æ¥ä¿è¯çš„ã€‚æ—¥å¿—åŒ…æ‹¬äº†<code>é‡åšæ—¥å¿—</code>å’Œ<code>å›æ»šæ—¥å¿—</code>ã€‚å½“æˆ‘ä»¬é€šè¿‡äº‹åŠ¡å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šå°†æ•°æ®åº“çš„å˜åŒ–ä¿¡æ¯è®°å½•åˆ°é‡åšæ—¥å¿—ä¸­ï¼Œç„¶åå†å¯¹æ•°æ®åº“ä¸­å¯¹åº”çš„è¡Œè¿›è¡Œä¿®æ”¹ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå³ä½¿æ•°æ®åº“ç³»ç»Ÿå´©æºƒï¼Œæ•°æ®åº“é‡å¯åä¹Ÿèƒ½æ‰¾åˆ°æ²¡æœ‰æ›´æ–°åˆ°æ•°æ®åº“ç³»ç»Ÿä¸­çš„é‡åšæ—¥å¿—ï¼Œé‡æ–°æ‰§è¡Œï¼Œä»è€Œä½¿äº‹åŠ¡å…·æœ‰æŒä¹…æ€§ã€‚</p><h5 id="1-3-äº‹åŠ¡çš„çŠ¶æ€"><a href="#1-3-äº‹åŠ¡çš„çŠ¶æ€" class="headerlink" title="1.3 äº‹åŠ¡çš„çŠ¶æ€"></a><strong>1.3</strong> <strong>äº‹åŠ¡çš„çŠ¶æ€</strong></h5><ul><li><strong>æ´»åŠ¨çš„ï¼ˆactiveï¼‰</strong></li></ul><p>äº‹åŠ¡å¯¹åº”çš„æ•°æ®åº“æ“ä½œæ­£åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ—¶ï¼Œæˆ‘ä»¬å°±è¯´è¯¥äº‹åŠ¡å¤„åœ¨<code>æ´»åŠ¨çš„</code>çŠ¶æ€ã€‚</p><ul><li><strong>éƒ¨åˆ†æäº¤çš„ï¼ˆpartially committedï¼‰</strong></li></ul><p>å½“äº‹åŠ¡ä¸­çš„æœ€åä¸€ä¸ªæ“ä½œæ‰§è¡Œå®Œæˆï¼Œä½†ç”±äºæ“ä½œéƒ½åœ¨å†…å­˜ä¸­æ‰§è¡Œï¼Œæ‰€é€ æˆçš„å½±å“å¹¶<code>æ²¡æœ‰åˆ·æ–°åˆ°ç£ç›˜</code>æ—¶ï¼Œæˆ‘ä»¬å°±è¯´è¯¥äº‹åŠ¡å¤„åœ¨<code>éƒ¨åˆ†æäº¤çš„</code>çŠ¶æ€ã€‚</p><ul><li><strong>å¤±è´¥çš„ï¼ˆfailedï¼‰</strong></li></ul><p>å½“äº‹åŠ¡å¤„åœ¨<code>æ´»åŠ¨çš„</code>æˆ–è€…<code>éƒ¨åˆ†æäº¤çš„</code>çŠ¶æ€æ—¶ï¼Œå¯èƒ½é‡åˆ°äº†æŸäº›é”™è¯¯ï¼ˆæ•°æ®åº“è‡ªèº«çš„é”™è¯¯ã€æ“ä½œç³»ç»Ÿé”™è¯¯æˆ–è€…ç›´æ¥æ–­ç”µç­‰ï¼‰è€Œæ— æ³•ç»§ç»­æ‰§è¡Œï¼Œæˆ–è€…äººä¸ºçš„åœæ­¢å½“å‰äº‹åŠ¡çš„æ‰§è¡Œï¼Œæˆ‘ä»¬å°±è¯´è¯¥äº‹åŠ¡å¤„åœ¨<code>å¤±è´¥çš„</code>çŠ¶æ€ã€‚</p><ul><li><strong>ä¸­æ­¢çš„ï¼ˆabortedï¼‰</strong></li></ul><p>å¦‚æœäº‹åŠ¡æ‰§è¡Œäº†ä¸€éƒ¨åˆ†è€Œå˜ä¸º<code>å¤±è´¥çš„</code>çŠ¶æ€ï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠå·²ç»ä¿®æ”¹çš„äº‹åŠ¡ä¸­çš„æ“ä½œè¿˜åŸåˆ°äº‹åŠ¡æ‰§è¡Œå‰çš„çŠ¶æ€ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯è¦æ’¤é”€å¤±è´¥äº‹åŠ¡å¯¹å½“å‰æ•°æ®åº“é€ æˆçš„å½±å“ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªæ’¤é”€çš„è¿‡ç¨‹ç§°ä¹‹ä¸º<code>å›æ»š</code>ã€‚å½“<code>å›æ»š</code>æ“ä½œæ‰§è¡Œå®Œæ¯•æ—¶ï¼Œä¹Ÿå°±æ˜¯æ•°æ®åº“æ¢å¤åˆ°äº†æ‰§è¡Œäº‹åŠ¡ä¹‹å‰çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å°±è¯´è¯¥äº‹åŠ¡å¤„åœ¨äº†<code>ä¸­æ­¢çš„</code>çŠ¶æ€ã€‚</p><ul><li><strong>æäº¤çš„ï¼ˆcommittedï¼‰</strong></li></ul><p>å½“ä¸€ä¸ªå¤„åœ¨<code>éƒ¨åˆ†æäº¤çš„</code>çŠ¶æ€çš„äº‹åŠ¡å°†ä¿®æ”¹è¿‡çš„æ•°æ®éƒ½<code>åŒæ­¥åˆ°ç£ç›˜</code>ä¸Šä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¯´è¯¥äº‹åŠ¡å¤„åœ¨äº†<code>æäº¤çš„</code>çŠ¶æ€ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204031104063.png" alt="image-20220403110448951"></p><h4 id="2-å¦‚ä½•ä½¿ç”¨äº‹åŠ¡"><a href="#2-å¦‚ä½•ä½¿ç”¨äº‹åŠ¡" class="headerlink" title="2. å¦‚ä½•ä½¿ç”¨äº‹åŠ¡"></a><strong>2.</strong> <strong>å¦‚ä½•ä½¿ç”¨äº‹åŠ¡</strong></h4><h5 id="2-1-æ˜¾å¼äº‹åŠ¡"><a href="#2-1-æ˜¾å¼äº‹åŠ¡" class="headerlink" title="2.1 æ˜¾å¼äº‹åŠ¡"></a><strong>2.1</strong> <strong>æ˜¾å¼äº‹åŠ¡</strong></h5><p><strong>æ­¥éª¤1ï¼š</strong> <code>START TRANSACTION</code>æˆ–è€…<code>BEGIN</code>ï¼Œä½œç”¨æ˜¯æ˜¾å¼å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚</p><pre><code class="mysql">mysql&gt; BEGIN; #æˆ–è€… mysql&gt; START TRANSACTION;</code></pre><p><code>START TRANSACTION</code>è¯­å¥ç›¸è¾ƒäº<code>BEGIN</code>ç‰¹åˆ«ä¹‹å¤„åœ¨äºï¼Œåè¾¹èƒ½è·Ÿéšå‡ ä¸ª<code>ä¿®é¥°ç¬¦</code>ï¼š </p><p>â‘ <code>READ ONLY</code>ï¼šæ ‡è¯†å½“å‰äº‹åŠ¡æ˜¯ä¸€ä¸ª<code>åªè¯»äº‹åŠ¡</code>ï¼Œä¹Ÿå°±æ˜¯å±äºè¯¥äº‹åŠ¡çš„æ•°æ®åº“æ“ä½œåªèƒ½è¯»å–æ•°æ®ï¼Œè€Œä¸èƒ½ä¿®æ”¹æ•°æ®ã€‚</p><p>â‘¡<code>READ WRITE</code>ï¼šæ ‡è¯†å½“å‰äº‹åŠ¡æ˜¯ä¸€ä¸ª<code>è¯»å†™äº‹åŠ¡</code>ï¼Œä¹Ÿå°±æ˜¯å±äºè¯¥äº‹åŠ¡çš„æ•°æ®åº“æ“ä½œæ—¢å¯ä»¥è¯»å–æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹æ•°æ®ã€‚</p><p>â‘¢<code>WITH CONSISTENT SNAPSHOT</code>ï¼šå¯åŠ¨ä¸€è‡´æ€§è¯»ã€‚</p><p><strong>æ­¥éª¤2ï¼š</strong>ä¸€ç³»åˆ—äº‹åŠ¡ä¸­çš„æ“ä½œï¼ˆä¸»è¦æ˜¯DMLï¼Œä¸å«DDLï¼‰</p><p><strong>æ­¥éª¤3ï¼š</strong>æäº¤äº‹åŠ¡ æˆ– ä¸­æ­¢äº‹åŠ¡ï¼ˆå³å›æ»šäº‹åŠ¡ï¼‰</p><pre><code class="mysql"># æäº¤äº‹åŠ¡ã€‚å½“æäº¤äº‹åŠ¡åï¼Œå¯¹æ•°æ®åº“çš„ä¿®æ”¹æ˜¯æ°¸ä¹…æ€§çš„ã€‚mysql&gt; COMMIT;</code></pre><pre><code class="mysql"># å›æ»šäº‹åŠ¡ã€‚å³æ’¤é”€æ­£åœ¨è¿›è¡Œçš„æ‰€æœ‰æ²¡æœ‰æäº¤çš„ä¿®æ”¹ mysql&gt; ROLLBACK; # å°†äº‹åŠ¡å›æ»šåˆ°æŸä¸ªä¿å­˜ç‚¹ã€‚ mysql&gt; ROLLBACK TO [SAVEPOINT]</code></pre><p>å…¶ä¸­å…³äºSAVEPOINTç›¸å…³æ“ä½œæœ‰ï¼š</p><pre><code class="mysql"># åœ¨äº‹åŠ¡ä¸­åˆ›å»ºä¿å­˜ç‚¹ï¼Œæ–¹ä¾¿åç»­é’ˆå¯¹ä¿å­˜ç‚¹è¿›è¡Œå›æ»šã€‚ä¸€ä¸ªäº‹ç‰©ä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªä¿å­˜ç‚¹ã€‚SAVEPOINT ä¿å­˜ç‚¹åç§°;</code></pre><pre><code class="mysql"># åˆ é™¤æŸä¸ªä¿å­˜ç‚¹RELEASE SAVEPOINT ä¿å­˜ç‚¹åç§°;</code></pre><h5 id="2-2-éšå¼äº‹åŠ¡"><a href="#2-2-éšå¼äº‹åŠ¡" class="headerlink" title="2.2 éšå¼äº‹åŠ¡"></a><strong>2.2</strong> <strong>éšå¼äº‹åŠ¡</strong></h5><ul><li>æ˜¾å¼çš„çš„ä½¿ç”¨<code>START TRANSACTION</code>æˆ–è€…<code>BEGIN</code>è¯­å¥å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚è¿™æ ·åœ¨æœ¬æ¬¡äº‹åŠ¡æäº¤æˆ–è€…å›æ»šå‰ä¼šæš‚æ—¶å…³é—­æ‰è‡ªåŠ¨æäº¤çš„åŠŸèƒ½ã€‚</li><li>æŠŠç³»ç»Ÿå˜é‡<code>autocommit</code>çš„å€¼è®¾ç½®ä¸º<code>OFF</code></li></ul><h5 id="2-3-éšå¼æäº¤æ•°æ®çš„æƒ…å†µ"><a href="#2-3-éšå¼æäº¤æ•°æ®çš„æƒ…å†µ" class="headerlink" title="2.3 éšå¼æäº¤æ•°æ®çš„æƒ…å†µ"></a><strong>2.3</strong> <strong>éšå¼æäº¤æ•°æ®çš„æƒ…å†µ</strong></h5><ul><li><p><strong>æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆData definition languageï¼Œç¼©å†™ä¸ºï¼šDDLï¼‰</strong></p></li><li><p><strong>éšå¼ä½¿ç”¨æˆ–ä¿®æ”¹mysqlæ•°æ®åº“ä¸­çš„è¡¨</strong></p></li><li><p><strong>äº‹åŠ¡æ§åˆ¶æˆ–å…³äºé”å®šçš„è¯­å¥</strong></p><ul><li>å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æˆ–è€…å›æ»šæ—¶å°±åˆä½¿ç”¨<code>START TRANSACTION</code>æˆ–è€…<code>BEGIN</code>è¯­å¥å¼€å¯äº†å¦ä¸€ä¸ªäº‹åŠ¡æ—¶ï¼Œä¼š<code>éšå¼çš„æäº¤</code>ä¸Šä¸€ä¸ªäº‹åŠ¡ã€‚</li><li>å½“å‰çš„<code>autocommit</code>ç³»ç»Ÿå˜é‡çš„å€¼ä¸º<code>OFF</code>ï¼Œæˆ‘ä»¬æ‰‹åŠ¨æŠŠå®ƒè°ƒä¸º<code>ON</code>æ—¶ï¼Œä¹Ÿä¼š<code>éšå¼çš„æäº¤</code>å‰è¾¹è¯­å¥æ‰€å±çš„äº‹åŠ¡ã€‚</li><li>ä½¿ç”¨<code>LOCK TABLES</code>ã€<code>UNLOCK TABLES</code>ç­‰å…³äºé”å®šçš„è¯­å¥ä¹Ÿä¼š<code>éšå¼çš„æäº¤</code>å‰è¾¹è¯­å¥æ‰€å±çš„äº‹åŠ¡ã€‚</li></ul></li></ul><h4 id="3-äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#3-äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="3. äº‹åŠ¡éš”ç¦»çº§åˆ«"></a><strong>3.</strong> <strong>äº‹åŠ¡éš”ç¦»çº§åˆ«</strong></h4><h5 id="3-1-æ•°æ®å¹¶å‘é—®é¢˜"><a href="#3-1-æ•°æ®å¹¶å‘é—®é¢˜" class="headerlink" title="3.1 æ•°æ®å¹¶å‘é—®é¢˜"></a><strong>3.1</strong> <strong>æ•°æ®å¹¶å‘é—®é¢˜</strong></h5><p><strong>1.</strong> <strong>è„å†™ï¼ˆ</strong><code>Dirty Write</code><strong>ï¼‰</strong></p><p>å¯¹äºä¸¤ä¸ªäº‹åŠ¡ Session Aã€Session Bï¼Œå¦‚æœäº‹åŠ¡Session A<code>ä¿®æ”¹äº†</code>å¦ä¸€ä¸ª<code>æœªæäº¤</code>äº‹åŠ¡Session B<code>ä¿®æ”¹è¿‡</code>çš„æ•°æ®ï¼Œé‚£å°±æ„å‘³ç€å‘ç”Ÿäº†<code>è„å†™</code></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204031124086.png" alt="image-20220403112416944"></p><p><strong>2.</strong> <strong>è„è¯»ï¼ˆ</strong><code>Dirty Read</code><strong>ï¼‰</strong></p><p>å¯¹äºä¸¤ä¸ªäº‹åŠ¡ Session Aã€Session Bï¼ŒSession A<code>è¯»å–</code>äº†å·²ç»è¢« Session B<code>æ›´æ–°</code>ä½†è¿˜<code>æ²¡æœ‰è¢«æäº¤</code>çš„å­—æ®µã€‚ä¹‹åè‹¥ Session B<code>å›æ»š</code>ï¼ŒSession A<code>è¯»å–</code>çš„å†…å®¹å°±æ˜¯<code>ä¸´æ—¶ä¸”æ— æ•ˆ</code>çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204031124136.png" alt="image-20220403112435995"></p><p><strong>3.</strong> <strong>ä¸å¯é‡å¤è¯»ï¼ˆ</strong><code>Non-Repeatable Read</code><strong>ï¼‰</strong></p><p>å¯¹äºä¸¤ä¸ªäº‹åŠ¡Session Aã€Session Bï¼ŒSession A<code>è¯»å–</code>äº†ä¸€ä¸ªå­—æ®µï¼Œç„¶å Session B<code>æ›´æ–°</code>äº†è¯¥å­—æ®µã€‚ ä¹‹åSession A<code>å†æ¬¡è¯»å–</code>åŒä¸€ä¸ªå­—æ®µï¼Œ<code>å€¼å°±ä¸åŒ</code>äº†ã€‚é‚£å°±æ„å‘³ç€å‘ç”Ÿäº†ä¸å¯é‡å¤è¯»ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204031124331.png" alt="image-20220403112458183"></p><p><strong>4.</strong> <strong>å¹»è¯»ï¼ˆ</strong><code>Phantom</code><strong>ï¼‰</strong></p><p>å¯¹äºä¸¤ä¸ªäº‹åŠ¡Session Aã€Session B, Session A ä»ä¸€ä¸ªè¡¨ä¸­<code>è¯»å–</code>äº†ä¸€ä¸ªå­—æ®µ, ç„¶å Session B åœ¨è¯¥è¡¨ä¸­<code>æ’å…¥</code>äº†ä¸€äº›æ–°çš„è¡Œã€‚ ä¹‹å, å¦‚æœ Session A<code>å†æ¬¡è¯»å–</code>åŒä¸€ä¸ªè¡¨, å°±ä¼šå¤šå‡ºå‡ è¡Œã€‚é‚£å°±æ„å‘³ç€å‘ç”Ÿäº†å¹»è¯»ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204031125847.png" alt="image-20220403112514712"></p><p><strong>æ³¨æ„1ï¼š</strong></p><p>æœ‰çš„åŒå­¦ä¼šæœ‰ç–‘é—®ï¼Œé‚£å¦‚æœSession Bä¸­<code>å‰”é™¤äº†</code>ä¸€äº›ç¬¦åˆ<code>studentno &gt; 0</code>çš„è®°å½•è€Œä¸æ˜¯æ’å…¥æ–°è®°å½•ï¼Œé‚£ä¹ˆSession Aä¹‹åå†æ ¹æ®<code>studentno &gt; 0</code>çš„æ¡ä»¶è¯»å–çš„<code>è®°å½•å˜å°‘äº†</code>ï¼Œè¿™ç§ç°è±¡ç®—ä¸ç®—<code>å¹»è¯»</code>å‘¢ï¼Ÿè¿™ç§ç°è±¡<code>ä¸å±äºå¹»è¯»</code>ï¼Œå¹»è¯»å¼ºè°ƒçš„æ˜¯ä¸€ä¸ªäº‹ç‰©æŒ‰ç…§æŸä¸ª<code>ç›¸åŒæ¡ä»¶å¤šæ¬¡è¯»å–</code>è®°å½•æ—¶ï¼Œåè¯»å–æ—¶è¯»åˆ°äº†ä¹‹å‰<code>æ²¡æœ‰è¯»åˆ°çš„è®°å½•</code>ã€‚</p><p><strong>æ³¨æ„2ï¼š</strong></p><p>é‚£å¯¹äºå…ˆå‰å·²ç»è¯»åˆ°çš„è®°å½•ï¼Œä¹‹ååˆè¯»å–ä¸åˆ°è¿™ç§æƒ…å†µï¼Œç®—å•¥å‘¢ï¼Ÿè¿™ç›¸å½“äºå¯¹æ¯ä¸€æ¡è®°å½•éƒ½å‘ç”Ÿäº†<code>ä¸å¯é‡å¤è¯»</code>çš„ç°è±¡ã€‚å¹»è¯»åªæ˜¯é‡ç‚¹å¼ºè°ƒäº†è¯»å–åˆ°ä¹‹å‰è¯»å–æ²¡æœ‰è·å–åˆ°çš„è®°å½•ã€‚</p><h5 id="3-2-SQLä¸­çš„å››ç§éš”ç¦»çº§åˆ«"><a href="#3-2-SQLä¸­çš„å››ç§éš”ç¦»çº§åˆ«" class="headerlink" title="3.2 SQLä¸­çš„å››ç§éš”ç¦»çº§åˆ«"></a><strong>3.2 SQLä¸­çš„å››ç§éš”ç¦»çº§åˆ«</strong></h5><p><code>SQLæ ‡å‡†</code>ä¸­è®¾ç«‹äº†4ä¸ª<code>éš”ç¦»çº§åˆ«</code>ï¼š</p><ul><li><code>READ UNCOMMITTED</code>ï¼šè¯»æœªæäº¤ï¼Œåœ¨è¯¥éš”ç¦»çº§åˆ«ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½å¯ä»¥çœ‹åˆ°å…¶ä»–æœªæäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœã€‚ä¸èƒ½é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€‚</li><li><code>READ COMMITTED</code>ï¼šè¯»å·²æäº¤ï¼Œå®ƒæ»¡è¶³äº†éš”ç¦»çš„ç®€å•å®šä¹‰ï¼šä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤äº‹åŠ¡æ‰€åšçš„æ”¹å˜ã€‚è¿™æ˜¯å¤§å¤šæ•°æ•°æ®åº“ç³»ç»Ÿçš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼ˆä½†ä¸æ˜¯MySQLé»˜è®¤çš„ï¼‰ã€‚å¯ä»¥é¿å…è„è¯»ï¼Œä½†ä¸å¯é‡å¤è¯»ã€å¹»è¯»é—®é¢˜ä»ç„¶å­˜åœ¨ã€‚</li><li><code>REPEATABLE READ</code>ï¼šå¯é‡å¤è¯»ï¼Œäº‹åŠ¡Aåœ¨è¯»åˆ°ä¸€æ¡æ•°æ®ä¹‹åï¼Œæ­¤æ—¶äº‹åŠ¡Bå¯¹è¯¥æ•°æ®è¿›è¡Œäº†ä¿®æ”¹å¹¶æäº¤ï¼Œé‚£ä¹ˆäº‹åŠ¡Aå†è¯»è¯¥æ•°æ®ï¼Œè¯»åˆ°çš„è¿˜æ˜¯åŸæ¥çš„å†…å®¹ã€‚å¯ä»¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»é—®é¢˜ä»ç„¶å­˜åœ¨ã€‚<code>è¿™æ˜¯MySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«</code>ã€‚</li><li><code>SERIALIZABLE</code>ï¼šå¯ä¸²è¡ŒåŒ–ï¼Œç¡®ä¿äº‹åŠ¡å¯ä»¥ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–ç›¸åŒçš„è¡Œã€‚åœ¨è¿™ä¸ªäº‹åŠ¡æŒç»­æœŸé—´ï¼Œç¦æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¯¥è¡¨æ‰§è¡Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œã€‚æ‰€æœ‰çš„å¹¶å‘é—®é¢˜éƒ½å¯ä»¥é¿å…ï¼Œä½†æ€§èƒ½ååˆ†ä½ä¸‹ã€‚èƒ½é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204031127542.png" alt="image-20220403112740425"></p><h5 id="3-3-å¦‚ä½•è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"><a href="#3-3-å¦‚ä½•è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«" class="headerlink" title="3.3 å¦‚ä½•è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"></a><strong>3.3</strong> <strong>å¦‚ä½•è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</strong></h5><pre><code class="mysql">SET [GLOBAL|SESSION] TRANSACTION ISOLATION LEVEL éš”ç¦»çº§åˆ«; #å…¶ä¸­ï¼Œéš”ç¦»çº§åˆ«æ ¼å¼ï¼š &gt; READ UNCOMMITTED &gt; READ COMMITTED &gt; REPEATABLE READ &gt; SERIALIZABLE</code></pre><p>æˆ–è€…ï¼š</p><pre><code class="mysql">SET [GLOBAL|SESSION] TRANSACTION_ISOLATION = &#39;éš”ç¦»çº§åˆ«&#39; #å…¶ä¸­ï¼Œéš”ç¦»çº§åˆ«æ ¼å¼ï¼š &gt; READ-UNCOMMITTED &gt; READ-COMMITTED &gt; REPEATABLE-READ &gt; SERIALIZABLE</code></pre><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬14ç«  MySqläº‹åŠ¡æ—¥å¿—</title>
      <link href="/2023/07/15/%E7%AC%AC14%E7%AB%A0%20MySQL%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97/"/>
      <url>/2023/07/15/%E7%AC%AC14%E7%AB%A0%20MySQL%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬14ç« -MySQLäº‹åŠ¡æ—¥å¿—"><a href="#ç¬¬14ç« -MySQLäº‹åŠ¡æ—¥å¿—" class="headerlink" title="ç¬¬14ç«  MySQLäº‹åŠ¡æ—¥å¿—"></a>ç¬¬14ç«  MySQLäº‹åŠ¡æ—¥å¿—</h3><p>äº‹åŠ¡æœ‰4ç§ç‰¹æ€§ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ã€‚é‚£ä¹ˆäº‹åŠ¡çš„å››ç§ç‰¹æ€§åˆ°åº•æ˜¯åŸºäºä»€ä¹ˆæœºåˆ¶å®ç°å‘¢ï¼Ÿ</p><ul><li>äº‹åŠ¡çš„éš”ç¦»æ€§ç”±<code>é”æœºåˆ¶</code>å®ç°ã€‚</li><li>è€Œäº‹åŠ¡çš„åŸå­æ€§ã€ä¸€è‡´æ€§å’ŒæŒä¹…æ€§ç”±äº‹åŠ¡çš„ redo æ—¥å¿—å’Œundo æ—¥å¿—æ¥ä¿è¯ã€‚<ul><li>REDO LOG ç§°ä¸º<code>é‡åšæ—¥å¿—</code>ï¼Œæä¾›å†å†™å…¥æ“ä½œï¼Œæ¢å¤æäº¤äº‹åŠ¡ä¿®æ”¹çš„é¡µæ“ä½œï¼Œç”¨æ¥ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ã€‚</li><li>UNDO LOG ç§°ä¸º<code>å›æ»šæ—¥å¿—</code>ï¼Œå›æ»šè¡Œè®°å½•åˆ°æŸä¸ªç‰¹å®šç‰ˆæœ¬ï¼Œç”¨æ¥ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€ä¸€è‡´æ€§ã€‚</li></ul></li></ul><h4 id="1-redoæ—¥å¿—"><a href="#1-redoæ—¥å¿—" class="headerlink" title="1. redoæ—¥å¿—"></a><strong>1. redoæ—¥å¿—</strong></h4><h5 id="1-1-ä¸ºä»€ä¹ˆéœ€è¦REDOæ—¥å¿—"><a href="#1-1-ä¸ºä»€ä¹ˆéœ€è¦REDOæ—¥å¿—" class="headerlink" title="1.1 ä¸ºä»€ä¹ˆéœ€è¦REDOæ—¥å¿—"></a><strong>1.1</strong> <strong>ä¸ºä»€ä¹ˆéœ€è¦REDOæ—¥å¿—</strong></h5><p>ä¸€æ–¹é¢ï¼Œç¼“å†²æ± å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ¶ˆé™¤CPUå’Œç£ç›˜ä¹‹é—´çš„é¸¿æ²Ÿï¼Œcheckpointæœºåˆ¶å¯ä»¥ä¿è¯æ•°æ®çš„æœ€ç»ˆè½ç›˜ï¼Œç„¶è€Œç”±äºcheckpoint<code>å¹¶ä¸æ˜¯æ¯æ¬¡å˜æ›´çš„æ—¶å€™å°±è§¦å‘</code>çš„ï¼Œè€Œæ˜¯masterçº¿ç¨‹éš”ä¸€æ®µæ—¶é—´å»å¤„ç†çš„ã€‚æ‰€ä»¥æœ€åçš„æƒ…å†µå°±æ˜¯äº‹åŠ¡æäº¤åï¼Œåˆšå†™å®Œç¼“å†²æ± ï¼Œæ•°æ®åº“å®•æœºäº†ï¼Œé‚£ä¹ˆè¿™æ®µæ•°æ®å°±æ˜¯ä¸¢å¤±çš„ï¼Œæ— æ³•æ¢å¤ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œäº‹åŠ¡åŒ…å«<code>æŒä¹…æ€§</code>çš„ç‰¹æ€§ï¼Œå°±æ˜¯è¯´å¯¹äºä¸€ä¸ªå·²ç»æäº¤çš„äº‹åŠ¡ï¼Œåœ¨äº‹åŠ¡æäº¤åå³ä½¿ç³»ç»Ÿå‘ç”Ÿäº†å´©æºƒï¼Œè¿™ä¸ªäº‹åŠ¡å¯¹æ•°æ®åº“ä¸­æ‰€åšçš„æ›´æ”¹ä¹Ÿä¸èƒ½ä¸¢å¤±ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•ä¿è¯è¿™ä¸ªæŒä¹…æ€§å‘¢ï¼Ÿ<code>ä¸€ä¸ªç®€å•çš„åšæ³•</code>ï¼šåœ¨äº‹åŠ¡æäº¤å®Œæˆä¹‹å‰æŠŠè¯¥äº‹åŠ¡æ‰€ä¿®æ”¹çš„æ‰€æœ‰é¡µé¢éƒ½åˆ·æ–°åˆ°ç£ç›˜ï¼Œä½†æ˜¯è¿™ä¸ªç®€å•ç²—æš´çš„åšæ³•æœ‰äº›é—®é¢˜</p><p><code>å¦ä¸€ä¸ªè§£å†³çš„æ€è·¯</code>ï¼šæˆ‘ä»¬åªæ˜¯æƒ³è®©å·²ç»æäº¤äº†çš„äº‹åŠ¡å¯¹æ•°æ®åº“ä¸­æ•°æ®æ‰€åšçš„ä¿®æ”¹æ°¸ä¹…ç”Ÿæ•ˆï¼Œå³ä½¿åæ¥ç³»ç»Ÿå´©æºƒï¼Œåœ¨é‡å¯åä¹Ÿèƒ½æŠŠè¿™ç§ä¿®æ”¹æ¢å¤å‡ºæ¥ã€‚æ‰€ä»¥æˆ‘ä»¬å…¶å®æ²¡æœ‰å¿…è¦åœ¨æ¯æ¬¡äº‹åŠ¡æäº¤æ—¶å°±æŠŠè¯¥äº‹åŠ¡åœ¨å†…å­˜ä¸­ä¿®æ”¹è¿‡çš„å…¨éƒ¨é¡µé¢åˆ·æ–°åˆ°ç£ç›˜ï¼Œåªéœ€è¦æŠŠ<code>ä¿®æ”¹</code>äº†å“ªäº›ä¸œè¥¿<code>è®°å½•ä¸€ä¸‹</code>å°±å¥½ã€‚æ¯”å¦‚ï¼ŒæŸä¸ªäº‹åŠ¡å°†ç³»ç»Ÿè¡¨ç©ºé—´ä¸­<code>ç¬¬10å·</code>é¡µé¢ä¸­åç§»é‡ä¸º<code>100</code>å¤„çš„é‚£ä¸ªå­—èŠ‚çš„å€¼<code>1</code>æ”¹æˆ<code>2</code>ã€‚æˆ‘ä»¬åªéœ€è¦è®°å½•ä¸€ä¸‹ï¼šå°†ç¬¬0å·è¡¨ç©ºé—´çš„10å·é¡µé¢çš„åç§»é‡ä¸º100å¤„çš„å€¼æ›´æ–°ä¸º 2 ã€‚</p><h5 id="1-2-REDOæ—¥å¿—çš„å¥½å¤„ã€ç‰¹ç‚¹"><a href="#1-2-REDOæ—¥å¿—çš„å¥½å¤„ã€ç‰¹ç‚¹" class="headerlink" title="1.2 REDOæ—¥å¿—çš„å¥½å¤„ã€ç‰¹ç‚¹"></a><strong>1.2 REDOæ—¥å¿—çš„å¥½å¤„ã€ç‰¹ç‚¹</strong></h5><p><strong>1.</strong> <strong>å¥½å¤„</strong></p><ul><li><strong>redoæ—¥å¿—é™ä½äº†åˆ·ç›˜é¢‘ç‡</strong></li><li><strong>redoæ—¥å¿—å ç”¨çš„ç©ºé—´éå¸¸å°</strong></li></ul><p><strong>2.</strong> <strong>ç‰¹ç‚¹</strong></p><ul><li><strong>redoæ—¥å¿—æ˜¯é¡ºåºå†™å…¥ç£ç›˜çš„</strong></li><li><strong>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œredo logä¸æ–­è®°å½•</strong></li></ul><h5 id="1-3-redoçš„ç»„æˆ"><a href="#1-3-redoçš„ç»„æˆ" class="headerlink" title="1.3 redoçš„ç»„æˆ"></a><strong>1.3 redoçš„ç»„æˆ</strong></h5><p>Redo logå¯ä»¥ç®€å•åˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><code>é‡åšæ—¥å¿—çš„ç¼“å†² (redo log buffer) </code>ï¼Œä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ˜¯æ˜“å¤±çš„ã€‚</li></ul><p><strong>å‚æ•°è®¾ç½®ï¼šinnodb_log_buffer_sizeï¼š</strong></p><p>redo log buffer å¤§å°ï¼Œé»˜è®¤<code>16M</code>ï¼Œæœ€å¤§å€¼æ˜¯4096Mï¼Œæœ€å°å€¼ä¸º1Mã€‚ </p><ul><li><code>é‡åšæ—¥å¿—æ–‡ä»¶ (redo log file)</code>ï¼Œä¿å­˜åœ¨ç¡¬ç›˜ä¸­ï¼Œæ˜¯æŒä¹…çš„ã€‚</li></ul><h5 id="1-4-redoçš„æ•´ä½“æµç¨‹"><a href="#1-4-redoçš„æ•´ä½“æµç¨‹" class="headerlink" title="1.4 redoçš„æ•´ä½“æµç¨‹"></a><strong>1.4 redoçš„æ•´ä½“æµç¨‹</strong></h5><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204031147714.png" alt="image-20220403114709581"></p><p>ç¬¬1æ­¥ï¼šå…ˆå°†åŸå§‹æ•°æ®ä»ç£ç›˜ä¸­è¯»å…¥å†…å­˜ä¸­æ¥ï¼Œä¿®æ”¹æ•°æ®çš„å†…å­˜æ‹·è´ </p><p>ç¬¬2æ­¥ï¼šç”Ÿæˆä¸€æ¡é‡åšæ—¥å¿—å¹¶å†™å…¥redo log bufferï¼Œè®°å½•çš„æ˜¯æ•°æ®è¢«ä¿®æ”¹åçš„å€¼ </p><p>ç¬¬3æ­¥ï¼šå½“äº‹åŠ¡commitæ—¶ï¼Œå°†redo log bufferä¸­çš„å†…å®¹åˆ·æ–°åˆ° redo log fileï¼Œå¯¹ redo log fileé‡‡ç”¨è¿½åŠ å†™çš„æ–¹å¼ </p><p>ç¬¬4æ­¥ï¼šå®šæœŸå°†å†…å­˜ä¸­ä¿®æ”¹çš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­</p><blockquote><p>Write-Ahead Log(é¢„å…ˆæ—¥å¿—æŒä¹…åŒ–)ï¼šåœ¨æŒä¹…åŒ–ä¸€ä¸ªæ•°æ®é¡µä¹‹å‰ï¼Œå…ˆå°†å†…å­˜ä¸­ç›¸åº”çš„æ—¥å¿—é¡µæŒä¹…åŒ–ã€‚</p></blockquote><h5 id="1-5-redo-logçš„åˆ·ç›˜ç­–ç•¥"><a href="#1-5-redo-logçš„åˆ·ç›˜ç­–ç•¥" class="headerlink" title="1.5 redo logçš„åˆ·ç›˜ç­–ç•¥"></a><strong>1.5 redo logçš„åˆ·ç›˜ç­–ç•¥</strong></h5><p>redo log bufferåˆ·ç›˜åˆ°redo log fileçš„è¿‡ç¨‹å¹¶ä¸æ˜¯çœŸæ­£çš„åˆ·åˆ°ç£ç›˜ä¸­å»ï¼Œåªæ˜¯åˆ·å…¥åˆ°<code>æ–‡ä»¶ç³»ç»Ÿç¼“å­˜</code>ï¼ˆpage cacheï¼‰ä¸­å»ï¼ˆè¿™æ˜¯ç°ä»£æ“ä½œç³»ç»Ÿä¸ºäº†æé«˜æ–‡ä»¶å†™å…¥æ•ˆç‡åšçš„ä¸€ä¸ªä¼˜åŒ–ï¼‰ï¼ŒçœŸæ­£çš„å†™å…¥ä¼šäº¤ç»™ç³»ç»Ÿè‡ªå·±æ¥å†³å®šï¼ˆæ¯”å¦‚page cacheè¶³å¤Ÿå¤§äº†ï¼‰ã€‚é‚£ä¹ˆå¯¹äºInnoDBæ¥è¯´å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœäº¤ç»™ç³»ç»Ÿæ¥åŒæ­¥ï¼ŒåŒæ ·å¦‚æœç³»ç»Ÿå®•æœºï¼Œé‚£ä¹ˆæ•°æ®ä¹Ÿä¸¢å¤±äº†ï¼ˆè™½ç„¶æ•´ä¸ªç³»ç»Ÿå®•æœºçš„æ¦‚ç‡è¿˜æ˜¯æ¯”è¾ƒå°çš„ï¼‰ã€‚</p><p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒInnoDBç»™å‡º<code>innodb_flush_log_at_trx_commit</code>å‚æ•°ï¼Œè¯¥å‚æ•°æ§åˆ¶ commitæäº¤äº‹åŠ¡æ—¶ï¼Œå¦‚ä½•å°† redo log buffer ä¸­çš„æ—¥å¿—åˆ·æ–°åˆ° redo log file ä¸­ã€‚å®ƒæ”¯æŒä¸‰ç§ç­–ç•¥ï¼š</p><ul><li><code>è®¾ç½®ä¸º0</code>ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶ä¸è¿›è¡Œåˆ·ç›˜æ“ä½œã€‚ï¼ˆç³»ç»Ÿé»˜è®¤master threadæ¯éš”1sè¿›è¡Œä¸€æ¬¡é‡åšæ—¥å¿—çš„åŒæ­¥ï¼‰</li><li><code>è®¾ç½®ä¸º1</code>ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°†è¿›è¡ŒåŒæ­¥ï¼Œåˆ·ç›˜æ“ä½œï¼ˆ<code>é»˜è®¤å€¼</code>ï¼‰ </li><li><code>è®¾ç½®ä¸º2</code>ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæŠŠ redo log buffer å†…å®¹å†™å…¥ page cacheï¼Œä¸è¿›è¡ŒåŒæ­¥ã€‚ç”±osè‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™åŒæ­¥åˆ°ç£ç›˜æ–‡ä»¶ã€‚</li></ul><h5 id="1-6-ä¸åŒåˆ·ç›˜ç­–ç•¥æ¼”ç¤º"><a href="#1-6-ä¸åŒåˆ·ç›˜ç­–ç•¥æ¼”ç¤º" class="headerlink" title="1.6 ä¸åŒåˆ·ç›˜ç­–ç•¥æ¼”ç¤º"></a><strong>1.6</strong> <strong>ä¸åŒåˆ·ç›˜ç­–ç•¥æ¼”ç¤º</strong></h5><p><strong>1.</strong> <strong>æµç¨‹å›¾</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204031152952.png" alt="image-20220403115232833"></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204031152607.png" alt="image-20220403115249492"></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204031153931.png" alt="image-20220403115300809"></p><h5 id="1-7-å†™å…¥redo-log-bufferè¿‡ç¨‹"><a href="#1-7-å†™å…¥redo-log-bufferè¿‡ç¨‹" class="headerlink" title="1.7 å†™å…¥redo log bufferè¿‡ç¨‹"></a><strong>1.7</strong> <strong>å†™å…¥redo log bufferè¿‡ç¨‹</strong></h5><p><strong>1.</strong> <strong>è¡¥å……æ¦‚å¿µï¼šMini-Transaction</strong></p><p>ä¸€ä¸ªäº‹åŠ¡å¯ä»¥åŒ…å«è‹¥å¹²æ¡è¯­å¥ï¼Œæ¯ä¸€æ¡è¯­å¥å…¶å®æ˜¯ç”±è‹¥å¹²ä¸ª<code>mtr</code>ç»„æˆï¼Œæ¯ä¸€ä¸ª<code>mtr</code>åˆå¯ä»¥åŒ…å«è‹¥å¹²æ¡redoæ—¥å¿—</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204040912119.png" alt="image-20220404091224993"></p><p><strong>2. redo</strong> <strong>æ—¥å¿—å†™å…¥log buffer</strong></p><p>ä¸åŒçš„äº‹åŠ¡å¯èƒ½æ˜¯<code>å¹¶å‘</code>æ‰§è¡Œçš„ï¼Œæ‰€ä»¥<code>äº‹åŠ¡T1</code>ã€<code>äº‹åŠ¡T2</code>ä¹‹é—´çš„<code>mtr</code>å¯èƒ½æ˜¯<code>äº¤æ›¿æ‰§è¡Œ</code>çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204040915708.png" alt="image-20220404091511602"></p><h5 id="1-8-redo-log-file"><a href="#1-8-redo-log-file" class="headerlink" title="1.8 redo log file"></a><strong>1.8 redo log file</strong></h5><p><strong>1.</strong> <strong>ç›¸å…³å‚æ•°è®¾ç½®</strong> </p><ul><li><p><code>innodb_log_group_home_dir</code>ï¼šæŒ‡å®š redo log æ–‡ä»¶ç»„æ‰€åœ¨çš„è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º<code>./</code>ï¼Œè¡¨ç¤ºåœ¨æ•°æ®åº“çš„æ•°æ®ç›®å½•ä¸‹ã€‚MySQLçš„é»˜è®¤æ•°æ®ç›®å½•ï¼ˆ<code>var/lib/mysql</code>ï¼‰ä¸‹é»˜è®¤æœ‰ä¸¤ä¸ªåä¸º<code>ib_logfile0</code>å’Œ<code>ib_logfile1</code>çš„æ–‡ä»¶ï¼Œlog bufferä¸­çš„æ—¥å¿—é»˜è®¤æƒ…å†µä¸‹å°±æ˜¯åˆ·æ–°åˆ°è¿™ä¸¤ä¸ªç£ç›˜æ–‡ä»¶ä¸­ã€‚æ­¤redoæ—¥å¿—æ–‡ä»¶ä½ç½®è¿˜å¯ä»¥ä¿®æ”¹ã€‚</p></li><li><p><code>innodb_log_files_in_group</code>ï¼šæŒ‡æ˜redo log fileçš„ä¸ªæ•°ï¼Œå‘½åæ–¹å¼å¦‚ï¼šib_logfile0ï¼Œib_logfile1â€¦ ib_logfilenã€‚é»˜è®¤2ä¸ªï¼Œæœ€å¤§100ä¸ªã€‚</p></li><li><p><code>innodb_flush_log_at_trx_commit</code>ï¼šæ§åˆ¶ redo log åˆ·æ–°åˆ°ç£ç›˜çš„ç­–ç•¥ï¼Œé»˜è®¤ä¸º<code>1</code>ã€‚ </p></li><li><p><code>innodb_log_file_size</code>ï¼šå•ä¸ª redo log æ–‡ä»¶è®¾ç½®å¤§å°ï¼Œé»˜è®¤å€¼ä¸º 48M ã€‚æœ€å¤§å€¼ä¸º512Gï¼Œæ³¨æ„æœ€å¤§å€¼æŒ‡çš„æ˜¯æ•´ä¸ª redo log ç³»åˆ—æ–‡ä»¶ä¹‹å’Œï¼Œå³ï¼ˆinnodb_log_files_in_group * innodb_log_file_size ï¼‰ä¸èƒ½å¤§äºæœ€å¤§å€¼512Gã€‚</p></li></ul><p><strong>2.</strong> <strong>æ—¥å¿—æ–‡ä»¶ç»„</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204040920532.png" alt="image-20220404092038421"></p><p><strong>3. checkpoint</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204040921715.png" alt="image-20220404092106617"></p><p>å¦‚æœ write pos è¿½ä¸Š checkpoint ï¼Œè¡¨ç¤º<strong>æ—¥å¿—æ–‡ä»¶ç»„</strong>æ»¡äº†ï¼Œè¿™æ—¶å€™ä¸èƒ½å†å†™å…¥æ–°çš„ redo logè®°å½•ï¼ŒMySQL å¾—åœä¸‹æ¥ï¼Œæ¸…ç©ºä¸€äº›è®°å½•ï¼ŒæŠŠ checkpoint æ¨è¿›ä¸€ä¸‹ã€‚</p><h4 id="2-Undoæ—¥å¿—"><a href="#2-Undoæ—¥å¿—" class="headerlink" title="2. Undoæ—¥å¿—"></a><strong>2. Undoæ—¥å¿—</strong></h4><p>redo logæ˜¯äº‹åŠ¡æŒä¹…æ€§çš„ä¿è¯ï¼Œundo logæ˜¯äº‹åŠ¡åŸå­æ€§çš„ä¿è¯ã€‚åœ¨äº‹åŠ¡ä¸­<code>æ›´æ–°æ•°æ®</code>çš„<code>å‰ç½®æ“ä½œ</code>å…¶å®æ˜¯è¦å…ˆå†™å…¥ä¸€ä¸ª undo log ã€‚</p><h5 id="2-1-å¦‚ä½•ç†è§£Undoæ—¥å¿—"><a href="#2-1-å¦‚ä½•ç†è§£Undoæ—¥å¿—" class="headerlink" title="2.1 å¦‚ä½•ç†è§£Undoæ—¥å¿—"></a><strong>2.1</strong> <strong>å¦‚ä½•ç†è§£Undoæ—¥å¿—</strong></h5><p>äº‹åŠ¡éœ€è¦ä¿è¯<code>åŸå­æ€§</code>ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆä»€ä¹ˆä¹Ÿä¸åšã€‚ä½†æœ‰æ—¶å€™äº‹åŠ¡æ‰§è¡Œåˆ°ä¸€åŠä¼šå‡ºç°ä¸€äº›æƒ…å†µï¼Œæ¯”å¦‚ï¼š</p><ul><li>æƒ…å†µä¸€ï¼šäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°å„ç§é”™è¯¯ï¼Œæ¯”å¦‚<code>æœåŠ¡å™¨æœ¬èº«çš„é”™è¯¯</code>ï¼Œ<code>æ“ä½œç³»ç»Ÿé”™è¯¯</code>ï¼Œç”šè‡³æ˜¯çªç„¶<code>æ–­ç”µ</code>å¯¼è‡´çš„é”™è¯¯ã€‚</li><li>æƒ…å†µäºŒï¼šç¨‹åºå‘˜å¯ä»¥åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰‹åŠ¨è¾“å…¥<code>ROLLBACK</code>è¯­å¥ç»“æŸå½“å‰äº‹åŠ¡çš„æ‰§è¡Œã€‚</li></ul><p>ä»¥ä¸Šæƒ…å†µå‡ºç°ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°æ®æ”¹å›åŸå…ˆçš„æ ·å­ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸º<code>å›æ»š</code>ï¼Œè¿™æ ·å°±å¯ä»¥é€ æˆä¸€ä¸ªå‡è±¡ï¼šè¿™ä¸ªäº‹åŠ¡çœ‹èµ·æ¥ä»€ä¹ˆéƒ½æ²¡åšï¼Œæ‰€ä»¥ç¬¦åˆ<code>åŸå­æ€§</code>è¦æ±‚ã€‚</p><h5 id="2-2-Undoæ—¥å¿—çš„ä½œç”¨"><a href="#2-2-Undoæ—¥å¿—çš„ä½œç”¨" class="headerlink" title="2.2 Undoæ—¥å¿—çš„ä½œç”¨"></a><strong>2.2 Undoæ—¥å¿—çš„ä½œç”¨</strong></h5><ul><li><strong>ä½œç”¨1ï¼šå›æ»šæ•°æ®</strong></li><li><strong>ä½œç”¨2ï¼šMVCCï¼ˆè¯¦æƒ…çœ‹ç¬¬16ç« ï¼‰</strong></li></ul><h5 id="2-3-undoçš„å­˜å‚¨ç»“æ„"><a href="#2-3-undoçš„å­˜å‚¨ç»“æ„" class="headerlink" title="2.3 undoçš„å­˜å‚¨ç»“æ„"></a><strong>2.3 undoçš„å­˜å‚¨ç»“æ„</strong></h5><p><strong>1.</strong> <strong>å›æ»šæ®µä¸undoé¡µ</strong></p><p>InnoDBå¯¹undo logçš„ç®¡ç†é‡‡ç”¨æ®µçš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯<code>å›æ»šæ®µï¼ˆrollback segmentï¼‰</code>ã€‚æ¯ä¸ªå›æ»šæ®µè®°å½•äº†<code>1024</code>ä¸ª<code>undo log segment</code>ï¼Œè€Œåœ¨æ¯ä¸ªundo log segmentæ®µä¸­è¿›è¡Œ<code>undoé¡µ</code>çš„ç”³è¯·ã€‚</p><p><strong>2.</strong> <strong>å›æ»šæ®µä¸äº‹åŠ¡</strong> </p><ol><li><p>æ¯ä¸ªäº‹åŠ¡åªä¼šä½¿ç”¨ä¸€ä¸ªå›æ»šæ®µï¼Œä¸€ä¸ªå›æ»šæ®µåœ¨åŒä¸€æ—¶åˆ»å¯èƒ½ä¼šæœåŠ¡äºå¤šä¸ªäº‹åŠ¡ã€‚</p></li><li><p>å½“ä¸€ä¸ªäº‹åŠ¡å¼€å§‹çš„æ—¶å€™ï¼Œä¼šåˆ¶å®šä¸€ä¸ªå›æ»šæ®µï¼Œåœ¨äº‹åŠ¡è¿›è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼ŒåŸå§‹çš„æ•°æ®ä¼šè¢«å¤åˆ¶åˆ°å›æ»šæ®µã€‚</p></li><li><p>åœ¨å›æ»šæ®µä¸­ï¼Œäº‹åŠ¡ä¼šä¸æ–­å¡«å……ç›˜åŒºï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæˆ–æ‰€æœ‰çš„ç©ºé—´è¢«ç”¨å®Œã€‚å¦‚æœå½“å‰çš„ç›˜åŒºä¸å¤Ÿç”¨ï¼Œäº‹åŠ¡ä¼šåœ¨æ®µä¸­è¯·æ±‚æ‰©å±•ä¸‹ä¸€ä¸ªç›˜åŒºï¼Œå¦‚æœæ‰€æœ‰å·²åˆ†é…çš„ç›˜åŒºéƒ½è¢«ç”¨å®Œï¼Œäº‹åŠ¡ä¼šè¦†ç›–æœ€åˆçš„ç›˜åŒºæˆ–è€…åœ¨å›æ»šæ®µå…è®¸çš„æƒ…å†µä¸‹æ‰©å±•æ–°çš„ç›˜åŒºæ¥ä½¿ç”¨ã€‚</p></li><li><p>å›æ»šæ®µå­˜åœ¨äºundoè¡¨ç©ºé—´ä¸­ï¼Œåœ¨æ•°æ®åº“ä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªundoè¡¨ç©ºé—´ï¼Œä½†åŒä¸€æ—¶åˆ»åªèƒ½ä½¿ç”¨ä¸€ä¸ªundoè¡¨ç©ºé—´ã€‚</p></li><li><p>å½“äº‹åŠ¡æäº¤æ—¶ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¼šåšä»¥ä¸‹ä¸¤ä»¶äº‹æƒ…ï¼š</p><ul><li>å°†undo logæ”¾å…¥åˆ—è¡¨ä¸­ï¼Œä»¥ä¾›ä¹‹åçš„purgeæ“ä½œ</li><li>åˆ¤æ–­undo logæ‰€åœ¨çš„é¡µæ˜¯å¦å¯ä»¥é‡ç”¨ï¼Œè‹¥å¯ä»¥åˆ†é…ç»™ä¸‹ä¸ªäº‹åŠ¡ä½¿ç”¨</li></ul></li></ol><p><strong>3.</strong> <strong>å›æ»šæ®µä¸­çš„æ•°æ®åˆ†ç±»</strong></p><ol><li><p>æœªæäº¤çš„å›æ»šæ•°æ®(uncommitted undo information) </p></li><li><p>å·²ç»æäº¤ä½†æœªè¿‡æœŸçš„å›æ»šæ•°æ®(committed undo information) </p></li><li><p>äº‹åŠ¡å·²ç»æäº¤å¹¶è¿‡æœŸçš„æ•°æ®(expired undo information)</p></li></ol><h5 id="2-4-undoçš„ç±»å‹"><a href="#2-4-undoçš„ç±»å‹" class="headerlink" title="2.4 undoçš„ç±»å‹"></a><strong>2.4 undoçš„ç±»å‹</strong></h5><p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œundo logåˆ†ä¸ºï¼š</p><ul><li>insert undo log </li><li>update undo log</li></ul><h5 id="2-5-undo-logçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#2-5-undo-logçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="2.5 undo logçš„ç”Ÿå‘½å‘¨æœŸ"></a><strong>2.5 undo logçš„ç”Ÿå‘½å‘¨æœŸ</strong></h5><p><strong>1.</strong> <strong>ç®€è¦ç”Ÿæˆè¿‡ç¨‹</strong></p><p><strong>åªæœ‰Buffer Poolçš„æµç¨‹ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204040937761.png" alt="image-20220404093706650"></p><p><strong>æœ‰äº†Redo Logå’ŒUndo Logä¹‹åï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204040938657.png" alt="image-20220404093832512"></p><p><strong>2.</strong> <strong>è¯¦ç»†ç”Ÿæˆè¿‡ç¨‹</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204040939231.png" alt="image-20220404093950136"></p><p><strong>å½“æˆ‘ä»¬æ‰§è¡ŒINSERTæ—¶ï¼š</strong></p><pre><code class="mysql">begin; INSERT INTO user (name) VALUES (&quot;tom&quot;);</code></pre><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204040940543.png" alt="image-20220404094033441"></p><p><strong>å½“æˆ‘ä»¬æ‰§è¡ŒUPDATEæ—¶ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204040941624.png" alt="image-20220404094105525"></p><pre><code class="mysql">UPDATE user SET id=2 WHERE id=1;</code></pre><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204040941449.png" alt="image-20220404094142337"></p><p><strong>3. undo logæ˜¯å¦‚ä½•å›æ»šçš„</strong></p><p>ä»¥ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œå‡è®¾æ‰§è¡Œrollbackï¼Œé‚£ä¹ˆå¯¹åº”çš„æµç¨‹åº”è¯¥æ˜¯è¿™æ ·ï¼š</p><ol><li><p>é€šè¿‡undo no&#x3D;3çš„æ—¥å¿—æŠŠid&#x3D;2çš„æ•°æ®åˆ é™¤</p></li><li><p>é€šè¿‡undo no&#x3D;2çš„æ—¥å¿—æŠŠid&#x3D;1çš„æ•°æ®çš„deletemarkè¿˜åŸæˆ0 </p></li><li><p>é€šè¿‡undo no&#x3D;1çš„æ—¥å¿—æŠŠid&#x3D;1çš„æ•°æ®çš„nameè¿˜åŸæˆTom </p></li><li><p>é€šè¿‡undo no&#x3D;0çš„æ—¥å¿—æŠŠid&#x3D;1çš„æ•°æ®åˆ é™¤</p></li></ol><p><strong>4. undo logçš„åˆ é™¤</strong></p><ul><li>é’ˆå¯¹äºinsert undo log</li></ul><p>å› ä¸ºinsertæ“ä½œçš„è®°å½•ï¼Œåªå¯¹äº‹åŠ¡æœ¬èº«å¯è§ï¼Œå¯¹å…¶ä»–äº‹åŠ¡ä¸å¯è§ã€‚æ•…è¯¥undo logå¯ä»¥åœ¨äº‹åŠ¡æäº¤åç›´æ¥åˆ é™¤ï¼Œä¸éœ€è¦è¿›è¡Œpurgeæ“ä½œã€‚</p><ul><li>é’ˆå¯¹äºupdate undo log</li></ul><p>è¯¥undo logå¯èƒ½éœ€è¦æä¾›MVCCæœºåˆ¶ï¼Œå› æ­¤ä¸èƒ½åœ¨äº‹åŠ¡æäº¤æ—¶å°±è¿›è¡Œåˆ é™¤ã€‚æäº¤æ—¶æ”¾å…¥undo logé“¾è¡¨ï¼Œç­‰å¾…purgeçº¿ç¨‹è¿›è¡Œæœ€åçš„åˆ é™¤ã€‚</p><h5 id="2-6-å°ç»“"><a href="#2-6-å°ç»“" class="headerlink" title="2.6 å°ç»“"></a><strong>2.6</strong> <strong>å°ç»“</strong></h5><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204040944948.png" alt="image-20220404094436830"></p><p>undo logæ˜¯é€»è¾‘æ—¥å¿—ï¼Œå¯¹äº‹åŠ¡å›æ»šæ—¶ï¼Œåªæ˜¯å°†æ•°æ®åº“é€»è¾‘åœ°æ¢å¤åˆ°åŸæ¥çš„æ ·å­ã€‚</p><p>redo logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯æ•°æ®é¡µçš„ç‰©ç†å˜åŒ–ï¼Œundo logä¸æ˜¯redo logçš„é€†è¿‡ç¨‹ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬16ç«  å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</title>
      <link href="/2023/07/15/%E7%AC%AC16%E7%AB%A0%20%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/"/>
      <url>/2023/07/15/%E7%AC%AC16%E7%AB%A0%20%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬16ç« -å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶"><a href="#ç¬¬16ç« -å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶" class="headerlink" title="ç¬¬16ç«  å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶"></a>ç¬¬16ç«  å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</h3><h4 id="1-ä»€ä¹ˆæ˜¯MVCC"><a href="#1-ä»€ä¹ˆæ˜¯MVCC" class="headerlink" title="1. ä»€ä¹ˆæ˜¯MVCC"></a><strong>1.</strong> <strong>ä»€ä¹ˆæ˜¯MVCC</strong></h4><p>MVCC ï¼ˆMultiversion Concurrency Controlï¼‰ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚é¡¾åæ€ä¹‰ï¼ŒMVCC æ˜¯é€šè¿‡æ•°æ®è¡Œçš„å¤šä¸ªç‰ˆæœ¬ç®¡ç†æ¥å®ç°æ•°æ®åº“çš„<code>å¹¶å‘æ§åˆ¶</code>ã€‚è¿™é¡¹æŠ€æœ¯ä½¿å¾—åœ¨InnoDBçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹æ‰§è¡Œ<code>ä¸€è‡´æ€§è¯»</code>æ“ä½œæœ‰äº†ä¿è¯ã€‚æ¢è¨€ä¹‹ï¼Œå°±æ˜¯ä¸ºäº†æŸ¥è¯¢ä¸€äº›æ­£åœ¨è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ›´æ–°çš„è¡Œï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°å®ƒä»¬è¢«æ›´æ–°ä¹‹å‰çš„å€¼ï¼Œè¿™æ ·åœ¨åšæŸ¥è¯¢çš„æ—¶å€™å°±ä¸ç”¨ç­‰å¾…å¦ä¸€ä¸ªäº‹åŠ¡é‡Šæ”¾é”ã€‚</p><h4 id="2-å¿«ç…§è¯»ä¸å½“å‰è¯»"><a href="#2-å¿«ç…§è¯»ä¸å½“å‰è¯»" class="headerlink" title="2. å¿«ç…§è¯»ä¸å½“å‰è¯»"></a><strong>2.</strong> <strong>å¿«ç…§è¯»ä¸å½“å‰è¯»</strong></h4><p>MVCCåœ¨MySQL InnoDBä¸­çš„å®ç°ä¸»è¦æ˜¯ä¸ºäº†æé«˜æ•°æ®åº“å¹¶å‘æ€§èƒ½ï¼Œç”¨æ›´å¥½çš„æ–¹å¼å»å¤„ç†<code>è¯»-å†™å†²çª</code>ï¼Œåšåˆ°å³ä½¿æœ‰è¯»å†™å†²çªæ—¶ï¼Œä¹Ÿèƒ½åšåˆ°<code>ä¸åŠ é”</code>ï¼Œ<code>éé˜»å¡å¹¶å‘è¯»</code>ï¼Œè€Œè¿™ä¸ªè¯»æŒ‡çš„å°±æ˜¯<code>å¿«ç…§è¯»</code>, è€Œé<code>å½“å‰è¯»</code>ã€‚å½“å‰è¯»å®é™…ä¸Šæ˜¯ä¸€ç§åŠ é”çš„æ“ä½œï¼Œæ˜¯æ‚²è§‚é”çš„å®ç°ã€‚è€ŒMVCCæœ¬è´¨æ˜¯é‡‡ç”¨ä¹è§‚é”æ€æƒ³çš„ä¸€ç§æ–¹å¼ã€‚</p><h5 id="2-1-å¿«ç…§è¯»"><a href="#2-1-å¿«ç…§è¯»" class="headerlink" title="2.1 å¿«ç…§è¯»"></a><strong>2.1</strong> <strong>å¿«ç…§è¯»</strong></h5><p>å¿«ç…§è¯»åˆå«ä¸€è‡´æ€§è¯»ï¼Œè¯»å–çš„æ˜¯å¿«ç…§æ•°æ®ã€‚<strong>ä¸åŠ é”çš„ç®€å•çš„</strong> <strong>SELECT</strong> <strong>éƒ½å±äºå¿«ç…§è¯»</strong>ï¼Œå³ä¸åŠ é”çš„éé˜»å¡è¯»ã€‚</p><p>ä¹‹æ‰€ä»¥å‡ºç°å¿«ç…§è¯»çš„æƒ…å†µï¼Œæ˜¯åŸºäºæé«˜å¹¶å‘æ€§èƒ½çš„è€ƒè™‘ï¼Œå¿«ç…§è¯»çš„å®ç°æ˜¯åŸºäºMVCCï¼Œå®ƒåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œé¿å…äº†åŠ é”æ“ä½œï¼Œé™ä½äº†å¼€é”€ã€‚</p><p>æ—¢ç„¶æ˜¯åŸºäºå¤šç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¿«ç…§è¯»å¯èƒ½è¯»åˆ°çš„å¹¶ä¸ä¸€å®šæ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œæœ‰å¯èƒ½æ˜¯ä¹‹å‰çš„å†å²ç‰ˆæœ¬ã€‚</p><p>å¿«ç…§è¯»çš„å‰ææ˜¯éš”ç¦»çº§åˆ«ä¸æ˜¯ä¸²è¡Œçº§åˆ«ï¼Œä¸²è¡Œçº§åˆ«ä¸‹çš„å¿«ç…§è¯»ä¼šé€€åŒ–æˆå½“å‰è¯»ã€‚</p><h5 id="2-2-å½“å‰è¯»"><a href="#2-2-å½“å‰è¯»" class="headerlink" title="2.2 å½“å‰è¯»"></a><strong>2.2</strong> <strong>å½“å‰è¯»</strong></h5><p>å½“å‰è¯»è¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆæœ€æ–°æ•°æ®ï¼Œè€Œä¸æ˜¯å†å²ç‰ˆæœ¬çš„æ•°æ®ï¼‰ï¼Œè¯»å–æ—¶è¿˜è¦ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•ï¼Œä¼šå¯¹è¯»å–çš„è®°å½•è¿›è¡ŒåŠ é”ã€‚åŠ é”çš„ SELECTï¼Œæˆ–è€…å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹éƒ½ä¼šè¿›è¡Œå½“å‰è¯»ã€‚</p><h4 id="3-å¤ä¹ "><a href="#3-å¤ä¹ " class="headerlink" title="3. å¤ä¹ "></a><strong>3.</strong> <strong>å¤ä¹ </strong></h4><h5 id="3-1-å†è°ˆéš”ç¦»çº§åˆ«"><a href="#3-1-å†è°ˆéš”ç¦»çº§åˆ«" class="headerlink" title="3.1 å†è°ˆéš”ç¦»çº§åˆ«"></a><strong>3.1</strong> <strong>å†è°ˆéš”ç¦»çº§åˆ«</strong></h5><p>æˆ‘ä»¬çŸ¥é“äº‹åŠ¡æœ‰ 4 ä¸ªéš”ç¦»çº§åˆ«ï¼Œå¯èƒ½å­˜åœ¨ä¸‰ç§å¹¶å‘é—®é¢˜ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051536648.png" alt="image-20220405153617536"></p><p>å¦å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051536125.png" alt="image-20220405153632021"></p><h5 id="3-2-éšè—å­—æ®µã€Undo-Logç‰ˆæœ¬é“¾"><a href="#3-2-éšè—å­—æ®µã€Undo-Logç‰ˆæœ¬é“¾" class="headerlink" title="3.2 éšè—å­—æ®µã€Undo Logç‰ˆæœ¬é“¾"></a><strong>3.2</strong> <strong>éšè—å­—æ®µã€Undo Logç‰ˆæœ¬é“¾</strong></h5><p>å›é¡¾ä¸€ä¸‹undoæ—¥å¿—çš„ç‰ˆæœ¬é“¾ï¼Œå¯¹äºä½¿ç”¨<code>InnoDB</code>å­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œå®ƒçš„èšç°‡ç´¢å¼•è®°å½•ä¸­éƒ½åŒ…å«ä¸¤ä¸ªå¿…è¦çš„éšè—åˆ—ã€‚</p><ul><li><code>trx_id</code>ï¼šæ¯æ¬¡ä¸€ä¸ªäº‹åŠ¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠè¯¥äº‹åŠ¡çš„<code>äº‹åŠ¡id</code>èµ‹å€¼ç»™trx_id éšè—åˆ—ã€‚</li><li><code>roll_pointer</code>ï¼šæ¯æ¬¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§çš„ç‰ˆæœ¬å†™å…¥åˆ° undoæ—¥å¿— ä¸­ï¼Œç„¶åè¿™ä¸ªéšè—åˆ—å°±ç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥æ‰¾åˆ°è¯¥è®°å½•ä¿®æ”¹å‰çš„ä¿¡æ¯ã€‚</li></ul><h4 id="4-MVCCå®ç°åŸç†ä¹‹ReadView"><a href="#4-MVCCå®ç°åŸç†ä¹‹ReadView" class="headerlink" title="4. MVCCå®ç°åŸç†ä¹‹ReadView"></a><strong>4. MVCCå®ç°åŸç†ä¹‹ReadView</strong></h4><p>MVCC çš„å®ç°ä¾èµ–äºï¼š<strong>éšè—å­—æ®µã€Undo Logã€Read View</strong>ã€‚</p><h5 id="4-1-ä»€ä¹ˆæ˜¯ReadView"><a href="#4-1-ä»€ä¹ˆæ˜¯ReadView" class="headerlink" title="4.1 ä»€ä¹ˆæ˜¯ReadView"></a><strong>4.1</strong> <strong>ä»€ä¹ˆæ˜¯ReadView</strong></h5><p>ReadViewå°±æ˜¯äº‹åŠ¡åœ¨ä½¿ç”¨MVCCæœºåˆ¶è¿›è¡Œå¿«ç…§è¯»æ“ä½œæ—¶äº§ç”Ÿçš„è¯»è§†å›¾ã€‚å½“äº‹åŠ¡å¯åŠ¨æ—¶ï¼Œä¼šç”Ÿæˆæ•°æ®åº“ç³»ç»Ÿå½“å‰çš„ä¸€ä¸ªå¿«ç…§ï¼ŒInnoDBä¸ºæ¯ä¸ªäº‹åŠ¡æ„é€ äº†ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥è®°å½•å¹¶ç»´æŠ¤ç³»ç»Ÿå½“å‰<code>æ´»è·ƒäº‹åŠ¡</code>çš„IDï¼ˆâ€œæ´»è·ƒâ€æŒ‡çš„å°±æ˜¯ï¼Œå¯åŠ¨äº†ä½†è¿˜æ²¡æäº¤ï¼‰ã€‚</p><h5 id="4-2-è®¾è®¡æ€è·¯"><a href="#4-2-è®¾è®¡æ€è·¯" class="headerlink" title="4.2 è®¾è®¡æ€è·¯"></a><strong>4.2</strong> <strong>è®¾è®¡æ€è·¯</strong></h5><p>ä½¿ç”¨<code>READ UNCOMMITTED</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ï¼Œç”±äºå¯ä»¥è¯»åˆ°æœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œæ‰€ä»¥ç›´æ¥è¯»å–è®°å½•çš„æœ€æ–°ç‰ˆæœ¬å°±å¥½äº†ã€‚</p><p>ä½¿ç”¨<code>SERIALIZABLE</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ï¼ŒInnoDBè§„å®šä½¿ç”¨åŠ é”çš„æ–¹å¼æ¥è®¿é—®è®°å½•ã€‚</p><p>ä½¿ç”¨<code>READ COMMITTED</code>å’Œ<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ï¼Œéƒ½å¿…é¡»ä¿è¯è¯»åˆ°<code>å·²ç»æäº¤äº†çš„</code>äº‹åŠ¡ä¿®æ”¹è¿‡çš„è®°å½•ã€‚å‡å¦‚å¦ä¸€ä¸ªäº‹åŠ¡å·²ç»ä¿®æ”¹äº†è®°å½•ä½†æ˜¯å°šæœªæäº¤ï¼Œæ˜¯ä¸èƒ½ç›´æ¥è¯»å–æœ€æ–°ç‰ˆæœ¬çš„è®°å½•çš„ï¼Œæ ¸å¿ƒé—®é¢˜å°±æ˜¯éœ€è¦åˆ¤æ–­ä¸€ä¸‹ç‰ˆæœ¬é“¾ä¸­çš„å“ªä¸ªç‰ˆæœ¬æ˜¯å½“å‰äº‹åŠ¡å¯è§çš„ï¼Œè¿™æ˜¯ReadViewè¦è§£å†³çš„ä¸»è¦é—®é¢˜ã€‚</p><p>è¿™ä¸ªReadViewä¸­ä¸»è¦åŒ…å«4ä¸ªæ¯”è¾ƒé‡è¦çš„å†…å®¹ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><ol><li><code>creator_trx_id</code>ï¼Œåˆ›å»ºè¿™ä¸ª Read View çš„äº‹åŠ¡ IDã€‚</li></ol><blockquote><p>è¯´æ˜ï¼šåªæœ‰åœ¨å¯¹è¡¨ä¸­çš„è®°å½•åšæ”¹åŠ¨æ—¶ï¼ˆæ‰§è¡ŒINSERTã€DELETEã€UPDATEè¿™äº›è¯­å¥æ—¶ï¼‰æ‰ä¼šä¸ºäº‹åŠ¡åˆ†é…äº‹åŠ¡idï¼Œå¦åˆ™åœ¨ä¸€ä¸ªåªè¯»äº‹åŠ¡ä¸­çš„äº‹åŠ¡idå€¼éƒ½é»˜è®¤ä¸º0ã€‚ </p></blockquote><ol start="2"><li><p><code>trx_ids</code>ï¼Œè¡¨ç¤ºåœ¨ç”ŸæˆReadViewæ—¶å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„è¯»å†™äº‹åŠ¡çš„<code>äº‹åŠ¡idåˆ—è¡¨</code>ã€‚ </p></li><li><p><code>up_limit_id</code>ï¼Œæ´»è·ƒçš„äº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡ IDã€‚ </p></li><li><p><code>low_limit_id</code>ï¼Œè¡¨ç¤ºç”ŸæˆReadViewæ—¶ç³»ç»Ÿä¸­åº”è¯¥åˆ†é…ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„<code>id</code>å€¼ã€‚low_limit_id æ˜¯ç³»ç»Ÿæœ€å¤§çš„äº‹åŠ¡idå€¼ï¼Œè¿™é‡Œè¦æ³¨æ„æ˜¯ç³»ç»Ÿä¸­çš„äº‹åŠ¡idï¼Œéœ€è¦åŒºåˆ«äºæ­£åœ¨æ´»è·ƒçš„äº‹åŠ¡IDã€‚</p></li></ol><blockquote><p>æ³¨æ„ï¼šlow_limit_idå¹¶ä¸æ˜¯trx_idsä¸­çš„æœ€å¤§å€¼ï¼Œäº‹åŠ¡idæ˜¯é€’å¢åˆ†é…çš„ã€‚æ¯”å¦‚ï¼Œç°åœ¨æœ‰idä¸º1ï¼Œ 2ï¼Œ3è¿™ä¸‰ä¸ªäº‹åŠ¡ï¼Œä¹‹åidä¸º3çš„äº‹åŠ¡æäº¤äº†ã€‚é‚£ä¹ˆä¸€ä¸ªæ–°çš„è¯»äº‹åŠ¡åœ¨ç”ŸæˆReadViewæ—¶ï¼Œtrx_idså°±åŒ…æ‹¬1å’Œ2ï¼Œup_limit_idçš„å€¼å°±æ˜¯1ï¼Œlow_limit_idçš„å€¼å°±æ˜¯4ã€‚</p></blockquote><h5 id="4-3-ReadViewçš„è§„åˆ™"><a href="#4-3-ReadViewçš„è§„åˆ™" class="headerlink" title="4.3 ReadViewçš„è§„åˆ™"></a><strong>4.3 ReadViewçš„è§„åˆ™</strong></h5><p>æœ‰äº†è¿™ä¸ªReadViewï¼Œè¿™æ ·åœ¨è®¿é—®æŸæ¡è®°å½•æ—¶ï¼Œåªéœ€è¦æŒ‰ç…§ä¸‹è¾¹çš„æ­¥éª¤åˆ¤æ–­è®°å½•çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è§ã€‚</p><ul><li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼ä¸ReadViewä¸­çš„<code>creator_trx_id</code>å€¼ç›¸åŒï¼Œæ„å‘³ç€å½“å‰äº‹åŠ¡åœ¨è®¿é—®å®ƒè‡ªå·±ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚</li><li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼å°äºReadViewä¸­çš„<code>up_limit_id</code>å€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”ŸæˆReadViewå‰å·²ç»æäº¤ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚</li><li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼å¤§äºæˆ–ç­‰äºReadViewä¸­çš„<code>low_limit_id</code>å€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”ŸæˆReadViewåæ‰å¼€å¯ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚</li><li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼åœ¨ReadViewçš„<code>up_limit_id</code>å’Œ<code>low_limit_id</code>ä¹‹é—´ï¼Œé‚£å°±éœ€è¦åˆ¤æ–­ä¸€ä¸‹trx_idå±æ€§å€¼æ˜¯ä¸æ˜¯åœ¨ trx_ids åˆ—è¡¨ä¸­ã€‚<ul><li>å¦‚æœåœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡è¿˜æ˜¯æ´»è·ƒçš„ï¼Œè¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«è®¿é—®ã€‚</li><li>å¦‚æœä¸åœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œè¯¥ç‰ˆæœ¬å¯ä»¥è¢«è®¿é—®ã€‚</li></ul></li></ul><h5 id="4-4-MVCCæ•´ä½“æ“ä½œæµç¨‹"><a href="#4-4-MVCCæ•´ä½“æ“ä½œæµç¨‹" class="headerlink" title="4.4 MVCCæ•´ä½“æ“ä½œæµç¨‹"></a><strong>4.4 MVCCæ•´ä½“æ“ä½œæµç¨‹</strong></h5><p>äº†è§£äº†è¿™äº›æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å½“æŸ¥è¯¢ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œç³»ç»Ÿå¦‚ä½•é€šè¿‡MVCCæ‰¾åˆ°å®ƒï¼š</p><ol><li><p>é¦–å…ˆè·å–äº‹åŠ¡è‡ªå·±çš„ç‰ˆæœ¬å·ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡ IDï¼› </p></li><li><p>è·å– ReadViewï¼› </p></li><li><p>æŸ¥è¯¢å¾—åˆ°çš„æ•°æ®ï¼Œç„¶åä¸ ReadView ä¸­çš„äº‹åŠ¡ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒï¼›</p></li><li><p>å¦‚æœä¸ç¬¦åˆ ReadView è§„åˆ™ï¼Œå°±éœ€è¦ä» Undo Log ä¸­è·å–å†å²å¿«ç…§ï¼›</p></li><li><p>æœ€åè¿”å›ç¬¦åˆè§„åˆ™çš„æ•°æ®ã€‚</p></li></ol><p>åœ¨éš”ç¦»çº§åˆ«ä¸ºè¯»å·²æäº¤ï¼ˆRead Committedï¼‰æ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ¯ä¸€æ¬¡ SELECT æŸ¥è¯¢éƒ½ä¼šé‡æ–°è·å–ä¸€æ¬¡Read Viewã€‚</p><p>å¦‚è¡¨æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051549618.png" alt="image-20220405154948505"></p><blockquote><p>æ³¨æ„ï¼Œæ­¤æ—¶åŒæ ·çš„æŸ¥è¯¢è¯­å¥éƒ½ä¼šé‡æ–°è·å–ä¸€æ¬¡ Read Viewï¼Œè¿™æ—¶å¦‚æœ Read View ä¸åŒï¼Œå°±å¯èƒ½äº§ç”Ÿä¸å¯é‡å¤è¯»æˆ–è€…å¹»è¯»çš„æƒ…å†µã€‚</p></blockquote><p>å½“éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»çš„æ—¶å€™ï¼Œå°±é¿å…äº†ä¸å¯é‡å¤è¯»ï¼Œè¿™æ˜¯å› ä¸ºä¸€ä¸ªäº‹åŠ¡åªåœ¨ç¬¬ä¸€æ¬¡ SELECT çš„æ—¶å€™ä¼šè·å–ä¸€æ¬¡ Read Viewï¼Œè€Œåé¢æ‰€æœ‰çš„ SELECT éƒ½ä¼šå¤ç”¨è¿™ä¸ª Read Viewï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051550072.png" alt="image-20220405155041964"></p><h4 id="5-ä¸¾ä¾‹è¯´æ˜"><a href="#5-ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="5. ä¸¾ä¾‹è¯´æ˜"></a><strong>5.</strong> <strong>ä¸¾ä¾‹è¯´æ˜</strong></h4><h5 id="5-1-READ-COMMITTEDéš”ç¦»çº§åˆ«ä¸‹"><a href="#5-1-READ-COMMITTEDéš”ç¦»çº§åˆ«ä¸‹" class="headerlink" title="5.1 READ COMMITTEDéš”ç¦»çº§åˆ«ä¸‹"></a><strong>5.1 READ COMMITTEDéš”ç¦»çº§åˆ«ä¸‹</strong></h5><p><strong>READ COMMITTED</strong> <strong>ï¼šæ¯æ¬¡è¯»å–æ•°æ®å‰éƒ½ç”Ÿæˆä¸€ä¸ªReadView</strong>ã€‚</p><h5 id="5-2-REPEATABLE-READéš”ç¦»çº§åˆ«ä¸‹"><a href="#5-2-REPEATABLE-READéš”ç¦»çº§åˆ«ä¸‹" class="headerlink" title="5.2 REPEATABLE READéš”ç¦»çº§åˆ«ä¸‹"></a><strong>5.2 REPEATABLE READéš”ç¦»çº§åˆ«ä¸‹</strong></h5><p>ä½¿ç”¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œåªä¼šåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡ŒæŸ¥è¯¢è¯­å¥æ—¶ç”Ÿæˆä¸€ä¸ª ReadView ï¼Œä¹‹åçš„æŸ¥è¯¢å°±ä¸ä¼šé‡å¤ç”Ÿæˆäº†ã€‚</p><h5 id="5-3-å¦‚ä½•è§£å†³å¹»è¯»"><a href="#5-3-å¦‚ä½•è§£å†³å¹»è¯»" class="headerlink" title="5.3 å¦‚ä½•è§£å†³å¹»è¯»"></a><strong>5.3</strong> <strong>å¦‚ä½•è§£å†³å¹»è¯»</strong></h5><p>å‡è®¾ç°åœ¨è¡¨ student ä¸­åªæœ‰ä¸€æ¡æ•°æ®ï¼Œæ•°æ®å†…å®¹ä¸­ï¼Œä¸»é”® id&#x3D;1ï¼Œéšè—çš„ trx_id&#x3D;10ï¼Œå®ƒçš„ undo log å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051556631.png" alt="image-20220405155640520"></p><p>å‡è®¾ç°åœ¨æœ‰äº‹åŠ¡ A å’Œäº‹åŠ¡ B å¹¶å‘æ‰§è¡Œï¼Œ<code>äº‹åŠ¡ A</code>çš„äº‹åŠ¡ id ä¸º<code>20</code>ï¼Œ<code>äº‹åŠ¡ B</code>çš„äº‹åŠ¡ id ä¸º<code>30</code>ã€‚</p><p>æ­¥éª¤1ï¼šäº‹åŠ¡ A å¼€å§‹ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ•°æ®ï¼ŒæŸ¥è¯¢çš„ SQL è¯­å¥å¦‚ä¸‹ã€‚</p><pre><code class="mysql">select * from student where id &gt;= 1;</code></pre><p>åœ¨å¼€å§‹æŸ¥è¯¢ä¹‹å‰ï¼ŒMySQL ä¼šä¸ºäº‹åŠ¡ A äº§ç”Ÿä¸€ä¸ª ReadViewï¼Œæ­¤æ—¶ ReadView çš„å†…å®¹å¦‚ä¸‹ï¼š<code>trx_ids= [20,30]</code>ï¼Œ<code>up_limit_id=20</code>ï¼Œ<code>low_limit_id=31</code>ï¼Œ<code>creator_trx_id=20</code>ã€‚</p><p>ç”±äºæ­¤æ—¶è¡¨ student ä¸­åªæœ‰ä¸€æ¡æ•°æ®ï¼Œä¸”ç¬¦åˆ where id&gt;&#x3D;1 æ¡ä»¶ï¼Œå› æ­¤ä¼šæŸ¥è¯¢å‡ºæ¥ã€‚ç„¶åæ ¹æ® ReadViewæœºåˆ¶ï¼Œå‘ç°è¯¥è¡Œæ•°æ®çš„trx_id&#x3D;10ï¼Œå°äºäº‹åŠ¡ A çš„ ReadView é‡Œ up_limit_idï¼Œè¿™è¡¨ç¤ºè¿™æ¡æ•°æ®æ˜¯äº‹åŠ¡ A å¼€å¯ä¹‹å‰ï¼Œå…¶ä»–äº‹åŠ¡å°±å·²ç»æäº¤äº†çš„æ•°æ®ï¼Œå› æ­¤äº‹åŠ¡ A å¯ä»¥è¯»å–åˆ°ã€‚</p><p>ç»“è®ºï¼šäº‹åŠ¡ A çš„ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œèƒ½è¯»å–åˆ°ä¸€æ¡æ•°æ®ï¼Œid&#x3D;1ã€‚</p><p>æ­¥éª¤2ï¼šæ¥ç€äº‹åŠ¡ B(trx_id&#x3D;30)ï¼Œå¾€è¡¨ student ä¸­æ–°æ’å…¥ä¸¤æ¡æ•°æ®ï¼Œå¹¶æäº¤äº‹åŠ¡ã€‚</p><pre><code class="mysql">insert into student(id,name) values(2,&#39;æå››&#39;); insert into student(id,name) values(3,&#39;ç‹äº”&#39;);</code></pre><p>æ­¤æ—¶è¡¨student ä¸­å°±æœ‰ä¸‰æ¡æ•°æ®äº†ï¼Œå¯¹åº”çš„ undo å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051559345.png" alt="image-20220405155909223"></p><p>æ­¥éª¤3ï¼šæ¥ç€äº‹åŠ¡ A å¼€å¯ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œæ ¹æ®å¯é‡å¤è¯»éš”ç¦»çº§åˆ«çš„è§„åˆ™ï¼Œæ­¤æ—¶äº‹åŠ¡ A å¹¶ä¸ä¼šå†é‡æ–°ç”ŸæˆReadViewã€‚æ­¤æ—¶è¡¨ student ä¸­çš„ 3 æ¡æ•°æ®éƒ½æ»¡è¶³ where id&gt;&#x3D;1 çš„æ¡ä»¶ï¼Œå› æ­¤ä¼šå…ˆæŸ¥å‡ºæ¥ã€‚ç„¶åæ ¹æ®ReadView æœºåˆ¶ï¼Œåˆ¤æ–­æ¯æ¡æ•°æ®æ˜¯ä¸æ˜¯éƒ½å¯ä»¥è¢«äº‹åŠ¡ A çœ‹åˆ°ã€‚</p><p>1ï¼‰é¦–å…ˆ id&#x3D;1 çš„è¿™æ¡æ•°æ®ï¼Œå‰é¢å·²ç»è¯´è¿‡äº†ï¼Œå¯ä»¥è¢«äº‹åŠ¡ A çœ‹åˆ°ã€‚</p><p>2ï¼‰ç„¶åæ˜¯ id&#x3D;2 çš„æ•°æ®ï¼Œå®ƒçš„ trx_id&#x3D;30ï¼Œæ­¤æ—¶äº‹åŠ¡ A å‘ç°ï¼Œè¿™ä¸ªå€¼å¤„äº up_limit_id å’Œ low_limit_id ä¹‹é—´ï¼Œå› æ­¤è¿˜éœ€è¦å†åˆ¤æ–­ 30 æ˜¯å¦å¤„äº trx_ids æ•°ç»„å†…ã€‚ç”±äºäº‹åŠ¡ A çš„ trx_ids&#x3D;[20,30]ï¼Œå› æ­¤åœ¨æ•°ç»„å†…ï¼Œè¿™è¡¨ç¤º id&#x3D;2 çš„è¿™æ¡æ•°æ®æ˜¯ä¸äº‹åŠ¡ A åœ¨åŒä¸€æ—¶åˆ»å¯åŠ¨çš„å…¶ä»–äº‹åŠ¡æäº¤çš„ï¼Œæ‰€ä»¥è¿™æ¡æ•°æ®ä¸èƒ½è®©äº‹åŠ¡ A çœ‹åˆ°ã€‚</p><p>3ï¼‰åŒç†ï¼Œid&#x3D;3 çš„è¿™æ¡æ•°æ®ï¼Œtrx_id ä¹Ÿä¸º 30ï¼Œå› æ­¤ä¹Ÿä¸èƒ½è¢«äº‹åŠ¡ A çœ‹è§ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051559867.png" alt="image-20220405155941753"></p><p>ç»“è®ºï¼šæœ€ç»ˆäº‹åŠ¡ A çš„ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œåªèƒ½æŸ¥è¯¢å‡º id&#x3D;1 çš„è¿™æ¡æ•°æ®ã€‚è¿™å’Œäº‹åŠ¡ A çš„ç¬¬ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤æ²¡æœ‰å‡ºç°å¹»è¯»ç°è±¡ï¼Œæ‰€ä»¥è¯´åœ¨ MySQL çš„å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸å­˜åœ¨å¹»è¯»é—®é¢˜ã€‚</p><h4 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6. æ€»ç»“"></a><strong>6.</strong> <strong>æ€»ç»“</strong></h4><p>è¿™é‡Œä»‹ç»äº†<code>MVCC</code>åœ¨<code>READ COMMITTD</code>ã€<code>REPEATABLE READ</code>è¿™ä¸¤ç§éš”ç¦»çº§åˆ«çš„äº‹åŠ¡åœ¨æ‰§è¡Œå¿«ç…§è¯»æ“ä½œæ—¶è®¿é—®è®°å½•çš„ç‰ˆæœ¬é“¾çš„è¿‡ç¨‹ã€‚è¿™æ ·ä½¿ä¸åŒäº‹åŠ¡çš„<code>è¯»-å†™</code>ã€<code>å†™-è¯»</code>æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œä»è€Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚</p><p>æ ¸å¿ƒç‚¹åœ¨äº ReadView çš„åŸç†ï¼Œ<code>READ COMMITTD</code>ã€<code>REPEATABLE READ</code>è¿™ä¸¤ä¸ªéš”ç¦»çº§åˆ«çš„ä¸€ä¸ªå¾ˆå¤§ä¸åŒå°±æ˜¯ç”ŸæˆReadViewçš„æ—¶æœºä¸åŒï¼š</p><ul><li><code>READ COMMITTD</code>åœ¨æ¯ä¸€æ¬¡è¿›è¡Œæ™®é€šSELECTæ“ä½œå‰éƒ½ä¼šç”Ÿæˆä¸€ä¸ªReadView </li><li><code>REPEATABLE READ</code>åªåœ¨ç¬¬ä¸€æ¬¡è¿›è¡Œæ™®é€šSELECTæ“ä½œå‰ç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¹‹åçš„æŸ¥è¯¢æ“ä½œéƒ½é‡å¤ä½¿ç”¨è¿™ä¸ªReadViewå°±å¥½äº†ã€‚</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬17ç«  å…¶å®ƒæ•°æ®åº“æ—¥å¿—</title>
      <link href="/2023/07/15/%E7%AC%AC17%E7%AB%A0%20%E5%85%B6%E5%AE%83%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%A5%E5%BF%97/"/>
      <url>/2023/07/15/%E7%AC%AC17%E7%AB%A0%20%E5%85%B6%E5%AE%83%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%A5%E5%BF%97/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬17ç« -å…¶å®ƒæ•°æ®åº“æ—¥å¿—"><a href="#ç¬¬17ç« -å…¶å®ƒæ•°æ®åº“æ—¥å¿—" class="headerlink" title="ç¬¬17ç«  å…¶å®ƒæ•°æ®åº“æ—¥å¿—"></a>ç¬¬17ç«  å…¶å®ƒæ•°æ®åº“æ—¥å¿—</h3><h4 id="1-MySQLæ”¯æŒçš„æ—¥å¿—"><a href="#1-MySQLæ”¯æŒçš„æ—¥å¿—" class="headerlink" title="1. MySQLæ”¯æŒçš„æ—¥å¿—"></a><strong>1. MySQLæ”¯æŒçš„æ—¥å¿—</strong></h4><h5 id="1-1-æ—¥å¿—ç±»å‹"><a href="#1-1-æ—¥å¿—ç±»å‹" class="headerlink" title="1.1 æ—¥å¿—ç±»å‹"></a><strong>1.1</strong> <strong>æ—¥å¿—ç±»å‹</strong></h5><p>MySQLæœ‰ä¸åŒç±»å‹çš„æ—¥å¿—æ–‡ä»¶ï¼Œç”¨æ¥å­˜å‚¨ä¸åŒç±»å‹çš„æ—¥å¿—ï¼Œåˆ†ä¸º<code>äºŒè¿›åˆ¶æ—¥å¿—</code>ã€<code>é”™è¯¯æ—¥å¿—</code>ã€<code>é€šç”¨æŸ¥è¯¢æ—¥å¿—</code>å’Œ<code>æ…¢æŸ¥è¯¢æ—¥å¿—</code>ï¼Œè¿™ä¹Ÿæ˜¯å¸¸ç”¨çš„4ç§ã€‚MySQL 8åˆæ–°å¢ä¸¤ç§æ”¯æŒçš„æ—¥å¿—ï¼š<code>ä¸­ç»§æ—¥å¿—</code>å’Œ<code>æ•°æ®å®šä¹‰è¯­å¥æ—¥å¿—</code>ã€‚ä½¿ç”¨è¿™äº›æ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥æŸ¥çœ‹MySQLå†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚</p><ul><li><p><strong>æ…¢æŸ¥è¯¢æ—¥å¿—ï¼š</strong>è®°å½•æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡long_query_timeçš„æ‰€æœ‰æŸ¥è¯¢ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚</p></li><li><p><strong>é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼š</strong>è®°å½•æ‰€æœ‰è¿æ¥çš„èµ·å§‹æ—¶é—´å’Œç»ˆæ­¢æ—¶é—´ï¼Œä»¥åŠè¿æ¥å‘é€ç»™æ•°æ®åº“æœåŠ¡å™¨çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œå¯¹æˆ‘ä»¬å¤åŸæ“ä½œçš„å®é™…åœºæ™¯ã€å‘ç°é—®é¢˜ï¼Œç”šè‡³æ˜¯å¯¹æ•°æ®åº“æ“ä½œçš„å®¡è®¡éƒ½æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚</p></li><li><p><strong>é”™è¯¯æ—¥å¿—ï¼š</strong>è®°å½•MySQLæœåŠ¡çš„å¯åŠ¨ã€è¿è¡Œæˆ–åœæ­¢MySQLæœåŠ¡æ—¶å‡ºç°çš„é—®é¢˜ï¼Œæ–¹ä¾¿æˆ‘ä»¬äº†è§£æœåŠ¡å™¨çš„çŠ¶æ€ï¼Œä»è€Œå¯¹æœåŠ¡å™¨è¿›è¡Œç»´æŠ¤ã€‚</p></li><li><p><strong>äºŒè¿›åˆ¶æ—¥å¿—ï¼š</strong>è®°å½•æ‰€æœ‰æ›´æ”¹æ•°æ®çš„è¯­å¥ï¼Œå¯ä»¥ç”¨äºä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥ï¼Œä»¥åŠæœåŠ¡å™¨é‡åˆ°æ•…éšœæ—¶æ•°æ®çš„æ— æŸå¤±æ¢å¤ã€‚</p></li><li><p><strong>ä¸­ç»§æ—¥å¿—ï¼š</strong>ç”¨äºä¸»ä»æœåŠ¡å™¨æ¶æ„ä¸­ï¼Œä»æœåŠ¡å™¨ç”¨æ¥å­˜æ”¾ä¸»æœåŠ¡å™¨äºŒè¿›åˆ¶æ—¥å¿—å†…å®¹çš„ä¸€ä¸ªä¸­é—´æ–‡ä»¶ã€‚ä»æœåŠ¡å™¨é€šè¿‡è¯»å–ä¸­ç»§æ—¥å¿—çš„å†…å®¹ï¼Œæ¥åŒæ­¥ä¸»æœåŠ¡å™¨ä¸Šçš„æ“ä½œã€‚</p></li><li><p><strong>æ•°æ®å®šä¹‰è¯­å¥æ—¥å¿—ï¼š</strong>è®°å½•æ•°æ®å®šä¹‰è¯­å¥æ‰§è¡Œçš„å…ƒæ•°æ®æ“ä½œã€‚</p></li></ul><p>é™¤äºŒè¿›åˆ¶æ—¥å¿—å¤–ï¼Œå…¶ä»–æ—¥å¿—éƒ½æ˜¯<code>æ–‡æœ¬æ–‡ä»¶</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ—¥å¿—åˆ›å»ºäº<code>MySQLæ•°æ®ç›®å½•</code>ä¸­ã€‚</p><h5 id="1-2-æ—¥å¿—çš„å¼Šç«¯"><a href="#1-2-æ—¥å¿—çš„å¼Šç«¯" class="headerlink" title="1.2 æ—¥å¿—çš„å¼Šç«¯"></a><strong>1.2</strong> <strong>æ—¥å¿—çš„å¼Šç«¯</strong></h5><ul><li><p>æ—¥å¿—åŠŸèƒ½ä¼š<code>é™ä½MySQLæ•°æ®åº“çš„æ€§èƒ½</code>ã€‚</p></li><li><p>æ—¥å¿—ä¼š<code>å ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´</code>ã€‚</p></li></ul><h4 id="2-é€šç”¨æŸ¥è¯¢æ—¥å¿—-general-query-log"><a href="#2-é€šç”¨æŸ¥è¯¢æ—¥å¿—-general-query-log" class="headerlink" title="2. é€šç”¨æŸ¥è¯¢æ—¥å¿—(general query log)"></a><strong>2.</strong> <strong>é€šç”¨æŸ¥è¯¢æ—¥å¿—(general query log)</strong></h4><p>é€šç”¨æŸ¥è¯¢æ—¥å¿—ç”¨æ¥<code>è®°å½•ç”¨æˆ·çš„æ‰€æœ‰æ“ä½œ</code>ï¼ŒåŒ…æ‹¬å¯åŠ¨å’Œå…³é—­MySQLæœåŠ¡ã€æ‰€æœ‰ç”¨æˆ·çš„è¿æ¥å¼€å§‹æ—¶é—´å’Œæˆªæ­¢æ—¶é—´ã€å‘ç»™ MySQL æ•°æ®åº“æœåŠ¡å™¨çš„æ‰€æœ‰ SQL æŒ‡ä»¤ç­‰ã€‚å½“æˆ‘ä»¬çš„æ•°æ®å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œ<strong>æŸ¥çœ‹é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼Œè¿˜åŸæ“ä½œæ—¶çš„å…·ä½“åœºæ™¯</strong>ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å‡†ç¡®å®šä½é—®é¢˜ã€‚</p><h5 id="2-1-æŸ¥çœ‹å½“å‰çŠ¶æ€"><a href="#2-1-æŸ¥çœ‹å½“å‰çŠ¶æ€" class="headerlink" title="2.1 æŸ¥çœ‹å½“å‰çŠ¶æ€"></a><strong>2.1</strong> <strong>æŸ¥çœ‹å½“å‰çŠ¶æ€</strong></h5><pre><code class="mysql">mysql&gt; SHOW VARIABLES LIKE &#39;%general%&#39;;</code></pre><h5 id="2-2-å¯åŠ¨æ—¥å¿—"><a href="#2-2-å¯åŠ¨æ—¥å¿—" class="headerlink" title="2.2 å¯åŠ¨æ—¥å¿—"></a><strong>2.2</strong> <strong>å¯åŠ¨æ—¥å¿—</strong></h5><p><strong>æ–¹å¼1ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p><pre><code class="ini">[mysqld] general_log=ON general_log_file=[path[filename]] #æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ç›®å½•è·¯å¾„ï¼Œfilenameä¸ºæ—¥å¿—æ–‡ä»¶å</code></pre><p><strong>æ–¹å¼2ï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p><pre><code class="mysql">SET GLOBAL general_log=on; # å¼€å¯é€šç”¨æŸ¥è¯¢æ—¥å¿—SET GLOBAL general_log_file=â€™path/filenameâ€™; # è®¾ç½®æ—¥å¿—æ–‡ä»¶ä¿å­˜ä½ç½®SET GLOBAL general_log=off; # å…³é—­é€šç”¨æŸ¥è¯¢æ—¥å¿—SHOW VARIABLES LIKE &#39;general_log%&#39;; # æŸ¥çœ‹è®¾ç½®åæƒ…å†µ</code></pre><h5 id="2-3-åœæ­¢æ—¥å¿—"><a href="#2-3-åœæ­¢æ—¥å¿—" class="headerlink" title="2.3 åœæ­¢æ—¥å¿—"></a><strong>2.3</strong> <strong>åœæ­¢æ—¥å¿—</strong></h5><p><strong>æ–¹å¼1ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p><pre><code class="ini">[mysqld] general_log=OFF</code></pre><p><strong>æ–¹å¼2ï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p><pre><code class="mysql">SET GLOBAL general_log=off;SHOW VARIABLES LIKE &#39;general_log%&#39;;</code></pre><h4 id="3-é”™è¯¯æ—¥å¿—-error-log"><a href="#3-é”™è¯¯æ—¥å¿—-error-log" class="headerlink" title="3.é”™è¯¯æ—¥å¿—(error log)"></a><strong>3.é”™è¯¯æ—¥å¿—(error log)</strong></h4><h5 id="3-1-å¯åŠ¨æ—¥å¿—"><a href="#3-1-å¯åŠ¨æ—¥å¿—" class="headerlink" title="3.1 å¯åŠ¨æ—¥å¿—"></a><strong>3.1</strong> <strong>å¯åŠ¨æ—¥å¿—</strong></h5><p>åœ¨MySQLæ•°æ®åº“ä¸­ï¼Œé”™è¯¯æ—¥å¿—åŠŸèƒ½æ˜¯<code>é»˜è®¤å¼€å¯</code>çš„ã€‚è€Œä¸”ï¼Œé”™è¯¯æ—¥å¿—<code>æ— æ³•è¢«ç¦æ­¢</code>ã€‚</p><pre><code class="ini">[mysqld] log-error=[path/[filename]] #pathä¸ºæ—¥å¿—æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•è·¯å¾„ï¼Œfilenameä¸ºæ—¥å¿—æ–‡ä»¶å</code></pre><h5 id="3-2-æŸ¥çœ‹æ—¥å¿—"><a href="#3-2-æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="3.2 æŸ¥çœ‹æ—¥å¿—"></a><strong>3.2</strong> <strong>æŸ¥çœ‹æ—¥å¿—</strong></h5><pre><code class="mysql">mysql&gt; SHOW VARIABLES LIKE &#39;log_err%&#39;;</code></pre><h5 id="3-3-åˆ é™¤-åˆ·æ–°æ—¥å¿—"><a href="#3-3-åˆ é™¤-åˆ·æ–°æ—¥å¿—" class="headerlink" title="3.3 åˆ é™¤\åˆ·æ–°æ—¥å¿—"></a><strong>3.3</strong> <strong>åˆ é™¤\åˆ·æ–°æ—¥å¿—</strong></h5><pre><code class="shell">install -omysql -gmysql -m0644 /dev/null /var/log/mysqld.logmysqladmin -uroot -p flush-logs</code></pre><h4 id="4-äºŒè¿›åˆ¶æ—¥å¿—-bin-log"><a href="#4-äºŒè¿›åˆ¶æ—¥å¿—-bin-log" class="headerlink" title="4. äºŒè¿›åˆ¶æ—¥å¿—(bin log)"></a><strong>4.</strong> <strong>äºŒè¿›åˆ¶æ—¥å¿—(bin log)</strong></h4><h5 id="4-1-æŸ¥çœ‹é»˜è®¤æƒ…å†µ"><a href="#4-1-æŸ¥çœ‹é»˜è®¤æƒ…å†µ" class="headerlink" title="4.1 æŸ¥çœ‹é»˜è®¤æƒ…å†µ"></a><strong>4.1</strong> <strong>æŸ¥çœ‹é»˜è®¤æƒ…å†µ</strong></h5><pre><code class="mysql">mysql&gt; show variables like &#39;%log_bin%&#39;;</code></pre><h5 id="4-2-æ—¥å¿—å‚æ•°è®¾ç½®"><a href="#4-2-æ—¥å¿—å‚æ•°è®¾ç½®" class="headerlink" title="4.2 æ—¥å¿—å‚æ•°è®¾ç½®"></a><strong>4.2</strong> <strong>æ—¥å¿—å‚æ•°è®¾ç½®</strong></h5><p><strong>æ–¹å¼1ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p><pre><code class="ini">[mysqld] #å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿— log-bin=atguigu-bin binlog_expire_logs_seconds=600 max_binlog_size=100M</code></pre><p><strong>è®¾ç½®å¸¦æ–‡ä»¶å¤¹çš„bin-logæ—¥å¿—å­˜æ”¾ç›®å½•</strong></p><pre><code class="ini">[mysqld] log-bin=&quot;/var/lib/mysql/binlog/atguigu-bin&quot;</code></pre><p>æ³¨æ„ï¼šæ–°å»ºçš„æ–‡ä»¶å¤¹éœ€è¦ä½¿ç”¨mysqlç”¨æˆ·ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å³å¯ã€‚</p><pre><code class="shell">chown -R -v mysql:mysql binlog</code></pre><p><strong>æ–¹å¼2ï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p><pre><code class="mysql"># global çº§åˆ« mysql&gt; set global sql_log_bin=0; ERROR 1228 (HY000): Variable &#39;sql_log_bin&#39; is a SESSION variable and can`t be used with SET GLOBAL # sessionçº§åˆ« mysql&gt; SET sql_log_bin=0; Query OK, 0 rows affected (0.01 ç§’)</code></pre><h5 id="4-3-æŸ¥çœ‹æ—¥å¿—"><a href="#4-3-æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="4.3 æŸ¥çœ‹æ—¥å¿—"></a><strong>4.3</strong> <strong>æŸ¥çœ‹æ—¥å¿—</strong></h5><pre><code class="mysql">mysqlbinlog -v &quot;/var/lib/mysql/binlog/atguigu-bin.000002&quot;# ä¸æ˜¾ç¤ºbinlogæ ¼å¼çš„è¯­å¥mysqlbinlog -v --base64-output=DECODE-ROWS &quot;/var/lib/mysql/binlog/atguigu-bin.000002&quot;</code></pre><pre><code class="mysql"># å¯æŸ¥çœ‹å‚æ•°å¸®åŠ© mysqlbinlog --no-defaults --help # æŸ¥çœ‹æœ€å100è¡Œ mysqlbinlog --no-defaults --base64-output=decode-rows -vv atguigu-bin.000002 |tail -100 # æ ¹æ®positionæŸ¥æ‰¾ mysqlbinlog --no-defaults --base64-output=decode-rows -vv atguigu-bin.000002 |grep -A20 &#39;4939002&#39;</code></pre><p>ä¸Šé¢è¿™ç§åŠæ³•è¯»å–å‡ºbinlogæ—¥å¿—çš„å…¨æ–‡å†…å®¹æ¯”è¾ƒå¤šï¼Œä¸å®¹æ˜“åˆ†è¾¨æŸ¥çœ‹åˆ°posç‚¹ä¿¡æ¯ï¼Œä¸‹é¢ä»‹ç»ä¸€ç§æ›´ä¸ºæ–¹ä¾¿çš„æŸ¥è¯¢å‘½ä»¤ï¼š</p><pre><code class="mysql">mysql&gt; show binlog events [IN &#39;log_name&#39;] [FROM pos] [LIMIT [offset,] row_count];</code></pre><ul><li><code>IN &#39;log_name&#39;</code>ï¼šæŒ‡å®šè¦æŸ¥è¯¢çš„binlogæ–‡ä»¶åï¼ˆä¸æŒ‡å®šå°±æ˜¯ç¬¬ä¸€ä¸ªbinlogæ–‡ä»¶ï¼‰ã€€</li><li><code>FROM pos</code>ï¼šæŒ‡å®šä»å“ªä¸ªposèµ·å§‹ç‚¹å¼€å§‹æŸ¥èµ·ï¼ˆä¸æŒ‡å®šå°±æ˜¯ä»æ•´ä¸ªæ–‡ä»¶é¦–ä¸ªposç‚¹å¼€å§‹ç®—ï¼‰</li><li><code>LIMIT [offset]</code>ï¼šåç§»é‡(ä¸æŒ‡å®šå°±æ˜¯0) </li><li><code>row_count</code>:æŸ¥è¯¢æ€»æ¡æ•°ï¼ˆä¸æŒ‡å®šå°±æ˜¯æ‰€æœ‰è¡Œï¼‰</li></ul><pre><code class="mysql">mysql&gt; show binlog events in &#39;atguigu-bin.000002&#39;;</code></pre><h5 id="4-4-ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®"><a href="#4-4-ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®" class="headerlink" title="4.4 ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®"></a><strong>4.4</strong> <strong>ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®</strong></h5><p>mysqlbinlogæ¢å¤æ•°æ®çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><pre><code class="shell">mysqlbinlog [option] filename|mysql â€“uuser -ppass;</code></pre><ul><li><code>filename</code>ï¼šæ˜¯æ—¥å¿—æ–‡ä»¶åã€‚</li><li><code>option</code>ï¼šå¯é€‰é¡¹ï¼Œæ¯”è¾ƒé‡è¦çš„ä¸¤å¯¹optionå‚æ•°æ˜¯â€“start-dateã€â€“stop-date å’Œ â€“start-positionã€â€“ stop-positionã€‚ <ul><li><code>--start-date å’Œ --stop-date</code>ï¼šå¯ä»¥æŒ‡å®šæ¢å¤æ•°æ®åº“çš„èµ·å§‹æ—¶é—´ç‚¹å’Œç»“æŸæ—¶é—´ç‚¹ã€‚</li><li><code>--start-positionå’Œ--stop-position</code>ï¼šå¯ä»¥æŒ‡å®šæ¢å¤æ•°æ®çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚</li></ul></li></ul><blockquote><p>æ³¨æ„ï¼šä½¿ç”¨mysqlbinlogå‘½ä»¤è¿›è¡Œæ¢å¤æ“ä½œæ—¶ï¼Œå¿…é¡»æ˜¯ç¼–å·å°çš„å…ˆæ¢å¤ï¼Œä¾‹å¦‚atguigu-bin.000001å¿…é¡»åœ¨atguigu-bin.000002ä¹‹å‰æ¢å¤ã€‚</p></blockquote><h5 id="4-5-åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—"><a href="#4-5-åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—" class="headerlink" title="4.5 åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—"></a><strong>4.5</strong> <strong>åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—</strong></h5><p><strong>1. PURGE MASTER LOGSï¼šåˆ é™¤æŒ‡å®šæ—¥å¿—æ–‡ä»¶</strong></p><pre><code class="mysql">PURGE &#123;MASTER | BINARY&#125; LOGS TO â€˜æŒ‡å®šæ—¥å¿—æ–‡ä»¶åâ€™ PURGE &#123;MASTER | BINARY&#125; LOGS BEFORE â€˜æŒ‡å®šæ—¥æœŸâ€™</code></pre><h4 id="5-å†è°ˆäºŒè¿›åˆ¶æ—¥å¿—-binlog"><a href="#5-å†è°ˆäºŒè¿›åˆ¶æ—¥å¿—-binlog" class="headerlink" title="5. å†è°ˆäºŒè¿›åˆ¶æ—¥å¿—(binlog)"></a><strong>5.</strong> <strong>å†è°ˆäºŒè¿›åˆ¶æ—¥å¿—(binlog)</strong></h4><h5 id="5-1-å†™å…¥æœºåˆ¶"><a href="#5-1-å†™å…¥æœºåˆ¶" class="headerlink" title="5.1 å†™å…¥æœºåˆ¶"></a><strong>5.1</strong> <strong>å†™å…¥æœºåˆ¶</strong></h5><p>binlogçš„å†™å…¥æ—¶æœºä¹Ÿéå¸¸ç®€å•ï¼Œäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°<code>binlog cache</code>ï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå†æŠŠbinlog cacheå†™åˆ°binlogæ–‡ä»¶ä¸­ã€‚å› ä¸ºä¸€ä¸ªäº‹åŠ¡çš„binlogä¸èƒ½è¢«æ‹†å¼€ï¼Œæ— è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§ï¼Œä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªå—å†…å­˜ä½œä¸ºbinlog cacheã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051630535.png" alt="image-20220405163025361"></p><p>writeå’Œfsyncçš„æ—¶æœºï¼Œå¯ä»¥ç”±å‚æ•°<code>sync_binlog</code>æ§åˆ¶ï¼Œé»˜è®¤æ˜¯ <code>0</code>ã€‚ä¸º0çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åªwriteï¼Œç”±ç³»ç»Ÿè‡ªè¡Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™æ‰§è¡Œfsyncã€‚è™½ç„¶æ€§èƒ½å¾—åˆ°æå‡ï¼Œä½†æ˜¯æœºå™¨å®•æœºï¼Œpage cacheé‡Œé¢çš„binglog ä¼šä¸¢å¤±ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051631346.png" alt="image-20220405163125180"></p><p>ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå¯ä»¥è®¾ç½®ä¸º<code>1</code>ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œfsyncï¼Œå°±å¦‚åŒ<strong>redo log</strong> <strong>åˆ·ç›˜æµç¨‹</strong>ä¸€æ ·ã€‚æœ€åè¿˜æœ‰ä¸€ç§æŠ˜ä¸­æ–¹å¼ï¼Œå¯ä»¥è®¾ç½®ä¸ºN(N&gt;1)ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½writeï¼Œä½†ç´¯ç§¯Nä¸ªäº‹åŠ¡åæ‰fsyncã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051632526.png" alt="image-20220405163205364"></p><p>åœ¨å‡ºç°IOç“¶é¢ˆçš„åœºæ™¯é‡Œï¼Œå°†sync_binlogè®¾ç½®æˆä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚åŒæ ·çš„ï¼Œå¦‚æœæœºå™¨å®•æœºï¼Œä¼šä¸¢å¤±æœ€è¿‘Nä¸ªäº‹åŠ¡çš„binlogæ—¥å¿—ã€‚</p><h5 id="5-2-binlogä¸redologå¯¹æ¯”"><a href="#5-2-binlogä¸redologå¯¹æ¯”" class="headerlink" title="5.2 binlogä¸redologå¯¹æ¯”"></a><strong>5.2 binlogä¸redologå¯¹æ¯”</strong></h5><ul><li>redo log å®ƒæ˜¯<code>ç‰©ç†æ—¥å¿—</code>ï¼Œè®°å½•å†…å®¹æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼Œå±äº InnoDB å­˜å‚¨å¼•æ“å±‚äº§ç”Ÿçš„ã€‚</li><li>è€Œ binlog æ˜¯<code>é€»è¾‘æ—¥å¿—</code>ï¼Œè®°å½•å†…å®¹æ˜¯è¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œç±»ä¼¼äºâ€œç»™ ID&#x3D;2 è¿™ä¸€è¡Œçš„ c å­—æ®µåŠ  1â€ï¼Œå±äºMySQL Server å±‚ã€‚</li><li>è™½ç„¶å®ƒä»¬éƒ½å±äºæŒä¹…åŒ–çš„ä¿è¯ï¼Œä½†æ˜¯ä¾§é‡ç‚¹ä¸åŒã€‚<ul><li>redo log è®©InnoDBå­˜å‚¨å¼•æ“æ‹¥æœ‰äº†å´©æºƒæ¢å¤èƒ½åŠ›ã€‚</li><li>binlogä¿è¯äº†MySQLé›†ç¾¤æ¶æ„çš„æ•°æ®ä¸€è‡´æ€§</li></ul></li></ul><h5 id="5-3-ä¸¤é˜¶æ®µæäº¤"><a href="#5-3-ä¸¤é˜¶æ®µæäº¤" class="headerlink" title="5.3 ä¸¤é˜¶æ®µæäº¤"></a><strong>5.3</strong> <strong>ä¸¤é˜¶æ®µæäº¤</strong></h5><p>åœ¨æ‰§è¡Œæ›´æ–°è¯­å¥è¿‡ç¨‹ï¼Œä¼šè®°å½•redo logä¸binlogä¸¤å—æ—¥å¿—ï¼Œä»¥åŸºæœ¬çš„äº‹åŠ¡ä¸ºå•ä½ï¼Œredo logåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥ä¸æ–­å†™å…¥ï¼Œè€Œbinlogåªæœ‰åœ¨æäº¤äº‹åŠ¡æ—¶æ‰å†™å…¥ï¼Œæ‰€ä»¥redo logä¸binlogçš„<code>å†™å…¥æ—¶æœº</code>ä¸ä¸€æ ·ã€‚</p><p>ä¸ºäº†è§£å†³ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸€è‡´é—®é¢˜ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨<strong>ä¸¤é˜¶æ®µæäº¤</strong>æ–¹æ¡ˆã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051637390.png" alt="image-20220405163716222"></p><p>ä½¿ç”¨<strong>ä¸¤é˜¶æ®µæäº¤</strong>åï¼Œå†™å…¥binlogæ—¶å‘ç”Ÿå¼‚å¸¸ä¹Ÿä¸ä¼šæœ‰å½±å“</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051639192.png" alt="image-20220405163902977"></p><p>å¦ä¸€ä¸ªåœºæ™¯ï¼Œredo logè®¾ç½®commité˜¶æ®µå‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¼šä¸ä¼šå›æ»šäº‹åŠ¡å‘¢ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051639403.png" alt="image-20220405163927129"></p><p>å¹¶ä¸ä¼šå›æ»šäº‹åŠ¡ï¼Œå®ƒä¼šæ‰§è¡Œä¸Šå›¾æ¡†ä½çš„é€»è¾‘ï¼Œè™½ç„¶redo logæ˜¯å¤„äºprepareé˜¶æ®µï¼Œä½†æ˜¯èƒ½é€šè¿‡äº‹åŠ¡idæ‰¾åˆ°å¯¹åº”çš„binlogæ—¥å¿—ï¼Œæ‰€ä»¥MySQLè®¤ä¸ºæ˜¯å®Œæ•´çš„ï¼Œå°±ä¼šæäº¤äº‹åŠ¡æ¢å¤æ•°æ®ã€‚</p><h4 id="6-ä¸­ç»§æ—¥å¿—-relay-log"><a href="#6-ä¸­ç»§æ—¥å¿—-relay-log" class="headerlink" title="6. ä¸­ç»§æ—¥å¿—(relay log)"></a><strong>6.</strong> <strong>ä¸­ç»§æ—¥å¿—(relay log)</strong></h4><h5 id="6-1-ä»‹ç»"><a href="#6-1-ä»‹ç»" class="headerlink" title="6.1 ä»‹ç»"></a><strong>6.1</strong> <strong>ä»‹ç»</strong></h5><p><strong>ä¸­ç»§æ—¥å¿—åªåœ¨ä¸»ä»æœåŠ¡å™¨æ¶æ„çš„ä»æœåŠ¡å™¨ä¸Šå­˜åœ¨</strong>ã€‚ä»æœåŠ¡å™¨ä¸ºäº†ä¸ä¸»æœåŠ¡å™¨ä¿æŒä¸€è‡´ï¼Œè¦ä»ä¸»æœåŠ¡å™¨è¯»å–äºŒè¿›åˆ¶æ—¥å¿—çš„å†…å®¹ï¼Œå¹¶ä¸”æŠŠè¯»å–åˆ°çš„ä¿¡æ¯å†™å…¥<code>æœ¬åœ°çš„æ—¥å¿—æ–‡ä»¶</code>ä¸­ï¼Œè¿™ä¸ªä»æœåŠ¡å™¨æœ¬åœ°çš„æ—¥å¿—æ–‡ä»¶å°±å«<code>ä¸­ç»§æ—¥å¿—</code>ã€‚ç„¶åï¼Œä»æœåŠ¡å™¨è¯»å–ä¸­ç»§æ—¥å¿—ï¼Œå¹¶æ ¹æ®ä¸­ç»§æ—¥å¿—çš„å†…å®¹å¯¹ä»æœåŠ¡å™¨çš„æ•°æ®è¿›è¡Œæ›´æ–°ï¼Œå®Œæˆä¸»ä»æœåŠ¡å™¨çš„<code>æ•°æ®åŒæ­¥</code>ã€‚</p><h5 id="6-2-æ¢å¤çš„å…¸å‹é”™è¯¯"><a href="#6-2-æ¢å¤çš„å…¸å‹é”™è¯¯" class="headerlink" title="6.2 æ¢å¤çš„å…¸å‹é”™è¯¯"></a><strong>6.2</strong> <strong>æ¢å¤çš„å…¸å‹é”™è¯¯</strong></h5><p>å¦‚æœä»æœåŠ¡å™¨å®•æœºï¼Œæœ‰çš„æ—¶å€™ä¸ºäº†ç³»ç»Ÿæ¢å¤ï¼Œè¦é‡è£…æ“ä½œç³»ç»Ÿï¼Œè¿™æ ·å°±å¯èƒ½ä¼šå¯¼è‡´ä½ çš„<code>æœåŠ¡å™¨åç§°</code>ä¸ä¹‹å‰<code>ä¸åŒ</code>ã€‚è€Œä¸­ç»§æ—¥å¿—é‡Œæ˜¯<code>åŒ…å«ä»æœåŠ¡å™¨å</code>çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¯èƒ½å¯¼è‡´ä½ æ¢å¤ä»æœåŠ¡å™¨çš„æ—¶å€™ï¼Œæ— æ³•ä»å®•æœºå‰çš„ä¸­ç»§æ—¥å¿—é‡Œè¯»å–æ•°æ®ï¼Œä»¥ä¸ºæ˜¯æ—¥å¿—æ–‡ä»¶æŸåäº†ï¼Œå…¶å®æ˜¯åç§°ä¸å¯¹äº†ã€‚</p><p>è§£å†³çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼ŒæŠŠä»æœåŠ¡å™¨çš„åç§°æ”¹å›ä¹‹å‰çš„åç§°ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬19ç«  æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤</title>
      <link href="/2023/07/15/%E7%AC%AC18%E7%AB%A0%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/"/>
      <url>/2023/07/15/%E7%AC%AC18%E7%AB%A0%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬18ç« -ä¸»ä»å¤åˆ¶"><a href="#ç¬¬18ç« -ä¸»ä»å¤åˆ¶" class="headerlink" title="ç¬¬18ç«  ä¸»ä»å¤åˆ¶"></a>ç¬¬18ç«  ä¸»ä»å¤åˆ¶</h3><h4 id="1-ä¸»ä»å¤åˆ¶æ¦‚è¿°"><a href="#1-ä¸»ä»å¤åˆ¶æ¦‚è¿°" class="headerlink" title="1. ä¸»ä»å¤åˆ¶æ¦‚è¿°"></a><strong>1.</strong> <strong>ä¸»ä»å¤åˆ¶æ¦‚è¿°</strong></h4><h5 id="1-1-å¦‚ä½•æå‡æ•°æ®åº“å¹¶å‘èƒ½åŠ›"><a href="#1-1-å¦‚ä½•æå‡æ•°æ®åº“å¹¶å‘èƒ½åŠ›" class="headerlink" title="1.1 å¦‚ä½•æå‡æ•°æ®åº“å¹¶å‘èƒ½åŠ›"></a><strong>1.1</strong> <strong>å¦‚ä½•æå‡æ•°æ®åº“å¹¶å‘èƒ½åŠ›</strong></h5><p>ä¸€èˆ¬åº”ç”¨å¯¹æ•°æ®åº“è€Œè¨€éƒ½æ˜¯â€œ<code>è¯»å¤šå†™å°‘</code>â€ï¼Œä¹Ÿå°±è¯´å¯¹æ•°æ®åº“è¯»å–æ•°æ®çš„å‹åŠ›æ¯”è¾ƒå¤§ï¼Œæœ‰ä¸€ä¸ªæ€è·¯å°±æ˜¯é‡‡ç”¨æ•°æ®åº“é›†ç¾¤çš„æ–¹æ¡ˆï¼Œåš<code>ä¸»ä»æ¶æ„</code>ã€è¿›è¡Œ<code>è¯»å†™åˆ†ç¦»</code>ï¼Œè¿™æ ·åŒæ ·å¯ä»¥æå‡æ•°æ®åº“çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„åº”ç”¨éƒ½éœ€è¦å¯¹æ•°æ®åº“è¿›è¡Œä¸»ä»æ¶æ„çš„è®¾ç½®ï¼Œæ¯•ç«Ÿè®¾ç½®æ¶æ„æœ¬èº«æ˜¯æœ‰æˆæœ¬çš„ã€‚</p><p>å¦‚æœæˆ‘ä»¬çš„ç›®çš„åœ¨äºæå‡æ•°æ®åº“é«˜å¹¶å‘è®¿é—®çš„æ•ˆç‡ï¼Œé‚£ä¹ˆé¦–å…ˆè€ƒè™‘çš„æ˜¯å¦‚ä½•<code>ä¼˜åŒ–SQLå’Œç´¢å¼•</code>ï¼Œè¿™ç§æ–¹å¼ç®€å•æœ‰æ•ˆï¼›å…¶æ¬¡æ‰æ˜¯é‡‡ç”¨<code>ç¼“å­˜çš„ç­–ç•¥</code>ï¼Œæ¯”å¦‚ä½¿ç”¨ Rediså°†çƒ­ç‚¹æ•°æ®ä¿å­˜åœ¨å†…å­˜æ•°æ®åº“ä¸­ï¼Œæå‡è¯»å–çš„æ•ˆç‡ï¼›æœ€åæ‰æ˜¯å¯¹æ•°æ®åº“é‡‡ç”¨<code>ä¸»ä»æ¶æ„</code>ï¼Œè¿›è¡Œè¯»å†™åˆ†ç¦»ã€‚</p><h5 id="1-2-ä¸»ä»å¤åˆ¶çš„ä½œç”¨"><a href="#1-2-ä¸»ä»å¤åˆ¶çš„ä½œç”¨" class="headerlink" title="1.2 ä¸»ä»å¤åˆ¶çš„ä½œç”¨"></a><strong>1.2</strong> <strong>ä¸»ä»å¤åˆ¶çš„ä½œç”¨</strong></h5><p><strong>ç¬¬1ä¸ªä½œç”¨ï¼šè¯»å†™åˆ†ç¦»ã€‚</strong></p><p><strong>ç¬¬2ä¸ªä½œç”¨å°±æ˜¯æ•°æ®å¤‡ä»½ã€‚</strong></p><p><strong>ç¬¬3ä¸ªä½œç”¨æ˜¯å…·æœ‰é«˜å¯ç”¨æ€§ã€‚</strong></p><h4 id="2-ä¸»ä»å¤åˆ¶çš„åŸç†"><a href="#2-ä¸»ä»å¤åˆ¶çš„åŸç†" class="headerlink" title="2. ä¸»ä»å¤åˆ¶çš„åŸç†"></a><strong>2.</strong> <strong>ä¸»ä»å¤åˆ¶çš„åŸç†</strong></h4><h5 id="2-1-åŸç†å‰–æ"><a href="#2-1-åŸç†å‰–æ" class="headerlink" title="2.1 åŸç†å‰–æ"></a><strong>2.1</strong> <strong>åŸç†å‰–æ</strong></h5><p><strong>ä¸‰ä¸ªçº¿ç¨‹</strong></p><p>å®é™…ä¸Šä¸»ä»åŒæ­¥çš„åŸç†å°±æ˜¯åŸºäº binlog è¿›è¡Œæ•°æ®åŒæ­¥çš„ã€‚åœ¨ä¸»ä»å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œä¼šåŸºäº<code>3 ä¸ªçº¿ç¨‹</code>æ¥æ“ä½œï¼Œä¸€ä¸ªä¸»åº“çº¿ç¨‹ï¼Œä¸¤ä¸ªä»åº“çº¿ç¨‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051646097.png" alt="image-20220405164559961"></p><p><code>äºŒè¿›åˆ¶æ—¥å¿—è½¬å‚¨çº¿ç¨‹</code>ï¼ˆBinlog dump threadï¼‰æ˜¯ä¸€ä¸ªä¸»åº“çº¿ç¨‹ã€‚å½“ä»åº“çº¿ç¨‹è¿æ¥çš„æ—¶å€™ï¼Œ ä¸»åº“å¯ä»¥å°†äºŒè¿›åˆ¶æ—¥å¿—å‘é€ç»™ä»åº“ï¼Œå½“ä¸»åº“è¯»å–äº‹ä»¶ï¼ˆEventï¼‰çš„æ—¶å€™ï¼Œä¼šåœ¨ Binlog ä¸Š<code>åŠ é”</code>ï¼Œè¯»å–å®Œæˆä¹‹åï¼Œå†å°†é”é‡Šæ”¾æ‰ã€‚</p><p><code>ä»åº“ I/O çº¿ç¨‹</code>ä¼šè¿æ¥åˆ°ä¸»åº“ï¼Œå‘ä¸»åº“å‘é€è¯·æ±‚æ›´æ–° Binlogã€‚è¿™æ—¶ä»åº“çš„ I&#x2F;O çº¿ç¨‹å°±å¯ä»¥è¯»å–åˆ°ä¸»åº“çš„äºŒè¿›åˆ¶æ—¥å¿—è½¬å‚¨çº¿ç¨‹å‘é€çš„ Binlog æ›´æ–°éƒ¨åˆ†ï¼Œå¹¶ä¸”æ‹·è´åˆ°æœ¬åœ°çš„ä¸­ç»§æ—¥å¿— ï¼ˆRelay logï¼‰ã€‚</p><p><code>ä»åº“ SQL çº¿ç¨‹</code>ä¼šè¯»å–ä»åº“ä¸­çš„ä¸­ç»§æ—¥å¿—ï¼Œå¹¶ä¸”æ‰§è¡Œæ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†ä»åº“ä¸­çš„æ•°æ®ä¸ä¸»åº“ä¿æŒåŒæ­¥ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051647759.png" alt="image-20220405164718627"></p><p><strong>å¤åˆ¶ä¸‰æ­¥éª¤</strong></p><p>æ­¥éª¤1ï¼š<code>Master</code>å°†å†™æ“ä½œè®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆ<code>binlog</code>ï¼‰ã€‚</p><p>æ­¥éª¤2ï¼š<code>Slave</code>å°†<code>Master</code>çš„binary log eventsæ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—ï¼ˆ<code>relay log</code>ï¼‰ï¼›</p><p>æ­¥éª¤3ï¼š<code>Slave</code>é‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åº”ç”¨åˆ°è‡ªå·±çš„æ•°æ®åº“ä¸­ã€‚ MySQLå¤åˆ¶æ˜¯å¼‚æ­¥çš„ä¸”ä¸²è¡ŒåŒ–çš„ï¼Œè€Œä¸”é‡å¯åä»<code>æ¥å…¥ç‚¹</code>å¼€å§‹å¤åˆ¶ã€‚</p><p><strong>å¤åˆ¶çš„é—®é¢˜</strong></p><p>å¤åˆ¶çš„æœ€å¤§é—®é¢˜ï¼š<code>å»¶æ—¶</code></p><h5 id="2-2-å¤åˆ¶çš„åŸºæœ¬åŸåˆ™"><a href="#2-2-å¤åˆ¶çš„åŸºæœ¬åŸåˆ™" class="headerlink" title="2.2 å¤åˆ¶çš„åŸºæœ¬åŸåˆ™"></a><strong>2.2</strong> <strong>å¤åˆ¶çš„åŸºæœ¬åŸåˆ™</strong></h5><ul><li><p>æ¯ä¸ª<code>Slave</code>åªæœ‰ä¸€ä¸ª<code>Master</code></p></li><li><p>æ¯ä¸ª<code>Slave</code>åªèƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æœåŠ¡å™¨ID</p></li><li><p>æ¯ä¸ª<code>Master</code>å¯ä»¥æœ‰å¤šä¸ª<code>Slave</code></p></li></ul><h4 id="3-åŒæ­¥æ•°æ®ä¸€è‡´æ€§é—®é¢˜"><a href="#3-åŒæ­¥æ•°æ®ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="3. åŒæ­¥æ•°æ®ä¸€è‡´æ€§é—®é¢˜"></a><strong>3.</strong> <strong>åŒæ­¥æ•°æ®ä¸€è‡´æ€§é—®é¢˜</strong></h4><p><strong>ä¸»ä»åŒæ­¥çš„è¦æ±‚ï¼š</strong></p><ul><li><p>è¯»åº“å’Œå†™åº“çš„æ•°æ®ä¸€è‡´(æœ€ç»ˆä¸€è‡´)ï¼›</p></li><li><p>å†™æ•°æ®å¿…é¡»å†™åˆ°å†™åº“ï¼›</p></li><li><p>è¯»æ•°æ®å¿…é¡»åˆ°è¯»åº“(ä¸ä¸€å®š)ï¼›</p></li></ul><h5 id="3-1-ç†è§£ä¸»ä»å»¶è¿Ÿé—®é¢˜"><a href="#3-1-ç†è§£ä¸»ä»å»¶è¿Ÿé—®é¢˜" class="headerlink" title="3.1 ç†è§£ä¸»ä»å»¶è¿Ÿé—®é¢˜"></a><strong>3.1</strong> <strong>ç†è§£ä¸»ä»å»¶è¿Ÿé—®é¢˜</strong></h5><p>è¿›è¡Œä¸»ä»åŒæ­¥çš„å†…å®¹æ˜¯äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨è¿›è¡Œ<code>ç½‘ç»œä¼ è¾“</code>çš„è¿‡ç¨‹ä¸­å°±ä¸€å®šä¼š<code>å­˜åœ¨ä¸»ä»å»¶è¿Ÿ</code>ï¼ˆæ¯”å¦‚ 500msï¼‰ï¼Œè¿™æ ·å°±å¯èƒ½é€ æˆç”¨æˆ·åœ¨ä»åº“ä¸Šè¯»å–çš„æ•°æ®ä¸æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸»ä»åŒæ­¥ä¸­çš„<code>æ•°æ®ä¸ä¸€è‡´æ€§</code>é—®é¢˜ã€‚</p><h5 id="3-2-ä¸»ä»å»¶è¿Ÿé—®é¢˜åŸå› "><a href="#3-2-ä¸»ä»å»¶è¿Ÿé—®é¢˜åŸå› " class="headerlink" title="3.2 ä¸»ä»å»¶è¿Ÿé—®é¢˜åŸå› "></a><strong>3.2</strong> <strong>ä¸»ä»å»¶è¿Ÿé—®é¢˜åŸå› </strong></h5><p>åœ¨ç½‘ç»œæ­£å¸¸çš„æ—¶å€™ï¼Œæ—¥å¿—ä»ä¸»åº“ä¼ ç»™ä»åº“æ‰€éœ€çš„æ—¶é—´æ˜¯å¾ˆçŸ­çš„ï¼Œå³T2-T1çš„å€¼æ˜¯éå¸¸å°çš„ã€‚å³ï¼Œç½‘ç»œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸»å¤‡å»¶è¿Ÿçš„ä¸»è¦æ¥æºæ˜¯å¤‡åº“æ¥æ”¶å®Œbinlogå’Œæ‰§è¡Œå®Œè¿™ä¸ªäº‹åŠ¡ä¹‹é—´çš„æ—¶é—´å·®ã€‚</p><p><strong>ä¸»å¤‡å»¶è¿Ÿæœ€ç›´æ¥çš„è¡¨ç°æ˜¯ï¼Œä»åº“æ¶ˆè´¹ä¸­ç»§æ—¥å¿—ï¼ˆrelay logï¼‰çš„é€Ÿåº¦ï¼Œæ¯”ä¸»åº“ç”Ÿäº§binlogçš„é€Ÿåº¦è¦æ…¢ã€‚</strong>é€ æˆåŸå› ï¼š</p><p>1ã€ä»åº“çš„æœºå™¨æ€§èƒ½æ¯”ä¸»åº“è¦å·®</p><p>2ã€ä»åº“çš„å‹åŠ›å¤§</p><p>3ã€å¤§äº‹åŠ¡çš„æ‰§è¡Œ</p><h5 id="3-3-å¦‚ä½•å‡å°‘ä¸»ä»å»¶è¿Ÿ"><a href="#3-3-å¦‚ä½•å‡å°‘ä¸»ä»å»¶è¿Ÿ" class="headerlink" title="3.3 å¦‚ä½•å‡å°‘ä¸»ä»å»¶è¿Ÿ"></a><strong>3.3</strong> <strong>å¦‚ä½•å‡å°‘ä¸»ä»å»¶è¿Ÿ</strong></h5><p>è‹¥æƒ³è¦å‡å°‘ä¸»ä»å»¶è¿Ÿçš„æ—¶é—´ï¼Œå¯ä»¥é‡‡å–ä¸‹é¢çš„åŠæ³•ï¼š</p><ol><li><p>é™ä½å¤šçº¿ç¨‹å¤§äº‹åŠ¡å¹¶å‘çš„æ¦‚ç‡ï¼Œä¼˜åŒ–ä¸šåŠ¡é€»è¾‘</p></li><li><p>ä¼˜åŒ–SQLï¼Œé¿å…æ…¢SQLï¼Œ<code>å‡å°‘æ‰¹é‡æ“ä½œ</code>ï¼Œå»ºè®®å†™è„šæœ¬ä»¥update-sleepè¿™æ ·çš„å½¢å¼å®Œæˆã€‚</p></li><li><p><code>æé«˜ä»åº“æœºå™¨çš„é…ç½®</code>ï¼Œå‡å°‘ä¸»åº“å†™binlogå’Œä»åº“è¯»binlogçš„æ•ˆç‡å·®ã€‚</p></li><li><p>å°½é‡é‡‡ç”¨<code>çŸ­çš„é“¾è·¯</code>ï¼Œä¹Ÿå°±æ˜¯ä¸»åº“å’Œä»åº“æœåŠ¡å™¨çš„è·ç¦»å°½é‡è¦çŸ­ï¼Œæå‡ç«¯å£å¸¦å®½ï¼Œå‡å°‘binlogä¼ è¾“çš„ç½‘ç»œå»¶æ—¶ã€‚</p></li><li><p>å®æ—¶æ€§è¦æ±‚çš„ä¸šåŠ¡è¯»å¼ºåˆ¶èµ°ä¸»åº“ï¼Œä»åº“åªåšç¾å¤‡ï¼Œå¤‡ä»½ã€‚</p></li></ol><h5 id="3-4-å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜"><a href="#3-4-å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="3.4 å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜"></a><strong>3.4</strong> <strong>å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜</strong></h5><p>è¯»å†™åˆ†ç¦»æƒ…å†µä¸‹ï¼Œè§£å†³ä¸»ä»åŒæ­¥ä¸­æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œ å°±æ˜¯è§£å†³ä¸»ä»ä¹‹é—´ æ•°æ®å¤åˆ¶æ–¹å¼ çš„é—®é¢˜ï¼Œå¦‚æœæŒ‰ç…§æ•°æ®ä¸€è‡´æ€§ ä»å¼±åˆ°å¼º æ¥è¿›è¡Œåˆ’åˆ†ï¼Œæœ‰ä»¥ä¸‹ 3 ç§å¤åˆ¶æ–¹å¼ã€‚</p><p><strong>æ–¹æ³•</strong> <strong>1ï¼šå¼‚æ­¥å¤åˆ¶</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051654133.png" alt="image-20220405165455998"></p><p><strong>æ–¹æ³•</strong> <strong>2ï¼šåŠåŒæ­¥å¤åˆ¶</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051655175.png" alt="image-20220405165513025"></p><p><strong>æ–¹æ³•</strong> <strong>3ï¼šç»„å¤åˆ¶</strong></p><p>é¦–å…ˆæˆ‘ä»¬å°†å¤šä¸ªèŠ‚ç‚¹å…±åŒç»„æˆä¸€ä¸ªå¤åˆ¶ç»„ï¼Œåœ¨<code>æ‰§è¡Œè¯»å†™ï¼ˆRWï¼‰äº‹åŠ¡</code>çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡ä¸€è‡´æ€§åè®®å±‚ï¼ˆConsensus å±‚ï¼‰çš„åŒæ„ï¼Œä¹Ÿå°±æ˜¯è¯»å†™äº‹åŠ¡æƒ³è¦è¿›è¡Œæäº¤ï¼Œå¿…é¡»è¦ç»è¿‡ç»„é‡Œâ€œå¤§å¤šæ•°äººâ€ï¼ˆå¯¹åº” Node èŠ‚ç‚¹ï¼‰çš„åŒæ„ï¼Œå¤§å¤šæ•°æŒ‡çš„æ˜¯åŒæ„çš„èŠ‚ç‚¹æ•°é‡éœ€è¦å¤§äº ï¼ˆN&#x2F;2+1ï¼‰ï¼Œè¿™æ ·æ‰å¯ä»¥è¿›è¡Œæäº¤ï¼Œè€Œä¸æ˜¯åŸå‘èµ·æ–¹ä¸€ä¸ªè¯´äº†ç®—ã€‚è€Œé’ˆå¯¹<code>åªè¯»ï¼ˆROï¼‰äº‹åŠ¡</code>åˆ™ä¸éœ€è¦ç»è¿‡ç»„å†…åŒæ„ï¼Œç›´æ¥ COMMIT å³å¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051656560.png" alt="image-20220405165650425"></p><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬19ç«  æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤</title>
      <link href="/2023/07/15/%E7%AC%AC19%E7%AB%A0%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/"/>
      <url>/2023/07/15/%E7%AC%AC19%E7%AB%A0%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬19ç« -æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤"><a href="#ç¬¬19ç« -æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤" class="headerlink" title="ç¬¬19ç«  æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤"></a>ç¬¬19ç«  æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤</h3><h4 id="1-ç‰©ç†å¤‡ä»½ä¸é€»è¾‘å¤‡ä»½"><a href="#1-ç‰©ç†å¤‡ä»½ä¸é€»è¾‘å¤‡ä»½" class="headerlink" title="1. ç‰©ç†å¤‡ä»½ä¸é€»è¾‘å¤‡ä»½"></a><strong>1.</strong> <strong>ç‰©ç†å¤‡ä»½ä¸é€»è¾‘å¤‡ä»½</strong></h4><p><strong>ç‰©ç†å¤‡ä»½</strong>ï¼šå¤‡ä»½æ•°æ®æ–‡ä»¶ï¼Œè½¬å‚¨æ•°æ®åº“ç‰©ç†æ–‡ä»¶åˆ°æŸä¸€ç›®å½•ã€‚ç‰©ç†å¤‡ä»½æ¢å¤é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œä½†å ç”¨ç©ºé—´æ¯”è¾ƒå¤§ï¼ŒMySQLä¸­å¯ä»¥ç”¨<code>xtrabackup</code>å·¥å…·æ¥è¿›è¡Œç‰©ç†å¤‡ä»½ã€‚</p><p><strong>é€»è¾‘å¤‡ä»½</strong>ï¼šå¯¹æ•°æ®åº“å¯¹è±¡åˆ©ç”¨å·¥å…·è¿›è¡Œå¯¼å‡ºå·¥ä½œï¼Œæ±‡æ€»å…¥å¤‡ä»½æ–‡ä»¶å†…ã€‚é€»è¾‘å¤‡ä»½æ¢å¤é€Ÿåº¦æ…¢ï¼Œä½†å ç”¨ç©ºé—´å°ï¼Œæ›´çµæ´»ã€‚MySQL ä¸­å¸¸ç”¨çš„é€»è¾‘å¤‡ä»½å·¥å…·ä¸º<code>mysqldump</code>ã€‚é€»è¾‘å¤‡ä»½å°±æ˜¯<code>å¤‡ä»½sqlè¯­å¥</code>ï¼Œåœ¨æ¢å¤çš„æ—¶å€™æ‰§è¡Œå¤‡ä»½çš„sqlè¯­å¥å®ç°æ•°æ®åº“æ•°æ®çš„é‡ç°ã€‚</p><h4 id="2-mysqldumpå®ç°é€»è¾‘å¤‡ä»½"><a href="#2-mysqldumpå®ç°é€»è¾‘å¤‡ä»½" class="headerlink" title="2. mysqldumpå®ç°é€»è¾‘å¤‡ä»½"></a><strong>2. mysqldumpå®ç°é€»è¾‘å¤‡ä»½</strong></h4><h5 id="2-1-å¤‡ä»½ä¸€ä¸ªæ•°æ®åº“"><a href="#2-1-å¤‡ä»½ä¸€ä¸ªæ•°æ®åº“" class="headerlink" title="2.1 å¤‡ä»½ä¸€ä¸ªæ•°æ®åº“"></a><strong>2.1</strong> <strong>å¤‡ä»½ä¸€ä¸ªæ•°æ®åº“</strong></h5><pre><code class="shell">mysqldump â€“u ç”¨æˆ·åç§° â€“h ä¸»æœºåç§° â€“på¯†ç  å¾…å¤‡ä»½çš„æ•°æ®åº“åç§°[tbname, [tbname...]]&gt; å¤‡ä»½æ–‡ä»¶å ç§°.sql</code></pre><pre><code class="shell">mysqldump -uroot -p atguigu&gt;atguigu.sql #å¤‡ä»½æ–‡ä»¶å­˜å‚¨åœ¨å½“å‰ç›®å½•ä¸‹mysqldump -uroot -p atguigudb1 &gt; /var/lib/mysql/atguigu.sql</code></pre><h5 id="2-2-å¤‡ä»½å…¨éƒ¨æ•°æ®åº“"><a href="#2-2-å¤‡ä»½å…¨éƒ¨æ•°æ®åº“" class="headerlink" title="2.2 å¤‡ä»½å…¨éƒ¨æ•°æ®åº“"></a><strong>2.2</strong> <strong>å¤‡ä»½å…¨éƒ¨æ•°æ®åº“</strong></h5><pre><code class="shell">mysqldump -uroot -pxxxxxx --all-databases &gt; all_database.sql mysqldump -uroot -pxxxxxx -A &gt; all_database.sql</code></pre><h5 id="2-3-å¤‡ä»½éƒ¨åˆ†æ•°æ®åº“"><a href="#2-3-å¤‡ä»½éƒ¨åˆ†æ•°æ®åº“" class="headerlink" title="2.3 å¤‡ä»½éƒ¨åˆ†æ•°æ®åº“"></a><strong>2.3</strong> <strong>å¤‡ä»½éƒ¨åˆ†æ•°æ®åº“</strong></h5><pre><code class="shell">mysqldump â€“u user â€“h host â€“p --databases [æ•°æ®åº“çš„åç§°1 [æ•°æ®åº“çš„åç§°2...]] &gt; å¤‡ä»½æ–‡ä»¶å ç§°.sql</code></pre><pre><code class="shell">mysqldump -uroot -p --databases atguigu atguigu12 &gt;two_database.sqlmysqldump -uroot -p -B atguigu atguigu12 &gt; two_database.sql</code></pre><h5 id="2-4-å¤‡ä»½éƒ¨åˆ†è¡¨"><a href="#2-4-å¤‡ä»½éƒ¨åˆ†è¡¨" class="headerlink" title="2.4 å¤‡ä»½éƒ¨åˆ†è¡¨"></a><strong>2.4</strong> <strong>å¤‡ä»½éƒ¨åˆ†è¡¨</strong></h5><pre><code class="shell">mysqldump â€“u user â€“h host â€“p æ•°æ®åº“çš„åç§° [è¡¨å1 [è¡¨å2...]] &gt; å¤‡ä»½æ–‡ä»¶åç§°.sql</code></pre><pre><code class="shell">mysqldump -uroot -p atguigu book&gt; book.sql#å¤‡ä»½å¤šå¼ è¡¨ mysqldump -uroot -p atguigu book account &gt; 2_tables_bak.sql</code></pre><h5 id="2-5-å¤‡ä»½å•è¡¨çš„éƒ¨åˆ†æ•°æ®"><a href="#2-5-å¤‡ä»½å•è¡¨çš„éƒ¨åˆ†æ•°æ®" class="headerlink" title="2.5 å¤‡ä»½å•è¡¨çš„éƒ¨åˆ†æ•°æ®"></a><strong>2.5</strong> <strong>å¤‡ä»½å•è¡¨çš„éƒ¨åˆ†æ•°æ®</strong></h5><pre><code class="shell">mysqldump -uroot -p atguigu student --where=&quot;id &lt; 10 &quot; &gt; student_part_id10_low_bak.sql</code></pre><h5 id="2-6-æ’é™¤æŸäº›è¡¨çš„å¤‡ä»½"><a href="#2-6-æ’é™¤æŸäº›è¡¨çš„å¤‡ä»½" class="headerlink" title="2.6 æ’é™¤æŸäº›è¡¨çš„å¤‡ä»½"></a><strong>2.6</strong> <strong>æ’é™¤æŸäº›è¡¨çš„å¤‡ä»½</strong></h5><pre><code class="shell">mysqldump -uroot -p atguigu --ignore-table=atguigu.student &gt; no_stu_bak.sql</code></pre><h5 id="2-7-åªå¤‡ä»½ç»“æ„æˆ–åªå¤‡ä»½æ•°æ®"><a href="#2-7-åªå¤‡ä»½ç»“æ„æˆ–åªå¤‡ä»½æ•°æ®" class="headerlink" title="2.7 åªå¤‡ä»½ç»“æ„æˆ–åªå¤‡ä»½æ•°æ®"></a><strong>2.7</strong> <strong>åªå¤‡ä»½ç»“æ„æˆ–åªå¤‡ä»½æ•°æ®</strong></h5><ul><li>åªå¤‡ä»½ç»“æ„</li></ul><pre><code class="shell">mysqldump -uroot -p atguigu --no-data &gt; atguigu_no_data_bak.sql</code></pre><ul><li>åªå¤‡ä»½æ•°æ®</li></ul><pre><code class="shell">mysqldump -uroot -p atguigu --no-create-info &gt; atguigu_no_create_info_bak.sql</code></pre><h5 id="2-8-å¤‡ä»½ä¸­åŒ…å«å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ã€äº‹ä»¶"><a href="#2-8-å¤‡ä»½ä¸­åŒ…å«å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ã€äº‹ä»¶" class="headerlink" title="2.8 å¤‡ä»½ä¸­åŒ…å«å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ã€äº‹ä»¶"></a><strong>2.8</strong> <strong>å¤‡ä»½ä¸­åŒ…å«å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ã€äº‹ä»¶</strong></h5><pre><code class="shell">mysqldump -uroot -p -R -E --databases atguigu &gt; fun_atguigu_bak.sql</code></pre><h4 id="3-mysqlå‘½ä»¤æ¢å¤æ•°æ®"><a href="#3-mysqlå‘½ä»¤æ¢å¤æ•°æ®" class="headerlink" title="3. mysqlå‘½ä»¤æ¢å¤æ•°æ®"></a><strong>3. mysqlå‘½ä»¤æ¢å¤æ•°æ®</strong></h4><pre><code class="shell">mysql â€“u root â€“p [dbname] &lt; backup.sql</code></pre><h5 id="3-1-å•åº“å¤‡ä»½ä¸­æ¢å¤å•åº“"><a href="#3-1-å•åº“å¤‡ä»½ä¸­æ¢å¤å•åº“" class="headerlink" title="3.1 å•åº“å¤‡ä»½ä¸­æ¢å¤å•åº“"></a><strong>3.1</strong> <strong>å•åº“å¤‡ä»½ä¸­æ¢å¤å•åº“</strong></h5><pre><code class="shell">#å¤‡ä»½æ–‡ä»¶ä¸­åŒ…å«äº†åˆ›å»ºæ•°æ®åº“çš„è¯­å¥mysql -uroot -p &lt; atguigu.sql#å¤‡ä»½æ–‡ä»¶ä¸­ä¸åŒ…å«äº†åˆ›å»ºæ•°æ®åº“çš„è¯­å¥mysql -uroot -p atguigu4&lt; atguigu.sql</code></pre><h5 id="3-2-å…¨é‡å¤‡ä»½æ¢å¤"><a href="#3-2-å…¨é‡å¤‡ä»½æ¢å¤" class="headerlink" title="3.2 å…¨é‡å¤‡ä»½æ¢å¤"></a><strong>3.2</strong> <strong>å…¨é‡å¤‡ä»½æ¢å¤</strong></h5><pre><code class="shell">mysql â€“u root â€“p &lt; all.sql</code></pre><h5 id="3-3-ä»å…¨é‡å¤‡ä»½ä¸­æ¢å¤å•åº“"><a href="#3-3-ä»å…¨é‡å¤‡ä»½ä¸­æ¢å¤å•åº“" class="headerlink" title="3.3 ä»å…¨é‡å¤‡ä»½ä¸­æ¢å¤å•åº“"></a><strong>3.3</strong> <strong>ä»å…¨é‡å¤‡ä»½ä¸­æ¢å¤å•åº“</strong></h5><pre><code class="shell">sed -n &#39;/^-- Current Database: `atguigu`/,/^-- Current Database: `/p&#39; all_database.sql &gt; atguigu.sql #åˆ†ç¦»å®Œæˆåæˆ‘ä»¬å†å¯¼å…¥atguigu.sqlå³å¯æ¢å¤å•ä¸ªåº“</code></pre><h5 id="3-4-ä»å•åº“å¤‡ä»½ä¸­æ¢å¤å•è¡¨"><a href="#3-4-ä»å•åº“å¤‡ä»½ä¸­æ¢å¤å•è¡¨" class="headerlink" title="3.4 ä»å•åº“å¤‡ä»½ä¸­æ¢å¤å•è¡¨"></a><strong>3.4</strong> <strong>ä»å•åº“å¤‡ä»½ä¸­æ¢å¤å•è¡¨</strong></h5><pre><code class="shell">cat atguigu.sql | sed -e &#39;/./&#123;H;$!d;&#125;&#39; -e &#39;x;/CREATE TABLE `class`/!d;q&#39; &gt; class_structure.sql cat atguigu.sql | grep --ignore-case &#39;insert into `class`&#39; &gt; class_data.sql #ç”¨shellè¯­æ³•åˆ†ç¦»å‡ºåˆ›å»ºè¡¨çš„è¯­å¥åŠæ’å…¥æ•°æ®çš„è¯­å¥å å†ä¾æ¬¡å¯¼å‡ºå³å¯å®Œæˆæ¢å¤ use atguigu; mysql&gt; source class_structure.sql; Query OK, 0 rows affected, 1 warning (0.00 sec) mysql&gt; source class_data.sql; Query OK, 1 row affected (0.01 sec)</code></pre><h4 id="4-è¡¨çš„å¯¼å‡ºä¸å¯¼å…¥"><a href="#4-è¡¨çš„å¯¼å‡ºä¸å¯¼å…¥" class="headerlink" title="4. è¡¨çš„å¯¼å‡ºä¸å¯¼å…¥"></a><strong>4.</strong> <strong>è¡¨çš„å¯¼å‡ºä¸å¯¼å…¥</strong></h4><h5 id="4-1-è¡¨çš„å¯¼å‡º"><a href="#4-1-è¡¨çš„å¯¼å‡º" class="headerlink" title="4.1 è¡¨çš„å¯¼å‡º"></a><strong>4.1</strong> <strong>è¡¨çš„å¯¼å‡º</strong></h5><p><strong>1.</strong> <strong>ä½¿ç”¨SELECTâ€¦INTO OUTFILEå¯¼å‡ºæ–‡æœ¬æ–‡ä»¶</strong> </p><pre><code class="mysql">SHOW GLOBAL VARIABLES LIKE &#39;%secure%&#39;;SELECT * FROM account INTO OUTFILE &quot;/var/lib/mysql-files/account.txt&quot;;</code></pre><p><strong>2.</strong> <strong>ä½¿ç”¨mysqldumpå‘½ä»¤å¯¼å‡ºæ–‡æœ¬æ–‡ä»¶</strong></p><pre><code class="shell">mysqldump -uroot -p -T &quot;/var/lib/mysql-files/&quot; atguigu account# æˆ–mysqldump -uroot -p -T &quot;/var/lib/mysql-files/&quot; atguigu account --fields-terminated- by=&#39;,&#39; --fields-optionally-enclosed-by=&#39;\&quot;&#39;</code></pre><p><strong>3.</strong> <strong>ä½¿ç”¨mysqlå‘½ä»¤å¯¼å‡ºæ–‡æœ¬æ–‡ä»¶</strong></p><pre><code class="shell">mysql -uroot -p --execute=&quot;SELECT * FROM account;&quot; atguigu&gt; &quot;/var/lib/mysql-files/account.txt&quot;</code></pre><h5 id="4-2-è¡¨çš„å¯¼å…¥"><a href="#4-2-è¡¨çš„å¯¼å…¥" class="headerlink" title="4.2 è¡¨çš„å¯¼å…¥"></a><strong>4.2</strong> <strong>è¡¨çš„å¯¼å…¥</strong></h5><p><strong>1.</strong> <strong>ä½¿ç”¨LOAD DATA INFILEæ–¹å¼å¯¼å…¥æ–‡æœ¬æ–‡ä»¶</strong></p><pre><code class="mysql">LOAD DATA INFILE &#39;/var/lib/mysql-files/account_0.txt&#39; INTO TABLE atguigu.account;# æˆ–LOAD DATA INFILE &#39;/var/lib/mysql-files/account_1.txt&#39; INTO TABLE atguigu.account FIELDS TERMINATED BY &#39;,&#39; ENCLOSED BY &#39;\&quot;&#39;;</code></pre><p><strong>2.</strong> <strong>ä½¿ç”¨mysqlimportæ–¹å¼å¯¼å…¥æ–‡æœ¬æ–‡ä»¶</strong></p><pre><code class="shell">mysqlimport -uroot -p atguigu &#39;/var/lib/mysql-files/account.txt&#39; --fields-terminated- by=&#39;,&#39; --fields-optionally-enclosed-by=&#39;\&quot;&#39;</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬06ç«  ç´¢å¼•çš„æ•°æ®ç»“æ„</title>
      <link href="/2023/07/15/%E7%AC%AC06%E7%AB%A0%20%E7%B4%A2%E5%BC%95%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
      <url>/2023/07/15/%E7%AC%AC06%E7%AB%A0%20%E7%B4%A2%E5%BC%95%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬06ç« -ç´¢å¼•çš„æ•°æ®ç»“æ„"><a href="#ç¬¬06ç« -ç´¢å¼•çš„æ•°æ®ç»“æ„" class="headerlink" title="ç¬¬06ç«  ç´¢å¼•çš„æ•°æ®ç»“æ„"></a>ç¬¬06ç«  ç´¢å¼•çš„æ•°æ®ç»“æ„</h3><h4 id="1-ç´¢å¼•åŠå…¶ä¼˜ç¼ºç‚¹"><a href="#1-ç´¢å¼•åŠå…¶ä¼˜ç¼ºç‚¹" class="headerlink" title="1. ç´¢å¼•åŠå…¶ä¼˜ç¼ºç‚¹"></a><strong>1.</strong> <strong>ç´¢å¼•åŠå…¶ä¼˜ç¼ºç‚¹</strong></h4><h5 id="1-1-ç´¢å¼•æ¦‚è¿°"><a href="#1-1-ç´¢å¼•æ¦‚è¿°" class="headerlink" title="1.1 ç´¢å¼•æ¦‚è¿°"></a><strong>1.1</strong> <strong>ç´¢å¼•æ¦‚è¿°</strong></h5><p>MySQLå®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼š<strong>ç´¢å¼•ï¼ˆIndexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„</strong>ã€‚</p><p><strong>ç´¢å¼•çš„æœ¬è´¨ï¼š</strong>ç´¢å¼•æ˜¯æ•°æ®ç»“æ„ã€‚ä½ å¯ä»¥ç®€å•ç†è§£ä¸ºâ€œæ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç»“æ„â€ï¼Œæ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•ã€‚è¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼æŒ‡å‘æ•°æ®ï¼Œ è¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„çš„åŸºç¡€ä¸Šå®ç°<code>é«˜çº§æŸ¥æ‰¾ç®—æ³•</code>ã€‚</p><h5 id="1-2-ä¼˜ç‚¹"><a href="#1-2-ä¼˜ç‚¹" class="headerlink" title="1.2 ä¼˜ç‚¹"></a><strong>1.2</strong> <strong>ä¼˜ç‚¹</strong></h5><p>ï¼ˆ1ï¼‰ç±»ä¼¼å¤§å­¦å›¾ä¹¦é¦†å»ºä¹¦ç›®ç´¢å¼•ï¼Œæé«˜æ•°æ®æ£€ç´¢çš„æ•ˆç‡ï¼Œé™ä½<code>æ•°æ®åº“çš„IOæˆæœ¬</code>ï¼Œè¿™ä¹Ÿæ˜¯åˆ›å»ºç´¢å¼•æœ€ä¸»è¦çš„åŸå› ã€‚</p><p>ï¼ˆ2ï¼‰é€šè¿‡åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œ<code>æ•°æ®çš„å”¯ä¸€æ€§</code>ã€‚</p><p>ï¼ˆ3ï¼‰åœ¨å®ç°æ•°æ®çš„å‚è€ƒå®Œæ•´æ€§æ–¹é¢ï¼Œå¯ä»¥<code>åŠ é€Ÿè¡¨å’Œè¡¨ä¹‹é—´çš„è¿æ¥</code>ã€‚æ¢å¥è¯è¯´ï¼Œå¯¹äºæœ‰ä¾èµ–å…³ç³»çš„å­è¡¨å’Œçˆ¶è¡¨è”åˆæŸ¥è¯¢æ—¶ï¼Œå¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚</p><p>ï¼ˆ4ï¼‰åœ¨ä½¿ç”¨åˆ†ç»„å’Œæ’åºå­å¥è¿›è¡Œæ•°æ®æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥æ˜¾è‘—<code>å‡å°‘æŸ¥è¯¢ä¸­åˆ†ç»„å’Œæ’åºçš„æ—¶é—´</code>ï¼Œé™ä½äº†CPUçš„æ¶ˆè€—ã€‚</p><h5 id="1-3-ç¼ºç‚¹"><a href="#1-3-ç¼ºç‚¹" class="headerlink" title="1.3 ç¼ºç‚¹"></a><strong>1.3</strong> <strong>ç¼ºç‚¹</strong></h5><p>ï¼ˆ1ï¼‰åˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•è¦<code>è€—è´¹æ—¶é—´</code>ï¼Œå¹¶ä¸”éšç€æ•°æ®é‡çš„å¢åŠ ï¼Œæ‰€è€—è´¹çš„æ—¶é—´ä¹Ÿä¼šå¢åŠ ã€‚</p><p>ï¼ˆ2ï¼‰ç´¢å¼•éœ€è¦å <code>ç£ç›˜ç©ºé—´</code>ï¼Œé™¤äº†æ•°æ®è¡¨å æ•°æ®ç©ºé—´ä¹‹å¤–ï¼Œæ¯ä¸€ä¸ªç´¢å¼•è¿˜è¦å ä¸€å®šçš„ç‰©ç†ç©ºé—´<code>å­˜å‚¨åœ¨ç£ç›˜ä¸Š</code>ï¼Œå¦‚æœæœ‰å¤§é‡çš„ç´¢å¼•ï¼Œç´¢å¼•æ–‡ä»¶å°±å¯èƒ½æ¯”æ•°æ®æ–‡ä»¶æ›´å¿«è¾¾åˆ°æœ€å¤§æ–‡ä»¶å°ºå¯¸ã€‚</p><p>ï¼ˆ3ï¼‰è™½ç„¶ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢é€Ÿåº¦ï¼ŒåŒæ—¶å´ä¼š<code>é™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦</code>ã€‚å½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€åœ°ç»´æŠ¤ï¼Œè¿™æ ·å°±é™ä½äº†æ•°æ®çš„ç»´æŠ¤é€Ÿåº¦ã€‚</p><h4 id="2-InnoDBä¸­ç´¢å¼•çš„æ¨æ¼”"><a href="#2-InnoDBä¸­ç´¢å¼•çš„æ¨æ¼”" class="headerlink" title="2. InnoDBä¸­ç´¢å¼•çš„æ¨æ¼”"></a><strong>2. InnoDBä¸­ç´¢å¼•çš„æ¨æ¼”</strong></h4><h5 id="2-1-ç´¢å¼•ä¹‹å‰çš„æŸ¥æ‰¾"><a href="#2-1-ç´¢å¼•ä¹‹å‰çš„æŸ¥æ‰¾" class="headerlink" title="2.1 ç´¢å¼•ä¹‹å‰çš„æŸ¥æ‰¾"></a><strong>2.1</strong> <strong>ç´¢å¼•ä¹‹å‰çš„æŸ¥æ‰¾</strong></h5><pre><code class="mysql">SELECT [åˆ—ååˆ—è¡¨] FROM è¡¨å WHERE åˆ—å = xxx;</code></pre><p><strong>1.åœ¨ä¸€ä¸ªé¡µä¸­çš„æŸ¥æ‰¾</strong></p><p>å‡è®¾ç›®å‰è¡¨ä¸­çš„è®°å½•æ¯”è¾ƒå°‘ï¼Œæ‰€æœ‰çš„è®°å½•éƒ½å¯ä»¥è¢«å­˜æ”¾åœ¨ä¸€ä¸ªé¡µä¸­ï¼Œåœ¨æŸ¥æ‰¾è®°å½•çš„æ—¶å€™å¯ä»¥æ ¹æ®æœç´¢æ¡ä»¶çš„ä¸åŒåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><ul><li>ä»¥ä¸»é”®ä¸ºæœç´¢æ¡ä»¶<ul><li>å¯ä»¥åœ¨é¡µç›®å½•ä¸­ä½¿ç”¨<code>äºŒåˆ†æ³•</code>å¿«é€Ÿå®šä½åˆ°å¯¹åº”çš„æ§½ï¼Œç„¶åå†éå†è¯¥æ§½å¯¹åº”åˆ†ç»„ä¸­çš„è®°å½•å³å¯å¿«é€Ÿæ‰¾åˆ°æŒ‡å®šçš„è®°å½•ã€‚</li></ul></li><li>ä»¥å…¶ä»–åˆ—ä½œä¸ºæœç´¢æ¡ä»¶<ul><li>å› ä¸ºåœ¨æ•°æ®é¡µä¸­å¹¶æ²¡æœ‰å¯¹éä¸»é”®å»ºç«‹æ‰€è°“çš„é¡µç›®å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½ç›¸åº”çš„æ§½ã€‚è¿™ç§æƒ…å†µä¸‹åªèƒ½ä»æœ€å°è®°å½•å¼€å§‹ä¾æ¬¡éå†å•é“¾è¡¨ä¸­çš„æ¯æ¡è®°å½•ï¼Œç„¶åå¯¹æ¯”æ¯æ¡è®°å½•æ˜¯ä¸æ˜¯ç¬¦åˆæœç´¢æ¡ä»¶ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™ç§æŸ¥æ‰¾çš„æ•ˆç‡æ˜¯éå¸¸ä½çš„ã€‚</li></ul></li></ul><p><strong>2.åœ¨å¾ˆå¤šé¡µä¸­æŸ¥æ‰¾</strong></p><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬è¡¨ä¸­å­˜æ”¾çš„è®°å½•éƒ½æ˜¯éå¸¸å¤šçš„ï¼Œéœ€è¦å¥½å¤šçš„æ•°æ®é¡µæ¥å­˜å‚¨è¿™äº›è®°å½•ã€‚åœ¨å¾ˆå¤šé¡µä¸­æŸ¥æ‰¾è®°å½•çš„è¯å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p><ol><li>å®šä½åˆ°è®°å½•æ‰€åœ¨çš„é¡µã€‚</li><li>ä»æ‰€åœ¨çš„é¡µå†…æŸ¥æ‰¾ç›¸åº”çš„è®°å½•ã€‚</li></ol><p>åœ¨æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œä¸è®ºæ˜¯æ ¹æ®ä¸»é”®åˆ—æˆ–è€…å…¶ä»–åˆ—çš„å€¼è¿›è¡ŒæŸ¥æ‰¾ï¼Œç”±äºæˆ‘ä»¬å¹¶ä¸èƒ½å¿«é€Ÿçš„å®šä½åˆ°è®°å½•æ‰€åœ¨çš„é¡µï¼Œæ‰€ä»¥åªèƒ½<code>ä»ç¬¬ä¸€ä¸ªé¡µ</code>æ²¿ç€<code>åŒå‘é“¾è¡¨</code>ä¸€ç›´å¾€ä¸‹æ‰¾ï¼Œåœ¨æ¯ä¸€ä¸ªé¡µä¸­æ ¹æ®æˆ‘ä»¬ä¸Šé¢çš„æŸ¥æ‰¾æ–¹å¼å»æŸ¥æ‰¾æŒ‡å®šçš„è®°å½•ã€‚å› ä¸ºè¦éå†æ‰€æœ‰çš„æ•°æ®é¡µï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼æ˜¾ç„¶æ˜¯<code>è¶…çº§è€—æ—¶</code>çš„ã€‚</p><h5 id="2-2-è®¾è®¡ç´¢å¼•"><a href="#2-2-è®¾è®¡ç´¢å¼•" class="headerlink" title="2.2 è®¾è®¡ç´¢å¼•"></a><strong>2.2</strong> <strong>è®¾è®¡ç´¢å¼•</strong></h5><pre><code class="mysql">mysql&gt; CREATE TABLE index_demo(    -&gt; c1 INT,    -&gt; c2 INT,    -&gt; c3 CHAR(1),    -&gt; PRIMARY KEY(c1)    -&gt; ) ROW_FORMAT = Compact;</code></pre><p>è¿™ä¸ªæ–°å»ºçš„<code>index_demo</code>è¡¨ä¸­æœ‰2ä¸ªINTç±»å‹çš„åˆ—ï¼Œ1ä¸ªCHAR(1)ç±»å‹çš„åˆ—ï¼Œè€Œä¸”æˆ‘ä»¬è§„å®šäº†c1åˆ—ä¸ºä¸»é”®ï¼Œè¿™ä¸ªè¡¨ä½¿ç”¨<code>Compact</code>è¡Œæ ¼å¼æ¥å®é™…å­˜å‚¨è®°å½•çš„ã€‚è¿™é‡Œæˆ‘ä»¬ç®€åŒ–äº†index_demoè¡¨çš„è¡Œæ ¼å¼ç¤ºæ„å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203300956080.png" alt="image-20220330095642965"></p><ul><li><code>record_type</code>ï¼šè®°å½•å¤´ä¿¡æ¯çš„ä¸€é¡¹å±æ€§ï¼Œè¡¨ç¤ºè®°å½•çš„ç±»å‹ï¼Œ<code>0</code>è¡¨ç¤ºæ™®é€šè®°å½•ã€<code>1</code>è¡¨ç¤ºç›®å½•é¡¹è®°å½•ã€<code>2</code>è¡¨ç¤ºæœ€å°è®°å½•ã€<code>3</code>è¡¨ç¤ºæœ€å¤§è®°å½•ã€‚</li><li><code>next_record</code>ï¼šè®°å½•å¤´ä¿¡æ¯çš„ä¸€é¡¹å±æ€§ï¼Œè¡¨ç¤ºä¸‹ä¸€æ¡åœ°å€ç›¸å¯¹äºæœ¬æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼Œæˆ‘ä»¬ç”¨ç®­å¤´æ¥è¡¨æ˜ä¸‹ä¸€æ¡è®°å½•æ˜¯è°ã€‚</li><li><code>å„ä¸ªåˆ—çš„å€¼</code>ï¼šè¿™é‡Œåªè®°å½•åœ¨<code>index_demo</code>è¡¨ä¸­çš„ä¸‰ä¸ªåˆ—ï¼Œåˆ†åˆ«æ˜¯<code>c1</code>ã€<code>c2</code>å’Œ<code>c3</code>ã€‚ </li><li><code>å…¶ä»–ä¿¡æ¯</code>ï¼šé™¤äº†ä¸Šè¿°3ç§ä¿¡æ¯ä»¥å¤–çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶ä»–éšè—åˆ—çš„å€¼ä»¥åŠè®°å½•çš„é¢å¤–ä¿¡æ¯ã€‚</li></ul><p>å°†è®°å½•æ ¼å¼ç¤ºæ„å›¾çš„å…¶ä»–ä¿¡æ¯é¡¹æš‚æ—¶å»æ‰å¹¶æŠŠå®ƒç«–èµ·æ¥çš„æ•ˆæœå°±æ˜¯è¿™æ ·ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301000365.png" alt="image-20220330100053271"></p><p>æŠŠä¸€äº›è®°å½•æ”¾åˆ°é¡µé‡Œçš„ç¤ºæ„å›¾å°±æ˜¯ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301001377.png" alt="image-20220330100150297"></p><p><strong>1.</strong> <strong>ä¸€ä¸ªç®€å•çš„ç´¢å¼•è®¾è®¡æ–¹æ¡ˆ</strong></p><p>æˆ‘ä»¬åœ¨æ ¹æ®æŸä¸ªæœç´¢æ¡ä»¶æŸ¥æ‰¾ä¸€äº›è®°å½•æ—¶ä¸ºä»€ä¹ˆè¦éå†æ‰€æœ‰çš„æ•°æ®é¡µå‘¢ï¼Ÿå› ä¸ºå„ä¸ªé¡µä¸­çš„è®°å½•å¹¶æ²¡æœ‰è§„å¾‹ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“æˆ‘ä»¬çš„æœç´¢æ¡ä»¶åŒ¹é…å“ªäº›é¡µä¸­çš„è®°å½•ï¼Œæ‰€ä»¥ä¸å¾—ä¸ä¾æ¬¡éå†æ‰€æœ‰çš„æ•°æ®é¡µã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬<code>æƒ³å¿«é€Ÿçš„å®šä½åˆ°éœ€è¦æŸ¥æ‰¾çš„è®°å½•åœ¨å“ªäº›æ•°æ®é¡µ</code>ä¸­è¯¥å’‹åŠï¼Ÿæˆ‘ä»¬å¯ä»¥ä¸ºå¿«é€Ÿå®šä½è®°å½•æ‰€åœ¨çš„æ•°æ®é¡µè€Œ<code>å»ºç«‹ä¸€ä¸ªç›®å½•</code>ï¼Œå»ºè¿™ä¸ªç›®å½•å¿…é¡»å®Œæˆä¸‹è¾¹è¿™äº›äº‹ï¼š</p><ul><li><strong>ä¸‹ä¸€ä¸ªæ•°æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€ä¸ªé¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼ã€‚</strong></li><li><strong>ç»™æ‰€æœ‰çš„é¡µå»ºç«‹ä¸€ä¸ªç›®å½•é¡¹ã€‚</strong></li></ul><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301004386.png" alt="image-20220330100409306"></p><p>ä»¥<code>é¡µ28</code>ä¸ºä¾‹ï¼Œå®ƒå¯¹åº”<code>ç›®å½•é¡¹2</code>ï¼Œè¿™ä¸ªç›®å½•é¡¹ä¸­åŒ…å«ç€è¯¥é¡µçš„é¡µå·<code>28</code>ä»¥åŠè¯¥é¡µä¸­ç”¨æˆ·è®°å½•çš„æœ€å°ä¸»é”®å€¼<code>5</code>ã€‚æˆ‘ä»¬åªéœ€è¦æŠŠå‡ ä¸ªç›®å½•é¡¹åœ¨ç‰©ç†å­˜å‚¨å™¨ä¸Šè¿ç»­å­˜å‚¨ï¼ˆæ¯”å¦‚ï¼šæ•°ç»„ï¼‰ï¼Œå°±å¯ä»¥å®ç°æ ¹æ®ä¸»é”®å€¼å¿«é€ŸæŸ¥æ‰¾æŸæ¡è®°å½•çš„åŠŸèƒ½äº†ã€‚æ¯”å¦‚ï¼šæŸ¥æ‰¾ä¸»é”®å€¼ä¸º<code>20</code>çš„è®°å½•ï¼Œå…·ä½“æŸ¥æ‰¾è¿‡ç¨‹åˆ†ä¸¤æ­¥ï¼š</p><ol><li><p>å…ˆä»ç›®å½•é¡¹ä¸­æ ¹æ®<code>äºŒåˆ†æ³•</code>å¿«é€Ÿç¡®å®šå‡ºä¸»é”®å€¼ä¸º<code>20</code>çš„è®°å½•åœ¨<code>ç›®å½•é¡¹3</code>ä¸­ï¼ˆå› ä¸º 12 &lt; 20 &lt; 209 ï¼‰ï¼Œå®ƒå¯¹åº”çš„é¡µæ˜¯<code>é¡µ9</code>ã€‚ </p></li><li><p>å†æ ¹æ®å‰è¾¹è¯´çš„åœ¨é¡µä¸­æŸ¥æ‰¾è®°å½•çš„æ–¹å¼å»<code>é¡µ9</code>ä¸­å®šä½å…·ä½“çš„è®°å½•ã€‚</p></li></ol><p>è‡³æ­¤ï¼Œé’ˆå¯¹æ•°æ®é¡µåšçš„ç®€æ˜“ç›®å½•å°±æå®šäº†ã€‚è¿™ä¸ªç›®å½•æœ‰ä¸€ä¸ªåˆ«åï¼Œç§°ä¸º<code>ç´¢å¼•</code>ã€‚</p><p><strong>2. InnoDBä¸­çš„ç´¢å¼•æ–¹æ¡ˆ</strong> </p><p><strong>â‘  è¿­ä»£1æ¬¡ï¼šç›®å½•é¡¹çºªå½•çš„é¡µ</strong></p><p>æˆ‘ä»¬æŠŠå‰è¾¹ä½¿ç”¨åˆ°çš„ç›®å½•é¡¹æ”¾åˆ°æ•°æ®é¡µä¸­çš„æ ·å­å°±æ˜¯è¿™æ ·ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301028743.png" alt="image-20220330102834658"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬æ–°åˆ†é…äº†ä¸€ä¸ªç¼–å·ä¸º30çš„é¡µæ¥ä¸“é—¨å­˜å‚¨ç›®å½•é¡¹è®°å½•ã€‚è¿™é‡Œå†æ¬¡å¼ºè°ƒ<code>ç›®å½•é¡¹è®°å½•</code>å’Œæ™®é€šçš„<code>ç”¨æˆ·è®°å½•</code>çš„<strong>ä¸åŒç‚¹</strong>ï¼š</p><ul><li><code>ç›®å½•é¡¹è®°å½•</code>çš„<code>record_type</code>å€¼æ˜¯1ï¼Œè€Œ<code>æ™®é€šç”¨æˆ·è®°å½•</code>çš„<code>record_type</code>å€¼æ˜¯0ã€‚</li><li>ç›®å½•é¡¹è®°å½•åªæœ‰<code>ä¸»é”®å€¼å’Œé¡µçš„ç¼–å·</code>ä¸¤ä¸ªåˆ—ï¼Œè€Œæ™®é€šçš„ç”¨æˆ·è®°å½•çš„åˆ—æ˜¯ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ï¼Œå¯èƒ½åŒ…å«<code>å¾ˆå¤šåˆ—</code>ï¼Œå¦å¤–è¿˜æœ‰InnoDBè‡ªå·±æ·»åŠ çš„éšè—åˆ—ã€‚</li><li>äº†è§£ï¼šè®°å½•å¤´ä¿¡æ¯é‡Œè¿˜æœ‰ä¸€ä¸ªå«<code>min_rec_mask</code>çš„å±æ€§ï¼Œåªæœ‰åœ¨å­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µä¸­çš„ä¸»é”®å€¼æœ€å°çš„<code>ç›®å½•é¡¹è®°å½•</code>çš„<code>min_rec_mask</code>å€¼ä¸º<code>1</code>ï¼Œå…¶ä»–åˆ«çš„è®°å½•çš„<code>min_rec_mask</code>å€¼éƒ½æ˜¯<code>0</code>ã€‚</li></ul><p><strong>ç›¸åŒç‚¹ï¼š</strong>ä¸¤è€…ç”¨çš„æ˜¯ä¸€æ ·çš„æ•°æ®é¡µï¼Œéƒ½ä¼šä¸ºä¸»é”®å€¼ç”Ÿæˆ<code>Page Directory</code>ï¼ˆé¡µç›®å½•ï¼‰ï¼Œä»è€Œåœ¨æŒ‰ç…§ä¸»é”®å€¼è¿›è¡ŒæŸ¥æ‰¾æ—¶å¯ä»¥ä½¿ç”¨<code>äºŒåˆ†æ³•</code>æ¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚</p><p>ç°åœ¨ä»¥æŸ¥æ‰¾ä¸»é”®ä¸º<code>20</code>çš„è®°å½•ä¸ºä¾‹ï¼Œæ ¹æ®æŸä¸ªä¸»é”®å€¼å»æŸ¥æ‰¾è®°å½•çš„æ­¥éª¤å°±å¯ä»¥å¤§è‡´æ‹†åˆ†æˆä¸‹è¾¹ä¸¤æ­¥ï¼š</p><ol><li><p>å…ˆåˆ°å­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µï¼Œä¹Ÿå°±æ˜¯é¡µ30ä¸­é€šè¿‡<code>äºŒåˆ†æ³•</code>å¿«é€Ÿå®šä½åˆ°å¯¹åº”ç›®å½•é¡¹ï¼Œå› ä¸º 12 &lt; 20 &lt; 209 ï¼Œæ‰€ä»¥å®šä½åˆ°å¯¹åº”çš„è®°å½•æ‰€åœ¨çš„é¡µå°±æ˜¯é¡µ9ã€‚ </p></li><li><p>å†åˆ°å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µ9ä¸­æ ¹æ®<code>äºŒåˆ†æ³•</code>å¿«é€Ÿå®šä½åˆ°ä¸»é”®å€¼ä¸º<code>20</code>çš„ç”¨æˆ·è®°å½•ã€‚</p></li></ol><p><strong>â‘¡ è¿­ä»£2æ¬¡ï¼šå¤šä¸ªç›®å½•é¡¹çºªå½•çš„é¡µ</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301034997.png" alt="image-20220330103442914"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬æ’å…¥äº†ä¸€æ¡ä¸»é”®å€¼ä¸º320çš„ç”¨æˆ·è®°å½•ä¹‹åéœ€è¦ä¸¤ä¸ªæ–°çš„æ•°æ®é¡µï¼š</p><ul><li>ä¸ºå­˜å‚¨è¯¥ç”¨æˆ·è®°å½•è€Œæ–°ç”Ÿæˆäº†<code>é¡µ31</code>ã€‚</li><li>å› ä¸ºåŸå…ˆå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„<code>é¡µ30çš„å®¹é‡å·²æ»¡</code>ï¼ˆæˆ‘ä»¬å‰è¾¹å‡è®¾åªèƒ½å­˜å‚¨4æ¡ç›®å½•é¡¹è®°å½•ï¼‰ï¼Œæ‰€ä»¥ä¸å¾—ä¸éœ€è¦ä¸€ä¸ªæ–°çš„<code>é¡µ32</code>æ¥å­˜æ”¾<code>é¡µ31</code>å¯¹åº”çš„ç›®å½•é¡¹ã€‚</li></ul><p>ç°åœ¨å› ä¸ºå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µä¸æ­¢ä¸€ä¸ªï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³æ ¹æ®ä¸»é”®å€¼æŸ¥æ‰¾ä¸€æ¡ç”¨æˆ·è®°å½•å¤§è‡´éœ€è¦3ä¸ªæ­¥éª¤ï¼Œä»¥æŸ¥æ‰¾ä¸»é”®å€¼ä¸º<code>20</code>çš„è®°å½•ä¸ºä¾‹ï¼š</p><ol><li><p>ç¡®å®š<code>ç›®å½•é¡¹è®°å½•é¡µ</code>æˆ‘ä»¬ç°åœ¨çš„å­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µæœ‰ä¸¤ä¸ªï¼Œå³<code>é¡µ30</code>å’Œ<code>é¡µ32</code>ï¼Œåˆå› ä¸ºé¡µ30è¡¨ç¤ºçš„ç›®å½•é¡¹çš„ä¸»é”®å€¼çš„èŒƒå›´æ˜¯ [1, 320) ï¼Œé¡µ32è¡¨ç¤ºçš„ç›®å½•é¡¹çš„ä¸»é”®å€¼ä¸å°äº 320 ï¼Œæ‰€ä»¥ä¸»é”®å€¼ä¸º<code>20</code>çš„è®°å½•å¯¹åº”çš„ç›®å½•é¡¹è®°å½•åœ¨<code>é¡µ30</code>ä¸­ã€‚</p></li><li><p>é€šè¿‡ç›®å½•é¡¹è®°å½•é¡µ<code>ç¡®å®šç”¨æˆ·è®°å½•çœŸå®æ‰€åœ¨çš„é¡µ</code>ã€‚åœ¨ä¸€ä¸ªå­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µä¸­é€šè¿‡ä¸»é”®å€¼å®šä½ä¸€æ¡ç›®å½•é¡¹è®°å½•çš„æ–¹å¼è¯´è¿‡äº†ã€‚</p></li><li><p>åœ¨çœŸå®å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µä¸­å®šä½åˆ°å…·ä½“çš„è®°å½•ã€‚</p></li></ol><p><strong>â‘¢ è¿­ä»£3æ¬¡ï¼šç›®å½•é¡¹è®°å½•é¡µçš„ç›®å½•é¡µ</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301038376.png" alt="image-20220330103847284"></p><p>å¦‚å›¾ï¼Œæˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªå­˜å‚¨æ›´é«˜çº§ç›®å½•é¡¹çš„<code>é¡µ33</code>ï¼Œè¿™ä¸ªé¡µä¸­çš„ä¸¤æ¡è®°å½•åˆ†åˆ«ä»£è¡¨é¡µ30å’Œé¡µ32ï¼Œå¦‚æœç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼åœ¨<code>[1, 320)</code>ä¹‹é—´ï¼Œåˆ™åˆ°é¡µ30ä¸­æŸ¥æ‰¾æ›´è¯¦ç»†çš„ç›®å½•é¡¹è®°å½•ï¼Œå¦‚æœä¸»é”®å€¼<code>ä¸å°äº320</code>çš„è¯ï¼Œå°±åˆ°é¡µ32ä¸­æŸ¥æ‰¾æ›´è¯¦ç»†çš„ç›®å½•é¡¹è®°å½•ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹è¾¹è¿™ä¸ªå›¾æ¥æè¿°å®ƒï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301040190.png" alt="image-20220330104012108"></p><p>è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œå®ƒçš„åç§°æ˜¯<code>B+æ ‘</code>ã€‚ </p><p><strong>â‘£</strong> <strong>B+Tree</strong></p><p>ä¸€ä¸ªB+æ ‘çš„èŠ‚ç‚¹å…¶å®å¯ä»¥åˆ†æˆå¥½å¤šå±‚ï¼Œè§„å®šæœ€ä¸‹è¾¹çš„é‚£å±‚ï¼Œä¹Ÿå°±æ˜¯å­˜æ”¾æˆ‘ä»¬ç”¨æˆ·è®°å½•çš„é‚£å±‚ä¸ºç¬¬<code>0</code>å±‚ï¼Œä¹‹åä¾æ¬¡å¾€ä¸ŠåŠ ã€‚ä¹‹å‰æˆ‘ä»¬åšäº†ä¸€ä¸ªéå¸¸æç«¯çš„å‡è®¾ï¼šå­˜æ”¾ç”¨æˆ·è®°å½•çš„é¡µ<code>æœ€å¤šå­˜æ”¾3æ¡è®°å½•</code>ï¼Œå­˜æ”¾ç›®å½•é¡¹è®°å½•çš„é¡µ<code>æœ€å¤šå­˜æ”¾4æ¡è®°å½•</code>ã€‚å…¶å®çœŸå®ç¯å¢ƒä¸­ä¸€ä¸ªé¡µå­˜æ”¾çš„è®°å½•æ•°é‡æ˜¯éå¸¸å¤§çš„ï¼Œå‡è®¾æ‰€æœ‰å­˜æ”¾ç”¨æˆ·è®°å½•çš„å¶å­èŠ‚ç‚¹ä»£è¡¨çš„æ•°æ®é¡µå¯ä»¥å­˜æ”¾<code>100æ¡ç”¨æˆ·è®°å½•</code>ï¼Œæ‰€æœ‰å­˜æ”¾ç›®å½•é¡¹è®°å½•çš„å†…èŠ‚ç‚¹ä»£è¡¨çš„æ•°æ®é¡µå¯ä»¥å­˜æ”¾<code>1000æ¡ç›®å½•é¡¹è®°å½•</code>ï¼Œé‚£ä¹ˆï¼š</p><ul><li>å¦‚æœB+æ ‘åªæœ‰1å±‚ï¼Œä¹Ÿå°±æ˜¯åªæœ‰1ä¸ªç”¨äºå­˜æ”¾ç”¨æˆ·è®°å½•çš„èŠ‚ç‚¹ï¼Œæœ€å¤šèƒ½å­˜æ”¾<code>100</code>æ¡è®°å½•ã€‚</li><li>å¦‚æœB+æ ‘æœ‰2å±‚ï¼Œæœ€å¤šèƒ½å­˜æ”¾<code>1000Ã—100=10,0000</code>æ¡è®°å½•ã€‚</li><li>å¦‚æœB+æ ‘æœ‰3å±‚ï¼Œæœ€å¤šèƒ½å­˜æ”¾<code>1000Ã—1000Ã—100=1,0000,0000</code>æ¡è®°å½•ã€‚</li><li>å¦‚æœB+æ ‘æœ‰4å±‚ï¼Œæœ€å¤šèƒ½å­˜æ”¾<code>1000Ã—1000Ã—1000Ã—100=1000,0000,0000</code>æ¡è®°å½•ã€‚ç›¸å½“å¤šçš„è®°å½•ï¼ï¼ï¼</li></ul><p>ä½ çš„è¡¨é‡Œèƒ½å­˜æ”¾<code>100000000000</code>æ¡è®°å½•å—ï¼Ÿæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬<code>ç”¨åˆ°çš„B+æ ‘éƒ½ä¸ä¼šè¶…è¿‡4å±‚</code>ï¼Œé‚£æˆ‘ä»¬é€šè¿‡ä¸»é”®å€¼å»æŸ¥æ‰¾æŸæ¡è®°å½•æœ€å¤šåªéœ€è¦åš4ä¸ªé¡µé¢å†…çš„æŸ¥æ‰¾ï¼ˆæŸ¥æ‰¾3ä¸ªç›®å½•é¡¹é¡µå’Œä¸€ä¸ªç”¨æˆ·è®°å½•é¡µï¼‰ï¼Œåˆå› ä¸ºåœ¨æ¯ä¸ªé¡µé¢å†…æœ‰æ‰€è°“çš„<code>Page Directory</code>ï¼ˆé¡µç›®å½•ï¼‰ï¼Œæ‰€ä»¥åœ¨é¡µé¢å†…ä¹Ÿå¯ä»¥é€šè¿‡<code>äºŒåˆ†æ³•</code>å®ç°å¿«é€Ÿå®šä½è®°å½•ã€‚</p><h5 id="2-3-å¸¸è§ç´¢å¼•æ¦‚å¿µ"><a href="#2-3-å¸¸è§ç´¢å¼•æ¦‚å¿µ" class="headerlink" title="2.3 å¸¸è§ç´¢å¼•æ¦‚å¿µ"></a><strong>2.3</strong> <strong>å¸¸è§ç´¢å¼•æ¦‚å¿µ</strong></h5><p><strong>1.</strong> <strong>èšç°‡ç´¢å¼•</strong></p><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ol><li><p>ä½¿ç”¨è®°å½•ä¸»é”®å€¼çš„å¤§å°è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åºï¼Œè¿™åŒ…æ‹¬ä¸‰ä¸ªæ–¹é¢çš„å«ä¹‰ï¼š</p><ul><li><p><code>é¡µå†…</code>çš„è®°å½•æ˜¯æŒ‰ç…§ä¸»é”®çš„å¤§å°é¡ºåºæ’æˆä¸€ä¸ª<code>å•å‘é“¾è¡¨</code>ã€‚</p></li><li><p>å„ä¸ªå­˜æ”¾<code>ç”¨æˆ·è®°å½•çš„é¡µ</code>ä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å¤§å°é¡ºåºæ’æˆä¸€ä¸ª<code>åŒå‘é“¾è¡¨</code>ã€‚</p></li><li><p>å­˜æ”¾<code>ç›®å½•é¡¹è®°å½•çš„é¡µ</code>åˆ†ä¸ºä¸åŒçš„å±‚æ¬¡ï¼Œåœ¨åŒä¸€å±‚æ¬¡ä¸­çš„é¡µä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç›®å½•é¡¹è®°å½•çš„ä¸»é”®å¤§å°é¡ºåºæ’æˆä¸€ä¸ª<code>åŒå‘é“¾è¡¨</code>ã€‚</p></li></ul></li><li><p>B+æ ‘çš„<code>å¶å­èŠ‚ç‚¹</code>å­˜å‚¨çš„æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚</p><p>æ‰€è°“å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œå°±æ˜¯æŒ‡è¿™ä¸ªè®°å½•ä¸­å­˜å‚¨äº†æ‰€æœ‰åˆ—çš„å€¼ï¼ˆåŒ…æ‹¬éšè—åˆ—ï¼‰ã€‚</p></li></ol><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li><code>æ•°æ®è®¿é—®æ›´å¿«</code>ï¼Œå› ä¸ºèšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªB+æ ‘ä¸­ï¼Œå› æ­¤ä»èšç°‡ç´¢å¼•ä¸­è·å–æ•°æ®æ¯”éèšç°‡ç´¢å¼•æ›´å¿«</li><li>èšç°‡ç´¢å¼•å¯¹äºä¸»é”®çš„<code>æ’åºæŸ¥æ‰¾</code>å’Œ<code>èŒƒå›´æŸ¥æ‰¾</code>é€Ÿåº¦éå¸¸å¿«</li><li>æŒ‰ç…§èšç°‡ç´¢å¼•æ’åˆ—é¡ºåºï¼ŒæŸ¥è¯¢æ˜¾ç¤ºä¸€å®šèŒƒå›´æ•°æ®çš„æ—¶å€™ï¼Œç”±äºæ•°æ®éƒ½æ˜¯ç´§å¯†ç›¸è¿ï¼Œæ•°æ®åº“ä¸ç”¨ä»å¤šä¸ªæ•°æ®å—ä¸­æå–æ•°æ®ï¼Œæ‰€ä»¥<code>èŠ‚çœäº†å¤§é‡çš„ioæ“ä½œ</code>ã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li><code>æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–äºæ’å…¥é¡ºåº</code>ï¼ŒæŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’å…¥æ˜¯æœ€å¿«çš„æ–¹å¼ï¼Œå¦åˆ™å°†ä¼šå‡ºç°é¡µåˆ†è£‚ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚å› æ­¤ï¼Œå¯¹äºInnoDBè¡¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šå®šä¹‰ä¸€ä¸ª<strong>è‡ªå¢IDåˆ—ä¸ºä¸»é”®</strong></li><li><code>æ›´æ–°ä¸»é”®çš„ä»£ä»·å¾ˆé«˜</code>ï¼Œå› ä¸ºå°†ä¼šå¯¼è‡´è¢«æ›´æ–°çš„è¡Œç§»åŠ¨ã€‚å› æ­¤ï¼Œå¯¹äºInnoDBè¡¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬å®šä¹‰<strong>ä¸»é”®ä¸ºä¸å¯æ›´æ–°</strong></li><li><code>äºŒçº§ç´¢å¼•è®¿é—®éœ€è¦ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾</code>ï¼Œç¬¬ä¸€æ¬¡æ‰¾åˆ°ä¸»é”®å€¼ï¼Œç¬¬äºŒæ¬¡æ ¹æ®ä¸»é”®å€¼æ‰¾åˆ°è¡Œæ•°æ®</li></ul><p><strong>2.</strong> <strong>äºŒçº§ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ã€éèšç°‡ç´¢å¼•ï¼‰</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301050055.png" alt="image-20220330105018965"></p><p><strong>æ¦‚å¿µï¼šå›è¡¨</strong> æˆ‘ä»¬æ ¹æ®è¿™ä¸ªä»¥c2åˆ—å¤§å°æ’åºçš„B+æ ‘åªèƒ½ç¡®å®šæˆ‘ä»¬è¦æŸ¥æ‰¾è®°å½•çš„ä¸»é”®å€¼ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³æ ¹æ®c2åˆ—çš„å€¼æŸ¥æ‰¾åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•çš„è¯ï¼Œä»ç„¶éœ€è¦åˆ°<code>èšç°‡ç´¢å¼•</code>ä¸­å†æŸ¥ä¸€éï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<code>å›è¡¨</code>ã€‚ä¹Ÿå°±æ˜¯æ ¹æ®c2åˆ—çš„å€¼æŸ¥è¯¢ä¸€æ¡å®Œæ•´çš„ç”¨æˆ·è®°å½•éœ€è¦ä½¿ç”¨åˆ°<code>2</code>æ£µB+æ ‘ï¼</p><p><strong>3.</strong> <strong>è”åˆç´¢å¼•</strong></p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶ä»¥å¤šä¸ªåˆ—çš„å¤§å°ä½œä¸ºæ’åºè§„åˆ™ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶ä¸ºå¤šä¸ªåˆ—å»ºç«‹ç´¢å¼•ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬æƒ³è®©B+æ ‘æŒ‰ç…§<code>c2å’Œc3åˆ—</code>çš„å¤§å°è¿›è¡Œæ’åºï¼Œè¿™ä¸ªåŒ…å«ä¸¤å±‚å«ä¹‰ï¼š</p><ul><li><p>å…ˆæŠŠå„ä¸ªè®°å½•å’Œé¡µæŒ‰ç…§c2åˆ—è¿›è¡Œæ’åºã€‚</p></li><li><p>åœ¨è®°å½•çš„c2åˆ—ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œé‡‡ç”¨c3åˆ—è¿›è¡Œæ’åº</p></li></ul><p>æ³¨æ„ä¸€ç‚¹ï¼Œä»¥c2å’Œc3åˆ—çš„å¤§å°ä¸ºæ’åºè§„åˆ™å»ºç«‹çš„B+æ ‘ç§°ä¸º<code>è”åˆç´¢å¼•</code>ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªäºŒçº§ç´¢å¼•ã€‚å®ƒçš„æ„æ€ä¸åˆ†åˆ«ä¸ºc2å’Œc3åˆ—åˆ†åˆ«å»ºç«‹ç´¢å¼•çš„è¡¨è¿°æ˜¯ä¸åŒçš„ï¼Œä¸åŒç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>å»ºç«‹<code>è”åˆç´¢å¼•</code>åªä¼šå»ºç«‹å¦‚ä¸Šå›¾ä¸€æ ·çš„1æ£µB+æ ‘ã€‚</p></li><li><p>ä¸ºc2å’Œc3åˆ—åˆ†åˆ«å»ºç«‹ç´¢å¼•ä¼šåˆ†åˆ«ä»¥c2å’Œc3åˆ—çš„å¤§å°ä¸ºæ’åºè§„åˆ™å»ºç«‹2æ£µB+æ ‘ã€‚</p></li></ul><h5 id="2-4-InnoDBçš„B-æ ‘ç´¢å¼•çš„æ³¨æ„äº‹é¡¹"><a href="#2-4-InnoDBçš„B-æ ‘ç´¢å¼•çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="2.4 InnoDBçš„B+æ ‘ç´¢å¼•çš„æ³¨æ„äº‹é¡¹"></a><strong>2.4 InnoDBçš„B+æ ‘ç´¢å¼•çš„æ³¨æ„äº‹é¡¹</strong></h5><p><strong>1.</strong> <strong>æ ¹é¡µé¢ä½ç½®ä¸‡å¹´ä¸åŠ¨</strong> </p><p>æˆ‘ä»¬å‰è¾¹ä»‹ç»B+ç´¢å¼•çš„æ—¶å€™ï¼Œä¸ºäº†å¤§å®¶ç†è§£ä¸Šçš„æ–¹ä¾¿ï¼Œå…ˆæŠŠå­˜å‚¨ç”¨æˆ·è®°å½•çš„å¶å­èŠ‚ç‚¹éƒ½ç”»å‡ºæ¥ï¼Œç„¶åæ¥ç€ç”»å­˜å‚¨ç›®å½•é¡¹è®°å½•çš„å†…èŠ‚ç‚¹ï¼Œå®é™…ä¸ŠB+æ ‘çš„å½¢æˆè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>æ¯å½“ä¸ºæŸä¸ªè¡¨åˆ›å»ºä¸€ä¸ªB+æ ‘ç´¢å¼•ï¼ˆèšç°‡ç´¢å¼•ä¸æ˜¯äººä¸ºåˆ›å»ºçš„ï¼Œé»˜è®¤å°±æœ‰ï¼‰çš„æ—¶å€™ï¼Œéƒ½ä¼šä¸ºè¿™ä¸ªç´¢å¼•åˆ›å»ºä¸€ä¸ª<code>æ ¹èŠ‚ç‚¹</code>é¡µé¢ã€‚æœ€å¼€å§‹è¡¨ä¸­æ²¡æœ‰æ•°æ®çš„æ—¶å€™ï¼Œæ¯ä¸ªB+æ ‘ç´¢å¼•å¯¹åº”çš„<code>æ ¹èŠ‚ç‚¹</code>ä¸­æ—¢æ²¡æœ‰ç”¨æˆ·è®°å½•ï¼Œä¹Ÿæ²¡æœ‰ç›®å½•é¡¹è®°å½•ã€‚</li><li>éšåå‘è¡¨ä¸­æ’å…¥ç”¨æˆ·è®°å½•æ—¶ï¼Œå…ˆæŠŠç”¨æˆ·è®°å½•å­˜å‚¨åˆ°è¿™ä¸ª<code>æ ¹èŠ‚ç‚¹</code>ä¸­ã€‚</li><li>å½“æ ¹èŠ‚ç‚¹ä¸­çš„å¯ç”¨<code>ç©ºé—´ç”¨å®Œæ—¶</code>ç»§ç»­æ’å…¥è®°å½•ï¼Œæ­¤æ—¶ä¼šå°†æ ¹èŠ‚ç‚¹ä¸­çš„æ‰€æœ‰è®°å½•å¤åˆ¶åˆ°ä¸€ä¸ªæ–°åˆ†é…çš„é¡µï¼Œæ¯”å¦‚<code>é¡µa</code>ä¸­ï¼Œç„¶åå¯¹è¿™ä¸ªæ–°é¡µè¿›è¡Œ<code>é¡µåˆ†è£‚</code>çš„æ“ä½œï¼Œå¾—åˆ°å¦ä¸€ä¸ªæ–°é¡µï¼Œæ¯”å¦‚<code>é¡µb</code>ã€‚è¿™æ—¶æ–°æ’å…¥çš„è®°å½•æ ¹æ®é”®å€¼ï¼ˆä¹Ÿå°±æ˜¯èšç°‡ç´¢å¼•ä¸­çš„ä¸»é”®å€¼ï¼ŒäºŒçº§ç´¢å¼•ä¸­å¯¹åº”çš„ç´¢å¼•åˆ—çš„å€¼ï¼‰çš„å¤§å°å°±ä¼šè¢«åˆ†é…åˆ°<code>é¡µa</code>æˆ–è€…<code>é¡µb</code>ä¸­ï¼Œè€Œ<code>æ ¹èŠ‚ç‚¹</code>ä¾¿å‡çº§ä¸ºå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µã€‚</li></ul><p>è¿™ä¸ªè¿‡ç¨‹ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼šä¸€ä¸ªB+æ ‘ç´¢å¼•çš„æ ¹èŠ‚ç‚¹è‡ªè¯ç”Ÿä¹‹æ—¥èµ·ï¼Œä¾¿ä¸ä¼šå†ç§»åŠ¨ã€‚è¿™æ ·åªè¦æˆ‘ä»¬å¯¹æŸä¸ªè¡¨å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆå®ƒçš„æ ¹èŠ‚ç‚¹çš„é¡µå·ä¾¿ä¼šè¢«è®°å½•åˆ°æŸä¸ªåœ°æ–¹ï¼Œç„¶åå‡¡æ˜¯<code>InnoDB</code>å­˜å‚¨å¼•æ“éœ€è¦ç”¨åˆ°è¿™ä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œéƒ½ä¼šä»é‚£ä¸ªå›ºå®šçš„åœ°æ–¹å–å‡ºæ ¹èŠ‚ç‚¹çš„é¡µå·ï¼Œä»è€Œæ¥è®¿é—®è¿™ä¸ªç´¢å¼•ã€‚</p><p><strong>2.</strong> <strong>å†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„å”¯ä¸€æ€§</strong> </p><p>æˆ‘ä»¬çŸ¥é“B+æ ‘ç´¢å¼•çš„å†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„å†…å®¹æ˜¯<code>ç´¢å¼•åˆ—+é¡µå·</code>çš„æ­é…ï¼Œä½†æ˜¯è¿™ä¸ªæ­é…å¯¹äºäºŒçº§ç´¢å¼•æ¥è¯´æœ‰ç‚¹ä¸ä¸¥è°¨ã€‚è¿˜æ‹¿<code>index_demo</code>è¡¨ä¸ºä¾‹ï¼Œå‡è®¾è¿™ä¸ªè¡¨ä¸­çš„æ•°æ®æ˜¯è¿™æ ·çš„ï¼š</p><table><thead><tr><th>c1</th><th>c2</th><th>c3</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>â€˜uâ€™</td></tr><tr><td>3</td><td>1</td><td>â€˜dâ€™</td></tr><tr><td>5</td><td>1</td><td>â€˜yâ€™</td></tr><tr><td>7</td><td>1</td><td>â€˜aâ€™</td></tr></tbody></table><p>å¦‚æœäºŒçº§ç´¢å¼•ä¸­ç›®å½•é¡¹çš„å†…å®¹åªæ˜¯<code>ç´¢å¼•å·+é¡µå·</code>çš„æ­é…çš„è¯ï¼Œé‚£ä¹ˆä¸º<code>c2</code>åˆ—å»ºç«‹ç´¢å¼•åçš„B+æ ‘åº”è¯¥é•¿è¿™æ ·ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301110222.png" alt="image-20220330111029120"></p><p>å¦‚æœæˆ‘ä»¬æƒ³è¦æ–°æ’å…¥ä¸€è¡Œè®°å½•ï¼Œå…¶ä¸­<code>c1</code>ã€<code>c2</code>ã€<code>c3</code>çš„å€¼åˆ†åˆ«æ˜¯ï¼š<code>9</code>ã€<code>1</code>ã€<code>c</code>ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹è¿™ä¸ªä¸ºc2åˆ—å»ºç«‹çš„äºŒçº§ç´¢å¼•å¯¹åº”çš„B+æ ‘æ—¶ä¾¿ç¢°åˆ°äº†ä¸ªå¤§é—®é¢˜ï¼šç”±äº<code>é¡µ3</code>ä¸­å­˜å‚¨çš„ç›®å½•é¡¹è®°å½•æ˜¯ç”±<code>c2åˆ—+é¡µå·</code>çš„å€¼æ„æˆçš„ï¼Œ<code>é¡µ3</code>ä¸­çš„ä¸¤æ¡ç›®å½•é¡¹è®°å½•å¯¹åº”çš„c2åˆ—çš„å€¼éƒ½æ˜¯<code>1</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿™æ¡æ–°æ’å…¥çš„è®°å½•åˆ°åº•åº”è¯¥æ”¾åœ¨<code>é¡µ4</code>ä¸­ï¼Œè¿˜æ˜¯åº”è¯¥æ”¾åœ¨<code>é¡µ5</code>ä¸­å•Šï¼Ÿç­”æ¡ˆæ˜¯ï¼šå¯¹ä¸èµ·ï¼Œæ‡µäº†ã€‚</p><p>ä¸ºäº†è®©æ–°æ’å…¥è®°å½•èƒ½æ‰¾åˆ°è‡ªå·±åœ¨å“ªä¸ªé¡µé‡Œï¼Œæˆ‘ä»¬éœ€è¦<strong>ä¿è¯åœ¨B+æ ‘çš„åŒä¸€å±‚å†…èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•é™¤é¡µå·è¿™ä¸ªå­—æ®µä»¥å¤–æ˜¯å”¯ä¸€çš„ã€‚</strong>æ‰€ä»¥å¯¹äºäºŒçº§ç´¢å¼•çš„å†…èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•çš„å†…å®¹å®é™…ä¸Šæ˜¯ç”±ä¸‰ä¸ªéƒ¨åˆ†æ„æˆçš„ï¼š</p><ul><li>ç´¢å¼•åˆ—çš„å€¼</li><li>ä¸»é”®å€¼</li><li>é¡µå·</li></ul><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301120304.png" alt="image-20220330112018199"></p><p>è¿™æ ·æˆ‘ä»¬å†æ’å…¥è®°å½•<code>(9, 1, &#39;c&#39;)</code>æ—¶ï¼Œç”±äº<code>é¡µ3</code>ä¸­å­˜å‚¨çš„ç›®å½•é¡¹è®°å½•æ˜¯ç”±<code>c2åˆ—+ä¸»é”®+é¡µå·</code>çš„å€¼æ„æˆçš„ï¼Œå¯ä»¥å…ˆæŠŠæ–°è®°å½•çš„<code>c2</code>åˆ—çš„å€¼å’Œ<code>é¡µ3</code>ä¸­å„ç›®å½•é¡¹è®°å½•çš„<code>c2</code>åˆ—çš„å€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœ<code>c2</code>åˆ—çš„å€¼ç›¸åŒçš„è¯ï¼Œå¯ä»¥æ¥ç€æ¯”è¾ƒä¸»é”®å€¼ï¼Œå› ä¸ºB+æ ‘åŒä¸€å±‚ä¸­ä¸åŒç›®å½•é¡¹è®°å½•çš„<code>c2åˆ—+ä¸»é”®</code>çš„å€¼è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æœ€åè‚¯å®šèƒ½å®šä½å”¯ä¸€çš„ä¸€æ¡ç›®å½•é¡¹è®°å½•ï¼Œåœ¨æœ¬ä¾‹ä¸­æœ€åç¡®å®šæ–°è®°å½•åº”è¯¥è¢«æ’å…¥åˆ°<code>é¡µ5</code>ä¸­ã€‚</p><p><strong>3.</strong> <strong>ä¸€ä¸ªé¡µé¢æœ€å°‘å¯ä»¥å­˜å‚¨2æ¡è®°å½•</strong></p><p>ä¸€ä¸ªB+æ ‘åªéœ€è¦å¾ˆå°‘çš„å±‚çº§å°±å¯ä»¥è½»æ¾å­˜å‚¨æ•°äº¿æ¡è®°å½•ï¼ŒæŸ¥è¯¢é€Ÿåº¦ç›¸å½“ä¸é”™ï¼è¿™æ˜¯å› ä¸ºB+æ ‘æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå¤§çš„å¤šå±‚çº§ç›®å½•ï¼Œæ¯ç»è¿‡ä¸€ä¸ªç›®å½•æ—¶éƒ½ä¼šè¿‡æ»¤æ‰è®¸å¤šæ— æ•ˆçš„å­ç›®å½•ï¼Œç›´åˆ°æœ€åè®¿é—®çš„å­˜å‚¨çœŸå®æ•°æ®çš„ç›®å½•ã€‚é‚£å¦‚æœä¸€ä¸ªå¤§çš„ç›®å½•ä¸­åªå­˜æ”¾ä¸€ä¸ªå­ç›®å½•æ˜¯ä¸ªå•¥æ•ˆæœå‘¢ï¼Ÿé‚£å°±æ˜¯ç›®å½•å±‚çº§éå¸¸éå¸¸éå¸¸å¤šï¼Œè€Œä¸”æœ€åçš„é‚£ä¸ªå­˜æ”¾çœŸå®æ•°æ®çš„ç›®å½•ä¸­å­˜æ”¾ä¸€æ¡è®°å½•ã€‚è´¹äº†åŠå¤©åŠ²åªèƒ½å­˜æ”¾ä¸€æ¡çœŸå®çš„ç”¨æˆ·è®°å½•ï¼Ÿæ‰€ä»¥<code>InnoDBçš„ä¸€ä¸ªæ•°æ®é¡µè‡³å°‘å¯ä»¥å­˜æ”¾ä¸¤æ¡è®°å½•</code></p><h4 id="3-MyISAMä¸­çš„ç´¢å¼•æ–¹æ¡ˆ"><a href="#3-MyISAMä¸­çš„ç´¢å¼•æ–¹æ¡ˆ" class="headerlink" title="3. MyISAMä¸­çš„ç´¢å¼•æ–¹æ¡ˆ"></a><strong>3. MyISAMä¸­çš„ç´¢å¼•æ–¹æ¡ˆ</strong></h4><p><strong>Bæ ‘ç´¢å¼•é€‚ç”¨å­˜å‚¨å¼•æ“å¦‚è¡¨æ‰€ç¤ºï¼š</strong></p><table><thead><tr><th>ç´¢å¼•&#x2F;å­˜å‚¨å¼•æ“</th><th>MyISAM</th><th>InnoDB</th><th>Memory</th></tr></thead><tbody><tr><td>B-Treeç´¢å¼•</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr></tbody></table><p>å³ä½¿å¤šä¸ªå­˜å‚¨å¼•æ“æ”¯æŒåŒä¸€ç§ç±»å‹çš„ç´¢å¼•ï¼Œä½†æ˜¯ä»–ä»¬çš„å®ç°åŸç†ä¹Ÿæ˜¯ä¸åŒçš„ã€‚Innodbå’ŒMyISAMé»˜è®¤çš„ç´¢å¼•æ˜¯Btreeç´¢å¼•ï¼›è€ŒMemoryé»˜è®¤çš„ç´¢å¼•æ˜¯Hashç´¢å¼•ã€‚</p><p>MyISAMå¼•æ“ä½¿ç”¨<code>B+Tree</code>ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¶å­èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯<code>æ•°æ®è®°å½•çš„åœ°å€</code>ã€‚</p><h5 id="3-1-MyISAMç´¢å¼•çš„åŸç†"><a href="#3-1-MyISAMç´¢å¼•çš„åŸç†" class="headerlink" title="3.1 MyISAMç´¢å¼•çš„åŸç†"></a><strong>3.1 MyISAMç´¢å¼•çš„åŸç†</strong></h5><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301133907.png" alt="image-20220330113307813"></p><h5 id="3-2-MyISAM-ä¸-InnoDBå¯¹æ¯”"><a href="#3-2-MyISAM-ä¸-InnoDBå¯¹æ¯”" class="headerlink" title="3.2 MyISAM ä¸ InnoDBå¯¹æ¯”"></a><strong>3.2 MyISAM</strong> <strong>ä¸</strong> <strong>InnoDBå¯¹æ¯”</strong></h5><p><strong>MyISAMçš„ç´¢å¼•æ–¹å¼éƒ½æ˜¯â€œéèšç°‡â€çš„ï¼Œä¸InnoDBåŒ…å«1ä¸ªèšç°‡ç´¢å¼•æ˜¯ä¸åŒçš„ã€‚</strong></p><p><strong>å°ç»“ä¸¤ç§å¼•æ“ä¸­ç´¢å¼•çš„åŒºåˆ«ï¼š</strong></p><p>â‘  åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æ ¹æ®ä¸»é”®å€¼å¯¹<code>èšç°‡ç´¢å¼•</code>è¿›è¡Œä¸€æ¬¡æŸ¥æ‰¾å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„è®°å½•ï¼Œè€Œåœ¨<code>MyISAM</code>ä¸­å´éœ€è¦è¿›è¡Œä¸€æ¬¡<code>å›è¡¨</code>æ“ä½œï¼Œæ„å‘³ç€MyISAMä¸­å»ºç«‹çš„ç´¢å¼•ç›¸å½“äºå…¨éƒ¨éƒ½æ˜¯<code>äºŒçº§ç´¢å¼•</code>ã€‚ </p><p>â‘¡ InnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ï¼Œè€ŒMyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯<code>åˆ†ç¦»çš„</code>ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚</p><p>â‘¢ InnoDBçš„éèšç°‡ç´¢å¼•dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•<code>ä¸»é”®çš„å€¼</code>ï¼Œè€ŒMyISAMç´¢å¼•è®°å½•çš„æ˜¯<code>åœ°å€</code>ã€‚æ¢å¥è¯è¯´ï¼ŒInnoDBçš„æ‰€æœ‰éèšç°‡ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ä½œä¸ºdataåŸŸã€‚</p><p>â‘£ MyISAMçš„å›è¡¨æ“ä½œæ˜¯ååˆ†<code>å¿«é€Ÿ</code>çš„ï¼Œå› ä¸ºæ˜¯æ‹¿ç€åœ°å€åç§»é‡ç›´æ¥åˆ°æ–‡ä»¶ä¸­å–æ•°æ®çš„ï¼Œåè§‚InnoDBæ˜¯é€šè¿‡è·å–ä¸»é”®ä¹‹åå†å»èšç°‡ç´¢å¼•é‡Œæ‰¾è®°å½•ï¼Œè™½ç„¶è¯´ä¹Ÿä¸æ…¢ï¼Œä½†è¿˜æ˜¯æ¯”ä¸ä¸Šç›´æ¥ç”¨åœ°å€å»è®¿é—®ã€‚</p><p>â‘¤ InnoDBè¦æ±‚è¡¨<code>å¿…é¡»æœ‰ä¸»é”®</code>ï¼ˆ<code>MyISAMå¯ä»¥æ²¡æœ‰</code>ï¼‰ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™MySQLç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¯ä»¥éç©ºä¸”å”¯ä¸€æ ‡è¯†æ•°æ®è®°å½•çš„åˆ—ä½œä¸ºä¸»é”®ã€‚å¦‚æœä¸å­˜åœ¨è¿™ç§åˆ—ï¼Œåˆ™MySQLè‡ªåŠ¨ä¸ºInnoDBè¡¨ç”Ÿæˆä¸€ä¸ªéšå«å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™ä¸ªå­—æ®µé•¿åº¦ä¸º6ä¸ªå­—èŠ‚ï¼Œç±»å‹ä¸ºé•¿æ•´å‹ã€‚</p><h4 id="4-ç´¢å¼•çš„ä»£ä»·"><a href="#4-ç´¢å¼•çš„ä»£ä»·" class="headerlink" title="4. ç´¢å¼•çš„ä»£ä»·"></a><strong>4.</strong> <strong>ç´¢å¼•çš„ä»£ä»·</strong></h4><p>ç´¢å¼•æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œå¯ä¸èƒ½ä¹±å»ºï¼Œå®ƒåœ¨ç©ºé—´å’Œæ—¶é—´ä¸Šéƒ½ä¼šæœ‰æ¶ˆè€—ï¼š</p><ul><li><strong>ç©ºé—´ä¸Šçš„ä»£ä»·</strong></li></ul><p>æ¯å»ºç«‹ä¸€ä¸ªç´¢å¼•éƒ½è¦ä¸ºå®ƒå»ºç«‹ä¸€æ£µB+æ ‘ï¼Œæ¯ä¸€æ£µB+æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ•°æ®é¡µï¼Œä¸€ä¸ªé¡µé»˜è®¤ä¼šå ç”¨<code>16KB</code>çš„å­˜å‚¨ç©ºé—´ï¼Œä¸€æ£µå¾ˆå¤§çš„B+æ ‘ç”±è®¸å¤šæ•°æ®é¡µç»„æˆï¼Œé‚£å°±æ˜¯å¾ˆå¤§çš„ä¸€ç‰‡å­˜å‚¨ç©ºé—´ã€‚</p><ul><li><strong>æ—¶é—´ä¸Šçš„ä»£ä»·</strong></li></ul><p>æ¯æ¬¡å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œ<code>å¢ã€åˆ ã€æ”¹</code>æ“ä½œæ—¶ï¼Œéƒ½éœ€è¦å»ä¿®æ”¹å„ä¸ªB+æ ‘ç´¢å¼•ã€‚è€Œä¸”æˆ‘ä»¬è®²è¿‡ï¼ŒB+æ ‘æ¯å±‚èŠ‚ç‚¹éƒ½æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼<code>ä»å°åˆ°å¤§çš„é¡ºåºæ’åº</code>è€Œç»„æˆäº†<code>åŒå‘é“¾è¡¨</code>ã€‚ä¸è®ºæ˜¯å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•ï¼Œè¿˜æ˜¯å†…èŠ‚ç‚¹ä¸­çš„è®°å½•ï¼ˆä¹Ÿå°±æ˜¯ä¸è®ºæ˜¯ç”¨æˆ·è®°å½•è¿˜æ˜¯ç›®å½•é¡¹è®°å½•ï¼‰éƒ½æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼ä»å°åˆ°å¤§çš„é¡ºåºè€Œå½¢æˆäº†ä¸€ä¸ªå•å‘é“¾è¡¨ã€‚è€Œå¢ã€åˆ ã€æ”¹æ“ä½œå¯èƒ½ä¼šå¯¹èŠ‚ç‚¹å’Œè®°å½•çš„æ’åºé€ æˆç ´åï¼Œæ‰€ä»¥å­˜å‚¨å¼•æ“éœ€è¦é¢å¤–çš„æ—¶é—´è¿›è¡Œä¸€äº›<code>è®°å½•ç§»ä½</code>ï¼Œ<code>é¡µé¢åˆ†è£‚</code>ã€<code>é¡µé¢å›æ”¶</code>ç­‰æ“ä½œæ¥ç»´æŠ¤å¥½èŠ‚ç‚¹å’Œè®°å½•çš„æ’åºã€‚å¦‚æœæˆ‘ä»¬å»ºäº†è®¸å¤šç´¢å¼•ï¼Œæ¯ä¸ªç´¢å¼•å¯¹åº”çš„B+æ ‘éƒ½è¦è¿›è¡Œç›¸å…³çš„ç»´æŠ¤æ“ä½œï¼Œä¼šç»™æ€§èƒ½æ‹–åè…¿ã€‚</p><h4 id="5-MySQLæ•°æ®ç»“æ„é€‰æ‹©çš„åˆç†æ€§"><a href="#5-MySQLæ•°æ®ç»“æ„é€‰æ‹©çš„åˆç†æ€§" class="headerlink" title="5. MySQLæ•°æ®ç»“æ„é€‰æ‹©çš„åˆç†æ€§"></a><strong>5. MySQLæ•°æ®ç»“æ„é€‰æ‹©çš„åˆç†æ€§</strong></h4><h5 id="5-1-äºŒå‰æœç´¢æ ‘"><a href="#5-1-äºŒå‰æœç´¢æ ‘" class="headerlink" title="5.1 äºŒå‰æœç´¢æ ‘"></a><strong>5.1</strong> <strong>äºŒå‰æœç´¢æ ‘</strong></h5><p>å¦‚æœæˆ‘ä»¬åˆ©ç”¨äºŒå‰æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œé‚£ä¹ˆç£ç›˜çš„IOæ¬¡æ•°å’Œç´¢å¼•æ ‘çš„é«˜åº¦æ˜¯ç›¸å…³çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301636830.png" alt="image-20220330163602743"></p><p>ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œå°±éœ€è¦<code>å‡å°‘ç£ç›˜IOæ•°</code>ã€‚ä¸ºäº†å‡å°‘ç£ç›˜IOçš„æ¬¡æ•°ï¼Œå°±éœ€è¦å°½é‡<code>é™ä½æ ‘çš„é«˜åº¦</code>ï¼Œéœ€è¦æŠŠåŸæ¥â€œç˜¦é«˜â€çš„æ ‘ç»“æ„å˜çš„â€œçŸ®èƒ–â€ï¼Œæ ‘çš„æ¯å±‚çš„åˆ†å‰è¶Šå¤šè¶Šå¥½ã€‚</p><h5 id="5-2-AVLæ ‘"><a href="#5-2-AVLæ ‘" class="headerlink" title="5.2 AVLæ ‘"></a><strong>5.2 AVLæ ‘</strong></h5><p>å¦‚æœæˆ‘ä»¬åˆ©ç”¨äºŒå‰æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œé‚£ä¹ˆç£ç›˜çš„IOæ¬¡æ•°å’Œç´¢å¼•æ ‘çš„é«˜åº¦æ˜¯ç›¸å…³çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301635653.png" alt="image-20220330163506536"></p><p>é’ˆå¯¹åŒæ ·çš„æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬æŠŠäºŒå‰æ ‘æ”¹æˆ<code>M å‰æ ‘</code>ï¼ˆM&gt;2ï¼‰å‘¢ï¼Ÿå½“ M&#x3D;3 æ—¶ï¼ŒåŒæ ·çš„ 31 ä¸ªèŠ‚ç‚¹å¯ä»¥ç”±ä¸‹é¢çš„ä¸‰å‰æ ‘æ¥è¿›è¡Œå­˜å‚¨ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301637104.png" alt="image-20220330163709022"></p><h5 id="5-3-B-Tree"><a href="#5-3-B-Tree" class="headerlink" title="5.3 B-Tree"></a><strong>5.3 B-Tree</strong></h5><p>B æ ‘çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301638995.png" alt="image-20220330163803905"></p><p>ä¸€ä¸ª M é˜¶çš„ B æ ‘ï¼ˆM&gt;2ï¼‰æœ‰ä»¥ä¸‹çš„ç‰¹æ€§ï¼š</p><ol><li><p>æ ¹èŠ‚ç‚¹çš„å„¿å­æ•°çš„èŒƒå›´æ˜¯ [2,M]ã€‚ </p></li><li><p>æ¯ä¸ªä¸­é—´èŠ‚ç‚¹åŒ…å« k-1 ä¸ªå…³é”®å­—å’Œ k ä¸ªå­©å­ï¼Œå­©å­çš„æ•°é‡ &#x3D; å…³é”®å­—çš„æ•°é‡ +1ï¼Œk çš„å–å€¼èŒƒå›´ä¸º[ceil(M&#x2F;2), M]ã€‚ </p></li><li><p>å¶å­èŠ‚ç‚¹åŒ…æ‹¬ k-1 ä¸ªå…³é”®å­—ï¼ˆå¶å­èŠ‚ç‚¹æ²¡æœ‰å­©å­ï¼‰ï¼Œk çš„å–å€¼èŒƒå›´ä¸º [ceil(M&#x2F;2), M]ã€‚ </p></li><li><p>å‡è®¾ä¸­é—´èŠ‚ç‚¹èŠ‚ç‚¹çš„å…³é”®å­—ä¸ºï¼šKey[1], Key[2], â€¦, Key[k-1]ï¼Œä¸”å…³é”®å­—æŒ‰ç…§å‡åºæ’åºï¼Œå³ Key[i] &lt;Key[i+1]ã€‚æ­¤æ—¶ k-1 ä¸ªå…³é”®å­—ç›¸å½“äºåˆ’åˆ†äº† k ä¸ªèŒƒå›´ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ç€ k ä¸ªæŒ‡é’ˆï¼Œå³ä¸ºï¼šP[1], P[2], â€¦,P[k]ï¼Œå…¶ä¸­ P[1] æŒ‡å‘å…³é”®å­—å°äº Key[1] çš„å­æ ‘ï¼ŒP[i] æŒ‡å‘å…³é”®å­—å±äº (Key[i-1], Key[i]) çš„å­æ ‘ï¼ŒP[k]æŒ‡å‘å…³é”®å­—å¤§äº Key[k-1] çš„å­æ ‘ã€‚</p></li><li><p>æ‰€æœ‰å¶å­èŠ‚ç‚¹ä½äºåŒä¸€å±‚ã€‚</p></li></ol><p>ä¸Šé¢é‚£å¼ å›¾æ‰€è¡¨ç¤ºçš„ B æ ‘å°±æ˜¯ä¸€æ£µ 3 é˜¶çš„ B æ ‘ã€‚æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ç£ç›˜å— 2ï¼Œé‡Œé¢çš„å…³é”®å­—ä¸ºï¼ˆ8ï¼Œ12ï¼‰ï¼Œå®ƒæœ‰ 3 ä¸ªå­©å­ (3ï¼Œ5)ï¼Œ(9ï¼Œ10) å’Œ (13ï¼Œ15)ï¼Œä½ èƒ½çœ‹åˆ° (3ï¼Œ5) å°äº 8ï¼Œ(9ï¼Œ10) åœ¨ 8 å’Œ 12 ä¹‹é—´ï¼Œè€Œ (13ï¼Œ15)å¤§äº 12ï¼Œåˆšå¥½ç¬¦åˆåˆšæ‰æˆ‘ä»¬ç»™å‡ºçš„ç‰¹å¾ã€‚</p><p>ç„¶åæˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•ç”¨ B æ ‘è¿›è¡ŒæŸ¥æ‰¾ã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦<code>æŸ¥æ‰¾çš„å…³é”®å­—æ˜¯ 9</code>ï¼Œé‚£ä¹ˆæ­¥éª¤å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><ol><li><p>æˆ‘ä»¬ä¸æ ¹èŠ‚ç‚¹çš„å…³é”®å­— (17ï¼Œ35ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œ9 å°äº 17 é‚£ä¹ˆå¾—åˆ°æŒ‡é’ˆ P1ï¼› </p></li><li><p>æŒ‰ç…§æŒ‡é’ˆ P1 æ‰¾åˆ°ç£ç›˜å— 2ï¼Œå…³é”®å­—ä¸ºï¼ˆ8ï¼Œ12ï¼‰ï¼Œå› ä¸º 9 åœ¨ 8 å’Œ 12 ä¹‹é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°æŒ‡é’ˆ P2ï¼› </p></li><li><p>æŒ‰ç…§æŒ‡é’ˆ P2 æ‰¾åˆ°ç£ç›˜å— 6ï¼Œå…³é”®å­—ä¸ºï¼ˆ9ï¼Œ10ï¼‰ï¼Œç„¶åæˆ‘ä»¬æ‰¾åˆ°äº†å…³é”®å­— 9ã€‚</p></li></ol><p>ä½ èƒ½çœ‹å‡ºæ¥åœ¨ B æ ‘çš„æœç´¢è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ¯”è¾ƒçš„æ¬¡æ•°å¹¶ä¸å°‘ï¼Œä½†å¦‚æœæŠŠæ•°æ®è¯»å–å‡ºæ¥ç„¶ååœ¨å†…å­˜ä¸­è¿›è¡Œæ¯”è¾ƒï¼Œè¿™ä¸ªæ—¶é—´å°±æ˜¯å¯ä»¥å¿½ç•¥ä¸è®¡çš„ã€‚è€Œè¯»å–ç£ç›˜å—æœ¬èº«éœ€è¦è¿›è¡Œ I&#x2F;O æ“ä½œï¼Œæ¶ˆè€—çš„æ—¶é—´æ¯”åœ¨å†…å­˜ä¸­è¿›è¡Œæ¯”è¾ƒæ‰€éœ€è¦çš„æ—¶é—´è¦å¤šï¼Œæ˜¯æ•°æ®æŸ¥æ‰¾ç”¨æ—¶çš„é‡è¦å› ç´ ã€‚<code>B æ ‘ç›¸æ¯”äºå¹³è¡¡äºŒå‰æ ‘æ¥è¯´ç£ç›˜ I/O æ“ä½œè¦å°‘</code>ï¼Œåœ¨æ•°æ®æŸ¥è¯¢ä¸­æ¯”å¹³è¡¡äºŒå‰æ ‘æ•ˆç‡è¦é«˜ã€‚æ‰€ä»¥<code>åªè¦æ ‘çš„é«˜åº¦è¶³å¤Ÿä½ï¼ŒIOæ¬¡æ•°è¶³å¤Ÿå°‘ï¼Œå°±å¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½</code>ã€‚</p><p><strong>å†ä¸¾ä¾‹1ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301644761.png" alt="image-20220330164411665"></p><h5 id="5-4-B-Tree"><a href="#5-4-B-Tree" class="headerlink" title="5.4 B+Tree"></a><strong>5.4 B+Tree</strong></h5><p><strong>B+</strong> <strong>æ ‘å’Œ</strong> <strong>B</strong> <strong>æ ‘çš„å·®å¼‚ï¼š</strong></p><ol><li><p>æœ‰ k ä¸ªå­©å­çš„èŠ‚ç‚¹å°±æœ‰ k ä¸ªå…³é”®å­—ã€‚ä¹Ÿå°±æ˜¯å­©å­æ•°é‡ &#x3D; å…³é”®å­—æ•°ï¼Œè€Œ B æ ‘ä¸­ï¼Œå­©å­æ•°é‡ &#x3D; å…³é”®å­—æ•°+1ã€‚</p></li><li><p>éå¶å­èŠ‚ç‚¹çš„å…³é”®å­—ä¹Ÿä¼šåŒæ—¶å­˜åœ¨åœ¨å­èŠ‚ç‚¹ä¸­ï¼Œå¹¶ä¸”æ˜¯åœ¨å­èŠ‚ç‚¹ä¸­æ‰€æœ‰å…³é”®å­—çš„æœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰ã€‚</p></li><li><p>éå¶å­èŠ‚ç‚¹ä»…ç”¨äºç´¢å¼•ï¼Œä¸ä¿å­˜æ•°æ®è®°å½•ï¼Œè·Ÿè®°å½•æœ‰å…³çš„ä¿¡æ¯éƒ½æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸­ã€‚è€Œ B æ ‘ä¸­ï¼Œ <code>éå¶å­èŠ‚ç‚¹æ—¢ä¿å­˜ç´¢å¼•ï¼Œä¹Ÿä¿å­˜æ•°æ®è®°å½•</code>ã€‚ </p></li><li><p>æ‰€æœ‰å…³é”®å­—éƒ½åœ¨å¶å­èŠ‚ç‚¹å‡ºç°ï¼Œå¶å­èŠ‚ç‚¹æ„æˆä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼Œè€Œä¸”å¶å­èŠ‚ç‚¹æœ¬èº«æŒ‰ç…§å…³é”®å­—çš„å¤§å°ä»å°åˆ°å¤§é¡ºåºé“¾æ¥ã€‚</p></li></ol><blockquote><p>B æ ‘å’Œ B+ æ ‘éƒ½å¯ä»¥ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Œåœ¨ MySQL ä¸­é‡‡ç”¨çš„æ˜¯ B+ æ ‘ã€‚</p><p>ä½†Bæ ‘å’ŒB+æ ‘å„æœ‰è‡ªå·±çš„åº”ç”¨åœºæ™¯ï¼Œä¸èƒ½è¯´B+æ ‘å®Œå…¨æ¯”Bæ ‘å¥½ï¼Œåä¹‹äº¦ç„¶ã€‚</p></blockquote><p><strong>æ€è€ƒé¢˜ï¼šä¸ºäº†å‡å°‘IOï¼Œç´¢å¼•æ ‘ä¼šä¸€æ¬¡æ€§åŠ è½½å—ï¼Ÿ</strong></p><blockquote><p>1ã€æ•°æ®åº“ç´¢å¼•æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ï¼Œå¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œå¿…ç„¶å¯¼è‡´ç´¢å¼•çš„å¤§å°ä¹Ÿä¼šå¾ˆå¤§ï¼Œè¶…è¿‡å‡ ä¸ªGã€‚</p><p>2ã€å½“æˆ‘ä»¬åˆ©ç”¨ç´¢å¼•æŸ¥è¯¢æ—¶å€™ï¼Œæ˜¯ä¸å¯èƒ½å°†å…¨éƒ¨å‡ ä¸ªGçš„ç´¢å¼•éƒ½åŠ è½½è¿›å†…å­˜çš„ï¼Œæˆ‘ä»¬èƒ½åšçš„åªèƒ½æ˜¯ï¼šé€ä¸€åŠ è½½æ¯ä¸€ä¸ªç£ç›˜é¡µï¼Œå› ä¸ºç£ç›˜é¡µå¯¹åº”ç€ç´¢å¼•æ ‘çš„èŠ‚ç‚¹ã€‚</p></blockquote><p><strong>æ€è€ƒé¢˜ï¼šB+æ ‘çš„å­˜å‚¨èƒ½åŠ›å¦‚ä½•ï¼Ÿä¸ºä½•è¯´ä¸€èˆ¬æŸ¥æ‰¾è¡Œè®°å½•ï¼Œæœ€å¤šåªéœ€1~3æ¬¡ç£ç›˜IO</strong></p><blockquote><p>InnoDBå­˜å‚¨å¼•æ“ä¸­é¡µçš„å¤§å°ä¸º16KBï¼Œä¸€èˆ¬è¡¨çš„ä¸»é”®ç±»å‹ä¸ºINT(å ç”¨4ä¸ªå­—èŠ‚)æˆ–BIGINT(å ç”¨8ä¸ªå­—èŠ‚)ï¼ŒæŒ‡é’ˆç±»å‹ä¹Ÿä¸€èˆ¬ä¸º4æˆ–8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªé¡µï¼ˆB+Treeä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ä¸­å¤§æ¦‚å­˜å‚¨16KB&#x2F;(8B+8B)&#x3D;1Kä¸ªé”®å€¼ï¼Œå› ä¸ºæ˜¯ä¼°ç®—ï¼Œä¸ºäº†æ–¹ä¾¿è®¡ç®—ï¼Œè¿™é‡Œçš„Kå–å€¼ä¸º10^3ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæ·±åº¦ä¸º3çš„B+Treeç´¢å¼•å¯ä»¥ç»´æŠ¤10^3 * 10^3 * 10^3 &#x3D; 10äº¿æ¡è®°å½•ã€‚ï¼ˆè¿™é‡Œå‡å®šä¸€ä¸ªæ•°æ®é¡µä¹Ÿå­˜å‚¨10^3æ¡è¡Œè®°å½•æ•°æ®äº†ï¼‰</p><p>å®é™…æƒ…å†µä¸­æ¯ä¸ªèŠ‚ç‚¹å¯èƒ½ä¸èƒ½å¡«å……æ»¡ï¼Œå› æ­¤åœ¨æ•°æ®åº“ä¸­ï¼Œ<code>B+Treeçš„é«˜åº¦ä¸€èˆ¬éƒ½åœ¨2~4å±‚</code>ã€‚MySQLçš„InnoDBå­˜å‚¨å¼•æ“åœ¨è®¾è®¡æ—¶æ˜¯å°†æ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥æ‰¾æŸä¸€é”®å€¼çš„è¡Œè®°å½•æ—¶æœ€å¤šåªéœ€è¦1~3æ¬¡ç£ç›˜I&#x2F;Oæ“ä½œ</p></blockquote><p><strong>æ€è€ƒé¢˜ï¼šä¸ºä»€ä¹ˆè¯´B+æ ‘æ¯”B-æ ‘æ›´é€‚åˆå®é™…åº”ç”¨ä¸­æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç´¢å¼•å’Œæ•°æ®åº“ç´¢å¼•ï¼Ÿ</strong></p><blockquote><p>1.B+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½</p><p>B+æ ‘çš„å†…éƒ¨ç»“ç‚¹å¹¶æ²¡æœ‰æŒ‡å‘å…³é”®å­—å…·ä½“ä¿¡æ¯çš„æŒ‡é’ˆã€‚å› æ­¤å…¶å†…éƒ¨ç»“ç‚¹ç›¸å¯¹äºBæ ‘æ›´å°ã€‚å¦‚æœæŠŠæ‰€æœ‰åŒä¸€å†…éƒ¨ç»“ç‚¹çš„å…³é”®å­—å­˜æ”¾åœ¨åŒä¸€ç›˜å—ä¸­ï¼Œé‚£ä¹ˆç›˜å—æ‰€èƒ½å®¹çº³çš„å…³é”®å­—æ•°é‡ä¹Ÿè¶Šå¤šã€‚ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ä¸­çš„éœ€è¦æŸ¥æ‰¾çš„å…³é”®å­—ä¹Ÿå°±è¶Šå¤šã€‚ç›¸å¯¹æ¥è¯´IOè¯»å†™æ¬¡æ•°ä¹Ÿå°±é™ä½äº†ã€‚</p><p>2ã€B+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®š</p><p>ç”±äºéç»ˆç»“ç‚¹å¹¶ä¸æ˜¯æœ€ç»ˆæŒ‡å‘æ–‡ä»¶å†…å®¹çš„èŠ‚ç‚¹ï¼Œè€Œåªæ˜¯å¶å­ç»“ç‚¹ä¸­å…³é”®å­—çš„ç´¢å¼•ã€‚æ‰€æœ‰ä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾å¿…é¡»èµ°ä¸€æ¡ä»æ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯ã€‚æ‰€æœ‰å…³é”®å­—æŸ¥è¯¢çš„è·¯å¾„é•¿åº¦ç›¸åŒï¼Œå¯¼è‡´æ¯ä¸€ä¸ªæ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“ã€‚</p></blockquote><p><strong>æ€è€ƒé¢˜ï¼šHashç´¢å¼•ä¸B+æ ‘ç´¢å¼•çš„åŒºåˆ«</strong></p><blockquote><p>1ã€Hashç´¢å¼•<code>ä¸èƒ½è¿›è¡ŒèŒƒå›´æŸ¥è¯¢</code>ï¼Œè€ŒB+æ ‘å¯ä»¥ã€‚è¿™æ˜¯å› ä¸ºHashç´¢å¼•æŒ‡å‘çš„æ•°æ®æ˜¯æ— åºçš„ï¼Œè€ŒB+æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯ä¸ªæœ‰åºçš„é“¾è¡¨ã€‚</p><p>2ã€Hashç´¢å¼•<code>ä¸æ”¯æŒè”åˆç´¢å¼•çš„æœ€å·¦ä¾§åŸåˆ™</code>ï¼ˆå³è”åˆç´¢å¼•çš„éƒ¨åˆ†ç´¢å¼•æ— æ³•ä½¿ç”¨ï¼‰ï¼Œè€ŒB+æ ‘å¯ä»¥ã€‚å¯¹äºè”åˆç´¢å¼•æ¥è¯´ï¼ŒHashç´¢å¼•åœ¨è®¡ç®—Hashå€¼çš„æ—¶å€™æ˜¯å°†ç´¢å¼•é”®åˆå¹¶åå†ä¸€èµ·è®¡ç®—Hashå€¼ï¼Œæ‰€ä»¥ä¸ä¼šé’ˆå¯¹æ¯ä¸ªç´¢å¼•å•ç‹¬è®¡ç®—Hashå€¼ã€‚å› æ­¤å¦‚æœç”¨åˆ°è”åˆç´¢å¼•çš„ä¸€ä¸ªæˆ–è€…å‡ ä¸ªç´¢å¼•æ—¶ï¼Œè”åˆç´¢å¼•æ— æ³•è¢«åˆ©ç”¨ã€‚</p><p>3ã€Hashç´¢å¼•<code>ä¸æ”¯æŒ ORDER BY æ’åº</code>ï¼Œå› ä¸ºHashç´¢å¼•æŒ‡å‘çš„æ•°æ®æ˜¯æ— åºçš„ï¼Œå› æ­¤æ— æ³•èµ·åˆ°æ’åºä¼˜åŒ–çš„ä½œç”¨ï¼Œè€ŒB+æ ‘ç´¢å¼•æ•°æ®æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥èµ·åˆ°å¯¹è¯¥å­—æ®µORDER BY æ’åºä¼˜åŒ–çš„ä½œç”¨ã€‚åŒç†ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•ç”¨Hashç´¢å¼•è¿›è¡Œ<code>æ¨¡ç³ŠæŸ¥è¯¢</code>ï¼Œè€ŒB+æ ‘ä½¿ç”¨LIKEè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢çš„æ—¶å€™ï¼ŒLIKEåé¢åæ¨¡ç³ŠæŸ¥è¯¢ï¼ˆæ¯”å¦‚%ç»“å°¾ï¼‰çš„è¯å°±å¯ä»¥èµ·åˆ°ä¼˜åŒ–ä½œç”¨ã€‚</p><p>4ã€<code>InnoDBä¸æ”¯æŒå“ˆå¸Œç´¢å¼•</code></p></blockquote><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬07ç«  InnoDBæ•°æ®å­˜å‚¨ç»“æ„</title>
      <link href="/2023/07/15/%E7%AC%AC07%E7%AB%A0%20InnoDB%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84/"/>
      <url>/2023/07/15/%E7%AC%AC07%E7%AB%A0%20InnoDB%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬07ç« -InnoDBæ•°æ®å­˜å‚¨ç»“æ„"><a href="#ç¬¬07ç« -InnoDBæ•°æ®å­˜å‚¨ç»“æ„" class="headerlink" title="ç¬¬07ç«  InnoDBæ•°æ®å­˜å‚¨ç»“æ„"></a>ç¬¬07ç«  InnoDBæ•°æ®å­˜å‚¨ç»“æ„</h3><h4 id="1-æ•°æ®åº“çš„å­˜å‚¨ç»“æ„ï¼šé¡µ"><a href="#1-æ•°æ®åº“çš„å­˜å‚¨ç»“æ„ï¼šé¡µ" class="headerlink" title="1. æ•°æ®åº“çš„å­˜å‚¨ç»“æ„ï¼šé¡µ"></a>1. æ•°æ®åº“çš„å­˜å‚¨ç»“æ„ï¼šé¡µ</h4><p>ç´¢å¼•ç»“æ„ç»™æˆ‘ä»¬æä¾›äº†é«˜æ•ˆçš„ç´¢å¼•æ–¹å¼ï¼Œä¸è¿‡ç´¢å¼•ä¿¡æ¯ä»¥åŠæ•°æ®è®°å½•éƒ½ä¿å­˜åœ¨æ–‡ä»¶ä¸Šçš„ï¼Œç¡®åˆ‡è¯´æ˜¯å­˜å‚¨åœ¨é¡µç»“æ„ä¸­ã€‚å¦ä¸€æ–¹é¢ï¼Œç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“ä¸­å®ç°çš„ï¼ŒMySQLæœåŠ¡å™¨ä¸Šçš„<code>å­˜å‚¨å¼•æ“</code>è´Ÿè´£å¯¹è¡¨ä¸­æ•°æ®çš„è¯»å–å’Œå†™å…¥å·¥ä½œã€‚ä¸åŒå­˜å‚¨å¼•æ“ä¸­<code>å­˜æ”¾çš„æ ¼å¼</code>ä¸€èˆ¬ä¸åŒçš„ï¼Œç”šè‡³æœ‰çš„å­˜å‚¨å¼•æ“æ¯”å¦‚Memoryéƒ½ä¸ç”¨ç£ç›˜æ¥å­˜å‚¨æ•°æ®ã€‚</p><p>ç”±äº<code>InnoDB</code>æ˜¯MySQLçš„<code>é»˜è®¤å­˜å‚¨å¼•æ“</code>ï¼Œæ‰€ä»¥æœ¬ç« å‰–æInooDBå­˜å‚¨å¼•æ“çš„æ•°æ®å­˜å‚¨ç»“æ„ã€‚</p><h5 id="1-1-ç£ç›˜ä¸å†…å­˜äº¤äº’åŸºæœ¬å•ä½ï¼šé¡µ"><a href="#1-1-ç£ç›˜ä¸å†…å­˜äº¤äº’åŸºæœ¬å•ä½ï¼šé¡µ" class="headerlink" title="1.1 ç£ç›˜ä¸å†…å­˜äº¤äº’åŸºæœ¬å•ä½ï¼šé¡µ"></a>1.1 ç£ç›˜ä¸å†…å­˜äº¤äº’åŸºæœ¬å•ä½ï¼šé¡µ</h5><p>InnoDBå°†æ•°æ®åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªé¡µï¼ŒInnoDBä¸­é¡µçš„å¤§å°é»˜è®¤ä¸º<code>16KB</code>ã€‚</p><p>ä»¥<code>é¡µ</code>ä½œä¸ºç£ç›˜å’Œå†…å­˜ä¹‹é—´äº¤äº’çš„åŸºæœ¬å•ä½ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡æœ€å°‘ä»ç£ç›˜ä¸­è¯»å–16KBçš„å†…å®¹åˆ°å†…å­˜ä¸­ï¼Œä¸€æ¬¡æœ€å°‘æŠŠå†…å­˜ä¸­çš„16KBå†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>åœ¨æ•°æ®åº“ä¸­ï¼Œä¸è®ºè¯»ä¸€è¡Œï¼Œè¿˜æ˜¯è¯»å¤šè¡Œï¼Œéƒ½æ˜¯å°†è¿™äº›è¡Œæ‰€åœ¨çš„é¡µè¿›è¡ŒåŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®åº“ç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½æ˜¯é¡µï¼ˆPageï¼‰ï¼Œæ•°æ®åº“I&#x2F;Oæ“ä½œçš„æœ€å°å•ä½æ˜¯é¡µã€‚</strong>ä¸€ä¸ªé¡µä¸­å¯ä»¥å­˜å‚¨å¤šä¸ªè¡Œè®°å½•ã€‚</p><blockquote><p>è®°å½•æ˜¯æŒ‰ç…§è¡Œæ¥å­˜å‚¨çš„ï¼Œä½†æ˜¯æ•°æ®åº“çš„è¯»å–å¹¶ä¸ä»¥è¡Œä¸ºå•ä½ï¼Œå¦åˆ™ä¸€æ¬¡è¯»å–ï¼ˆä¹Ÿå°±æ˜¯ä¸€æ¬¡I&#x2F;Oæ“ä½œï¼‰åªèƒ½å¤„ç†ä¸€è¡Œæ•°æ®ï¼Œæ•ˆç‡ä¼šéå¸¸ä½ã€‚</p></blockquote><h5 id="1-2-é¡µç»“æ„æ¦‚è¿°"><a href="#1-2-é¡µç»“æ„æ¦‚è¿°" class="headerlink" title="1.2 é¡µç»“æ„æ¦‚è¿°"></a>1.2 é¡µç»“æ„æ¦‚è¿°</h5><p>é¡µaã€é¡µbã€é¡µcâ€¦é¡µnè¿™äº›é¡µå¯ä»¥<code>ä¸åœ¨ç‰©ç†ç»“æ„ä¸Šç›¸è¿</code>ï¼Œåªè¦é€šè¿‡<code>åŒå‘é“¾è¡¨</code>ç›¸å…³è”å³å¯ã€‚æ¯ä¸ªæ•°æ®é¡µä¸­çš„è®°å½•ä¼šæŒ‰ç…§ä¸»é”®å€¼ä»å°åˆ°å¤§çš„é¡ºåºç»„æˆä¸€ä¸ª<code>å•å‘é“¾è¡¨</code>ï¼Œæ¯ä¸ªæ•°æ®é¡µéƒ½ä¼šä¸ºå­˜å‚¨åœ¨å®ƒé‡Œè¾¹çš„è®°å½•ç”Ÿæˆä¸€ä¸ª<code>é¡µç›®å½•</code>ï¼Œåœ¨é€šè¿‡ä¸»é”®æŸ¥æ‰¾æŸæ¡è®°å½•çš„æ—¶å€™å¯ä»¥åœ¨é¡µç›®å½•ä¸­<code>ä½¿ç”¨äºŒåˆ†æ³•</code>å¿«é€Ÿå®šä½åˆ°å¯¹åº”çš„æ§½ï¼Œç„¶åå†éå†è¯¥æ§½å¯¹åº”çš„åˆ†ç»„ä¸­çš„è®°å½•å³å¯å¿«é€Ÿæ‰¾åˆ°æŒ‡å®šçš„è®°å½•ã€‚</p><h5 id="1-3-é¡µçš„ä¸Šå±‚ç»“æ„"><a href="#1-3-é¡µçš„ä¸Šå±‚ç»“æ„" class="headerlink" title="1.3 é¡µçš„ä¸Šå±‚ç»“æ„"></a>1.3 é¡µçš„ä¸Šå±‚ç»“æ„</h5><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301838071.png" alt="image-20220330183814954"></p><p>åŒºï¼ˆExtentï¼‰æ˜¯æ¯”é¡µå¤§ä¸€çº§çš„å­˜å‚¨ç»“æ„ï¼Œåœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œä¸€ä¸ªåŒºä¼šåˆ†é…<code>64ä¸ªè¿ç»­çš„é¡µ</code>ã€‚å› ä¸ºInnoDBä¸­çš„é¡µå¤§å°é»˜è®¤æ˜¯16KBï¼Œæ‰€ä»¥ä¸€ä¸ªåŒºçš„å¤§å°æ˜¯64*16KB&#x3D;<code>1MB</code>ã€‚</p><p>æ®µï¼ˆSegmentï¼‰ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŒºç»„æˆï¼ŒåŒºåœ¨æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªè¿ç»­åˆ†é…çš„ç©ºé—´ï¼ˆåœ¨InnoDBä¸­æ˜¯è¿ç»­çš„64ä¸ªé¡µï¼‰ï¼Œä¸è¿‡åœ¨æ®µä¸­ä¸è¦æ±‚åŒºä¸åŒºä¹‹é—´æ˜¯ç›¸é‚»çš„ã€‚<code>æ®µæ˜¯æ•°æ®åº“ä¸­çš„åˆ†é…å•ä½ï¼Œä¸åŒç±»å‹çš„æ•°æ®åº“å¯¹è±¡ä»¥ä¸åŒçš„æ®µå½¢å¼å­˜åœ¨ã€‚</code>å½“æˆ‘ä»¬åˆ›å»ºæ•°æ®è¡¨ã€ç´¢å¼•çš„æ—¶å€™ï¼Œå°±ä¼šç›¸åº”åˆ›å»ºå¯¹åº”çš„æ®µï¼Œæ¯”å¦‚åˆ›å»ºä¸€å¼ è¡¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ªè¡¨æ®µï¼Œåˆ›å»ºä¸€ä¸ªç´¢å¼•æ—¶ä¼šåˆ›å»ºä¸€ä¸ªç´¢å¼•æ®µã€‚</p><p>è¡¨ç©ºé—´ï¼ˆTablespaceï¼‰æ˜¯ä¸€ä¸ªé€»è¾‘å®¹å™¨ï¼Œè¡¨ç©ºé—´å­˜å‚¨çš„å¯¹è±¡æ˜¯æ®µï¼Œåœ¨ä¸€ä¸ªè¡¨ç©ºé—´ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ®µï¼Œä½†æ˜¯ä¸€ä¸ªæ®µåªèƒ½å±äºä¸€ä¸ªè¡¨ç©ºé—´ã€‚æ•°æ®åº“ç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ç©ºé—´ç»„æˆï¼Œè¡¨ç©ºé—´ä»ç®¡ç†ä¸Šå¯ä»¥åˆ’åˆ†ä¸º<code>ç³»ç»Ÿè¡¨ç©ºé—´</code>ã€<code>ç”¨æˆ·è¡¨ç©ºé—´</code>ã€<code>æ’¤é”€è¡¨ç©ºé—´</code>ã€<code>ä¸´æ—¶è¡¨ç©ºé—´</code>ç­‰ã€‚</p><h4 id="2-é¡µçš„å†…éƒ¨ç»“æ„"><a href="#2-é¡µçš„å†…éƒ¨ç»“æ„" class="headerlink" title="2. é¡µçš„å†…éƒ¨ç»“æ„"></a>2. é¡µçš„å†…éƒ¨ç»“æ„</h4><h5 id="2-1-ç¬¬1éƒ¨åˆ†ï¼šæ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨"><a href="#2-1-ç¬¬1éƒ¨åˆ†ï¼šæ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨" class="headerlink" title="2.1 ç¬¬1éƒ¨åˆ†ï¼šæ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨"></a>2.1 ç¬¬1éƒ¨åˆ†ï¼šæ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨</h5><h6 id="2-1-1-File-Headerï¼ˆæ–‡ä»¶å¤´éƒ¨ï¼‰ï¼ˆ38å­—èŠ‚ï¼‰"><a href="#2-1-1-File-Headerï¼ˆæ–‡ä»¶å¤´éƒ¨ï¼‰ï¼ˆ38å­—èŠ‚ï¼‰" class="headerlink" title="2.1.1 File Headerï¼ˆæ–‡ä»¶å¤´éƒ¨ï¼‰ï¼ˆ38å­—èŠ‚ï¼‰"></a>2.1.1 File Headerï¼ˆæ–‡ä»¶å¤´éƒ¨ï¼‰ï¼ˆ38å­—èŠ‚ï¼‰</h6><p><strong>ä½œç”¨</strong>ï¼š<br>æè¿°å„ç§é¡µçš„é€šç”¨ä¿¡æ¯ã€‚ï¼ˆæ¯”å¦‚é¡µçš„ç¼–å·ã€å…¶ä¸Šä¸€é¡µã€ä¸‹ä¸€é¡µæ˜¯è°ç­‰ï¼‰</p><p><strong>å¤§å°</strong>ï¼š38å­—èŠ‚</p><table><thead><tr><th>åç§°</th><th>å ç”¨ç©ºé—´å¤§å°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>FIL_PAGE_SPACE_OR_CHKSUM</code></td><td><code>4</code>å­—èŠ‚</td><td>é¡µçš„æ ¡éªŒå’Œï¼ˆchecksumå€¼ï¼‰</td></tr><tr><td><code>FIL_PAGE_OFFSET</code></td><td><code>4</code>å­—èŠ‚</td><td>é¡µå·</td></tr><tr><td><code>FIL_PAGE_PREV</code></td><td><code>4</code>å­—èŠ‚</td><td>ä¸Šä¸€ä¸ªé¡µçš„é¡µå·</td></tr><tr><td><code>FIL_PAGE_NEXT</code></td><td><code>4</code>å­—èŠ‚</td><td>ä¸‹ä¸€ä¸ªé¡µçš„é¡µå·</td></tr><tr><td>FIL_PAGE_LSN</td><td><code>8</code>å­—èŠ‚</td><td>é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®</td></tr><tr><td><code>FIL_PAGE_TYPE</code></td><td><code>2</code>å­—èŠ‚</td><td>è¯¥é¡µçš„ç±»å‹</td></tr><tr><td>FIL_PAGE_FILE_FLUSH_LSN</td><td><code>8</code>å­—èŠ‚</td><td>ä»…åœ¨ç³»ç»Ÿè¡¨ç©ºé—´çš„ä¸€ä¸ªé¡µä¸­å®šä¹‰ï¼Œä»£è¡¨æ–‡ä»¶è‡³å°‘è¢«åˆ·æ–°åˆ°äº†å¯¹åº”çš„LSNå€¼</td></tr><tr><td><code>FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID</code></td><td><code>4</code>å­—èŠ‚</td><td>é¡µå±äºå“ªä¸ªè¡¨ç©ºé—´</td></tr></tbody></table><ul><li><code>FIL_PAGE_OFFSETï¼ˆ4å­—èŠ‚ï¼‰</code>ï¼šæ¯ä¸€ä¸ªé¡µéƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„é¡µå·ï¼Œå°±è·Ÿä½ çš„èº«ä»½è¯å·ç ä¸€æ ·ï¼ŒInnoDBé€šè¿‡é¡µå·å¯ä»¥å”¯ä¸€å®šä½ä¸€ä¸ªé¡µã€‚</li><li><code>FIL_PAGE_TYPEï¼ˆ2å­—èŠ‚ï¼‰</code>ï¼šè¿™ä¸ªä»£è¡¨å½“å‰é¡µçš„ç±»å‹ã€‚</li></ul><table><thead><tr><th>ç±»å‹åç§°</th><th>åå…­è¿›åˆ¶</th><th>æè¿°</th></tr></thead><tbody><tr><td>FIL_PAGE_TYPE_ALLOCATED</td><td>0x0000</td><td>æœ€æ–°åˆ†é…ï¼Œè¿˜æ²¡æœ‰ä½¿ç”¨</td></tr><tr><td><code>FIL_PAGE_UNDO_LOG</code></td><td>0x0002</td><td>Undoæ—¥å¿—é¡µ</td></tr><tr><td>FIL_PAGE_INODE</td><td>0x0003</td><td>æ®µä¿¡æ¯èŠ‚ç‚¹</td></tr><tr><td>FIL_PAGE_IBUF_FREE_LIST</td><td>0x0004</td><td>Insert Bufferç©ºé—²åˆ—è¡¨</td></tr><tr><td>FIL_PAGE_IBUF_BITMAP</td><td>0x0005</td><td>Insert Bufferä½å›¾</td></tr><tr><td><code>FIL_PAGE_TYPE_SYS</code></td><td>0x0006</td><td>ç³»ç»Ÿé¡µ</td></tr><tr><td>FIL_PAGE_TYPE_TRX_SYS</td><td>0x0007</td><td>äº‹åŠ¡ç³»ç»Ÿæ•°æ®</td></tr><tr><td>FIL_PAGE_TYPE_FSP_HDR</td><td>0x0008</td><td>è¡¨ç©ºé—´å¤´éƒ¨ä¿¡æ¯</td></tr><tr><td>FIL_PAGE_TYPE_XDES</td><td>0x0009</td><td>æ‰©å±•æè¿°é¡µ</td></tr><tr><td>FIL_PAGE_TYPE_BLOB</td><td>0x000A</td><td>æº¢å‡ºé¡µ</td></tr><tr><td><code>FIL_PAGE_INDEX</code></td><td>0x45BF</td><td>ç´¢å¼•é¡µï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„<code>æ•°æ®é¡µ</code></td></tr></tbody></table><ul><li><code>FIL_PAGE_PREVï¼ˆ4å­—èŠ‚ï¼‰å’ŒFIL_PAGE_NEXTï¼ˆ4å­—èŠ‚ï¼‰</code>ï¼šInnoDBéƒ½æ˜¯ä»¥é¡µä¸ºå•ä½å­˜æ”¾æ•°æ®çš„ï¼Œå¦‚æœæ•°æ®åˆ†æ•£åˆ°å¤šä¸ªä¸è¿ç»­çš„é¡µä¸­å­˜å‚¨çš„è¯éœ€è¦æŠŠè¿™äº›é¡µå…³è”èµ·æ¥ï¼ŒFIL_PAGE_PREVå’ŒFIL_PAGE_NEXTå°±åˆ†åˆ«ä»£è¡¨æœ¬é¡µçš„ä¸Šä¸€ä¸ªå’Œä¸‹ä¸€ä¸ªé¡µçš„é¡µå·ã€‚è¿™æ ·é€šè¿‡å»ºç«‹ä¸€ä¸ªåŒå‘é“¾è¡¨æŠŠè®¸è®¸å¤šå¤šçš„é¡µå°±éƒ½ä¸²è”èµ·æ¥äº†ï¼Œä¿è¯è¿™äº›é¡µä¹‹é—´<strong>ä¸éœ€è¦æ˜¯ç‰©ç†ä¸Šçš„è¿ç»­ï¼Œè€Œæ˜¯é€»è¾‘ä¸Šçš„è¿ç»­ã€‚</strong></li><li><code>FIL_PAGE_SPACE_OR_CHKSUMï¼ˆ4å­—èŠ‚ï¼‰</code>ï¼šä»£è¡¨å½“å‰é¡µé¢çš„æ ¡éªŒå’Œï¼ˆchecksumï¼‰ã€‚æ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨éƒ½æœ‰å±æ€§ï¼šFIL_PAGE_SPACE_OR_CHKSUM</li></ul><p><strong>ä½œç”¨ï¼š</strong></p><p>InnoDBå­˜å‚¨å¼•æ“ä»¥é¡µä¸ºå•ä½æŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­å¤„ç†ï¼Œå¦‚æœè¯¥é¡µä¸­çš„æ•°æ®åœ¨å†…å­˜ä¸­è¢«ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆ<code>åœ¨ä¿®æ”¹åçš„æŸä¸ªæ—¶é—´éœ€è¦æŠŠæ•°æ®åŒæ­¥åˆ°ç£ç›˜ä¸­ã€‚</code>ä½†æ˜¯åœ¨åŒæ­¥äº†ä¸€åŠçš„æ—¶å€™æ–­ç”µäº†ï¼Œé€ æˆäº†è¯¥é¡µä¼ è¾“çš„ä¸å®Œæ•´ã€‚</p><p>ä¸ºäº†æ£€æµ‹ä¸€ä¸ªé¡µæ˜¯å¦å®Œæ•´ï¼ˆä¹Ÿå°±æ˜¯åœ¨åŒæ­¥çš„æ—¶å€™æœ‰æ²¡æœ‰å‘ç”ŸåªåŒæ­¥ä¸€åŠçš„å°´å°¬æƒ…å†µï¼‰ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡æ–‡ä»¶å°¾çš„æ ¡éªŒå’Œï¼ˆchecksum å€¼ï¼‰ä¸æ–‡ä»¶å¤´çš„æ ¡éªŒå’Œåšæ¯”å¯¹ï¼Œå¦‚æœä¸¤ä¸ªå€¼ä¸ç›¸ç­‰åˆ™è¯æ˜é¡µçš„ä¼ è¾“æœ‰é—®é¢˜ï¼Œéœ€è¦é‡æ–°è¿›è¡Œä¼ è¾“ï¼Œå¦åˆ™è®¤ä¸ºé¡µçš„ä¼ è¾“å·²ç»å®Œæˆã€‚</p><ul><li><code>FIL_PAGE_LSNï¼ˆ8å­—èŠ‚ï¼‰</code>ï¼šé¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®ï¼ˆè‹±æ–‡åæ˜¯ï¼šLog Sequence Numberï¼‰</li></ul><h6 id="2-1-2-File-Trailerï¼ˆæ–‡ä»¶å°¾éƒ¨ï¼‰ï¼ˆ8å­—èŠ‚ï¼‰"><a href="#2-1-2-File-Trailerï¼ˆæ–‡ä»¶å°¾éƒ¨ï¼‰ï¼ˆ8å­—èŠ‚ï¼‰" class="headerlink" title="2.1.2 File Trailerï¼ˆæ–‡ä»¶å°¾éƒ¨ï¼‰ï¼ˆ8å­—èŠ‚ï¼‰"></a>2.1.2 File Trailerï¼ˆæ–‡ä»¶å°¾éƒ¨ï¼‰ï¼ˆ8å­—èŠ‚ï¼‰</h6><ul><li>å‰4ä¸ªå­—èŠ‚ä»£è¡¨é¡µçš„æ ¡éªŒå’Œï¼šè¿™ä¸ªéƒ¨åˆ†æ˜¯å’ŒFile Headerä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚</li><li>å4ä¸ªå­—èŠ‚ä»£è¡¨é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®ï¼ˆLSNï¼‰ï¼šè¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼Œå¦‚æœé¦–éƒ¨å’Œå°¾éƒ¨çš„LSNå€¼æ ¡éªŒä¸æˆåŠŸçš„è¯ï¼Œå°±è¯´æ˜åŒæ­¥è¿‡ç¨‹å‡ºç°äº†é—®é¢˜ã€‚</li></ul><h5 id="2-2-ç¬¬2éƒ¨åˆ†ï¼šç©ºé—²ç©ºé—´ã€ç”¨æˆ·è®°å½•å’Œæœ€å°æœ€å¤§è®°å½•"><a href="#2-2-ç¬¬2éƒ¨åˆ†ï¼šç©ºé—²ç©ºé—´ã€ç”¨æˆ·è®°å½•å’Œæœ€å°æœ€å¤§è®°å½•" class="headerlink" title="2.2 ç¬¬2éƒ¨åˆ†ï¼šç©ºé—²ç©ºé—´ã€ç”¨æˆ·è®°å½•å’Œæœ€å°æœ€å¤§è®°å½•"></a>2.2 ç¬¬2éƒ¨åˆ†ï¼šç©ºé—²ç©ºé—´ã€ç”¨æˆ·è®°å½•å’Œæœ€å°æœ€å¤§è®°å½•</h5><h6 id="2-2-1-Free-Space-ç©ºé—²ç©ºé—´"><a href="#2-2-1-Free-Space-ç©ºé—²ç©ºé—´" class="headerlink" title="2.2.1 Free Space (ç©ºé—²ç©ºé—´)"></a>2.2.1 Free Space (ç©ºé—²ç©ºé—´)</h6><p>æˆ‘ä»¬è‡ªå·±å­˜å‚¨çš„è®°å½•ä¼šæŒ‰ç…§æŒ‡å®šçš„<code>è¡Œæ ¼å¼</code>å­˜å‚¨åˆ°<code>User Records</code>éƒ¨åˆ†ã€‚ä½†æ˜¯åœ¨ä¸€å¼€å§‹ç”Ÿæˆé¡µçš„æ—¶å€™ï¼Œå…¶å®å¹¶æ²¡æœ‰User Recordsè¿™ä¸ªéƒ¨åˆ†ï¼Œ<code>æ¯å½“æˆ‘ä»¬æ’å…¥ä¸€æ¡è®°å½•ï¼Œéƒ½ä¼šä»Free Spaceéƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å°šæœªä½¿ç”¨çš„å­˜å‚¨ç©ºé—´ä¸­ç”³è¯·ä¸€ä¸ªè®°å½•å¤§å°çš„ç©ºé—´åˆ’åˆ†åˆ°User Recordséƒ¨åˆ†</code>ï¼Œå½“Free Spaceéƒ¨åˆ†çš„ç©ºé—´å…¨éƒ¨è¢«User Recordséƒ¨åˆ†æ›¿ä»£æ‰ä¹‹åï¼Œä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªé¡µä½¿ç”¨å®Œäº†ï¼Œå¦‚æœè¿˜æœ‰æ–°çš„è®°å½•æ’å…¥çš„è¯ï¼Œå°±éœ€è¦å»<code>ç”³è¯·æ–°çš„é¡µ</code>äº†ã€‚</p><h6 id="2-2-2-User-Records-ç”¨æˆ·è®°å½•"><a href="#2-2-2-User-Records-ç”¨æˆ·è®°å½•" class="headerlink" title="2.2.2 User Records (ç”¨æˆ·è®°å½•)"></a>2.2.2 User Records (ç”¨æˆ·è®°å½•)</h6><p>User Recordsä¸­çš„è¿™äº›è®°å½•æŒ‰ç…§<code>æŒ‡å®šçš„è¡Œæ ¼å¼</code>ä¸€æ¡ä¸€æ¡æ‘†åœ¨User Recordséƒ¨åˆ†ï¼Œç›¸äº’ä¹‹é—´å½¢æˆ<code>å•é“¾è¡¨</code>ã€‚</p><h6 id="2-2-3-Infimum-Supremumï¼ˆæœ€å°æœ€å¤§è®°å½•ï¼‰"><a href="#2-2-3-Infimum-Supremumï¼ˆæœ€å°æœ€å¤§è®°å½•ï¼‰" class="headerlink" title="2.2.3 Infimum + Supremumï¼ˆæœ€å°æœ€å¤§è®°å½•ï¼‰"></a>2.2.3 Infimum + Supremumï¼ˆæœ€å°æœ€å¤§è®°å½•ï¼‰</h6><p><strong>è®°å½•å¯ä»¥æ¯”è¾ƒå¤§å°å—</strong>ï¼Ÿ<br>æ˜¯çš„ï¼Œè®°å½•å¯ä»¥æ¯”å¤§å°ï¼Œå¯¹äºä¸€æ¡å®Œæ•´çš„è®°å½•æ¥è¯´ï¼Œæ¯”è¾ƒè®°å½•çš„å¤§å°å°±æ˜¯<code>æ¯”è¾ƒä¸»é”®</code>çš„å¤§å°ã€‚æ¯”æ–¹è¯´æˆ‘ä»¬æ’å…¥çš„4è¡Œè®°å½•çš„ä¸»é”®å€¼åˆ†åˆ«æ˜¯ï¼š1ã€2ã€3ã€4ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€è¿™4æ¡è®°å½•æ˜¯ä»å°åˆ°å¤§ä¾æ¬¡é€’å¢ã€‚</p><p>InnoDBè§„å®šçš„æœ€å°è®°å½•ä¸æœ€å¤§è®°å½•è¿™ä¸¤æ¡è®°å½•çš„æ„é€ ååˆ†ç®€å•ï¼Œéƒ½æ˜¯ç”±5å­—èŠ‚å¤§å°çš„è®°å½•å¤´ä¿¡æ¯å’Œ8å­—èŠ‚å¤§å°çš„ä¸€ä¸ªå›ºå®šçš„éƒ¨åˆ†ç»„æˆçš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301913664.png" alt="image-20220330191335574"></p><p>è¿™ä¸¤æ¡è®°å½•<code>ä¸æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„è®°å½•</code>ï¼Œæ‰€ä»¥å®ƒä»¬å¹¶ä¸å­˜æ”¾åœ¨é¡µçš„User Recordséƒ¨åˆ†ï¼Œä»–ä»¬è¢«å•ç‹¬æ”¾åœ¨ä¸€ä¸ªç§°ä¸ºInfimum + Supremumçš„éƒ¨åˆ†</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301914167.png" alt="image-20220330191446070"></p><h5 id="2-3-ç¬¬3éƒ¨åˆ†ï¼šé¡µç›®å½•å’Œé¡µé¢å¤´éƒ¨"><a href="#2-3-ç¬¬3éƒ¨åˆ†ï¼šé¡µç›®å½•å’Œé¡µé¢å¤´éƒ¨" class="headerlink" title="2.3 ç¬¬3éƒ¨åˆ†ï¼šé¡µç›®å½•å’Œé¡µé¢å¤´éƒ¨"></a>2.3 ç¬¬3éƒ¨åˆ†ï¼šé¡µç›®å½•å’Œé¡µé¢å¤´éƒ¨</h5><h6 id="2-3-1-Page-Directoryï¼ˆé¡µç›®å½•ï¼‰"><a href="#2-3-1-Page-Directoryï¼ˆé¡µç›®å½•ï¼‰" class="headerlink" title="2.3.1 Page Directoryï¼ˆé¡µç›®å½•ï¼‰"></a>2.3.1 Page Directoryï¼ˆé¡µç›®å½•ï¼‰</h6><p><strong>ä¸ºä»€ä¹ˆéœ€è¦é¡µç›®å½•</strong>ï¼Ÿ<br>åœ¨é¡µä¸­ï¼Œè®°å½•æ˜¯ä»¥<code>å•å‘é“¾è¡¨</code>çš„å½¢å¼è¿›è¡Œå­˜å‚¨çš„ã€‚å•å‘é“¾è¡¨çš„ç‰¹ç‚¹å°±æ˜¯æ’å…¥ã€åˆ é™¤éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯<code>æ£€ç´¢æ•ˆç‡ä¸é«˜</code>ï¼Œæœ€å·®çš„æƒ…å†µä¸‹éœ€è¦éå†é“¾è¡¨ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹æ‰èƒ½å®Œæˆæ£€ç´¢ã€‚å› æ­¤åœ¨é¡µç»“æ„ä¸­ä¸“é—¨è®¾è®¡äº†é¡µç›®å½•è¿™ä¸ªæ¨¡å—ï¼Œ<code>ä¸“é—¨ç»™è®°å½•åšä¸€ä¸ªç›®å½•</code>ï¼Œé€šè¿‡<code>äºŒåˆ†æŸ¥æ‰¾æ³•</code>çš„æ–¹å¼è¿›è¡Œæ£€ç´¢ï¼Œæå‡æ•ˆç‡ã€‚</p><p><strong>é¡µç›®å½•ï¼ŒäºŒåˆ†æ³•æŸ¥æ‰¾</strong></p><ol><li>å°†æ‰€æœ‰çš„è®°å½•<code>åˆ†æˆå‡ ä¸ªç»„</code>ï¼Œè¿™äº›è®°å½•åŒ…æ‹¬æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•ï¼Œä½†ä¸åŒ…æ‹¬æ ‡è®°ä¸ºâ€œå·²åˆ é™¤â€çš„è®°å½•ã€‚</li><li>ç¬¬ 1 ç»„ï¼Œä¹Ÿå°±æ˜¯æœ€å°è®°å½•æ‰€åœ¨çš„åˆ†ç»„åªæœ‰ 1 ä¸ªè®°å½•ï¼›<br>æœ€åä¸€ç»„ï¼Œå°±æ˜¯æœ€å¤§è®°å½•æ‰€åœ¨çš„åˆ†ç»„ï¼Œä¼šæœ‰ 1-8 æ¡è®°å½•ï¼›<br>å…¶ä½™çš„ç»„è®°å½•æ•°é‡åœ¨ 4-8 æ¡ä¹‹é—´ã€‚<br>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œé™¤äº†ç¬¬ 1 ç»„ï¼ˆæœ€å°è®°å½•æ‰€åœ¨ç»„ï¼‰ä»¥å¤–ï¼Œå…¶ä½™ç»„çš„è®°å½•æ•°ä¼š<code>å°½é‡å¹³åˆ†</code>ã€‚</li><li>åœ¨æ¯ä¸ªç»„ä¸­æœ€åä¸€æ¡è®°å½•çš„å¤´ä¿¡æ¯ä¸­ä¼šå­˜å‚¨è¯¥ç»„ä¸€å…±æœ‰å¤šå°‘æ¡è®°å½•ï¼Œä½œä¸º n_owned å­—æ®µã€‚</li><li><code>é¡µç›®å½•ç”¨æ¥å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡</code>ï¼Œè¿™äº›åœ°å€åç§»é‡ä¼šæŒ‰ç…§<code>å…ˆåé¡ºåºå­˜å‚¨</code>èµ·æ¥ï¼Œæ¯ç»„çš„åœ°å€åç§»é‡ä¹Ÿè¢«ç§°ä¹‹ä¸º<code>æ§½ï¼ˆslotï¼‰</code>ï¼Œæ¯ä¸ªæ§½ç›¸å½“äºæŒ‡é’ˆæŒ‡å‘äº†ä¸åŒç»„çš„æœ€åä¸€ä¸ªè®°å½•ã€‚</li></ol><p><strong>ä¸¾ä¾‹ï¼š</strong></p><p>ç°åœ¨çš„page_demoè¡¨ä¸­æ­£å¸¸çš„è®°å½•å…±æœ‰6æ¡ï¼ŒInnoDBä¼šæŠŠå®ƒä»¬åˆ†æˆä¸¤ç»„ï¼Œç¬¬ä¸€ç»„ä¸­åªæœ‰ä¸€ä¸ªæœ€å°è®°å½•ï¼Œç¬¬äºŒç»„ä¸­æ˜¯å‰©ä½™çš„5æ¡è®°å½•ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301921631.png" alt="image-20220330192130497"></p><p>ä»è¿™ä¸ªå›¾ä¸­æˆ‘ä»¬éœ€è¦æ³¨æ„è¿™ä¹ˆå‡ ç‚¹ï¼š</p><ul><li>ç°åœ¨é¡µç›®å½•éƒ¨åˆ†ä¸­æœ‰ä¸¤ä¸ªæ§½ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬çš„è®°å½•è¢«åˆ†æˆäº†ä¸¤ä¸ªç»„ï¼Œæ§½1ä¸­çš„å€¼æ˜¯112ï¼Œä»£è¡¨æœ€å¤§è®°å½•çš„åœ°å€åç§»é‡ï¼ˆå°±æ˜¯ä»é¡µé¢çš„0å­—èŠ‚å¼€å§‹æ•°ï¼Œæ•°112ä¸ªå­—èŠ‚ï¼‰ï¼›æ§½0ä¸­çš„å€¼æ˜¯99ï¼Œä»£è¡¨æœ€å°è®°å½•çš„åœ°å€åç§»é‡ã€‚</li><li>æ³¨æ„æœ€å°å’Œæœ€å¤§è®°å½•çš„å¤´ä¿¡æ¯ä¸­çš„n_ownedå±æ€§<ul><li>æœ€å°è®°å½•çš„n_ownedå€¼ä¸º1ï¼Œè¿™å°±ä»£è¡¨ç€ä»¥æœ€å°è®°å½•ç»“å°¾çš„è¿™ä¸ªåˆ†ç»„ä¸­åªæœ‰1æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯æœ€å°è®°å½•æœ¬èº«ã€‚</li><li>æœ€å¤§è®°å½•çš„n_ownedå€¼ä¸º5ï¼Œè¿™å°±ä»£è¡¨ç€ä»¥æœ€å¤§è®°å½•ç»“å°¾çš„è¿™ä¸ªåˆ†ç»„ä¸­åªæœ‰5æ¡è®°å½•ï¼ŒåŒ…æ‹¬æœ€å¤§è®°å½•æœ¬èº«è¿˜æœ‰æˆ‘ä»¬è‡ªå·±æ’å…¥çš„4æ¡è®°å½•ã€‚</li></ul></li></ul><p>ç”¨ç®­å¤´æŒ‡å‘çš„æ–¹å¼æ›¿ä»£æ•°å­—ï¼Œè¿™æ ·æ›´æ˜“äºæˆ‘ä»¬ç†è§£ï¼Œä¿®æ”¹åå¦‚ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301924874.png" alt="image-20220330192413776"></p><p><strong>ä¸ºä»€ä¹ˆæœ€å°è®°å½•çš„n_ownedå€¼ä¸º1ï¼Œè€Œæœ€å¤§è®°å½•çš„n_ownedå€¼ä¸º5å‘¢ï¼Ÿ</strong></p><p>InnoDBè§„å®šï¼šå¯¹äºæœ€å°è®°å½•æ‰€åœ¨çš„åˆ†ç»„åªèƒ½æœ‰1æ¡è®°å½•ï¼Œæœ€å¤§è®°å½•æ‰€åœ¨çš„åˆ†ç»„æ‹¥æœ‰çš„è®°å½•æ¡æ•°åªèƒ½åœ¨1<del>8æ¡ä¹‹é—´ï¼Œå‰©ä¸‹çš„åˆ†ç»„ä¸­è®°å½•çš„æ¡æ•°èŒƒå›´åªèƒ½åœ¨æ˜¯ 4</del>8 æ¡ä¹‹é—´ã€‚</p><p>åˆ†ç»„æ˜¯æŒ‰ç…§ä¸‹è¾¹çš„æ­¥éª¤è¿›è¡Œçš„ï¼š</p><ul><li>åˆå§‹æƒ…å†µä¸‹ä¸€ä¸ªæ•°æ®é¡µé‡Œåªæœ‰æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•ä¸¤æ¡è®°å½•ï¼Œå®ƒä»¬åˆ†å±äºä¸¤ä¸ªåˆ†ç»„ã€‚</li><li>ä¹‹åæ¯æ’å…¥ä¸€æ¡è®°å½•ï¼Œéƒ½ä¼šä»é¡µç›®å½•ä¸­æ‰¾åˆ°ä¸»é”®å€¼æ¯”æœ¬è®°å½•çš„ä¸»é”®å€¼å¤§å¹¶ä¸”å·®å€¼æœ€å°çš„æ§½ï¼Œç„¶åæŠŠè¯¥æ§½å¯¹åº”çš„è®°å½•çš„n_ownedå€¼åŠ 1ï¼Œè¡¨ç¤ºæœ¬ç»„å†…åˆæ·»åŠ äº†ä¸€æ¡è®°å½•ï¼Œç›´åˆ°è¯¥ç»„ä¸­çš„è®°å½•æ•°ç­‰äº8ä¸ªã€‚</li><li>åœ¨ä¸€ä¸ªç»„ä¸­çš„è®°å½•æ•°ç­‰äº8ä¸ªåå†æ’å…¥ä¸€æ¡è®°å½•æ—¶ï¼Œä¼šå°†ç»„ä¸­çš„è®°å½•æ‹†åˆ†æˆä¸¤ä¸ªç»„ï¼Œä¸€ä¸ªç»„ä¸­4æ¡è®°å½•ï¼Œå¦ä¸€ä¸ª5æ¡è®°å½•ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šåœ¨é¡µç›®å½•ä¸­æ–°å¢ä¸€ä¸ªæ§½æ¥è®°å½•è¿™ä¸ªæ–°å¢åˆ†ç»„ä¸­æœ€å¤§çš„é‚£æ¡è®°å½•çš„åç§»é‡ã€‚</li></ul><h6 id="2-3-2-Page-Headerï¼ˆé¡µé¢å¤´éƒ¨ï¼‰"><a href="#2-3-2-Page-Headerï¼ˆé¡µé¢å¤´éƒ¨ï¼‰" class="headerlink" title="2.3.2 Page Headerï¼ˆé¡µé¢å¤´éƒ¨ï¼‰"></a>2.3.2 Page Headerï¼ˆé¡µé¢å¤´éƒ¨ï¼‰</h6><p>ä¸ºäº†èƒ½å¾—åˆ°ä¸€ä¸ªæ•°æ®é¡µä¸­å­˜å‚¨çš„è®°å½•çš„çŠ¶æ€ä¿¡æ¯ï¼Œæ¯”å¦‚æœ¬é¡µä¸­å·²ç»å­˜å‚¨äº†å¤šå°‘æ¡è®°å½•ï¼Œç¬¬ä¸€æ¡è®°å½•çš„åœ°å€æ˜¯ä»€ä¹ˆï¼Œé¡µç›®å½•ä¸­å­˜å‚¨äº†å¤šå°‘ä¸ªæ§½ç­‰ç­‰ï¼Œç‰¹æ„åœ¨é¡µä¸­å®šä¹‰äº†ä¸€ä¸ªå«Page Headerçš„éƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†å ç”¨å›ºå®šçš„56ä¸ªå­—èŠ‚ï¼Œä¸“é—¨å­˜å‚¨å„ç§çŠ¶æ€ä¿¡æ¯ã€‚</p><table><thead><tr><th>åç§°</th><th>å ç”¨ç©ºé—´å¤§å°</th><th>æè¿°</th></tr></thead><tbody><tr><td>PAGE_N_DIR_SLOTS</td><td>2å­—èŠ‚</td><td>åœ¨é¡µç›®å½•ä¸­çš„æ§½æ•°é‡</td></tr><tr><td>PAGE_HEAP_TOP</td><td>2å­—èŠ‚</td><td>è¿˜æœªä½¿ç”¨çš„ç©ºé—´æœ€å°åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´ä»è¯¥åœ°å€ä¹‹åå°±æ˜¯<code>Free Space</code></td></tr><tr><td>PAGE_N_HEAP</td><td>2å­—èŠ‚</td><td>æœ¬é¡µä¸­çš„è®°å½•çš„æ•°é‡ï¼ˆåŒ…æ‹¬æœ€å°å’Œæœ€å¤§è®°å½•ä»¥åŠæ ‡è®°ä¸ºåˆ é™¤çš„è®°å½•ï¼‰</td></tr><tr><td>PAGE_FREE</td><td>2å­—èŠ‚</td><td>ç¬¬ä¸€ä¸ªå·²ç»æ ‡è®°ä¸ºåˆ é™¤çš„è®°å½•çš„è®°å½•åœ°å€ï¼ˆå„ä¸ªå·²åˆ é™¤çš„è®°å½•é€šè¿‡<code>next_record</code>ä¹Ÿä¼šç»„æˆä¸€ä¸ªå•é“¾è¡¨ï¼Œè¿™ä¸ªå•é“¾è¡¨ä¸­çš„è®°å½•å¯ä»¥è¢«é‡æ–°åˆ©ç”¨ï¼‰</td></tr><tr><td>PAGE_GARBAGE</td><td>2å­—èŠ‚</td><td>å·²åˆ é™¤è®°å½•å ç”¨çš„å­—èŠ‚æ•°</td></tr><tr><td>PAGE_LAST_INSERT</td><td>2å­—èŠ‚</td><td>æœ€åæ’å…¥è®°å½•çš„ä½ç½®</td></tr><tr><td>PAGE_DIRECTION</td><td>2å­—èŠ‚</td><td>è®°å½•æ’å…¥çš„æ–¹å‘</td></tr><tr><td>PAGE_N_DIRECTION</td><td>2å­—èŠ‚</td><td>ä¸€ä¸ªæ–¹å‘è¿ç»­æ’å…¥çš„è®°å½•æ•°é‡</td></tr><tr><td>PAGE_N_RECS</td><td>2å­—èŠ‚</td><td>è¯¥é¡µä¸­è®°å½•çš„æ•°é‡ï¼ˆä¸åŒ…æ‹¬æœ€å°å’Œæœ€å¤§è®°å½•ä»¥åŠè¢«æ ‡è®°ä¸ºåˆ é™¤çš„è®°å½•ï¼‰</td></tr><tr><td>PAGE_MAX_TRX_ID</td><td>8å­—èŠ‚</td><td>ä¿®æ”¹å½“å‰é¡µçš„æœ€å¤§äº‹åŠ¡IDï¼Œè¯¥å€¼ä»…åœ¨äºŒçº§ç´¢å¼•ä¸­å®šä¹‰</td></tr><tr><td>PAGE_LEVEL</td><td>2å­—èŠ‚</td><td>å½“å‰é¡µåœ¨B+æ ‘ä¸­æ‰€å¤„çš„å±‚çº§</td></tr><tr><td>PAGE_INDEX_ID</td><td>8å­—èŠ‚</td><td>ç´¢å¼•IDï¼Œè¡¨ç¤ºå½“å‰é¡µå±äºå“ªä¸ªç´¢å¼•</td></tr><tr><td>PAGE_BTR_SEG_LEAF</td><td>10å­—èŠ‚</td><td>B+æ ‘å¶å­æ®µçš„å¤´éƒ¨ä¿¡æ¯ï¼Œä»…åœ¨B+æ ‘çš„Rooté¡µå®šä¹‰</td></tr><tr><td>PAGE_BTR_SEG_TOP</td><td>10å­—èŠ‚</td><td>B+æ ‘éå¶å­æ®µçš„å¤´éƒ¨ä¿¡æ¯ï¼Œä»…åœ¨B+æ ‘çš„Rooté¡µå®šä¹‰</td></tr></tbody></table><h4 id="3-InnoDBè¡Œæ ¼å¼ï¼ˆæˆ–è®°å½•æ ¼å¼ï¼‰"><a href="#3-InnoDBè¡Œæ ¼å¼ï¼ˆæˆ–è®°å½•æ ¼å¼ï¼‰" class="headerlink" title="3. InnoDBè¡Œæ ¼å¼ï¼ˆæˆ–è®°å½•æ ¼å¼ï¼‰"></a>3. InnoDBè¡Œæ ¼å¼ï¼ˆæˆ–è®°å½•æ ¼å¼ï¼‰</h4><h5 id="3-1-æŒ‡å®šè¡Œæ ¼å¼çš„è¯­æ³•"><a href="#3-1-æŒ‡å®šè¡Œæ ¼å¼çš„è¯­æ³•" class="headerlink" title="3.1 æŒ‡å®šè¡Œæ ¼å¼çš„è¯­æ³•"></a>3.1 æŒ‡å®šè¡Œæ ¼å¼çš„è¯­æ³•</h5><pre><code class="mysql">CREATE TABLE è¡¨å (åˆ—çš„ä¿¡æ¯) ROW_FORMAT=è¡Œæ ¼å¼åç§°</code></pre><pre><code class="mysql">ALTER TABLE è¡¨å ROW_FORMAT=è¡Œæ ¼å¼åç§°</code></pre><h5 id="3-2-COMPACTè¡Œæ ¼å¼"><a href="#3-2-COMPACTè¡Œæ ¼å¼" class="headerlink" title="3.2 COMPACTè¡Œæ ¼å¼"></a>3.2 COMPACTè¡Œæ ¼å¼</h5><p>åœ¨MySQL 5.1ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤è®¾ç½®ä¸ºCompactè¡Œæ ¼å¼ã€‚ä¸€æ¡å®Œæ•´çš„è®°å½•å…¶å®å¯ä»¥è¢«åˆ†ä¸ºè®°å½•çš„é¢å¤–ä¿¡æ¯å’Œè®°å½•çš„çœŸå®æ•°æ®ä¸¤å¤§éƒ¨åˆ†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301939611.png" alt="image-20220330193949517"></p><h6 id="3-2-1-å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨"><a href="#3-2-1-å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨" class="headerlink" title="3.2.1 å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨"></a>3.2.1 å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</h6><p>MySQLæ”¯æŒä¸€äº›å˜é•¿çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚VARCHAR(M)ã€VARBINARY(M)ã€TEXTç±»å‹ï¼ŒBLOBç±»å‹ï¼Œè¿™äº›æ•°æ®ç±»å‹ä¿®é¥°åˆ—ç§°ä¸º<code>å˜é•¿å­—æ®µ</code>ï¼Œå˜é•¿å­—æ®µä¸­å­˜å‚¨å¤šå°‘å­—èŠ‚çš„æ•°æ®ä¸æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å­˜å‚¨çœŸå®æ•°æ®çš„æ—¶å€™éœ€è¦é¡ºä¾¿æŠŠè¿™äº›æ•°æ®å ç”¨çš„å­—èŠ‚æ•°ä¹Ÿå­˜èµ·æ¥ã€‚<code>åœ¨Compactè¡Œæ ¼å¼ä¸­ï¼ŒæŠŠæ‰€æœ‰å˜é•¿å­—æ®µçš„çœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚é•¿åº¦éƒ½å­˜æ”¾åœ¨è®°å½•çš„å¼€å¤´éƒ¨ä½ï¼Œä»è€Œå½¢æˆä¸€ä¸ªå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€‚</code></p><blockquote><p> æ³¨æ„ï¼šè¿™é‡Œé¢å­˜å‚¨çš„å˜é•¿é•¿åº¦å’Œå­—æ®µé¡ºåºæ˜¯åè¿‡æ¥çš„ã€‚æ¯”å¦‚ä¸¤ä¸ªvarcharå­—æ®µåœ¨è¡¨ç»“æ„çš„é¡ºåºæ˜¯a(10)ï¼Œb(15)ã€‚é‚£ä¹ˆåœ¨å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ä¸­å­˜å‚¨çš„é•¿åº¦é¡ºåºå°±æ˜¯15ï¼Œ10ï¼Œæ˜¯åè¿‡æ¥çš„ã€‚</p></blockquote><h6 id="3-2-2-NULLå€¼åˆ—è¡¨"><a href="#3-2-2-NULLå€¼åˆ—è¡¨" class="headerlink" title="3.2.2 NULLå€¼åˆ—è¡¨"></a>3.2.2 NULLå€¼åˆ—è¡¨</h6><p>Compactè¡Œæ ¼å¼ä¼šæŠŠå¯ä»¥ä¸ºNULLçš„åˆ—ç»Ÿä¸€ç®¡ç†èµ·æ¥ï¼Œå­˜åœ¨ä¸€ä¸ªæ ‡è®°ä¸ºNULLå€¼åˆ—è¡¨ä¸­ã€‚å¦‚æœè¡¨ä¸­æ²¡æœ‰å…è®¸å­˜å‚¨ NULL çš„åˆ—ï¼Œåˆ™ NULLå€¼åˆ—è¡¨ä¹Ÿä¸å­˜åœ¨äº†ã€‚<br><strong>ä¸ºä»€ä¹ˆå®šä¹‰NULLå€¼åˆ—è¡¨ï¼Ÿ</strong><br>ä¹‹æ‰€ä»¥è¦å­˜å‚¨NULLæ˜¯å› ä¸ºæ•°æ®éƒ½æ˜¯éœ€è¦å¯¹é½çš„ï¼Œå¦‚æœ<code>æ²¡æœ‰æ ‡æ³¨å‡ºæ¥NULLå€¼çš„ä½ç½®</code>ï¼Œå°±æœ‰å¯èƒ½åœ¨æŸ¥è¯¢æ•°æ®çš„æ—¶å€™<code>å‡ºç°æ··ä¹±</code>ã€‚å¦‚æœä½¿ç”¨<code>ä¸€ä¸ªç‰¹å®šçš„ç¬¦å·</code>æ”¾åˆ°ç›¸åº”çš„æ•°æ®ä½è¡¨ç¤ºç©ºç½®çš„è¯ï¼Œè™½ç„¶èƒ½è¾¾åˆ°æ•ˆæœï¼Œä½†æ˜¯è¿™æ ·å¾ˆæµªè´¹ç©ºé—´ï¼Œæ‰€ä»¥ç›´æ¥å°±åœ¨è¡Œæ•°æ®å¾—å¤´éƒ¨å¼€è¾Ÿå‡ºä¸€å—ç©ºé—´ä¸“é—¨ç”¨æ¥è®°å½•è¯¥è¡Œæ•°æ®å“ªäº›æ˜¯éç©ºæ•°æ®ï¼Œå“ªäº›æ˜¯ç©ºæ•°æ®ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><ol><li>äºŒè¿›åˆ¶ä½çš„å€¼ä¸º1æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸ºNULLã€‚</li><li>äºŒè¿›åˆ¶ä½çš„å€¼ä¸º0æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸ä¸ºNULLã€‚</li></ol><blockquote><p>æ³¨æ„ï¼šåŒæ ·é¡ºåºä¹Ÿæ˜¯åè¿‡æ¥å­˜æ”¾çš„</p></blockquote><h6 id="3-2-3-è®°å½•å¤´ä¿¡æ¯ï¼ˆ5å­—èŠ‚ï¼‰"><a href="#3-2-3-è®°å½•å¤´ä¿¡æ¯ï¼ˆ5å­—èŠ‚ï¼‰" class="headerlink" title="3.2.3 è®°å½•å¤´ä¿¡æ¯ï¼ˆ5å­—èŠ‚ï¼‰"></a>3.2.3 è®°å½•å¤´ä¿¡æ¯ï¼ˆ5å­—èŠ‚ï¼‰</h6><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202203301945235.png" alt="image-20220330194534127"></p><table><thead><tr><th>åç§°</th><th>å¤§å°ï¼ˆå•ä½ï¼šbitï¼‰</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>é¢„ç•™ä½1</code></td><td>1</td><td>æ²¡æœ‰ä½¿ç”¨</td></tr><tr><td><code>é¢„ç•™ä½2</code></td><td>1</td><td>æ²¡æœ‰ä½¿ç”¨</td></tr><tr><td><code>delete_mask</code></td><td>1</td><td>æ ‡è®°è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤</td></tr><tr><td><code>mini_rec_mask</code></td><td>1</td><td>B+æ ‘çš„æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°è®°å½•éƒ½ä¼šæ·»åŠ è¯¥æ ‡è®°</td></tr><tr><td><code>n_owned</code></td><td>4</td><td>è¡¨ç¤ºå½“å‰è®°å½•æ‹¥æœ‰çš„è®°å½•æ•°</td></tr><tr><td><code>heap_no</code></td><td>13</td><td>è¡¨ç¤ºå½“å‰è®°å½•åœ¨è®°å½•å †çš„ä½ç½®ä¿¡æ¯</td></tr><tr><td><code>record_type</code></td><td>3</td><td>è¡¨ç¤ºå½“å‰è®°å½•çš„ç±»å‹ï¼Œ<code>0</code>è¡¨ç¤ºæ™®é€šè®°å½•ï¼Œ<code>1</code>è¡¨ç¤ºB+æ ‘éå¶å­èŠ‚ç‚¹è®°å½•ï¼Œ<code>2</code>è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ<code>3</code>è¡¨ç¤ºæœ€å¤§è®°å½•</td></tr><tr><td><code>next_record</code></td><td>16</td><td>è¡¨ç¤ºä¸‹ä¸€æ¡è®°å½•çš„ç›¸å¯¹ä½ç½®</td></tr></tbody></table><ul><li><code>delete_mask</code>ï¼šè¿™ä¸ªå±æ€§æ ‡è®°ç€å½“å‰è®°å½•æ˜¯å¦è¢«åˆ é™¤ï¼Œå ç”¨1ä¸ªäºŒè¿›åˆ¶ä½ã€‚<ul><li>å€¼ä¸º0ï¼šä»£è¡¨è®°å½•å¹¶æ²¡æœ‰è¢«åˆ é™¤</li><li>å€¼ä¸º1ï¼šä»£è¡¨è®°å½•è¢«åˆ é™¤æ‰äº†</li></ul></li></ul><p><strong>è¢«åˆ é™¤çš„è®°å½•ä¸ºä»€ä¹ˆè¿˜åœ¨é¡µä¸­å­˜å‚¨å‘¢ï¼Ÿ</strong><br>ä½ ä»¥ä¸ºå®ƒåˆ é™¤äº†ï¼Œå¯å®ƒè¿˜åœ¨çœŸå®çš„ç£ç›˜ä¸Šã€‚è¿™äº›è¢«åˆ é™¤çš„è®°å½•ä¹‹æ‰€ä»¥ä¸ç«‹å³ä»ç£ç›˜ä¸Šç§»é™¤ï¼Œæ˜¯å› ä¸ºç§»é™¤å®ƒä»¬ä¹‹åå…¶ä»–çš„è®°å½•åœ¨ç£ç›˜ä¸Šéœ€è¦<code>é‡æ–°æ’åˆ—ï¼Œå¯¼è‡´æ€§èƒ½æ¶ˆè€—</code>ã€‚æ‰€ä»¥åªæ˜¯æ‰“ä¸€ä¸ªåˆ é™¤æ ‡è®°è€Œå·²ï¼Œæ‰€æœ‰è¢«åˆ é™¤æ‰çš„è®°å½•éƒ½ä¼šç»„æˆä¸€ä¸ªæ‰€è°“çš„<code>åƒåœ¾é“¾è¡¨</code>ï¼Œåœ¨è¿™ä¸ªé“¾è¡¨ä¸­çš„è®°å½•å ç”¨çš„ç©ºé—´ç§°ä¹‹ä¸º<code>å¯é‡ç”¨ç©ºé—´</code>ï¼Œä¹‹åå¦‚æœæœ‰æ–°è®°å½•æ’å…¥åˆ°è¡¨ä¸­çš„è¯ï¼Œå¯èƒ½æŠŠè¿™äº›è¢«åˆ é™¤çš„è®°å½•å ç”¨çš„å­˜å‚¨ç©ºé—´è¦†ç›–æ‰ã€‚</p><ul><li><code>min_rec_mask</code>ï¼šB+æ ‘çš„æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°è®°å½•éƒ½ä¼šæ·»åŠ è¯¥æ ‡è®°ï¼Œmin_rec_maskå€¼ä¸º1ã€‚æˆ‘ä»¬è‡ªå·±æ’å…¥çš„å››æ¡è®°å½•çš„min_rec_maskå€¼éƒ½æ˜¯0ï¼Œæ„å‘³ç€å®ƒä»¬éƒ½ä¸æ˜¯B+æ ‘çš„éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°è®°å½•ã€‚</li><li><code>record_type</code>ï¼šè¿™ä¸ªå±æ€§è¡¨ç¤ºå½“å‰è®°å½•çš„ç±»å‹ï¼Œä¸€å…±æœ‰4ç§ç±»å‹çš„è®°å½•ï¼š<ul><li>0ï¼šè¡¨ç¤ºæ™®é€šè®°å½•</li><li>1ï¼šè¡¨ç¤ºB+æ ‘éå¶èŠ‚ç‚¹è®°å½•</li><li>2ï¼šè¡¨ç¤ºæœ€å°è®°å½•</li><li>3ï¼šè¡¨ç¤ºæœ€å¤§è®°å½•</li></ul></li><li><code>heap_no</code>ï¼šè¿™ä¸ªå±æ€§è¡¨ç¤ºå½“å‰è®°å½•åœ¨æœ¬é¡µä¸­çš„ä½ç½®ã€‚</li></ul><p><strong>æ€ä¹ˆä¸è§heap_noå€¼ä¸º0å’Œ1çš„è®°å½•å‘¢</strong>ï¼Ÿ<br>MySQLä¼šè‡ªåŠ¨ç»™æ¯ä¸ªé¡µé‡ŒåŠ äº†ä¸¤ä¸ªè®°å½•ï¼Œç”±äºè¿™ä¸¤ä¸ªè®°å½•å¹¶ä¸æ˜¯æˆ‘ä»¬è‡ªå·±æ’å…¥çš„ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ä¹Ÿç§°ä¸º<code>ä¼ªè®°å½•</code>æˆ–è€…<code>è™šæ‹Ÿè®°å½•</code>ã€‚è¿™ä¸¤ä¸ªä¼ªè®°å½•ä¸€ä¸ªä»£è¡¨<code>æœ€å°è®°å½•</code>ï¼Œä¸€ä¸ªä»£è¡¨<code>æœ€å¤§è®°å½•</code>ã€‚æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•çš„heap_noå€¼åˆ†åˆ«æ˜¯0å’Œ1ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬çš„ä½ç½®æœ€é å‰</p><ul><li><code>n_owned</code>ï¼šé¡µç›®å½•ä¸­æ¯ä¸ªç»„ä¸­æœ€åä¸€æ¡è®°å½•çš„å¤´ä¿¡æ¯ä¸­ä¼šå­˜å‚¨è¯¥ç»„ä¸€å…±æœ‰å¤šå°‘æ¡è®°å½•ï¼Œä½œä¸º n_owned å­—æ®µ</li><li><code>next_record</code>ï¼šè®°å½•å¤´ä¿¡æ¯é‡Œè¯¥å±æ€§éå¸¸é‡è¦ï¼Œå®ƒè¡¨ç¤ºä»å½“å‰è®°å½•çš„çœŸå®æ•°æ®åˆ°ä¸‹ä¸€æ¡è®°å½•çš„çœŸå®æ•°æ®çš„<code>åœ°å€åç§»é‡</code>ã€‚</li></ul><h6 id="3-2-4-è®°å½•çš„çœŸå®æ•°æ®"><a href="#3-2-4-è®°å½•çš„çœŸå®æ•°æ®" class="headerlink" title="3.2.4 è®°å½•çš„çœŸå®æ•°æ®"></a>3.2.4 è®°å½•çš„çœŸå®æ•°æ®</h6><table><thead><tr><th>åˆ—å</th><th>æ˜¯å¦å¿…é¡»</th><th>å ç”¨ç©ºé—´</th><th>æè¿°</th></tr></thead><tbody><tr><td>row_id</td><td>å¦</td><td>6å­—èŠ‚</td><td>è¡ŒIDï¼Œå”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•</td></tr><tr><td>transaction_id</td><td>æ˜¯</td><td>6å­—èŠ‚</td><td>äº‹åŠ¡ID</td></tr><tr><td>roll_pointer</td><td>æ˜¯</td><td>7å­—èŠ‚</td><td>å›æ»šæŒ‡é’ˆ</td></tr></tbody></table><p>ä¸€ä¸ªè¡¨æ²¡æœ‰æ‰‹åŠ¨å®šä¹‰ä¸»é”®ï¼Œåˆ™ä¼šé€‰å–ä¸€ä¸ªUniqueé”®ä½œä¸ºä¸»é”®ï¼Œå¦‚æœè¿Uniqueé”®éƒ½æ²¡æœ‰å®šä¹‰çš„è¯ï¼Œåˆ™ä¼šä¸ºè¡¨é»˜è®¤æ·»åŠ ä¸€ä¸ªåä¸ºrow_idçš„éšè—åˆ—ä½œä¸ºä¸»é”®ã€‚æ‰€ä»¥row_idæ˜¯åœ¨æ²¡æœ‰è‡ªå®šä¹‰ä¸»é”®ä»¥åŠUniqueé”®çš„æƒ…å†µä¸‹æ‰ä¼šå­˜åœ¨çš„ã€‚</p><h5 id="3-3-Dynamicå’ŒCompressedè¡Œæ ¼å¼"><a href="#3-3-Dynamicå’ŒCompressedè¡Œæ ¼å¼" class="headerlink" title="3.3 Dynamicå’ŒCompressedè¡Œæ ¼å¼"></a>3.3 Dynamicå’ŒCompressedè¡Œæ ¼å¼</h5><p>æˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸€ä¸ªé¡µçš„å¤§å°ä¸€èˆ¬æ˜¯16KBï¼Œä¹Ÿå°±æ˜¯16384å­—èŠ‚ï¼Œè€Œä¸€ä¸ªVARCHAR(M)ç±»å‹çš„åˆ—å°±æœ€å¤šå¯ä»¥å­˜å‚¨65533ä¸ªå­—èŠ‚ï¼Œè¿™æ ·å°±å¯èƒ½å‡ºç°ä¸€ä¸ªé¡µå­˜æ”¾ä¸äº†ä¸€æ¡è®°å½•ï¼Œè¿™ç§ç°è±¡ç§°ä¸º<code>è¡Œæº¢å‡º</code></p><p>åœ¨Compactå’ŒReduntantè¡Œæ ¼å¼ä¸­ï¼Œå¯¹äºå ç”¨å­˜å‚¨ç©ºé—´éå¸¸å¤§çš„åˆ—ï¼Œåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„åªä¼šå­˜å‚¨è¯¥åˆ—çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼ŒæŠŠå‰©ä½™çš„æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å‡ ä¸ªå…¶ä»–çš„é¡µä¸­è¿›è¡Œ<code>åˆ†é¡µå­˜å‚¨</code>ï¼Œç„¶åè®°å½•çš„çœŸå®æ•°æ®å¤„ç”¨20ä¸ªå­—èŠ‚å­˜å‚¨æŒ‡å‘è¿™äº›é¡µçš„åœ°å€ï¼ˆå½“ç„¶è¿™20ä¸ªå­—èŠ‚ä¸­è¿˜åŒ…æ‹¬è¿™äº›åˆ†æ•£åœ¨å…¶ä»–é¡µé¢ä¸­çš„æ•°æ®çš„å ç”¨çš„å­—èŠ‚æ•°ï¼‰ï¼Œä»è€Œå¯ä»¥æ‰¾åˆ°å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µã€‚è¿™ç§°ä¸º<code>é¡µçš„æ‰©å±•</code>ã€‚</p><p>åœ¨MySQL 8.0ä¸­ï¼Œé»˜è®¤è¡Œæ ¼å¼å°±æ˜¯Dynamicï¼ŒDynamicã€Compressedè¡Œæ ¼å¼å’ŒCompactè¡Œæ ¼å¼æŒºåƒï¼Œåªä¸è¿‡åœ¨å¤„ç†è¡Œæº¢å‡ºæ•°æ®æ—¶æœ‰åˆ†æ­§</p><ul><li>Compressedå’ŒDynamicä¸¤ç§è®°å½•æ ¼å¼å¯¹äºå­˜æ”¾åœ¨BLOBä¸­çš„æ•°æ®é‡‡ç”¨äº†å®Œå…¨çš„è¡Œæº¢å‡ºçš„æ–¹å¼ã€‚å¦‚å›¾ï¼Œåœ¨æ•°æ®é¡µä¸­åªå­˜æ”¾20ä¸ªå­—èŠ‚çš„æŒ‡é’ˆï¼ˆæº¢å‡ºé¡µçš„åœ°å€ï¼‰ï¼Œå®é™…çš„æ•°æ®éƒ½å­˜æ”¾åœ¨Off Pageï¼ˆæº¢å‡ºé¡µï¼‰ä¸­ã€‚</li><li>Compactå’ŒRedundantä¸¤ç§æ ¼å¼ä¼šåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„å­˜å‚¨ä¸€éƒ¨åˆ†æ•°æ®ï¼ˆå­˜æ”¾768ä¸ªå‰ç¼€å­—èŠ‚ï¼‰ã€‚</li></ul><h4 id="4-åŒºã€æ®µå’Œç¢ç‰‡åŒº"><a href="#4-åŒºã€æ®µå’Œç¢ç‰‡åŒº" class="headerlink" title="4. åŒºã€æ®µå’Œç¢ç‰‡åŒº"></a>4. åŒºã€æ®µå’Œç¢ç‰‡åŒº</h4><h5 id="4-1-ä¸ºä»€ä¹ˆè¦æœ‰åŒºï¼Ÿ"><a href="#4-1-ä¸ºä»€ä¹ˆè¦æœ‰åŒºï¼Ÿ" class="headerlink" title="4.1 ä¸ºä»€ä¹ˆè¦æœ‰åŒºï¼Ÿ"></a>4.1 ä¸ºä»€ä¹ˆè¦æœ‰åŒºï¼Ÿ</h5><p><code>B+</code>æ ‘çš„æ¯ä¸€å±‚ä¸­çš„é¡µéƒ½ä¼šå½¢æˆä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¦‚æœæ˜¯ä»¥<code>é¡µä¸ºå•ä½</code>æ¥åˆ†é…å­˜å‚¨ç©ºé—´çš„è¯ï¼ŒåŒå‘é“¾è¡¨ç›¸é‚»çš„ä¸¤ä¸ªé¡µä¹‹é—´çš„<code>ç‰©ç†ä½ç½®å¯èƒ½ç¦»å¾—éå¸¸è¿œ</code>ã€‚æˆ‘ä»¬ä»‹ç»B+æ ‘ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯çš„æ—¶å€™ç‰¹åˆ«æåˆ°èŒƒå›´æŸ¥è¯¢åªéœ€è¦å®šä½åˆ°æœ€å·¦è¾¹çš„è®°å½•å’Œæœ€å³è¾¹çš„è®°å½•ï¼Œç„¶åæ²¿ç€åŒå‘é“¾è¡¨ä¸€ç›´æ‰«æå°±å¯ä»¥äº†ï¼Œè€Œå¦‚æœé“¾è¡¨ä¸­ç›¸é‚»çš„ä¸¤ä¸ªé¡µç‰©ç†ä½ç½®ç¦»å¾—éå¸¸è¿œï¼Œå°±æ˜¯æ‰€è°“çš„<code>éšæœºI/O</code>ã€‚å†ä¸€æ¬¡å¼ºè°ƒï¼Œç£ç›˜çš„é€Ÿåº¦å’Œå†…å­˜çš„é€Ÿåº¦å·®äº†å¥½å‡ ä¸ªæ•°é‡çº§ï¼Œ<code>éšæœºI/Oæ˜¯éå¸¸æ…¢</code>çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°½é‡è®©é“¾è¡¨ä¸­ç›¸é‚»çš„é¡µçš„ç‰©ç†ä½ç½®ä¹Ÿç›¸é‚»ï¼Œè¿™æ ·è¿›è¡ŒèŒƒå›´æŸ¥è¯¢çš„æ—¶å€™æ‰å¯ä»¥ä½¿ç”¨æ‰€è°“çš„<code>é¡ºåºI/O</code>ã€‚</p><p>å¼•å…¥<code>åŒº</code>çš„æ¦‚å¿µï¼Œä¸€ä¸ªåŒºå°±æ˜¯ç‰©ç†ä½ç½®ä¸Šè¿ç»­çš„<code>64ä¸ªé¡µ</code>ã€‚å› ä¸ºInnoDBä¸­çš„é¡µçš„å¤§å°é»˜è®¤æ˜¯16KBï¼Œæ‰€ä»¥ä¸€ä¸ªåŒºçš„å¤§å°æ˜¯64*16KB&#x3D;<code>1MB</code>ã€‚åœ¨è¡¨ä¸­<code>æ•°æ®é‡å¤§</code>çš„æ—¶å€™ï¼Œä¸ºæŸä¸ªç´¢å¼•åˆ†é…ç©ºé—´çš„æ—¶å€™å°±ä¸å†æŒ‰ç…§é¡µçš„å•ä½åˆ†é…äº†ï¼Œè€Œæ˜¯æŒ‰ç…§<code>åŒºä¸ºå•ä½åˆ†é…</code>ï¼Œç”šè‡³åœ¨è¡¨ä¸­çš„æ•°æ®ç‰¹åˆ«å¤šçš„æ—¶å€™ï¼Œå¯ä»¥ä¸€æ¬¡æ€§åˆ†é…å¤šä¸ªè¿ç»­çš„åŒºã€‚è™½ç„¶å¯èƒ½é€ æˆ<code>ä¸€ç‚¹ç‚¹ç©ºé—´çš„æµªè´¹</code>ï¼ˆæ•°æ®ä¸è¶³ä»¥å¡«å……æ»¡æ•´ä¸ªåŒºï¼‰ï¼Œä½†æ˜¯ä»æ€§èƒ½è§’åº¦çœ‹ï¼Œå¯ä»¥æ¶ˆé™¤å¾ˆå¤šçš„éšæœºI&#x2F;Oï¼Œ<code>åŠŸå¤§äºè¿‡</code>ï¼</p><h5 id="4-2-ä¸ºä»€ä¹ˆè¦æœ‰æ®µï¼Ÿ"><a href="#4-2-ä¸ºä»€ä¹ˆè¦æœ‰æ®µï¼Ÿ" class="headerlink" title="4.2 ä¸ºä»€ä¹ˆè¦æœ‰æ®µï¼Ÿ"></a>4.2 ä¸ºä»€ä¹ˆè¦æœ‰æ®µï¼Ÿ</h5><p>å¯¹äºèŒƒå›´æŸ¥è¯¢ï¼Œå…¶å®æ˜¯å¯¹B+æ ‘å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•è¿›è¡Œé¡ºåºæ‰«æï¼Œè€Œå¦‚æœä¸åŒºåˆ†å¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹ï¼Œç»Ÿç»ŸæŠŠèŠ‚ç‚¹ä»£è¡¨çš„é¡µé¢æ”¾åˆ°ç”³è¯·åˆ°çš„åŒºä¸­çš„è¯ï¼Œè¿›è¡ŒèŒƒå›´æ‰«æçš„æ•ˆæœå°±å¤§æ‰“æŠ˜æ‰£äº†ã€‚æ‰€ä»¥InnoDBå¯¹B+æ ‘çš„<code>å¶å­èŠ‚ç‚¹</code>å’Œ<code>éå¶å­èŠ‚ç‚¹</code>è¿›è¡Œäº†åŒºåˆ«å¯¹å¾…ï¼Œä¹Ÿå°±æ˜¯è¯´å¶å­èŠ‚ç‚¹æœ‰è‡ªå·±ç‹¬æœ‰çš„åŒºï¼Œéå¶å­èŠ‚ç‚¹ä¹Ÿæœ‰è‡ªå·±ç‹¬æœ‰çš„åŒºã€‚å­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆå°±ç®—æ˜¯ä¸€ä¸ª<code>æ®µï¼ˆsegmentï¼‰</code>ï¼Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆä¹Ÿç®—æ˜¯ä¸€ä¸ªæ®µã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç´¢å¼•ä¼šç”Ÿæˆ2ä¸ªæ®µï¼Œä¸€ä¸ª<code>å¶å­èŠ‚ç‚¹æ®µ</code>ï¼Œä¸€ä¸ª<code>éå¶å­èŠ‚ç‚¹æ®µ</code>ã€‚</p><p>é™¤äº†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹æ®µå’Œéå¶å­èŠ‚ç‚¹æ®µä¹‹å¤–ï¼ŒInnoDBä¸­è¿˜æœ‰ä¸ºå­˜å‚¨ä¸€äº›ç‰¹æ®Šçš„æ•°æ®è€Œå®šä¹‰çš„æ®µï¼Œæ¯”å¦‚å›æ»šæ®µã€‚æ‰€ä»¥ï¼Œå¸¸è§çš„æ®µæœ‰<code>æ•°æ®æ®µ</code>ã€<code>ç´¢å¼•æ®µ</code>ã€<code>å›æ»šæ®µ</code>ã€‚æ•°æ®æ®µå³ä¸ºB+æ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œç´¢å¼•æ®µå³ä¸ºB+æ ‘çš„éå¶å­èŠ‚ç‚¹ã€‚</p><p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œå¯¹æ®µçš„ç®¡ç†éƒ½æ˜¯ç”±å¼•æ“è‡ªèº«æ‰€å®Œæˆï¼ŒDBAä¸èƒ½ä¹Ÿæ²¡æœ‰å¿…è¦å¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚è¿™ä»ä¸€å®šç¨‹åº¦ä¸Šç®€åŒ–äº†DBAå¯¹äºæ®µçš„ç®¡ç†ã€‚</p><p>æ®µå…¶å®ä¸å¯¹åº”è¡¨ç©ºé—´ä¸­çš„æŸä¸€ä¸ªè¿ç»­çš„ç‰©ç†åŒºåŸŸï¼Œè€Œæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”±è‹¥å¹²ä¸ªé›¶æ•£çš„é¡µé¢ä»¥åŠä¸€äº›å®Œæ•´çš„åŒºç»„æˆã€‚</p><h5 id="4-3-ä¸ºä»€ä¹ˆè¦æœ‰ç¢ç‰‡åŒºï¼Ÿ"><a href="#4-3-ä¸ºä»€ä¹ˆè¦æœ‰ç¢ç‰‡åŒºï¼Ÿ" class="headerlink" title="4.3 ä¸ºä»€ä¹ˆè¦æœ‰ç¢ç‰‡åŒºï¼Ÿ"></a>4.3 ä¸ºä»€ä¹ˆè¦æœ‰ç¢ç‰‡åŒºï¼Ÿ</h5><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“çš„è¡¨åªæœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œä¸€ä¸ªç´¢å¼•ä¼šç”Ÿæˆ2ä¸ªæ®µï¼Œè€Œæ®µæ˜¯ä»¥åŒºä¸ºå•ä½ç”³è¯·å­˜å‚¨ç©ºé—´çš„ï¼Œä¸€ä¸ªåŒºé»˜è®¤å ç”¨1Mï¼ˆ64*16KB&#x3D;1024KBï¼‰å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥<strong>é»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªåªå­˜åœ¨å‡ æ¡è®°å½•çš„å°è¡¨ä¹Ÿéœ€è¦2Mçš„å­˜å‚¨ç©ºé—´ä¹ˆï¼Ÿ</strong>ä»¥åæ¯æ¬¡æ·»åŠ ä¸€ä¸ªç´¢å¼•éƒ½è¦å¤šç”³è¯·2Mçš„å­˜å‚¨ç©ºé—´ä¹ˆï¼Ÿè¿™å¯¹äºå­˜å‚¨è®°å½•æ¯”è¾ƒå°‘çš„è¡¨ç®€ç›´æ˜¯å¤©å¤§çš„æµªè´¹ã€‚è¿™ä¸ªé—®é¢˜çš„ç—‡ç»“åœ¨äºåˆ°ç°åœ¨ä¸ºæ­¢æˆ‘ä»¬ä»‹ç»çš„åŒºéƒ½æ˜¯éå¸¸<code>çº¯ç²¹</code>çš„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªåŒºè¢«æ•´ä¸ªåˆ†é…ç»™æŸä¸€ä¸ªæ®µï¼Œæˆ–è€…è¯´åŒºä¸­çš„æ‰€æœ‰é¡µé¢éƒ½æ˜¯ä¸ºäº†å­˜å‚¨åŒä¸€ä¸ªæ®µçš„æ•°æ®è€Œå­˜åœ¨çš„ï¼Œå³ä½¿æ®µçš„æ•°æ®å¡«ä¸æ»¡åŒºä¸­æ‰€æœ‰çš„é¡µé¢ï¼Œé‚£ä½™ä¸‹çš„é¡µé¢ä¹Ÿä¸èƒ½æŒªä½œä»–ç”¨ã€‚</p><p>ä¸ºäº†è€ƒè™‘ä»¥å®Œæ•´çš„åŒºä¸ºå•ä½åˆ†é…ç»™æŸä¸ªæ®µå¯¹äº<code>æ•°æ®é‡è¾ƒå°</code>çš„è¡¨å¤ªæµªè´¹å­˜å‚¨ç©ºé—´çš„è¿™ç§æƒ…å†µï¼ŒInnoDBæå‡ºäº†ä¸€ä¸ª<code>ç¢ç‰‡ï¼ˆfragmentï¼‰åŒº</code>çš„æ¦‚å¿µã€‚åœ¨ä¸€ä¸ªç¢ç‰‡åŒºä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„é¡µéƒ½æ˜¯ä¸ºäº†å­˜å‚¨åŒä¸€ä¸ªæ®µçš„æ•°æ®è€Œå­˜åœ¨çš„ï¼Œè€Œæ˜¯ç¢ç‰‡åŒºä¸­çš„é¡µå¯ä»¥ç”¨äºä¸åŒçš„ç›®çš„ï¼Œæ¯”å¦‚æœ‰äº›é¡µé¢ç”¨äºæ®µAï¼Œæœ‰äº›é¡µé¢ç”¨äºæ®µBï¼Œæœ‰äº›é¡µç”šè‡³å“ªä¸ªæ®µéƒ½ä¸å±äºã€‚<code>ç¢ç‰‡åŒºç›´å±äºè¡¨ç©ºé—´</code>ï¼Œå¹¶ä¸å±äºä»»ä½•ä¸€ä¸ªæ®µã€‚</p><p>æ‰€ä»¥æ­¤åä¸ºæŸä¸ªæ®µåˆ†é…å­˜å‚¨ç©ºé—´çš„ç­–ç•¥æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>åœ¨åˆšå¼€å§‹å‘è¡¨ä¸­æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œæ®µæ˜¯ä»æŸä¸ªç¢ç‰‡åŒºä»¥å•ä¸ªé¡µé¢ä¸ºå•ä½æ¥åˆ†é…å­˜å‚¨ç©ºé—´çš„ã€‚</li><li>å½“æŸä¸ªæ®µå·²ç»å ç”¨äº†<code>32ä¸ªç¢ç‰‡åŒº</code>é¡µé¢ä¹‹åï¼Œå°±ä¼šç”³è¯·ä»¥å®Œæ•´çš„åŒºä¸ºå•ä½æ¥åˆ†é…å­˜å‚¨ç©ºé—´ã€‚</li></ul><p>æ‰€ä»¥ç°åœ¨æ®µä¸èƒ½ä»…å®šä¹‰ä¸ºæ˜¯æŸäº›åŒºçš„é›†åˆï¼Œæ›´ç²¾ç¡®çš„åº”è¯¥æ˜¯<code>æŸäº›é›¶æ•£çš„é¡µé¢</code>å·²ç»<code>ä¸€äº›å®Œæ•´çš„åŒº</code>çš„é›†åˆã€‚</p><h5 id="4-4-åŒºçš„åˆ†ç±»"><a href="#4-4-åŒºçš„åˆ†ç±»" class="headerlink" title="4.4 åŒºçš„åˆ†ç±»"></a>4.4 åŒºçš„åˆ†ç±»</h5><p>åŒºå¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸º4ç§ç±»å‹ï¼š</p><ul><li><code>ç©ºé—²çš„åŒº(FREE)</code>ï¼šç°åœ¨è¿˜æ²¡æœ‰ç”¨åˆ°è¿™ä¸ªåŒºä¸­çš„ä»»ä½•é¡µé¢ã€‚</li><li><code>æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(FREE_FRAG)</code>ï¼šè¡¨ç¤ºç¢ç‰‡åŒºä¸­è¿˜æœ‰å¯ç”¨çš„é¡µé¢ã€‚</li><li><code>æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(FULL_FRAG)</code>ï¼šè¡¨ç¤ºç¢ç‰‡åŒºä¸­çš„æ‰€æœ‰é¡µé¢éƒ½è¢«ä½¿ç”¨ï¼Œæ²¡æœ‰ç©ºé—²é¡µé¢ã€‚</li><li><code>é™„å±äºæŸä¸ªæ®µçš„åŒº(FSEG)</code>ï¼šæ¯ä¸€ç´¢å¼•éƒ½å¯ä»¥åˆ†ä¸ºå¶å­èŠ‚ç‚¹æ®µå’Œéå¶å­èŠ‚ç‚¹æ®µ</li></ul><p>å¤„äº<code>FREE</code>ã€<code>FREE_FRAG</code>ä»¥åŠ<code>FULL_FRAG</code>è¿™ä¸‰ç§çŠ¶æ€çš„åŒºéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œç›´å±äºè¡¨ç©ºé—´ã€‚è€Œå¤„äº<code>FSEG</code>çŠ¶æ€çš„åŒºæ˜¯é™„å±äºæŸä¸ªæ®µçš„ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬11ç«  æ•°æ®åº“çš„è®¾è®¡è§„èŒƒ</title>
      <link href="/2023/07/15/%E7%AC%AC11%E7%AB%A0%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83/"/>
      <url>/2023/07/15/%E7%AC%AC11%E7%AB%A0%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬11ç« -æ•°æ®åº“çš„è®¾è®¡è§„èŒƒ"><a href="#ç¬¬11ç« -æ•°æ®åº“çš„è®¾è®¡è§„èŒƒ" class="headerlink" title="ç¬¬11ç«  æ•°æ®åº“çš„è®¾è®¡è§„èŒƒ"></a>ç¬¬11ç«  æ•°æ®åº“çš„è®¾è®¡è§„èŒƒ</h3><h4 id="1-èŒƒ-å¼"><a href="#1-èŒƒ-å¼" class="headerlink" title="1. èŒƒ å¼"></a><strong>1.</strong> <strong>èŒƒ å¼</strong></h4><h5 id="1-1-èŒƒå¼ç®€ä»‹"><a href="#1-1-èŒƒå¼ç®€ä»‹" class="headerlink" title="1.1 èŒƒå¼ç®€ä»‹"></a><strong>1.1</strong> <strong>èŒƒå¼ç®€ä»‹</strong></h5><p><strong>åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œå…³äºæ•°æ®è¡¨è®¾è®¡çš„åŸºæœ¬åŸåˆ™ã€è§„åˆ™å°±ç§°ä¸ºèŒƒå¼ã€‚</strong>å¯ä»¥ç†è§£ä¸ºï¼Œä¸€å¼ æ•°æ®è¡¨çš„è®¾è®¡ç»“æ„éœ€è¦æ»¡è¶³çš„æŸç§è®¾è®¡æ ‡å‡†çš„<code>çº§åˆ«</code>ã€‚è¦æƒ³è®¾è®¡ä¸€ä¸ªç»“æ„åˆç†çš„å…³ç³»å‹æ•°æ®åº“ï¼Œå¿…é¡»æ»¡è¶³ä¸€å®šçš„èŒƒå¼ã€‚</p><h5 id="1-2-èŒƒå¼éƒ½åŒ…æ‹¬å“ªäº›"><a href="#1-2-èŒƒå¼éƒ½åŒ…æ‹¬å“ªäº›" class="headerlink" title="1.2 èŒƒå¼éƒ½åŒ…æ‹¬å“ªäº›"></a><strong>1.2</strong> <strong>èŒƒå¼éƒ½åŒ…æ‹¬å“ªäº›</strong></h5><p>ç›®å‰å…³ç³»å‹æ•°æ®åº“æœ‰å…­ç§å¸¸è§èŒƒå¼ï¼ŒæŒ‰ç…§èŒƒå¼çº§åˆ«ï¼Œä»ä½åˆ°é«˜åˆ†åˆ«æ˜¯ï¼š<strong>ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ã€ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ã€ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ã€å·´æ–¯-ç§‘å¾·èŒƒå¼ï¼ˆBCNFï¼‰ã€ç¬¬å››èŒƒå¼(4NFï¼‰å’Œç¬¬äº”èŒƒå¼ï¼ˆ5NFï¼Œåˆç§°å®Œç¾èŒƒå¼ï¼‰</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204030928295.png" alt="image-20220403092826169"></p><h5 id="1-3-é”®å’Œç›¸å…³å±æ€§çš„æ¦‚å¿µ"><a href="#1-3-é”®å’Œç›¸å…³å±æ€§çš„æ¦‚å¿µ" class="headerlink" title="1.3 é”®å’Œç›¸å…³å±æ€§çš„æ¦‚å¿µ"></a><strong>1.3</strong> <strong>é”®å’Œç›¸å…³å±æ€§çš„æ¦‚å¿µ</strong></h5><p>è¿™é‡Œæœ‰ä¸¤ä¸ªè¡¨ï¼š</p><p><code>çƒå‘˜è¡¨(player)</code>ï¼šçƒå‘˜ç¼–å· | å§“å | èº«ä»½è¯å· | å¹´é¾„ | çƒé˜Ÿç¼–å·</p><p><code>çƒé˜Ÿè¡¨(team)</code>ï¼šçƒé˜Ÿç¼–å· | ä¸»æ•™ç»ƒ | çƒé˜Ÿæ‰€åœ¨åœ°</p><ul><li><code>è¶…é”®</code>ï¼šå¯¹äºçƒå‘˜è¡¨æ¥è¯´ï¼Œè¶…é”®å°±æ˜¯åŒ…æ‹¬çƒå‘˜ç¼–å·æˆ–è€…èº«ä»½è¯å·çš„ä»»æ„ç»„åˆï¼Œæ¯”å¦‚ï¼ˆçƒå‘˜ç¼–å·ï¼‰ï¼ˆçƒå‘˜ç¼–å·ï¼Œå§“åï¼‰ï¼ˆèº«ä»½è¯å·ï¼Œå¹´é¾„ï¼‰ç­‰ã€‚</li><li><code>å€™é€‰é”®</code>ï¼šå°±æ˜¯æœ€å°çš„è¶…é”®ï¼Œå¯¹äºçƒå‘˜è¡¨æ¥è¯´ï¼Œå€™é€‰é”®å°±æ˜¯ï¼ˆçƒå‘˜ç¼–å·ï¼‰æˆ–è€…ï¼ˆèº«ä»½è¯å·ï¼‰ã€‚</li><li><code>ä¸»é”®</code>ï¼šæˆ‘ä»¬è‡ªå·±é€‰å®šï¼Œä¹Ÿå°±æ˜¯ä»å€™é€‰é”®ä¸­é€‰æ‹©ä¸€ä¸ªï¼Œæ¯”å¦‚ï¼ˆçƒå‘˜ç¼–å·ï¼‰ã€‚</li><li><code>å¤–é”®</code>ï¼šçƒå‘˜è¡¨ä¸­çš„çƒé˜Ÿç¼–å·ã€‚</li><li><code>ä¸»å±æ€§</code>ã€<code>éä¸»å±æ€§</code>ï¼šåœ¨çƒå‘˜è¡¨ä¸­ï¼Œä¸»å±æ€§æ˜¯ï¼ˆçƒå‘˜ç¼–å·ï¼‰ï¼ˆèº«ä»½è¯å·ï¼‰ï¼Œå…¶ä»–çš„å±æ€§ï¼ˆå§“åï¼‰ï¼ˆå¹´é¾„ï¼‰ï¼ˆçƒé˜Ÿç¼–å·ï¼‰éƒ½æ˜¯éä¸»å±æ€§ã€‚</li></ul><h5 id="1-4-ç¬¬ä¸€èŒƒå¼-1st-NF"><a href="#1-4-ç¬¬ä¸€èŒƒå¼-1st-NF" class="headerlink" title="1.4 ç¬¬ä¸€èŒƒå¼(1st NF)"></a><strong>1.4</strong> <strong>ç¬¬ä¸€èŒƒå¼(1st NF)</strong></h5><p>ç¬¬ä¸€èŒƒå¼ä¸»è¦æ˜¯ç¡®ä¿æ•°æ®è¡¨ä¸­æ¯ä¸ªå­—æ®µçš„å€¼å¿…é¡»å…·æœ‰<code>åŸå­æ€§</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®è¡¨ä¸­æ¯ä¸ªå­—æ®µçš„å€¼ä¸º<code>ä¸å¯å†æ¬¡æ‹†åˆ†</code>çš„æœ€å°æ•°æ®å•ä½ã€‚</p><h5 id="1-5-ç¬¬äºŒèŒƒå¼-2nd-NF"><a href="#1-5-ç¬¬äºŒèŒƒå¼-2nd-NF" class="headerlink" title="1.5 ç¬¬äºŒèŒƒå¼(2nd NF)"></a><strong>1.5</strong> <strong>ç¬¬äºŒèŒƒå¼(2nd NF)</strong></h5><p>ç¬¬äºŒèŒƒå¼è¦æ±‚ï¼Œåœ¨æ»¡è¶³ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œè¿˜è¦<strong>æ»¡è¶³æ•°æ®è¡¨é‡Œçš„æ¯ä¸€æ¡æ•°æ®è®°å½•ï¼Œéƒ½æ˜¯å¯å”¯ä¸€æ ‡è¯†çš„ã€‚è€Œä¸”æ‰€æœ‰éä¸»é”®å­—æ®µï¼Œéƒ½å¿…é¡»å®Œå…¨ä¾èµ–ä¸»é”®ï¼Œä¸èƒ½åªä¾èµ–ä¸»é”®çš„ä¸€éƒ¨åˆ†ã€‚</strong>å¦‚æœçŸ¥é“ä¸»é”®çš„æ‰€æœ‰å±æ€§çš„å€¼ï¼Œå°±å¯ä»¥æ£€ç´¢åˆ°ä»»ä½•å…ƒç»„ï¼ˆè¡Œï¼‰çš„ä»»ä½•å±æ€§çš„ä»»ä½•å€¼ã€‚</p><h5 id="1-6-ç¬¬ä¸‰èŒƒå¼-3rd-NF"><a href="#1-6-ç¬¬ä¸‰èŒƒå¼-3rd-NF" class="headerlink" title="1.6 ç¬¬ä¸‰èŒƒå¼(3rd NF)"></a><strong>1.6</strong> <strong>ç¬¬ä¸‰èŒƒå¼(3rd NF)</strong></h5><p>ç¬¬ä¸‰èŒƒå¼æ˜¯åœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œç¡®ä¿æ•°æ®è¡¨ä¸­çš„æ¯ä¸€ä¸ªéä¸»é”®å­—æ®µéƒ½å’Œä¸»é”®å­—æ®µç›´æ¥ç›¸å…³ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>è¦æ±‚æ•°æ®è¡¨ä¸­çš„æ‰€æœ‰éä¸»é”®å­—æ®µä¸èƒ½ä¾èµ–äºå…¶ä»–éä¸»é”®å­—æ®µã€‚</strong>ï¼ˆå³ï¼Œä¸èƒ½å­˜åœ¨éä¸»å±æ€§Aä¾èµ–äºéä¸»å±æ€§Bï¼Œéä¸»å±æ€§Bä¾èµ–äºä¸»é”®Cçš„æƒ…å†µï¼Œå³å­˜åœ¨â€Aâ€“&gt;Bâ€“&gt;Câ€çš„å†³å®šå…³ç³»ï¼‰é€šä¿—åœ°è®²ï¼Œè¯¥è§„åˆ™çš„æ„æ€æ˜¯æ‰€æœ‰<code>éä¸»é”®å±æ€§</code>ä¹‹é—´ä¸èƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œå¿…é¡»<code>ç›¸äº’ç‹¬ç«‹</code>ã€‚</p><h5 id="1-7-å°ç»“"><a href="#1-7-å°ç»“" class="headerlink" title="1.7 å°ç»“"></a>1.7 å°ç»“</h5><p>å…³äºæ•°æ®è¡¨çš„è®¾è®¡ï¼Œæœ‰ä¸‰ä¸ªèŒƒå¼è¦éµå¾ªã€‚</p><p>ï¼ˆ1ï¼‰ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ï¼Œç¡®ä¿æ¯åˆ—ä¿æŒ<code>åŸå­æ€§</code></p><p>æ•°æ®åº“çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸå­æ•°æ®é¡¹ï¼Œä¸å¯å†åˆ†çš„æœ€å°æ•°æ®å•å…ƒï¼Œè€Œä¸èƒ½æ˜¯é›†åˆã€æ•°ç»„ã€è®°å½•ç­‰éåŸå­æ•°æ®é¡¹ã€‚</p><p>ï¼ˆ2ï¼‰ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼Œç¡®ä¿æ¯åˆ—éƒ½å’Œä¸»é”®<code>å®Œå…¨ä¾èµ–</code></p><p>å°¤å…¶åœ¨å¤åˆä¸»é”®çš„æƒ…å†µå‘ä¸‹ï¼Œéä¸»é”®éƒ¨åˆ†ä¸åº”è¯¥ä¾èµ–äºéƒ¨åˆ†ä¸»é”®ã€‚</p><p>ï¼ˆ3ï¼‰ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼Œç¡®ä¿æ¯åˆ—éƒ½å’Œä¸»é”®<code>ç›´æ¥ç›¸å…³</code>ï¼Œè€Œä¸æ˜¯é—´æ¥ç›¸å…³</p><p><strong>èŒƒå¼çš„ä¼˜ç‚¹ï¼š</strong>æ•°æ®çš„æ ‡å‡†åŒ–æœ‰åŠ©äºæ¶ˆé™¤æ•°æ®åº“ä¸­çš„<code>æ•°æ®å†—ä½™</code>ï¼Œç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰é€šå¸¸è¢«è®¤ä¸ºåœ¨æ€§èƒ½ã€æ‹“å±•æ€§å’Œæ•°æ®å®Œæ•´æ€§æ–¹é¢è¾¾åˆ°äº†æœ€å¥½çš„å¹³è¡¡ã€‚</p><p><strong>èŒƒå¼çš„ç¼ºç‚¹ï¼š</strong>èŒƒå¼çš„ä½¿ç”¨ï¼Œå¯èƒ½<code>é™ä½æŸ¥è¯¢çš„æ•ˆç‡</code>ã€‚å› ä¸ºèŒƒå¼ç­‰çº§è¶Šé«˜ï¼Œè®¾è®¡å‡ºæ¥çš„æ•°æ®è¡¨å°±è¶Šå¤šã€è¶Šç²¾ç»†ï¼Œæ•°æ®çš„å†—ä½™åº¦å°±è¶Šä½ï¼Œè¿›è¡Œæ•°æ®æŸ¥è¯¢çš„æ—¶å€™å°±å¯èƒ½éœ€è¦<code>å…³è”å¤šå¼ è¡¨</code>ï¼Œè¿™ä¸ä½†ä»£ä»·æ˜‚è´µï¼Œä¹Ÿå¯èƒ½ä½¿ä¸€äº›<code>ç´¢å¼•ç­–ç•¥æ— æ•ˆ</code>ã€‚</p><p>èŒƒå¼åªæ˜¯æå‡ºäº†è®¾è®¡çš„æ ‡å‡†ï¼Œå®é™…ä¸Šè®¾è®¡æ•°æ®è¡¨æ—¶ï¼Œæœªå¿…ä¸€å®šè¦ç¬¦åˆè¿™äº›æ ‡å‡†ã€‚å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¼šå‡ºç°ä¸ºäº†æ€§èƒ½å’Œè¯»å–æ•ˆç‡è¿åèŒƒå¼åŒ–çš„åŸåˆ™ï¼Œé€šè¿‡<code>å¢åŠ å°‘é‡çš„å†—ä½™</code>æˆ–é‡å¤çš„æ•°æ®æ¥æé«˜æ•°æ®åº“çš„<code>è¯»æ€§èƒ½</code>ï¼Œå‡å°‘å…³è”æŸ¥è¯¢ï¼Œjoinè¡¨çš„æ¬¡æ•°ï¼Œå®ç°<code>ç©ºé—´æ¢å–æ—¶é—´</code>çš„ç›®çš„ã€‚å› æ­¤åœ¨å®é™…çš„è®¾è®¡è¿‡ç¨‹ä¸­è¦ç†è®ºç»“åˆå®é™…ï¼Œçµæ´»è¿ç”¨ã€‚</p><h4 id="2-åèŒƒå¼åŒ–"><a href="#2-åèŒƒå¼åŒ–" class="headerlink" title="2. åèŒƒå¼åŒ–"></a><strong>2.</strong> <strong>åèŒƒå¼åŒ–</strong></h4><h5 id="2-1-æ¦‚è¿°"><a href="#2-1-æ¦‚è¿°" class="headerlink" title="2.1 æ¦‚è¿°"></a><strong>2.1</strong> <strong>æ¦‚è¿°</strong></h5><p><strong>è§„èŒƒåŒ–</strong> <strong>vs</strong> <strong>æ€§èƒ½</strong></p><ol><li><p>ä¸ºæ»¡è¶³æŸç§å•†ä¸šç›®æ ‡ , æ•°æ®åº“æ€§èƒ½æ¯”è§„èŒƒåŒ–æ•°æ®åº“æ›´é‡è¦</p></li><li><p>åœ¨æ•°æ®è§„èŒƒåŒ–çš„åŒæ—¶ , è¦ç»¼åˆè€ƒè™‘æ•°æ®åº“çš„æ€§èƒ½</p></li><li><p>é€šè¿‡åœ¨ç»™å®šçš„è¡¨ä¸­æ·»åŠ é¢å¤–çš„å­—æ®µï¼Œä»¥å¤§é‡å‡å°‘éœ€è¦ä»ä¸­æœç´¢ä¿¡æ¯æ‰€éœ€çš„æ—¶é—´</p></li><li><p>é€šè¿‡åœ¨ç»™å®šçš„è¡¨ä¸­æ’å…¥è®¡ç®—åˆ—ï¼Œä»¥æ–¹ä¾¿æŸ¥è¯¢</p></li></ol><h5 id="2-2-åèŒƒå¼çš„æ–°é—®é¢˜"><a href="#2-2-åèŒƒå¼çš„æ–°é—®é¢˜" class="headerlink" title="2.2 åèŒƒå¼çš„æ–°é—®é¢˜"></a><strong>2.2</strong> <strong>åèŒƒå¼çš„æ–°é—®é¢˜</strong></h5><ul><li>å­˜å‚¨<code>ç©ºé—´å˜å¤§</code>äº†</li><li>ä¸€ä¸ªè¡¨ä¸­å­—æ®µåšäº†ä¿®æ”¹ï¼Œå¦ä¸€ä¸ªè¡¨ä¸­å†—ä½™çš„å­—æ®µä¹Ÿéœ€è¦åšåŒæ­¥ä¿®æ”¹ï¼Œå¦åˆ™<code>æ•°æ®ä¸ä¸€è‡´</code></li><li>è‹¥é‡‡ç”¨å­˜å‚¨è¿‡ç¨‹æ¥æ”¯æŒæ•°æ®çš„æ›´æ–°ã€åˆ é™¤ç­‰é¢å¤–æ“ä½œï¼Œå¦‚æœæ›´æ–°é¢‘ç¹ï¼Œä¼šéå¸¸<code>æ¶ˆè€—ç³»ç»Ÿèµ„æº</code></li><li>åœ¨<code>æ•°æ®é‡å°</code>çš„æƒ…å†µä¸‹ï¼ŒåèŒƒå¼ä¸èƒ½ä½“ç°æ€§èƒ½çš„ä¼˜åŠ¿ï¼Œå¯èƒ½è¿˜ä¼šè®©æ•°æ®åº“çš„è®¾è®¡æ›´åŠ <code>å¤æ‚</code></li></ul><h5 id="2-3-åèŒƒå¼çš„é€‚ç”¨åœºæ™¯"><a href="#2-3-åèŒƒå¼çš„é€‚ç”¨åœºæ™¯" class="headerlink" title="2.3 åèŒƒå¼çš„é€‚ç”¨åœºæ™¯"></a><strong>2.3</strong> <strong>åèŒƒå¼çš„é€‚ç”¨åœºæ™¯</strong></h5><p>å½“å†—ä½™ä¿¡æ¯æœ‰ä»·å€¼æˆ–è€…èƒ½<code>å¤§å¹…åº¦æé«˜æŸ¥è¯¢æ•ˆç‡</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰ä¼šé‡‡å–åèŒƒå¼çš„ä¼˜åŒ–ã€‚</p><p><strong>1.</strong> <strong>å¢åŠ å†—ä½™å­—æ®µçš„å»ºè®®</strong> </p><p>1ï¼‰è¿™ä¸ªå†—ä½™å­—æ®µ<code>ä¸éœ€è¦ç»å¸¸è¿›è¡Œä¿®æ”¹</code></p><p>2ï¼‰è¿™ä¸ªå†—ä½™å­—æ®µ<code>æŸ¥è¯¢çš„æ—¶å€™ä¸å¯æˆ–ç¼º</code></p><p><strong>2.</strong> <strong>å†å²å¿«ç…§ã€å†å²æ•°æ®çš„éœ€è¦</strong></p><p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ä¸€äº›å†—ä½™ä¿¡æ¯ï¼Œæ¯”å¦‚è®¢å•ä¸­çš„æ”¶è´§äººä¿¡æ¯ï¼ŒåŒ…æ‹¬å§“åã€ç”µè¯å’Œåœ°å€ç­‰ã€‚æ¯æ¬¡å‘ç”Ÿçš„<code>è®¢å•æ”¶è´§ä¿¡æ¯</code>éƒ½å±äº<code>å†å²å¿«ç…§</code>ï¼Œéœ€è¦è¿›è¡Œä¿å­˜ï¼Œä½†ç”¨æˆ·å¯ä»¥éšæ—¶ä¿®æ”¹è‡ªå·±çš„ä¿¡æ¯ï¼Œè¿™æ—¶ä¿å­˜è¿™äº›å†—ä½™ä¿¡æ¯æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚</p><p>åèŒƒå¼ä¼˜åŒ–ä¹Ÿå¸¸ç”¨åœ¨<code>æ•°æ®ä»“åº“</code>çš„è®¾è®¡ä¸­ï¼Œå› ä¸ºæ•°æ®ä»“åº“é€šå¸¸<code>å­˜å‚¨å†å²æ•°æ®</code>ï¼Œå¯¹å¢åˆ æ”¹çš„å®æ—¶æ€§è¦æ±‚ä¸å¼ºï¼Œå¯¹å†å²æ•°æ®çš„åˆ†æéœ€æ±‚å¼ºã€‚è¿™æ—¶é€‚å½“å…è®¸æ•°æ®çš„å†—ä½™åº¦ï¼Œæ›´æ–¹ä¾¿è¿›è¡Œæ•°æ®åˆ†æã€‚</p><h4 id="3-BCNF-å·´æ–¯èŒƒå¼"><a href="#3-BCNF-å·´æ–¯èŒƒå¼" class="headerlink" title="3. BCNF(å·´æ–¯èŒƒå¼)"></a><strong>3. BCNF(å·´æ–¯èŒƒå¼)</strong></h4><p>ä¸»å±æ€§ï¼ˆä»“åº“åï¼‰å¯¹äºå€™é€‰é”®ï¼ˆç®¡ç†å‘˜ï¼Œç‰©å“åï¼‰æ˜¯éƒ¨åˆ†ä¾èµ–çš„å…³ç³»ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½å¯¼è‡´å¼‚å¸¸æƒ…å†µã€‚å› æ­¤å¼•å…¥BCNFï¼Œ<strong>å®ƒåœ¨</strong> <strong>3NF</strong> <strong>çš„åŸºç¡€ä¸Šæ¶ˆé™¤äº†ä¸»å±æ€§å¯¹å€™é€‰é”®çš„éƒ¨åˆ†ä¾èµ–æˆ–è€…ä¼ é€’ä¾èµ–å…³ç³»</strong>ã€‚</p><p>å¦‚æœåœ¨å…³ç³»Rä¸­ï¼ŒUä¸ºä¸»é”®ï¼ŒAå±æ€§æ˜¯ä¸»é”®çš„ä¸€ä¸ªå±æ€§ï¼Œè‹¥å­˜åœ¨A-&gt;Yï¼ŒYä¸ºä¸»å±æ€§ï¼Œåˆ™è¯¥å…³ç³»ä¸å±äºBCNFã€‚</p><h4 id="4-ERæ¨¡å‹"><a href="#4-ERæ¨¡å‹" class="headerlink" title="4. ERæ¨¡å‹"></a><strong>4. ERæ¨¡å‹</strong></h4><p>ERæ¨¡å‹ä¹Ÿå«åš<code>å®ä½“å…³ç³»æ¨¡å‹</code>ï¼Œæ˜¯ç”¨æ¥æè¿°ç°å®ç”Ÿæ´»ä¸­å®¢è§‚å­˜åœ¨çš„äº‹ç‰©ã€äº‹ç‰©çš„å±æ€§ï¼Œä»¥åŠäº‹ç‰©ä¹‹é—´å…³ç³»çš„ä¸€ç§æ•°æ®æ¨¡å‹ã€‚<strong>åœ¨å¼€å‘åŸºäºæ•°æ®åº“çš„ä¿¡æ¯ç³»ç»Ÿçš„è®¾è®¡é˜¶æ®µï¼Œé€šå¸¸ä½¿ç”¨ERæ¨¡å‹æ¥æè¿°ä¿¡æ¯éœ€è¦å’Œä¿¡æ¯ç‰¹æ€§ï¼Œå¸®åŠ©æˆ‘ä»¬ç†æ¸…ä¸šåŠ¡é€»è¾‘ï¼Œä»è€Œè®¾è®¡å‡ºä¼˜ç§€çš„æ•°æ®åº“ã€‚</strong></p><h5 id="4-1-ER-æ¨¡å‹åŒ…æ‹¬é‚£äº›è¦ç´ ï¼Ÿ"><a href="#4-1-ER-æ¨¡å‹åŒ…æ‹¬é‚£äº›è¦ç´ ï¼Ÿ" class="headerlink" title="4.1 ER æ¨¡å‹åŒ…æ‹¬é‚£äº›è¦ç´ ï¼Ÿ"></a>4.1 ER æ¨¡å‹åŒ…æ‹¬é‚£äº›è¦ç´ ï¼Ÿ</h5><p><strong>ER</strong> <strong>æ¨¡å‹ä¸­æœ‰ä¸‰ä¸ªè¦ç´ ï¼Œåˆ†åˆ«æ˜¯å®ä½“ã€å±æ€§å’Œå…³ç³»</strong>ã€‚ </p><p><code>å®ä½“</code>ï¼Œå¯ä»¥çœ‹åšæ˜¯æ•°æ®å¯¹è±¡ï¼Œå¾€å¾€å¯¹åº”äºç°å®ç”Ÿæ´»ä¸­çš„çœŸå®å­˜åœ¨çš„ä¸ªä½“ã€‚åœ¨ ER æ¨¡å‹ä¸­ï¼Œç”¨<code>çŸ©å½¢</code>æ¥è¡¨ç¤ºã€‚å®ä½“åˆ†ä¸ºä¸¤ç±»ï¼Œåˆ†åˆ«æ˜¯<code>å¼ºå®ä½“</code>å’Œ<code>å¼±å®ä½“</code>ã€‚å¼ºå®ä½“æ˜¯æŒ‡ä¸ä¾èµ–äºå…¶ä»–å®ä½“çš„å®ä½“ï¼›å¼±å®ä½“æ˜¯æŒ‡å¯¹å¦ä¸€ä¸ªå®ä½“æœ‰å¾ˆå¼ºçš„ä¾èµ–å…³ç³»çš„å®ä½“ã€‚</p><p><code>å±æ€§</code>ï¼Œåˆ™æ˜¯æŒ‡å®ä½“çš„ç‰¹æ€§ã€‚æ¯”å¦‚è¶…å¸‚çš„åœ°å€ã€è”ç³»ç”µè¯ã€å‘˜å·¥æ•°ç­‰ã€‚åœ¨ ER æ¨¡å‹ä¸­ç”¨<code>æ¤­åœ†å½¢</code>æ¥è¡¨ç¤ºã€‚</p><p><code>å…³ç³»</code>ï¼Œåˆ™æ˜¯æŒ‡å®ä½“ä¹‹é—´çš„è”ç³»ã€‚æ¯”å¦‚è¶…å¸‚æŠŠå•†å“å–ç»™é¡¾å®¢ï¼Œå°±æ˜¯ä¸€ç§è¶…å¸‚ä¸é¡¾å®¢ä¹‹é—´çš„è”ç³»ã€‚åœ¨ ER æ¨¡å‹ä¸­ç”¨<code>è±å½¢</code>æ¥è¡¨ç¤ºã€‚</p><p>æ³¨æ„ï¼šå®ä½“å’Œå±æ€§ä¸å®¹æ˜“åŒºåˆ†ã€‚è¿™é‡Œæä¾›ä¸€ä¸ªåŸåˆ™ï¼šæˆ‘ä»¬è¦ä»ç³»ç»Ÿæ•´ä½“çš„è§’åº¦å‡ºå‘å»çœ‹ï¼Œ<strong>å¯ä»¥ç‹¬ç«‹å­˜åœ¨çš„æ˜¯å®ä½“ï¼Œä¸å¯å†åˆ†çš„æ˜¯å±æ€§</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå±æ€§ä¸èƒ½åŒ…å«å…¶ä»–å±æ€§ã€‚</p><h5 id="4-2-å…³ç³»çš„ç±»å‹"><a href="#4-2-å…³ç³»çš„ç±»å‹" class="headerlink" title="4.2 å…³ç³»çš„ç±»å‹"></a><strong>4.2</strong> <strong>å…³ç³»çš„ç±»å‹</strong></h5><p>åœ¨ ER æ¨¡å‹çš„ 3 ä¸ªè¦ç´ ä¸­ï¼Œå…³ç³»åˆå¯ä»¥åˆ†ä¸º 3 ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šã€‚</p><p><code>ä¸€å¯¹ä¸€</code>ï¼šæŒ‡å®ä½“ä¹‹é—´çš„å…³ç³»æ˜¯ä¸€ä¸€å¯¹åº”çš„</p><p><code>ä¸€å¯¹å¤š</code>ï¼šæŒ‡ä¸€è¾¹çš„å®ä½“é€šè¿‡å…³ç³»ï¼Œå¯ä»¥å¯¹åº”å¤šä¸ªå¦å¤–ä¸€è¾¹çš„å®ä½“ã€‚ç›¸åï¼Œå¦å¤–ä¸€è¾¹çš„å®ä½“é€šè¿‡è¿™ä¸ªå…³ç³»ï¼Œåˆ™åªèƒ½å¯¹åº”å”¯ä¸€çš„ä¸€è¾¹çš„å®ä½“</p><p><code>å¤šå¯¹å¤š</code>ï¼šæŒ‡å…³ç³»ä¸¤è¾¹çš„å®ä½“éƒ½å¯ä»¥é€šè¿‡å…³ç³»å¯¹åº”å¤šä¸ªå¯¹æ–¹çš„å®ä½“</p><h4 id="5-æ•°æ®è¡¨çš„è®¾è®¡åŸåˆ™"><a href="#5-æ•°æ®è¡¨çš„è®¾è®¡åŸåˆ™" class="headerlink" title="5. æ•°æ®è¡¨çš„è®¾è®¡åŸåˆ™"></a><strong>5.</strong> <strong>æ•°æ®è¡¨çš„è®¾è®¡åŸåˆ™</strong></h4><p>æ•°æ®è¡¨è®¾è®¡çš„ä¸€èˆ¬åŸåˆ™ï¼šâ€ä¸‰å°‘ä¸€å¤šâ€ </p><p><strong>1.</strong> <strong>æ•°æ®è¡¨çš„ä¸ªæ•°è¶Šå°‘è¶Šå¥½</strong> </p><p><strong>2.</strong> <strong>æ•°æ®è¡¨ä¸­çš„å­—æ®µä¸ªæ•°è¶Šå°‘è¶Šå¥½</strong></p><p><strong>3.</strong> <strong>æ•°æ®è¡¨ä¸­è”åˆä¸»é”®çš„å­—æ®µä¸ªæ•°è¶Šå°‘è¶Šå¥½</strong></p><p><strong>4.</strong> <strong>ä½¿ç”¨ä¸»é”®å’Œå¤–é”®è¶Šå¤šè¶Šå¥½</strong></p><blockquote><p>æ³¨æ„ï¼šè¿™ä¸ªåŸåˆ™å¹¶ä¸æ˜¯ç»å¯¹çš„ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ç‰ºç‰²æ•°æ®çš„å†—ä½™åº¦æ¥æ¢å–æ•°æ®å¤„ç†çš„æ•ˆç‡ã€‚</p></blockquote><h4 id="6-æ•°æ®åº“å¯¹è±¡ç¼–å†™å»ºè®®"><a href="#6-æ•°æ®åº“å¯¹è±¡ç¼–å†™å»ºè®®" class="headerlink" title="6. æ•°æ®åº“å¯¹è±¡ç¼–å†™å»ºè®®"></a><strong>6.</strong> <strong>æ•°æ®åº“å¯¹è±¡ç¼–å†™å»ºè®®</strong></h4><h5 id="6-1-å…³äºåº“"><a href="#6-1-å…³äºåº“" class="headerlink" title="6.1 å…³äºåº“"></a><strong>6.1</strong> <strong>å…³äºåº“</strong></h5><ol><li><p>ã€å¼ºåˆ¶ã€‘åº“çš„åç§°å¿…é¡»æ§åˆ¶åœ¨32ä¸ªå­—ç¬¦ä»¥å†…ï¼Œåªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œå»ºè®®ä»¥è‹±æ–‡å­—æ¯å¼€å¤´ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘åº“åä¸­è‹±æ–‡<code>ä¸€å¾‹å°å†™</code>ï¼Œä¸åŒå•è¯é‡‡ç”¨<code>ä¸‹åˆ’çº¿</code>åˆ†å‰²ã€‚é¡»è§åçŸ¥æ„ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘åº“çš„åç§°æ ¼å¼ï¼šä¸šåŠ¡ç³»ç»Ÿåç§°_å­ç³»ç»Ÿåã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘åº“åç¦æ­¢ä½¿ç”¨å…³é”®å­—ï¼ˆå¦‚type,orderç­‰ï¼‰ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘åˆ›å»ºæ•°æ®åº“æ—¶å¿…é¡»<code>æ˜¾å¼æŒ‡å®šå­—ç¬¦é›†</code>ï¼Œå¹¶ä¸”å­—ç¬¦é›†åªèƒ½æ˜¯utf8æˆ–è€…utf8mb4ã€‚åˆ›å»ºæ•°æ®åº“SQLä¸¾ä¾‹ï¼šCREATE DATABASE crm_fund <code>DEFAULT CHARACTER SET &#39;utf8&#39;</code>; </p></li><li><p>ã€å»ºè®®ã€‘å¯¹äºç¨‹åºè¿æ¥æ•°æ®åº“è´¦å·ï¼Œéµå¾ª<code>æƒé™æœ€å°åŸåˆ™</code>ã€‚ä½¿ç”¨æ•°æ®åº“è´¦å·åªèƒ½åœ¨ä¸€ä¸ªDBä¸‹ä½¿ç”¨ï¼Œä¸å‡†è·¨åº“ã€‚ç¨‹åºä½¿ç”¨çš„è´¦å·<code>åŸåˆ™ä¸Šä¸å‡†æœ‰dropæƒé™</code>ã€‚ </p></li><li><p>ã€å»ºè®®ã€‘ä¸´æ—¶åº“ä»¥<code>tmp_</code>ä¸ºå‰ç¼€ï¼Œå¹¶ä»¥æ—¥æœŸä¸ºåç¼€ï¼›å¤‡ä»½åº“ä»¥<code>bak_</code>ä¸ºå‰ç¼€ï¼Œå¹¶ä»¥æ—¥æœŸä¸ºåç¼€ã€‚</p></li></ol><h5 id="6-2-å…³äºè¡¨ã€åˆ—"><a href="#6-2-å…³äºè¡¨ã€åˆ—" class="headerlink" title="6.2 å…³äºè¡¨ã€åˆ—"></a><strong>6.2</strong> <strong>å…³äºè¡¨ã€åˆ—</strong></h5><ol><li><p>ã€å¼ºåˆ¶ã€‘è¡¨å’Œåˆ—çš„åç§°å¿…é¡»æ§åˆ¶åœ¨32ä¸ªå­—ç¬¦ä»¥å†…ï¼Œè¡¨ååªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œå»ºè®®ä»¥<code>è‹±æ–‡å­—æ¯å¼€å¤´</code>ã€‚ </p></li><li><p>ã€å¼ºåˆ¶ã€‘ <code>è¡¨åã€åˆ—åä¸€å¾‹å°å†™</code>ï¼Œä¸åŒå•è¯é‡‡ç”¨ä¸‹åˆ’çº¿åˆ†å‰²ã€‚é¡»è§åçŸ¥æ„ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘è¡¨åè¦æ±‚æœ‰æ¨¡å—åå¼ºç›¸å…³ï¼ŒåŒä¸€æ¨¡å—çš„è¡¨åå°½é‡ä½¿ç”¨<code>ç»Ÿä¸€å‰ç¼€</code>ã€‚æ¯”å¦‚ï¼šcrm_fund_item </p></li><li><p>ã€å¼ºåˆ¶ã€‘åˆ›å»ºè¡¨æ—¶å¿…é¡»<code>æ˜¾å¼æŒ‡å®šå­—ç¬¦é›†</code>ä¸ºutf8æˆ–utf8mb4ã€‚ </p></li><li><p>ã€å¼ºåˆ¶ã€‘è¡¨åã€åˆ—åç¦æ­¢ä½¿ç”¨å…³é”®å­—ï¼ˆå¦‚type,orderç­‰ï¼‰ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘åˆ›å»ºè¡¨æ—¶å¿…é¡»<code>æ˜¾å¼æŒ‡å®šè¡¨å­˜å‚¨å¼•æ“</code>ç±»å‹ã€‚å¦‚æ— ç‰¹æ®Šéœ€æ±‚ï¼Œä¸€å¾‹ä¸ºInnoDBã€‚ </p></li><li><p>ã€å¼ºåˆ¶ã€‘å»ºè¡¨å¿…é¡»æœ‰commentã€‚ </p></li><li><p>ã€å¼ºåˆ¶ã€‘å­—æ®µå‘½ååº”å°½å¯èƒ½ä½¿ç”¨è¡¨è¾¾å®é™…å«ä¹‰çš„è‹±æ–‡å•è¯æˆ–<code>ç¼©å†™</code>ã€‚å¦‚ï¼šå…¬å¸ IDï¼Œä¸è¦ä½¿ç”¨ corporation_id, è€Œç”¨corp_id å³å¯ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘å¸ƒå°”å€¼ç±»å‹çš„å­—æ®µå‘½åä¸º<code>is_æè¿°</code>ã€‚å¦‚memberè¡¨ä¸Šè¡¨ç¤ºæ˜¯å¦ä¸ºenabledçš„ä¼šå‘˜çš„å­—æ®µå‘½åä¸º is_enabledã€‚ </p></li><li><p>ã€å¼ºåˆ¶ã€‘ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨å›¾ç‰‡ã€æ–‡ä»¶ç­‰å¤§çš„äºŒè¿›åˆ¶æ•°æ®ã€‚é€šå¸¸æ–‡ä»¶å¾ˆå¤§ï¼ŒçŸ­æ—¶é—´å†…é€ æˆæ•°æ®é‡å¿«é€Ÿå¢é•¿ï¼Œæ•°æ®åº“è¿›è¡Œæ•°æ®åº“è¯»å–æ—¶ï¼Œé€šå¸¸ä¼šè¿›è¡Œå¤§é‡çš„éšæœºIOæ“ä½œï¼Œæ–‡ä»¶å¾ˆå¤§æ—¶ï¼ŒIOæ“ä½œå¾ˆè€—æ—¶ã€‚é€šå¸¸å­˜å‚¨äºæ–‡ä»¶æœåŠ¡å™¨ï¼Œæ•°æ®åº“åªå­˜å‚¨æ–‡ä»¶åœ°å€ä¿¡æ¯ã€‚</p></li><li><p>ã€å»ºè®®ã€‘å»ºè¡¨æ—¶å…³äºä¸»é”®ï¼š<code>è¡¨å¿…é¡»æœ‰ä¸»é”® </code>(1)å¼ºåˆ¶è¦æ±‚ä¸»é”®ä¸ºidï¼Œç±»å‹ä¸ºintæˆ–bigintï¼Œä¸”ä¸ºauto_increment å»ºè®®ä½¿ç”¨unsignedæ— ç¬¦å·å‹ã€‚ (2)æ ‡è¯†è¡¨é‡Œæ¯ä¸€è¡Œä¸»ä½“çš„å­—æ®µä¸è¦è®¾ä¸ºä¸»é”®ï¼Œå»ºè®®è®¾ä¸ºå…¶ä»–å­—æ®µå¦‚user_idï¼Œorder_idç­‰ï¼Œå¹¶å»ºç«‹unique keyç´¢å¼•ã€‚å› ä¸ºå¦‚æœè®¾ä¸ºä¸»é”®ä¸”ä¸»é”®å€¼ä¸ºéšæœºæ’å…¥ï¼Œåˆ™ä¼šå¯¼è‡´innodbå†…éƒ¨é¡µåˆ†è£‚å’Œå¤§é‡éšæœºI&#x2F;Oï¼Œæ€§èƒ½ä¸‹é™ã€‚</p></li><li><p>ã€å»ºè®®ã€‘æ ¸å¿ƒè¡¨ï¼ˆå¦‚ç”¨æˆ·è¡¨ï¼‰å¿…é¡»æœ‰è¡Œæ•°æ®çš„<code>åˆ›å»ºæ—¶é—´å­—æ®µ</code>ï¼ˆcreate_timeï¼‰å’Œ<code>æœ€åæ›´æ–°æ—¶é—´å­—æ®µ</code>ï¼ˆupdate_timeï¼‰ï¼Œä¾¿äºæŸ¥é—®é¢˜ã€‚</p></li><li><p>ã€å»ºè®®ã€‘è¡¨ä¸­æ‰€æœ‰å­—æ®µå°½é‡éƒ½æ˜¯<code>NOT NULL</code>å±æ€§ï¼Œä¸šåŠ¡å¯ä»¥æ ¹æ®éœ€è¦å®šä¹‰<code>DEFAULTå€¼</code>ã€‚ å› ä¸ºä½¿ç”¨NULLå€¼ä¼šå­˜åœ¨æ¯ä¸€è¡Œéƒ½ä¼šå ç”¨é¢å¤–å­˜å‚¨ç©ºé—´ã€æ•°æ®è¿ç§»å®¹æ˜“å‡ºé”™ã€èšåˆå‡½æ•°è®¡ç®—ç»“æœåå·®ç­‰é—®é¢˜ã€‚</p></li><li><p>ã€å»ºè®®ã€‘æ‰€æœ‰å­˜å‚¨ç›¸åŒæ•°æ®çš„<code>åˆ—åå’Œåˆ—ç±»å‹å¿…é¡»ä¸€è‡´</code>ï¼ˆä¸€èˆ¬ä½œä¸ºå…³è”åˆ—ï¼Œå¦‚æœæŸ¥è¯¢æ—¶å…³è”åˆ—ç±»å‹ä¸ä¸€è‡´ä¼šè‡ªåŠ¨è¿›è¡Œæ•°æ®ç±»å‹éšå¼è½¬æ¢ï¼Œä¼šé€ æˆåˆ—ä¸Šçš„ç´¢å¼•å¤±æ•ˆï¼Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡é™ä½ï¼‰ã€‚</p></li><li><p>ã€å»ºè®®ã€‘ä¸­é—´è¡¨ï¼ˆæˆ–ä¸´æ—¶è¡¨ï¼‰ç”¨äºä¿ç•™ä¸­é—´ç»“æœé›†ï¼Œåç§°ä»¥<code>tmp_</code>å¼€å¤´ã€‚å¤‡ä»½è¡¨ç”¨äºå¤‡ä»½æˆ–æŠ“å–æºè¡¨å¿«ç…§ï¼Œåç§°ä»¥<code>bak_</code>å¼€å¤´ã€‚ä¸­é—´è¡¨å’Œå¤‡ä»½è¡¨å®šæœŸæ¸…ç†ã€‚</p></li><li><p>ã€ç¤ºèŒƒã€‘ä¸€ä¸ªè¾ƒä¸ºè§„èŒƒçš„å»ºè¡¨è¯­å¥ï¼š</p></li></ol><pre><code class="mysql">CREATE TABLE user_info (     `id` int unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;è‡ªå¢ä¸»é”®&#39;,     `user_id` bigint(11) NOT NULL COMMENT &#39;ç”¨æˆ·id&#39;,     `username` varchar(45) NOT NULL COMMENT &#39;çœŸå®å§“å&#39;,     `email` varchar(30) NOT NULL COMMENT &#39;ç”¨æˆ·é‚®ç®±&#39;,     `nickname` varchar(45) NOT NULL COMMENT &#39;æ˜µç§°&#39;,     `birthday` date NOT NULL COMMENT &#39;ç”Ÿæ—¥&#39;,     `sex` tinyint(4) DEFAULT &#39;0&#39; COMMENT &#39;æ€§åˆ«&#39;,     `short_introduce` varchar(150) DEFAULT NULL COMMENT &#39;ä¸€å¥è¯ä»‹ç»è‡ªå·±ï¼Œæœ€å¤š50ä¸ªæ±‰å­—&#39;,     `user_resume` varchar(300) NOT NULL COMMENT &#39;ç”¨æˆ·æäº¤çš„ç®€å†å­˜æ”¾åœ°å€&#39;,     `user_register_ip` int NOT NULL COMMENT &#39;ç”¨æˆ·æ³¨å†Œæ—¶çš„æºip&#39;,     `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,     `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;,     `user_review_status` tinyint NOT NULL COMMENT &#39;ç”¨æˆ·èµ„æ–™å®¡æ ¸çŠ¶æ€ï¼Œ1ä¸ºé€šè¿‡ï¼Œ2ä¸ºå®¡æ ¸ä¸­ï¼Œ3ä¸ºæœª é€šè¿‡ï¼Œ4ä¸ºè¿˜æœªæäº¤å®¡æ ¸&#39;,    PRIMARY KEY (`id`),     UNIQUE KEY `uniq_user_id` (`user_id`),     KEY `idx_username`(`username`),     KEY `idx_create_time_status`(`create_time`,`user_review_status`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&#39;ç½‘ç«™ç”¨æˆ·åŸºæœ¬ä¿¡æ¯&#39;</code></pre><ol start="17"><li>ã€å»ºè®®ã€‘åˆ›å»ºè¡¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¯è§†åŒ–å·¥å…·ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿è¡¨ã€å­—æ®µç›¸å…³çš„çº¦å®šéƒ½èƒ½è®¾ç½®ä¸Šã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬é€šå¸¸å¾ˆå°‘è‡ªå·±å†™ DDL è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›å¯è§†åŒ–å·¥å…·æ¥åˆ›å»ºå’Œæ“ä½œæ•°æ®åº“å’Œæ•°æ®è¡¨ã€‚å¯è§†åŒ–å·¥å…·é™¤äº†æ–¹ä¾¿ï¼Œè¿˜èƒ½ç›´æ¥å¸®æˆ‘ä»¬å°†æ•°æ®åº“çš„ç»“æ„å®šä¹‰è½¬åŒ–æˆ SQL è¯­è¨€ï¼Œæ–¹ä¾¿æ•°æ®åº“å’Œæ•°æ®è¡¨ç»“æ„çš„å¯¼å‡ºå’Œå¯¼å…¥ã€‚</li></ol><h5 id="6-3-å…³äºç´¢å¼•"><a href="#6-3-å…³äºç´¢å¼•" class="headerlink" title="6.3 å…³äºç´¢å¼•"></a><strong>6.3</strong> <strong>å…³äºç´¢å¼•</strong></h5><ol><li><p>ã€å¼ºåˆ¶ã€‘InnoDBè¡¨å¿…é¡»ä¸»é”®ä¸ºid int&#x2F;bigint auto_incrementï¼Œä¸”ä¸»é”®å€¼<code>ç¦æ­¢è¢«æ›´æ–°</code>ã€‚ </p></li><li><p>ã€å¼ºåˆ¶ã€‘InnoDBå’ŒMyISAMå­˜å‚¨å¼•æ“è¡¨ï¼Œç´¢å¼•ç±»å‹å¿…é¡»ä¸º<code>BTREE</code>ã€‚ </p></li><li><p>ã€å»ºè®®ã€‘ä¸»é”®çš„åç§°ä»¥<code>pk_</code>å¼€å¤´ï¼Œå”¯ä¸€é”®ä»¥<code>uni_</code>æˆ–<code>uk_</code>å¼€å¤´ï¼Œæ™®é€šç´¢å¼•ä»¥<code>idx_</code>å¼€å¤´ï¼Œä¸€å¾‹ä½¿ç”¨å°å†™æ ¼å¼ï¼Œä»¥å­—æ®µçš„åç§°æˆ–ç¼©å†™ä½œä¸ºåç¼€ã€‚</p></li><li><p>ã€å»ºè®®ã€‘å¤šå•è¯ç»„æˆçš„columnnameï¼Œå–å‰å‡ ä¸ªå•è¯é¦–å­—æ¯ï¼ŒåŠ æœ«å•è¯ç»„æˆcolumn_nameã€‚å¦‚: sample è¡¨ member_id ä¸Šçš„ç´¢å¼•ï¼šidx_sample_midã€‚ </p></li><li><p>ã€å»ºè®®ã€‘å•ä¸ªè¡¨ä¸Šçš„ç´¢å¼•ä¸ªæ•°<code>ä¸èƒ½è¶…è¿‡6ä¸ª</code>ã€‚ </p></li><li><p>ã€å»ºè®®ã€‘åœ¨å»ºç«‹ç´¢å¼•æ—¶ï¼Œå¤šè€ƒè™‘å»ºç«‹<code>è”åˆç´¢å¼•</code>ï¼Œå¹¶æŠŠåŒºåˆ†åº¦æœ€é«˜çš„å­—æ®µæ”¾åœ¨æœ€å‰é¢ã€‚</p></li><li><p>ã€å»ºè®®ã€‘åœ¨å¤šè¡¨ JOIN çš„SQLé‡Œï¼Œä¿è¯è¢«é©±åŠ¨è¡¨çš„è¿æ¥åˆ—ä¸Šæœ‰ç´¢å¼•ï¼Œè¿™æ ·JOIN æ‰§è¡Œæ•ˆç‡æœ€é«˜ã€‚</p></li><li><p>ã€å»ºè®®ã€‘å»ºè¡¨æˆ–åŠ ç´¢å¼•æ—¶ï¼Œä¿è¯è¡¨é‡Œäº’ç›¸ä¸å­˜åœ¨<code>å†—ä½™ç´¢å¼•</code>ã€‚ æ¯”å¦‚ï¼šå¦‚æœè¡¨é‡Œå·²ç»å­˜åœ¨key(a,b)ï¼Œ åˆ™key(a)ä¸ºå†—ä½™ç´¢å¼•ï¼Œéœ€è¦åˆ é™¤ã€‚</p></li></ol><h5 id="6-4-SQLç¼–å†™"><a href="#6-4-SQLç¼–å†™" class="headerlink" title="6.4 SQLç¼–å†™"></a><strong>6.4 SQLç¼–å†™</strong></h5><ol><li><p>ã€å¼ºåˆ¶ã€‘ç¨‹åºç«¯SELECTè¯­å¥å¿…é¡»æŒ‡å®šå…·ä½“å­—æ®µåç§°ï¼Œç¦æ­¢å†™æˆ *ã€‚ </p></li><li><p>ã€å»ºè®®ã€‘ç¨‹åºç«¯insertè¯­å¥æŒ‡å®šå…·ä½“å­—æ®µåç§°ï¼Œä¸è¦å†™æˆINSERT INTO t1 VALUES(â€¦)ã€‚ </p></li><li><p>ã€å»ºè®®ã€‘é™¤é™æ€è¡¨æˆ–å°è¡¨ï¼ˆ100è¡Œä»¥å†…ï¼‰ï¼ŒDMLè¯­å¥å¿…é¡»æœ‰WHEREæ¡ä»¶ï¼Œä¸”ä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾ã€‚</p></li><li><p>ã€å»ºè®®ã€‘INSERT INTOâ€¦VALUES(XX),(XX),(XX).. è¿™é‡ŒXXçš„å€¼ä¸è¦è¶…è¿‡5000ä¸ªã€‚ å€¼è¿‡å¤šè™½ç„¶ä¸Šçº¿å¾ˆå¿«ï¼Œä½†ä¼šå¼•èµ·ä¸»ä»åŒæ­¥å»¶è¿Ÿã€‚</p></li><li><p>ã€å»ºè®®ã€‘SELECTè¯­å¥ä¸è¦ä½¿ç”¨UNIONï¼Œæ¨èä½¿ç”¨UNION ALLï¼Œå¹¶ä¸”UNIONå­å¥ä¸ªæ•°é™åˆ¶åœ¨5ä¸ªä»¥å†…ã€‚</p></li><li><p>ã€å»ºè®®ã€‘çº¿ä¸Šç¯å¢ƒï¼Œå¤šè¡¨ JOIN ä¸è¦è¶…è¿‡5ä¸ªè¡¨ã€‚</p></li><li><p>ã€å»ºè®®ã€‘å‡å°‘ä½¿ç”¨ORDER BYï¼Œå’Œä¸šåŠ¡æ²Ÿé€šèƒ½ä¸æ’åºå°±ä¸æ’åºï¼Œæˆ–å°†æ’åºæ”¾åˆ°ç¨‹åºç«¯å»åšã€‚ORDER BYã€GROUP BYã€DISTINCT è¿™äº›è¯­å¥è¾ƒä¸ºè€—è´¹CPUï¼Œæ•°æ®åº“çš„CPUèµ„æºæ˜¯æå…¶å®è´µçš„ã€‚</p></li><li><p>ã€å»ºè®®ã€‘åŒ…å«äº†ORDER BYã€GROUP BYã€DISTINCT è¿™äº›æŸ¥è¯¢çš„è¯­å¥ï¼ŒWHERE æ¡ä»¶è¿‡æ»¤å‡ºæ¥çš„ç»“æœé›†è¯·ä¿æŒåœ¨1000è¡Œä»¥å†…ï¼Œå¦åˆ™SQLä¼šå¾ˆæ…¢ã€‚</p></li><li><p>ã€å»ºè®®ã€‘å¯¹å•è¡¨çš„å¤šæ¬¡alteræ“ä½œå¿…é¡»åˆå¹¶ä¸ºä¸€æ¬¡ã€‚å¯¹äºè¶…è¿‡100Wè¡Œçš„å¤§è¡¨è¿›è¡Œalter tableï¼Œå¿…é¡»ç»è¿‡DBAå®¡æ ¸ï¼Œå¹¶åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œï¼Œå¤šä¸ªalteréœ€æ•´åˆåœ¨ä¸€èµ·ã€‚ å› ä¸ºalter tableä¼šäº§ç”Ÿ<code>è¡¨é”</code>ï¼ŒæœŸé—´é˜»å¡å¯¹äºè¯¥è¡¨çš„æ‰€æœ‰å†™å…¥ï¼Œå¯¹äºä¸šåŠ¡å¯èƒ½ä¼šäº§ç”Ÿæå¤§å½±å“ã€‚</p></li><li><p>ã€å»ºè®®ã€‘æ‰¹é‡æ“ä½œæ•°æ®æ—¶ï¼Œéœ€è¦æ§åˆ¶äº‹åŠ¡å¤„ç†é—´éš”æ—¶é—´ï¼Œè¿›è¡Œå¿…è¦çš„sleepã€‚ </p></li><li><p>ã€å»ºè®®ã€‘äº‹åŠ¡é‡ŒåŒ…å«SQLä¸è¶…è¿‡5ä¸ªã€‚å› ä¸ºè¿‡é•¿çš„äº‹åŠ¡ä¼šå¯¼è‡´é”æ•°æ®è¾ƒä¹…ï¼ŒMySQLå†…éƒ¨ç¼“å­˜ã€è¿æ¥æ¶ˆè€—è¿‡å¤šç­‰é—®é¢˜ã€‚</p></li><li><p>ã€å»ºè®®ã€‘äº‹åŠ¡é‡Œæ›´æ–°è¯­å¥å°½é‡åŸºäºä¸»é”®æˆ–UNIQUE KEYï¼Œå¦‚UPDATEâ€¦ WHERE id&#x3D;XX;å¦åˆ™ä¼šäº§ç”Ÿé—´éš™é”ï¼Œå†…éƒ¨æ‰©å¤§é”å®šèŒƒå›´ï¼Œå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼Œäº§ç”Ÿæ­»é”ã€‚</p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬15ç«  Mysqlé”</title>
      <link href="/2023/07/15/%E7%AC%AC15%E7%AB%A0%20%E9%94%81/"/>
      <url>/2023/07/15/%E7%AC%AC15%E7%AB%A0%20%E9%94%81/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬15ç« -é”"><a href="#ç¬¬15ç« -é”" class="headerlink" title="ç¬¬15ç«  é”"></a>ç¬¬15ç«  é”</h3><h4 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a><strong>1.</strong> <strong>æ¦‚è¿°</strong></h4><p>åœ¨æ•°æ®åº“ä¸­ï¼Œé™¤ä¼ ç»Ÿçš„è®¡ç®—èµ„æºï¼ˆå¦‚CPUã€RAMã€I&#x2F;Oç­‰ï¼‰çš„äº‰ç”¨ä»¥å¤–ï¼Œæ•°æ®ä¹Ÿæ˜¯ä¸€ç§ä¾›è®¸å¤šç”¨æˆ·å…±äº«çš„èµ„æºã€‚ä¸ºä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéœ€è¦å¯¹<code>å¹¶å‘æ“ä½œè¿›è¡Œæ§åˆ¶</code>ï¼Œå› æ­¤äº§ç”Ÿäº†<code>é”</code>ã€‚åŒæ—¶<code>é”æœºåˆ¶</code>ä¹Ÿä¸ºå®ç°MySQLçš„å„ä¸ªéš”ç¦»çº§åˆ«æä¾›äº†ä¿è¯ã€‚ é”å†²çª ä¹Ÿæ˜¯å½±å“æ•°æ®åº“<code>å¹¶å‘è®¿é—®æ€§èƒ½</code>çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚æ‰€ä»¥é”å¯¹æ•°æ®åº“è€Œè¨€æ˜¾å¾—å°¤å…¶é‡è¦ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚</p><h4 id="2-MySQLå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•"><a href="#2-MySQLå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•" class="headerlink" title="2. MySQLå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•"></a><strong>2. MySQLå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•</strong></h4><h5 id="2-1-è¯»-è¯»æƒ…å†µ"><a href="#2-1-è¯»-è¯»æƒ…å†µ" class="headerlink" title="2.1 è¯»-è¯»æƒ…å†µ"></a><strong>2.1</strong> <strong>è¯»-è¯»æƒ…å†µ</strong></h5><p><code>è¯»-è¯»</code>æƒ…å†µï¼Œå³å¹¶å‘äº‹åŠ¡ç›¸ç»§<code>è¯»å–ç›¸åŒçš„è®°å½•</code>ã€‚è¯»å–æ“ä½œæœ¬èº«ä¸ä¼šå¯¹è®°å½•æœ‰ä»»ä½•å½±å“ï¼Œå¹¶ä¸ä¼šå¼•èµ·ä»€ä¹ˆé—®é¢˜ï¼Œæ‰€ä»¥å…è®¸è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚</p><h5 id="2-2-å†™-å†™æƒ…å†µ"><a href="#2-2-å†™-å†™æƒ…å†µ" class="headerlink" title="2.2 å†™-å†™æƒ…å†µ"></a><strong>2.2</strong> <strong>å†™-å†™æƒ…å†µ</strong></h5><p><code>å†™-å†™</code>æƒ…å†µï¼Œå³å¹¶å‘äº‹åŠ¡ç›¸ç»§å¯¹ç›¸åŒçš„è®°å½•åšå‡ºæ”¹åŠ¨ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šå‘ç”Ÿ<code>è„å†™</code>çš„é—®é¢˜ï¼Œä»»ä½•ä¸€ç§éš”ç¦»çº§åˆ«éƒ½ä¸å…è®¸è¿™ç§é—®é¢˜çš„å‘ç”Ÿã€‚æ‰€ä»¥åœ¨å¤šä¸ªæœªæäº¤äº‹åŠ¡ç›¸ç»§å¯¹ä¸€æ¡è®°å½•åšæ”¹åŠ¨æ—¶ï¼Œéœ€è¦è®©å®ƒä»¬<code>æ’é˜Ÿæ‰§è¡Œ</code>ï¼Œè¿™ä¸ªæ’é˜Ÿçš„è¿‡ç¨‹å…¶å®æ˜¯é€šè¿‡<code>é”</code>æ¥å®ç°çš„ã€‚</p><h5 id="2-3-è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ"><a href="#2-3-è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ" class="headerlink" title="2.3 è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ"></a><strong>2.3</strong> <strong>è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ</strong></h5><p><code>è¯»-å†™</code>æˆ–<code>å†™-è¯»</code>ï¼Œå³ä¸€ä¸ªäº‹åŠ¡è¿›è¡Œè¯»å–æ“ä½œï¼Œå¦ä¸€ä¸ªè¿›è¡Œæ”¹åŠ¨æ“ä½œã€‚è¿™ç§æƒ…å†µä¸‹å¯èƒ½å‘ç”Ÿ<code>è„è¯»</code>ã€<code>ä¸å¯é‡å¤è¯»</code>ã€<code>å¹»è¯»</code>çš„é—®é¢˜ã€‚</p><h5 id="2-4-å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ"><a href="#2-4-å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2.4 å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ"></a><strong>2.4</strong> <strong>å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ</strong></h5><p>æ€ä¹ˆè§£å†³<code>è„è¯»</code>ã€<code>ä¸å¯é‡å¤è¯»</code>ã€<code>å¹»è¯»</code>è¿™äº›é—®é¢˜å‘¢ï¼Ÿå…¶å®æœ‰ä¸¤ç§å¯é€‰çš„è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>æ–¹æ¡ˆä¸€ï¼šè¯»æ“ä½œåˆ©ç”¨å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆ<code>MVCC</code>ï¼Œä¸‹ç« è®²è§£ï¼‰ï¼Œå†™æ“ä½œè¿›è¡Œ<code>åŠ é”</code>ã€‚</li></ul><p>æ‰€è°“çš„<code>MVCC</code>ï¼Œå°±æ˜¯ç”Ÿæˆä¸€ä¸ª<code>ReadView</code>ï¼Œé€šè¿‡ReadViewæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è®°å½•ç‰ˆæœ¬ï¼ˆå†å²ç‰ˆæœ¬ç”±<code>undoæ—¥å¿—</code>æ„å»ºï¼‰ã€‚æŸ¥è¯¢è¯­å¥åªèƒ½<code>è¯»</code>åˆ°åœ¨ç”ŸæˆReadViewä¹‹å‰<code>å·²æäº¤äº‹åŠ¡æ‰€åšçš„æ›´æ”¹</code>ï¼Œåœ¨ç”ŸæˆReadViewä¹‹å‰æœªæäº¤çš„äº‹åŠ¡æˆ–è€…ä¹‹åæ‰å¼€å¯çš„äº‹åŠ¡æ‰€åšçš„æ›´æ”¹æ˜¯çœ‹ä¸åˆ°çš„ã€‚è€Œ<code>å†™æ“ä½œ</code>è‚¯å®šé’ˆå¯¹çš„æ˜¯<code>æœ€æ–°ç‰ˆæœ¬çš„è®°å½•</code>ï¼Œè¯»è®°å½•çš„å†å²ç‰ˆæœ¬å’Œæ”¹åŠ¨è®°å½•çš„æœ€æ–°ç‰ˆæœ¬æœ¬èº«å¹¶ä¸å†²çªï¼Œä¹Ÿå°±æ˜¯é‡‡ç”¨MVCCæ—¶ï¼Œ<code>è¯»-å†™</code>æ“ä½œå¹¶ä¸å†²çªã€‚</p><blockquote><p>æ™®é€šçš„SELECTè¯­å¥åœ¨READ COMMITTEDå’ŒREPEATABLE READéš”ç¦»çº§åˆ«ä¸‹ä¼šä½¿ç”¨åˆ°MVCCè¯»å–è®°å½•ã€‚</p><ul><li>åœ¨<code>READ COMMITTED</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ¯æ¬¡æ‰§è¡ŒSELECTæ“ä½œæ—¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªReadViewï¼ŒReadViewçš„å­˜åœ¨æœ¬èº«å°±ä¿è¯äº†<code>äº‹åŠ¡ä¸å¯ä»¥è¯»å–åˆ°æœªæäº¤çš„äº‹åŠ¡æ‰€åšçš„æ›´æ”¹</code>ï¼Œä¹Ÿå°±æ˜¯é¿å…äº†è„è¯»ç°è±¡ï¼›</li><li>åœ¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­åªæœ‰<code>ç¬¬ä¸€æ¬¡æ‰§è¡ŒSELECTæ“ä½œ </code>æ‰ä¼šç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¹‹åçš„SELECTæ“ä½œéƒ½<code>å¤ç”¨</code>è¿™ReadViewï¼Œè¿™æ ·ä¹Ÿå°±é¿å…äº†ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„é—®é¢˜ã€‚</li></ul></blockquote><ul><li><p>æ–¹æ¡ˆäºŒï¼šè¯»ã€å†™æ“ä½œéƒ½é‡‡ç”¨<code>åŠ é”</code>çš„æ–¹å¼ã€‚</p></li><li><p>å°ç»“å¯¹æ¯”å‘ç°ï¼š</p><ul><li>é‡‡ç”¨<code>MVCC</code>æ–¹å¼çš„è¯ï¼Œ<code>è¯»-å†™</code>æ“ä½œå½¼æ­¤å¹¶ä¸å†²çªï¼Œ<code>æ€§èƒ½æ›´é«˜</code>ã€‚</li><li>é‡‡ç”¨<code>åŠ é”</code>æ–¹å¼çš„è¯ï¼Œ<code>è¯»-å†™</code>æ“ä½œå½¼æ­¤éœ€è¦<code>æ’é˜Ÿæ‰§è¡Œ</code>ï¼Œå½±å“æ€§èƒ½ã€‚</li></ul></li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å½“ç„¶æ„¿æ„é‡‡ç”¨<code>MVCC</code>æ¥è§£å†³<code>è¯»-å†™</code>æ“ä½œå¹¶å‘æ‰§è¡Œçš„é—®é¢˜ï¼Œä½†æ˜¯ä¸šåŠ¡åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¦æ±‚å¿…é¡»é‡‡ç”¨<code>åŠ é”</code>çš„æ–¹å¼æ‰§è¡Œã€‚</p><h4 id="3-é”çš„ä¸åŒè§’åº¦åˆ†ç±»"><a href="#3-é”çš„ä¸åŒè§’åº¦åˆ†ç±»" class="headerlink" title="3. é”çš„ä¸åŒè§’åº¦åˆ†ç±»"></a><strong>3.</strong> <strong>é”çš„ä¸åŒè§’åº¦åˆ†ç±»</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204050933339.png" alt="image-20220405093322184"></p><h5 id="3-1-ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†ï¼šè¯»é”ã€å†™é”"><a href="#3-1-ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†ï¼šè¯»é”ã€å†™é”" class="headerlink" title="3.1 ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†ï¼šè¯»é”ã€å†™é”"></a><strong>3.1</strong> <strong>ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†ï¼šè¯»é”ã€å†™é”</strong></h5><ul><li><code>è¯»é”</code>ï¼šä¹Ÿç§°ä¸º<code>å…±äº«é”</code>ã€è‹±æ–‡ç”¨<code>S</code>è¡¨ç¤ºã€‚é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚</li><li><code>å†™é”</code>ï¼šä¹Ÿç§°ä¸º<code>æ’ä»–é”</code>ã€è‹±æ–‡ç”¨<code>X</code>è¡¨ç¤ºã€‚å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚</li></ul><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äº</strong> <strong>InnoDB</strong> <strong>å¼•æ“æ¥è¯´ï¼Œè¯»é”å’Œå†™é”å¯ä»¥åŠ åœ¨è¡¨ä¸Šï¼Œä¹Ÿå¯ä»¥åŠ åœ¨è¡Œä¸Šã€‚</strong></p><p><strong>1. é”å®šè¯»</strong></p><p>åœ¨é‡‡ç”¨<code>åŠ é”</code>æ–¹å¼è§£å†³<code>è„è¯»</code>ã€<code>ä¸å¯é‡å¤è¯»</code>ã€<code>å¹»è¯»</code>è¿™äº›é—®é¢˜æ—¶ï¼Œè¯»å–ä¸€æ¡è®°å½•æ—¶éœ€è¦è·å–è¯¥è®°å½•çš„<code>Sé”</code>ï¼Œå…¶å®æ˜¯ä¸ä¸¥è°¨çš„ï¼Œæœ‰æ—¶å€™éœ€è¦åœ¨è¯»å–è®°å½•æ—¶å°±è·å–è®°å½•çš„<code>Xé”</code>ï¼Œæ¥ç¦æ­¢åˆ«çš„äº‹åŠ¡è¯»å†™è¯¥è®°å½•ï¼Œä¸ºæ­¤MySQLæå‡ºäº†ä¸¤ç§æ¯”è¾ƒç‰¹æ®Šçš„<code>SELECT</code>è¯­å¥æ ¼å¼ï¼š</p><ul><li>å¯¹è¯»å–çš„è®°å½•åŠ <code>Sé”</code>ï¼š</li></ul><pre><code class="mysql">SELECT ... LOCK IN SHARE MODE;# æˆ–SELECT ... FOR SHARE; #(8.0æ–°å¢è¯­æ³•)</code></pre><ul><li>å¯¹è¯»å–çš„è®°å½•åŠ <code>Xé”</code>ï¼š</li></ul><pre><code class="mysql">SELECT ... FOR UPDATE;</code></pre><p><strong>MySQL8.0æ–°ç‰¹æ€§ï¼š</strong></p><p>åœ¨5.7åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼ŒSELECT â€¦ FOR UPDATEï¼Œå¦‚æœè·å–ä¸åˆ°é”ï¼Œä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°<code>innodb_lock_wait_timeout</code>è¶…æ—¶ã€‚åœ¨8.0ç‰ˆæœ¬ä¸­ï¼ŒSELECT â€¦ FOR UPDATE, SELECT â€¦ FOR SHARE æ·»åŠ <code>NOWAIT</code>ã€<code>SKIP LOCKED</code>è¯­æ³•ï¼Œè·³è¿‡é”ç­‰å¾…ï¼Œæˆ–è€…è·³è¿‡é”å®šã€‚</p><ul><li>NOWAITï¼šå¦‚æœæŸ¥è¯¢çš„è¡Œå·²ç»åŠ é”ï¼Œä¼šç«‹å³æŠ¥é”™è¿”å›</li><li>SKIP LOCKEDï¼šå¦‚æœæŸ¥è¯¢çš„è¡Œå·²ç»åŠ é”ï¼Œåªè¿”å›ç»“æœä¸­ä¸åŒ…å«è¢«é”å®šçš„è¡Œ</li></ul><p><strong>2. å†™æ“ä½œ</strong></p><ul><li><code>DELETE</code>ï¼šå¯¹ä¸€æ¡è®°å½•åšDELETEæ“ä½œçš„è¿‡ç¨‹å…¶å®æ˜¯å…ˆåœ¨<code>B+</code>æ ‘ä¸­å®šä½åˆ°è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œç„¶åè·å–è¿™æ¡è®°å½•çš„<code>Xé”</code>ï¼Œå†æ‰§è¡Œ<code>delete mark</code>æ“ä½œã€‚</li><li><code>UPDATE</code>ï¼šåœ¨å¯¹ä¸€æ¡è®°å½•åšUPDATEæ“ä½œæ—¶åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š<ul><li>æƒ…å†µ1ï¼šæœªä¿®æ”¹è¯¥è®°å½•çš„é”®å€¼ï¼Œå¹¶ä¸”è¢«æ›´æ–°çš„åˆ—å ç”¨çš„å­˜å‚¨ç©ºé—´åœ¨ä¿®æ”¹å‰åæœªå‘ç”Ÿå˜åŒ–ã€‚åˆ™å…ˆåœ¨<code>B+</code>æ ‘ä¸­å®šä½åˆ°è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œç„¶åå†è·å–ä¸€ä¸‹è®°å½•çš„<code>Xé”</code>ï¼Œæœ€ååœ¨åŸçºªå½•çš„ä½ç½®è¿›è¡Œä¿®æ”¹æ“ä½œã€‚</li><li>æƒ…å†µ2ï¼šæœªä¿®æ”¹è¯¥è®°å½•çš„é”®å€¼ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªè¢«æ›´æ–°çš„åˆ—å ç”¨çš„å­˜å‚¨ç©ºé—´åœ¨ä¿®æ”¹å‰åå‘ç”Ÿå˜åŒ–ã€‚åˆ™å…ˆåœ¨<code>B+</code>æ ‘ä¸­å®šä½åˆ°è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œç„¶åè·å–ä¸€ä¸‹è®°å½•çš„<code>Xé”</code>ï¼Œå°†è¯¥è®°å½•å½»åº•åˆ é™¤æ‰ï¼ˆå°±æ˜¯æŠŠè®°å½•å½»åº•ç§»å…¥åƒåœ¾é“¾è¡¨ï¼‰ï¼Œæœ€åå†æ’å…¥ä¸€æ¡æ–°è®°å½•ã€‚æ–°æ’å…¥çš„è®°å½•ç”±<code>INSERT</code>æ“ä½œæä¾›çš„<code>éšå¼é”</code>è¿›è¡Œä¿æŠ¤ã€‚</li><li>æƒ…å†µ3ï¼šä¿®æ”¹è¯¥è®°å½•çš„é”®å€¼ï¼Œåˆ™ç›¸å½“äºåœ¨åŸçºªå½•ä¸Šåš<code>DELECT</code>æ“ä½œä¹‹åå†æ¥ä¸€æ¬¡<code>INSERT</code>æ“ä½œã€‚</li></ul></li><li><code>INSERT</code>ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ–°æ’å…¥ä¸€æ¡è®°å½•çš„æ“ä½œå¹¶ä¸åŠ é”ï¼Œé€šè¿‡ä¸€ç§ç§°ä¹‹ä¸º<code>éšå¼é”</code>çš„ç»“æ„æ¥ä¿æŠ¤è¿™æ¡æ–°æ’å…¥çš„è®°å½•åœ¨æœ¬äº‹åŠ¡æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—®ã€‚</li></ul><h5 id="3-2-ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ†ï¼šè¡¨çº§é”ã€é¡µçº§é”ã€è¡Œé”"><a href="#3-2-ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ†ï¼šè¡¨çº§é”ã€é¡µçº§é”ã€è¡Œé”" class="headerlink" title="3.2 ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ†ï¼šè¡¨çº§é”ã€é¡µçº§é”ã€è¡Œé”"></a><strong>3.2</strong> <strong>ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ†ï¼šè¡¨çº§é”ã€é¡µçº§é”ã€è¡Œé”</strong></h5><p><strong>1.</strong> <strong>è¡¨é”ï¼ˆTable Lockï¼‰</strong> </p><p>è¯¥é”ä¼šé”å®šæ•´å¼ è¡¨ï¼Œå®ƒæ˜¯MySQLä¸­æœ€åŸºæœ¬çš„é”ç­–ç•¥ï¼Œå¹¶<code>ä¸ä¾èµ–äºå­˜å‚¨å¼•æ“</code>ï¼Œå¹¶ä¸”è¡¨é”æ˜¯<code>å¼€é”€æœ€å°‘</code>çš„ç­–ç•¥ã€‚ç”±äºè¡¨çº§é”ä¸€æ¬¡ä¼šå°†æ•´ä¸ªè¡¨é”å®šï¼Œæ‰€ä»¥å¯ä»¥å¾ˆå¥½çš„<code>é¿å…æ­»é”</code>çš„é—®é¢˜ã€‚å½“ç„¶ï¼Œé”çš„ç²’åº¦å¤§æ‰€å¸¦æ¥æœ€å¤§çš„è´Ÿé¢å½±å“å°±æ˜¯å‡ºç°é”èµ„æºäº‰ç”¨çš„æ¦‚ç‡ä¹Ÿä¼šæœ€é«˜ï¼Œå¯¼è‡´<code>å¹¶å‘ç‡å¤§æ‰“æŠ˜æ‰£</code>ã€‚</p><p><strong>â‘  è¡¨çº§åˆ«çš„Sé”ã€Xé”</strong></p><p>åœ¨å¯¹æŸä¸ªè¡¨æ‰§è¡ŒSELECTã€INSERTã€DELETEã€UPDATEè¯­å¥æ—¶ï¼ŒInnoDBå­˜å‚¨å¼•æ“æ˜¯ä¸ä¼šä¸ºè¿™ä¸ªè¡¨æ·»åŠ è¡¨çº§åˆ«çš„<code>Sé”</code>æˆ–è€…<code>Xé”</code>çš„ã€‚åœ¨å¯¹æŸä¸ªè¡¨æ‰§è¡Œä¸€äº›è¯¸å¦‚<code>ALTER TABLE</code>ã€<code>DROP TABLE</code>è¿™ç±»çš„<code>DDL</code>è¯­å¥æ—¶ï¼Œå…¶ä»–äº‹åŠ¡å¯¹è¿™ä¸ªè¡¨å¹¶å‘æ‰§è¡Œè¯¸å¦‚SELECTã€INSERTã€DELETEã€UPDATEçš„è¯­å¥ä¼šå‘ç”Ÿé˜»å¡ã€‚åŒç†ï¼ŒæŸä¸ªäº‹åŠ¡ä¸­å¯¹æŸä¸ªè¡¨æ‰§è¡ŒSELECTã€INSERTã€DELETEã€UPDATEè¯­å¥æ—¶ï¼Œåœ¨å…¶ä»–ä¼šè¯ä¸­å¯¹è¿™ä¸ªè¡¨æ‰§è¡Œ<code>DDL</code>è¯­å¥ä¹Ÿä¼šå‘ç”Ÿé˜»å¡ã€‚è¿™ä¸ªè¿‡ç¨‹å…¶å®æ˜¯é€šè¿‡åœ¨<code>serverå±‚</code>ä½¿ç”¨ä¸€ç§ç§°ä¹‹ä¸º<code>å…ƒæ•°æ®é”</code>ï¼ˆè‹±æ–‡åï¼š<code>Metadata Locks</code>ï¼Œç®€ç§°<code>MDL</code>ï¼‰ç»“æ„æ¥å®ç°çš„ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ä¼šä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“æä¾›çš„è¡¨çº§åˆ«çš„<code>Sé”</code>å’Œ<code>Xé”</code>ã€‚åªä¼šåœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ¯”æ–¹è¯´<code>å´©æºƒæ¢å¤</code>è¿‡ç¨‹ä¸­ç”¨åˆ°ã€‚æ¯”å¦‚ï¼Œåœ¨ç³»ç»Ÿå˜é‡<code>autocommit=0ï¼Œinnodb_table_locks = 1</code>æ—¶ï¼Œ<code>æ‰‹åŠ¨</code>è·å–InnoDBå­˜å‚¨å¼•æ“æä¾›çš„è¡¨t çš„<code>Sé”</code>æˆ–è€…<code>Xé”</code>å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><ul><li><p><code>LOCK TABLES t READ</code>ï¼šInnoDBå­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨<code>t</code>åŠ è¡¨çº§åˆ«çš„<code>Sé”</code>ã€‚ </p></li><li><p><code>LOCK TABLES t WRITE</code>ï¼šInnoDBå­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨<code>t</code>åŠ è¡¨çº§åˆ«çš„<code>Xé”</code>ã€‚</p></li></ul><p>æ€»ç»“ï¼šMyISAMåœ¨æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼ˆSELECTï¼‰å‰ï¼Œä¼šç»™æ¶‰åŠçš„æ‰€æœ‰è¡¨åŠ è¯»é”ï¼Œåœ¨æ‰§è¡Œå¢åˆ æ”¹æ“ä½œå‰ï¼Œä¼šç»™æ¶‰åŠçš„è¡¨åŠ å†™é”ã€‚<code>InnoDB</code>å­˜å‚¨å¼•æ“æ˜¯ä¸ä¼šä¸ºè¿™ä¸ªè¡¨æ·»åŠ è¡¨çº§åˆ«çš„<code>è¯»é”</code>æˆ–è€…<code>å†™é”</code>çš„ã€‚</p><p><strong>â‘¡ æ„å‘é” ï¼ˆintention lockï¼‰</strong></p><p>InnoDB æ”¯æŒ<code>å¤šç²’åº¦é”ï¼ˆmultiple granularity lockingï¼‰</code>ï¼Œå®ƒå…è®¸<code>è¡Œçº§é”</code>ä¸<code>è¡¨çº§é”</code>å…±å­˜ï¼Œè€Œ<strong>æ„å‘é”</strong>å°±æ˜¯å…¶ä¸­çš„ä¸€ç§<code>è¡¨é”</code>ã€‚</p><p>1ã€æ„å‘é”çš„å­˜åœ¨æ˜¯ä¸ºäº†åè°ƒè¡Œé”å’Œè¡¨é”çš„å…³ç³»ï¼Œæ”¯æŒå¤šç²’åº¦ï¼ˆè¡¨é”ä¸è¡Œé”ï¼‰çš„é”å¹¶å­˜ã€‚</p><p>2ã€æ„å‘é”æ˜¯ä¸€ç§<code>ä¸ä¸è¡Œçº§é”å†²çªçš„è¡¨çº§é”</code>ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚</p><p>3ã€è¡¨æ˜â€œæŸä¸ªäº‹åŠ¡æ­£åœ¨æŸäº›è¡ŒæŒæœ‰äº†é”æˆ–è¯¥äº‹åŠ¡å‡†å¤‡å»æŒæœ‰é”â€</p><p>æ„å‘é”åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><strong>æ„å‘å…±äº«é”</strong>ï¼ˆintention shared lock, ISï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ <strong>å…±äº«é”</strong>ï¼ˆSé”ï¼‰</li></ul><pre><code class="mysql">-- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE;</code></pre><ul><li><strong>æ„å‘æ’ä»–é”</strong>ï¼ˆintention exclusive lock, IXï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ <strong>æ’ä»–é”</strong>ï¼ˆXé”ï¼‰</li></ul><pre><code class="mysql">-- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE;</code></pre><p>å³ï¼šæ„å‘é”æ˜¯ç”±å­˜å‚¨å¼•æ“<code>è‡ªå·±ç»´æŠ¤çš„</code>ï¼Œç”¨æˆ·æ— æ³•æ‰‹åŠ¨æ“ä½œæ„å‘é”ï¼Œåœ¨ä¸ºæ•°æ®è¡ŒåŠ å…±äº« &#x2F; æ’ä»–é”ä¹‹å‰ï¼ŒInooDB ä¼šå…ˆè·å–è¯¥æ•°æ®è¡Œ<code>æ‰€åœ¨æ•°æ®è¡¨çš„å¯¹åº”æ„å‘é”</code>ã€‚</p><p><strong>1. æ„å‘é”è¦è§£å†³çš„é—®é¢˜</strong></p><p>ç°åœ¨æœ‰ä¸¤ä¸ªäº‹åŠ¡ï¼Œåˆ†åˆ«æ˜¯T1å’ŒT2ï¼Œå…¶ä¸­T2è¯•å›¾åœ¨è¯¥è¡¨çº§åˆ«ä¸Šåº”ç”¨å…±äº«æˆ–æ’å®ƒé”ï¼Œå¦‚æœæ²¡æœ‰æ„å‘é”å­˜åœ¨ï¼Œé‚£ä¹ˆT2å°±éœ€è¦å»æ£€æŸ¥å„ä¸ªé¡µæˆ–è¡Œæ˜¯å¦å­˜åœ¨é”ï¼›å¦‚æœå­˜åœ¨æ„å‘é”ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šå—åˆ°ç”±T1æ§åˆ¶çš„<code>è¡¨çº§åˆ«æ„å‘é”çš„é˜»å¡</code>ã€‚T2åœ¨é”å®šè¯¥è¡¨å‰ä¸å¿…æ£€æŸ¥å„ä¸ªé¡µæˆ–è¡Œé”ï¼Œè€Œåªéœ€æ£€æŸ¥è¡¨ä¸Šçš„æ„å‘é”ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç»™æ›´å¤§ä¸€çº§çº§åˆ«çš„ç©ºé—´ç¤ºæ„é‡Œé¢æ˜¯å¦å·²ç»ä¸Šè¿‡é”ã€‚</p><p>åœ¨æ•°æ®è¡¨çš„åœºæ™¯ä¸­ï¼Œ<strong>å¦‚æœæˆ‘ä»¬ç»™æŸä¸€è¡Œæ•°æ®åŠ ä¸Šäº†æ’å®ƒé”ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨ç»™æ›´å¤§ä¸€çº§çš„ç©ºé—´ï¼Œæ¯”å¦‚æ•°æ®é¡µæˆ–æ•°æ®è¡¨åŠ ä¸Šæ„å‘é”ï¼Œå‘Šè¯‰å…¶ä»–äººè¿™ä¸ªæ•°æ®é¡µæˆ–æ•°æ®è¡¨å·²ç»æœ‰äººä¸Šè¿‡æ’å®ƒé”äº†</strong>ï¼Œè¿™æ ·å½“å…¶ä»–äººæƒ³è¦è·å–æ•°æ®è¡¨æ’å®ƒé”çš„æ—¶å€™ï¼Œåªéœ€è¦äº†è§£æ˜¯å¦æœ‰äººå·²ç»è·å–äº†è¿™ä¸ªæ•°æ®è¡¨çš„æ„å‘æ’å®ƒé”å³å¯ã€‚</p><ul><li>å¦‚æœäº‹åŠ¡æƒ³è¦è·å–æ•°æ®è¡¨ä¸­æŸäº›è®°å½•çš„å…±äº«é”ï¼Œå°±éœ€è¦åœ¨æ•°æ®è¡¨ä¸Š<code>æ·»åŠ æ„å‘å…±äº«é”</code></li><li>å¦‚æœäº‹åŠ¡æƒ³è¦è·å–æ•°æ®è¡¨ä¸­æŸäº›è®°å½•çš„æ’å®ƒé”ï¼Œå°±éœ€è¦åœ¨æ•°æ®è¡¨ä¸Š<code>æ·»åŠ æ„å‘æ’ä»–é”</code></li></ul><p>è¿™æ—¶ï¼Œæ„å‘é”ä¼šå‘Šè¯‰å…¶ä»–äº‹åŠ¡å·²ç»æœ‰äººé”å®šäº†è¡¨ä¸­çš„æŸäº›è®°å½•ã€‚</p><p><strong>â‘¢ è‡ªå¢é”ï¼ˆAUTO-INCé”ï¼‰</strong></p><p><strong>1. â€œSimple insertsâ€</strong> <strong>ï¼ˆç®€å•æ’å…¥ï¼‰</strong></p><p>å¯ä»¥<code>é¢„å…ˆç¡®å®šè¦æ’å…¥çš„è¡Œæ•°</code>ï¼ˆå½“è¯­å¥è¢«åˆå§‹å¤„ç†æ—¶ï¼‰çš„è¯­å¥ã€‚åŒ…æ‹¬æ²¡æœ‰åµŒå¥—å­æŸ¥è¯¢çš„å•è¡Œå’Œå¤šè¡Œ<code>INSERT...VALUES()</code>å’Œ<code>REPLACE</code>è¯­å¥ã€‚</p><p><strong>2. â€œBulk insertsâ€</strong> <strong>ï¼ˆæ‰¹é‡æ’å…¥ï¼‰</strong></p><p><code>äº‹å…ˆä¸çŸ¥é“è¦æ’å…¥çš„è¡Œæ•°</code>ï¼ˆå’Œæ‰€éœ€è‡ªåŠ¨é€’å¢å€¼çš„æ•°é‡ï¼‰çš„è¯­å¥ã€‚æ¯”å¦‚<code>INSERT ... SELECT</code>ï¼Œ<code>REPLACE ... SELECT</code>å’Œ<code>LOAD DATA</code>è¯­å¥ï¼Œä½†ä¸åŒ…æ‹¬çº¯INSERTã€‚ InnoDBåœ¨æ¯å¤„ç†ä¸€è¡Œï¼Œä¸ºAUTO_INCREMENTåˆ—åˆ†é…ä¸€ä¸ªæ–°å€¼ã€‚</p><p><strong>3. â€œMixed-mode insertsâ€</strong> <strong>ï¼ˆæ··åˆæ¨¡å¼æ’å…¥ï¼‰</strong></p><p>è¿™äº›æ˜¯â€œSimple insertsâ€è¯­å¥ä½†æ˜¯æŒ‡å®šéƒ¨åˆ†æ–°è¡Œçš„è‡ªåŠ¨é€’å¢å€¼ã€‚ä¾‹å¦‚<code>INSERT INTO teacher (id,name) VALUES (1,&#39;a&#39;), (NULL,&#39;b&#39;), (5,&#39;c&#39;), (NULL,&#39;d&#39;);</code>åªæ˜¯æŒ‡å®šäº†éƒ¨åˆ†idçš„å€¼ã€‚å¦ä¸€ç§ç±»å‹çš„â€œæ··åˆæ¨¡å¼æ’å…¥â€æ˜¯<code>INSERT ... ON DUPLICATE KEY UPDATE</code>ã€‚ </p><p>å¯¹äºä¸Šé¢æ•°æ®æ’å…¥çš„æ¡ˆä¾‹ï¼ŒMySQLé‡‡ç”¨äº†<code>è‡ªå¢é”</code>çš„æ–¹å¼æ¥å®ç°ï¼Œ<strong>AUTO-INTé”æ˜¯å½“å‘ä½¿ç”¨å«æœ‰AUTO_INCREMENTåˆ—çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶éœ€è¦è·å–çš„ä¸€ç§ç‰¹æ®Šçš„è¡¨çº§é”</strong>ï¼Œåœ¨æ‰§è¡Œæ’å…¥è¯­å¥æ—¶å°±åœ¨è¡¨çº§åˆ«åŠ ä¸€ä¸ªAUTO-INTé”ï¼Œç„¶åä¸ºæ¯æ¡å¾…æ’å…¥è®°å½•çš„AUTO_INCREMENTä¿®é¥°çš„åˆ—åˆ†é…é€’å¢çš„å€¼ï¼Œåœ¨è¯¥è¯­å¥æ‰§è¡Œç»“æŸåï¼Œå†æŠŠAUTO-INTé”é‡Šæ”¾æ‰ã€‚<strong>ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰AUTO-INCé”çš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–äº‹åŠ¡çš„æ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡</strong>ï¼Œå¯ä»¥ä¿è¯ä¸€ä¸ªè¯­å¥ä¸­åˆ†é…çš„é€’å¢å€¼æ˜¯è¿ç»­çš„ã€‚ä¹Ÿæ­£å› ä¸ºæ­¤ï¼Œå…¶å¹¶å‘æ€§æ˜¾ç„¶å¹¶ä¸é«˜ï¼Œ<strong>å½“æˆ‘ä»¬å‘ä¸€ä¸ªæœ‰AUTO_INCREMENTå…³é”®å­—çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦å¯¹è¿™ä¸ªè¡¨é”è¿›è¡Œç«äº‰</strong>ï¼Œè¿™æ ·çš„å¹¶å‘æ½œåŠ›å…¶å®æ˜¯å¾ˆä½ä¸‹çš„ï¼Œæ‰€ä»¥innodbé€šè¿‡<code>innodb_autoinc_lock_mode</code>çš„ä¸åŒå–å€¼æ¥æä¾›ä¸åŒçš„é”å®šæœºåˆ¶ï¼Œæ¥æ˜¾è‘—æé«˜SQLè¯­å¥çš„å¯ä¼¸ç¼©æ€§å’Œæ€§èƒ½ã€‚</p><p>innodb_autoinc_lock_modeæœ‰ä¸‰ç§å–å€¼ï¼Œåˆ†åˆ«å¯¹åº”ä¸ä¸åŒé”å®šæ¨¡å¼ï¼š</p><p><code>ï¼ˆ1ï¼‰innodb_autoinc_lock_mode = 0(â€œä¼ ç»Ÿâ€é”å®šæ¨¡å¼)</code></p><p>åœ¨æ­¤é”å®šæ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰ç±»å‹çš„insertè¯­å¥éƒ½ä¼šè·å¾—ä¸€ä¸ªç‰¹æ®Šçš„è¡¨çº§AUTO-INCé”ï¼Œç”¨äºæ’å…¥å…·æœ‰AUTO_INCREMENTåˆ—çš„è¡¨ã€‚è¿™ç§æ¨¡å¼å…¶å®å°±å¦‚æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­ï¼Œå³æ¯å½“æ‰§è¡Œinsertçš„æ—¶å€™ï¼Œéƒ½ä¼šå¾—åˆ°ä¸€ä¸ªè¡¨çº§é”(AUTO-INCé”)ï¼Œä½¿å¾—è¯­å¥ä¸­ç”Ÿæˆçš„auto_incrementä¸ºé¡ºåºï¼Œä¸”åœ¨binlogä¸­é‡æ”¾çš„æ—¶å€™ï¼Œå¯ä»¥ä¿è¯masterä¸slaveä¸­æ•°æ®çš„auto_incrementæ˜¯ç›¸åŒçš„ã€‚å› ä¸ºæ˜¯è¡¨çº§é”ï¼Œå½“åœ¨åŒä¸€æ—¶é—´å¤šä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œinsertçš„æ—¶å€™ï¼Œå¯¹äºAUTO-INCé”çš„äº‰å¤ºä¼š<code>é™åˆ¶å¹¶å‘</code>èƒ½åŠ›ã€‚</p><p><code>ï¼ˆ2ï¼‰innodb_autoinc_lock_mode = 1(â€œè¿ç»­â€é”å®šæ¨¡å¼)</code></p><p>åœ¨ MySQL 8.0 ä¹‹å‰ï¼Œè¿ç»­é”å®šæ¨¡å¼æ˜¯<code>é»˜è®¤</code>çš„ã€‚</p><p>åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œâ€œbulk insertsâ€ä»ç„¶ä½¿ç”¨AUTO-INCè¡¨çº§é”ï¼Œå¹¶ä¿æŒåˆ°è¯­å¥ç»“æŸã€‚è¿™é€‚ç”¨äºæ‰€æœ‰INSERT â€¦ SELECTï¼ŒREPLACE â€¦ SELECTå’ŒLOAD DATAè¯­å¥ã€‚åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¯­å¥å¯ä»¥æŒæœ‰AUTO-INCé”ã€‚</p><p>å¯¹äºâ€œSimple insertsâ€ï¼ˆè¦æ’å…¥çš„è¡Œæ•°äº‹å…ˆå·²çŸ¥ï¼‰ï¼Œåˆ™é€šè¿‡åœ¨<code>mutexï¼ˆè½»é‡é”ï¼‰</code>çš„æ§åˆ¶ä¸‹è·å¾—æ‰€éœ€æ•°é‡çš„è‡ªåŠ¨é€’å¢å€¼æ¥é¿å…è¡¨çº§AUTO-INCé”ï¼Œ å®ƒåªåœ¨åˆ†é…è¿‡ç¨‹çš„æŒç»­æ—¶é—´å†…ä¿æŒï¼Œè€Œä¸æ˜¯ç›´åˆ°è¯­å¥å®Œæˆã€‚ä¸ä½¿ç”¨è¡¨çº§AUTO-INCé”ï¼Œé™¤éAUTO-INCé”ç”±å¦ä¸€ä¸ªäº‹åŠ¡ä¿æŒã€‚å¦‚æœå¦ä¸€ä¸ªäº‹åŠ¡ä¿æŒAUTO-INCé”ï¼Œåˆ™â€œSimple insertsâ€ç­‰å¾…AUTO-INCé”ï¼Œå¦‚åŒå®ƒæ˜¯ä¸€ä¸ªâ€œbulk insertsâ€ã€‚ </p><p><code>ï¼ˆ3ï¼‰innodb_autoinc_lock_mode = 2(â€œäº¤é”™â€é”å®šæ¨¡å¼)</code></p><p>ä» MySQL 8.0 å¼€å§‹ï¼Œäº¤é”™é”æ¨¡å¼æ˜¯<code>é»˜è®¤</code>è®¾ç½®ã€‚</p><p>åœ¨è¿™ç§é”å®šæ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰ç±»INSERTè¯­å¥éƒ½ä¸ä¼šä½¿ç”¨è¡¨çº§AUTO-INCé”ï¼Œå¹¶ä¸”å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªè¯­å¥ã€‚è¿™æ˜¯æœ€å¿«å’Œæœ€å¯æ‹“å±•çš„é”å®šæ¨¡å¼ï¼Œä½†æ˜¯å½“ä½¿ç”¨åŸºäºè¯­å¥çš„å¤åˆ¶æˆ–æ¢å¤æ–¹æ¡ˆæ—¶ï¼Œ<strong>ä»äºŒè¿›åˆ¶æ—¥å¿—é‡æ’­SQLè¯­å¥æ—¶ï¼Œè¿™æ˜¯ä¸å®‰å…¨çš„ã€‚</strong></p><p>åœ¨æ­¤é”å®šæ¨¡å¼ä¸‹ï¼Œè‡ªåŠ¨é€’å¢å€¼<code>ä¿è¯</code>åœ¨æ‰€æœ‰å¹¶å‘æ‰§è¡Œçš„æ‰€æœ‰ç±»å‹çš„insertè¯­å¥ä¸­æ˜¯<code>å”¯ä¸€</code>ä¸”<code>å•è°ƒé€’å¢</code>çš„ã€‚ä½†æ˜¯ï¼Œç”±äºå¤šä¸ªè¯­å¥å¯ä»¥åŒæ—¶ç”Ÿæˆæ•°å­—ï¼ˆå³ï¼Œè·¨è¯­å¥äº¤å‰ç¼–å·ï¼‰ï¼Œ<strong>ä¸ºä»»ä½•ç»™å®šè¯­å¥æ’å…¥çš„è¡Œç”Ÿæˆçš„å€¼å¯èƒ½ä¸æ˜¯è¿ç»­çš„ã€‚</strong></p><p><strong>â‘£ å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰</strong></p><p>MySQL5.5å¼•å…¥äº†meta data lockï¼Œç®€ç§°MDLé”ï¼Œå±äºè¡¨é”èŒƒç•´ã€‚MDL çš„ä½œç”¨æ˜¯ï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚æ¯”å¦‚ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢æ­£åœ¨éå†ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œè€Œæ‰§è¡ŒæœŸé—´å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ª<code>è¡¨ç»“æ„åšå˜æ›´</code>ï¼Œå¢åŠ äº†ä¸€åˆ—ï¼Œé‚£ä¹ˆæŸ¥è¯¢çº¿ç¨‹æ‹¿åˆ°çš„ç»“æœè·Ÿè¡¨ç»“æ„å¯¹ä¸ä¸Šï¼Œè‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚</p><p>å› æ­¤ï¼Œ<strong>å½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLè¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLå†™é”ã€‚</strong></p><p><strong>2. InnoDBä¸­çš„è¡Œé”</strong></p><p>è¡Œé”ï¼ˆRow Lockï¼‰ä¹Ÿç§°ä¸ºè®°å½•é”ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é”ä½æŸä¸€è¡Œï¼ˆæŸæ¡è®°å½•rowï¼‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQLæœåŠ¡å™¨å±‚å¹¶æ²¡æœ‰å®ç°è¡Œé”æœºåˆ¶ï¼Œ<strong>è¡Œçº§é”åªåœ¨å­˜å‚¨å¼•æ“å±‚å®ç°ã€‚</strong></p><p><strong>ä¼˜ç‚¹ï¼š</strong>é”å®šåŠ›åº¦å°ï¼Œå‘ç”Ÿ<code>é”å†²çªæ¦‚ç‡ä½</code>ï¼Œå¯ä»¥å®ç°çš„<code>å¹¶å‘åº¦é«˜</code></p><p><strong>ç¼ºç‚¹ï¼š</strong>å¯¹äº<code>é”çš„å¼€é”€æ¯”è¾ƒå¤§</code>ï¼ŒåŠ é”ä¼šæ¯”è¾ƒæ…¢ï¼Œå®¹æ˜“å‡ºç°<code>æ­»é”</code>æƒ…å†µ</p><p>InnoDBä¸MyISAMçš„æœ€å¤§ä¸åŒæœ‰ä¸¤ç‚¹ï¼šä¸€æ˜¯æ”¯æŒäº‹åŠ¡ï¼›äºŒæ˜¯é‡‡ç”¨äº†è¡Œçº§é”ã€‚</p><p><strong>â‘  è®°å½•é”ï¼ˆRecord Locksï¼‰</strong></p><p>è®°å½•é”ä¹Ÿå°±æ˜¯ä»…ä»…æŠŠä¸€æ¡è®°å½•é”ä¸Šï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š<code>LOCK_REC_NOT_GAP</code>ã€‚</p><p>è®°å½•é”æ˜¯æœ‰Sé”å’ŒXé”ä¹‹åˆ†çš„ï¼Œç§°ä¹‹ä¸º<code>Så‹è®°å½•é”</code>å’Œ<code>Xå‹è®°å½•é”</code>ã€‚</p><ul><li>å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„Så‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿå¯ä»¥ç»§ç»­è·å–è¯¥è®°å½•çš„Så‹è®°å½•é”ï¼Œä½†ä¸å¯ä»¥ç»§ç»­è·å–Xå‹è®°å½•é”ï¼›</li><li>å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„Xå‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ä¸å¯ä»¥ç»§ç»­è·å–è¯¥è®°å½•çš„Så‹è®°å½•é”ï¼Œä¹Ÿä¸å¯ä»¥ç»§ç»­è·å–Xå‹è®°å½•é”ã€‚</li></ul><p><strong>â‘¡ é—´éš™é”ï¼ˆGap Locksï¼‰</strong></p><p><code>MySQL</code>åœ¨<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«ä¸‹æ˜¯å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜çš„ï¼Œè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼Œå¯ä»¥ä½¿ç”¨<code>MVCC</code>æ–¹æ¡ˆè§£å†³ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨<code>åŠ é”</code>æ–¹æ¡ˆè§£å†³ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨åŠ é”æ–¹æ¡ˆè§£å†³æ—¶æœ‰ä¸ªå¤§é—®é¢˜ï¼Œå°±æ˜¯äº‹åŠ¡åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯»å–æ“ä½œæ—¶ï¼Œé‚£äº›å¹»å½±è®°å½•å°šä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ— æ³•ç»™è¿™äº›<code>å¹»å½±è®°å½•</code>åŠ ä¸Š<code>è®°å½•é”</code>ã€‚InnoDBæå‡ºäº†ä¸€ç§ç§°ä¹‹ä¸º<code>Gap Locks</code>çš„é”ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š<code>LOCK_GAP</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç®€ç§°ä¸º<code>gapé”</code>ã€‚</p><p><strong>gapé”çš„æå‡ºä»…ä»…æ˜¯ä¸ºäº†é˜²æ­¢æ’å…¥å¹»å½±è®°å½•è€Œæå‡ºçš„</strong>ã€‚è™½ç„¶æœ‰<code>å…±äº«gapé”</code>å’Œ<code>ç‹¬å gapé”</code>è¿™æ ·çš„è¯´æ³•ï¼Œä½†æ˜¯å®ƒä»¬èµ·åˆ°çš„ä½œç”¨æ˜¯ç›¸åŒçš„ã€‚è€Œä¸”å¦‚æœå¯¹ä¸€æ¡è®°å½•åŠ äº†gapé”ï¼ˆä¸è®ºæ˜¯å…±äº«gapé”è¿˜æ˜¯ç‹¬å gapé”ï¼‰ï¼Œå¹¶ä¸ä¼šé™åˆ¶å…¶ä»–äº‹åŠ¡å¯¹è¿™æ¡è®°å½•åŠ è®°å½•é”æˆ–è€…ç»§ç»­åŠ gapé”ã€‚</p><p><strong>â‘¢ ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰</strong></p><p>æœ‰æ—¶å€™æˆ‘ä»¬æ—¢æƒ³<code>é”ä½æŸæ¡è®°å½•</code>ï¼Œåˆæƒ³<code>é˜»æ­¢</code>å…¶ä»–äº‹åŠ¡åœ¨è¯¥è®°å½•å‰è¾¹çš„<code>é—´éš™æ’å…¥æ–°è®°å½•</code>ï¼Œæ‰€ä»¥InnoDBå°±æå‡ºäº†ä¸€ç§ç§°ä¹‹ä¸º<code>Next-Key Locks</code>çš„é”ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š<code>LOCK_ORDINARY</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç®€ç§°ä¸º<code>next-keyé”</code>ã€‚Next-Key Locksæ˜¯åœ¨å­˜å‚¨å¼•æ“<code>innodb</code>ã€äº‹åŠ¡çº§åˆ«åœ¨<code>å¯é‡å¤è¯»</code>çš„æƒ…å†µä¸‹ä½¿ç”¨çš„æ•°æ®åº“é”ï¼Œinnodbé»˜è®¤çš„é”å°±æ˜¯Next-Key locksã€‚ </p><pre><code class="mysql">begin; select * from student where id &lt;=8 and id &gt; 3 for update;</code></pre><p><strong>â‘£ æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰</strong></p><p>æˆ‘ä»¬è¯´ä¸€ä¸ªäº‹åŠ¡åœ¨<code>æ’å…¥</code>ä¸€æ¡è®°å½•æ—¶éœ€è¦åˆ¤æ–­ä¸€ä¸‹æ’å…¥ä½ç½®æ˜¯ä¸æ˜¯è¢«åˆ«çš„äº‹åŠ¡åŠ äº†<code>gapé”</code>ï¼ˆ<code>next-keyé”</code>ä¹ŸåŒ…å«<code>gapé”</code>ï¼‰ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œæ’å…¥æ“ä½œéœ€è¦ç­‰å¾…ï¼Œç›´åˆ°æ‹¥æœ‰<code>gapé”</code>çš„é‚£ä¸ªäº‹åŠ¡æäº¤ã€‚ä½†æ˜¯<strong>InnoDBè§„å®šäº‹åŠ¡åœ¨ç­‰å¾…çš„æ—¶å€™ä¹Ÿéœ€è¦åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªé”ç»“æ„</strong>ï¼Œè¡¨æ˜æœ‰äº‹åŠ¡æƒ³åœ¨æŸä¸ª<code>é—´éš™</code>ä¸­<code>æ’å…¥</code>æ–°è®°å½•ï¼Œä½†æ˜¯ç°åœ¨åœ¨ç­‰å¾…ã€‚InnoDBå°±æŠŠè¿™ç§ç±»å‹çš„é”å‘½åä¸º<code>Insert Intention Locks</code>ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š<code>LOCK_INSERT_INTENTION</code>ï¼Œæˆ‘ä»¬ç§°ä¸º<code>æ’å…¥æ„å‘é”</code>ã€‚æ’å…¥æ„å‘é”æ˜¯ä¸€ç§<code>Gapé”</code>ï¼Œä¸æ˜¯æ„å‘é”ï¼Œåœ¨insertæ“ä½œæ—¶äº§ç”Ÿã€‚</p><p>æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”±<code>INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”</code>ã€‚</p><p>äº‹å®ä¸Š<strong>æ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é”ã€‚</strong></p><p><strong>3.</strong> <strong>é¡µé”</strong></p><p>é¡µé”å°±æ˜¯åœ¨<code>é¡µçš„ç²’åº¦</code>ä¸Šè¿›è¡Œé”å®šï¼Œé”å®šçš„æ•°æ®èµ„æºæ¯”è¡Œé”è¦å¤šï¼Œå› ä¸ºä¸€ä¸ªé¡µä¸­å¯ä»¥æœ‰å¤šä¸ªè¡Œè®°å½•ã€‚å½“æˆ‘ä»¬ä½¿ç”¨é¡µé”çš„æ—¶å€™ï¼Œä¼šå‡ºç°æ•°æ®æµªè´¹çš„ç°è±¡ï¼Œä½†è¿™æ ·çš„æµªè´¹æœ€å¤šä¹Ÿå°±æ˜¯ä¸€ä¸ªé¡µä¸Šçš„æ•°æ®è¡Œã€‚<strong>é¡µé”çš„å¼€é”€ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œä¼šå‡ºç°æ­»é”ã€‚é”å®šç²’åº¦ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬ã€‚</strong></p><p>æ¯ä¸ªå±‚çº§çš„é”æ•°é‡æ˜¯æœ‰é™åˆ¶çš„ï¼Œå› ä¸ºé”ä¼šå ç”¨å†…å­˜ç©ºé—´ï¼Œ<code>é”ç©ºé—´çš„å¤§å°æ˜¯æœ‰é™çš„</code>ã€‚å½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡äº†è¿™ä¸ªå±‚çº§çš„é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ<code>é”å‡çº§</code>ã€‚é”å‡çº§å°±æ˜¯ç”¨æ›´å¤§ç²’åº¦çš„é”æ›¿ä»£å¤šä¸ªæ›´å°ç²’åº¦çš„é”ï¼Œæ¯”å¦‚InnoDB ä¸­è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å ç”¨çš„é”ç©ºé—´é™ä½äº†ï¼Œä½†åŒæ—¶æ•°æ®çš„å¹¶å‘åº¦ä¹Ÿä¸‹é™äº†ã€‚</p><h5 id="3-3-ä»å¯¹å¾…é”çš„æ€åº¦åˆ’åˆ†-ä¹è§‚é”ã€æ‚²è§‚é”"><a href="#3-3-ä»å¯¹å¾…é”çš„æ€åº¦åˆ’åˆ†-ä¹è§‚é”ã€æ‚²è§‚é”" class="headerlink" title="3.3 ä»å¯¹å¾…é”çš„æ€åº¦åˆ’åˆ†:ä¹è§‚é”ã€æ‚²è§‚é”"></a><strong>3.3</strong> <strong>ä»å¯¹å¾…é”çš„æ€åº¦åˆ’åˆ†:ä¹è§‚é”ã€æ‚²è§‚é”</strong></h5><p>ä»å¯¹å¾…é”çš„æ€åº¦æ¥çœ‹é”çš„è¯ï¼Œå¯ä»¥å°†é”åˆ†æˆä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œä»åå­—ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸¤ç§é”æ˜¯ä¸¤ç§çœ‹å¾…<code>æ•°æ®å¹¶å‘çš„æ€ç»´æ–¹å¼</code>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¹è§‚é”å’Œæ‚²è§‚é”å¹¶ä¸æ˜¯é”ï¼Œè€Œæ˜¯é”çš„<code>è®¾è®¡æ€æƒ³</code>ã€‚</p><p><strong>1.</strong> <strong>æ‚²è§‚é”ï¼ˆPessimistic Lockingï¼‰</strong></p><p>æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼š<code>é˜»å¡</code>ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆ<strong>å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹</strong>ï¼‰ã€‚æ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ï¼Œå½“å…¶ä»–çº¿ç¨‹æƒ³è¦è®¿é—®æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦é˜»å¡æŒ‚èµ·ã€‚Javaä¸­<code>synchronized</code>å’Œ<code>ReentrantLock</code>ç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚</p><p>æ³¨æ„ï¼š<strong>select â€¦ for update è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰æ‰«æçš„è¡Œéƒ½ä¼šè¢«é”ä¸Šï¼Œå› æ­¤åœ¨MySQLä¸­ç”¨æ‚²è§‚é”å¿…é¡»ç¡®å®šä½¿ç”¨äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™å°†ä¼šæŠŠæ•´ä¸ªè¡¨é”ä½ã€‚</strong></p><p><strong>2.</strong> <strong>ä¹è§‚é”ï¼ˆOptimistic Lockingï¼‰</strong></p><p>ä¹è§‚é”è®¤ä¸ºå¯¹åŒä¸€æ•°æ®çš„å¹¶å‘æ“ä½œä¸ä¼šæ€»å‘ç”Ÿï¼Œå±äºå°æ¦‚ç‡äº‹ä»¶ï¼Œä¸ç”¨æ¯æ¬¡éƒ½å¯¹æ•°æ®ä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œä¹Ÿå°±æ˜¯<strong>ä¸é‡‡ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºæ¥å®ç°</strong>ã€‚åœ¨ç¨‹åºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>ç‰ˆæœ¬å·æœºåˆ¶</code>æˆ–è€…<code>CASæœºåˆ¶</code>å®ç°ã€‚<strong>ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡</strong>ã€‚åœ¨Javaä¸­<code>java.util.concurrent.atomic</code>åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ï¼šCASå®ç°çš„ã€‚</p><p><strong>1.</strong> <strong>ä¹è§‚é”çš„ç‰ˆæœ¬å·æœºåˆ¶</strong></p><p>åœ¨è¡¨ä¸­è®¾è®¡ä¸€ä¸ª<code>ç‰ˆæœ¬å­—æ®µ version</code>ï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™ï¼Œä¼šè·å– version å­—æ®µçš„å–å€¼ã€‚ç„¶åå¯¹æ•°æ®è¿›è¡Œæ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ï¼Œä¼šæ‰§è¡Œ<code>UPDATE ... SET version=version+1 WHERE version=version</code>ã€‚æ­¤æ—¶å¦‚æœå·²ç»æœ‰äº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œäº†æ›´æ”¹ï¼Œä¿®æ”¹å°±ä¸ä¼šæˆåŠŸã€‚</p><p><strong>2.</strong> <strong>ä¹è§‚é”çš„æ—¶é—´æˆ³æœºåˆ¶</strong></p><p>æ—¶é—´æˆ³å’Œç‰ˆæœ¬å·æœºåˆ¶ä¸€æ ·ï¼Œä¹Ÿæ˜¯åœ¨æ›´æ–°æäº¤çš„æ—¶å€™ï¼Œå°†å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å’Œæ›´æ–°ä¹‹å‰å–å¾—çš„æ—¶é—´æˆ³è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸¤è€…ä¸€è‡´åˆ™æ›´æ–°æˆåŠŸï¼Œå¦åˆ™å°±æ˜¯ç‰ˆæœ¬å†²çªã€‚</p><p>ä½ èƒ½çœ‹åˆ°ä¹è§‚é”å°±æ˜¯ç¨‹åºå‘˜è‡ªå·±æ§åˆ¶æ•°æ®å¹¶å‘æ“ä½œçš„æƒé™ï¼ŒåŸºæœ¬æ˜¯é€šè¿‡ç»™æ•°æ®è¡Œå¢åŠ ä¸€ä¸ªæˆ³ï¼ˆç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³ï¼‰ï¼Œä»è€Œè¯æ˜å½“å‰æ‹¿åˆ°çš„æ•°æ®æ˜¯å¦æœ€æ–°ã€‚</p><p><strong>3.</strong> <strong>ä¸¤ç§é”çš„é€‚ç”¨åœºæ™¯</strong></p><p>ä»è¿™ä¸¤ç§é”çš„è®¾è®¡æ€æƒ³ä¸­ï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä¹è§‚é”å’Œæ‚²è§‚é”çš„é€‚ç”¨åœºæ™¯ï¼š</p><ol><li><p><code>ä¹è§‚é”</code>é€‚åˆ<code>è¯»æ“ä½œå¤š</code>çš„åœºæ™¯ï¼Œç›¸å¯¹æ¥è¯´å†™çš„æ“ä½œæ¯”è¾ƒå°‘ã€‚å®ƒçš„ä¼˜ç‚¹åœ¨äº<code>ç¨‹åºå®ç°</code>ï¼Œ<code>ä¸å­˜åœ¨æ­»é”</code>é—®é¢˜ï¼Œä¸è¿‡é€‚ç”¨åœºæ™¯ä¹Ÿä¼šç›¸å¯¹ä¹è§‚ï¼Œå› ä¸ºå®ƒé˜»æ­¢ä¸äº†é™¤äº†ç¨‹åºä»¥å¤–çš„æ•°æ®åº“æ“ä½œã€‚</p></li><li><p><code>æ‚²è§‚é”</code>é€‚åˆ<code>å†™æ“ä½œå¤š</code>çš„åœºæ™¯ï¼Œå› ä¸ºå†™çš„æ“ä½œå…·æœ‰<code>æ’å®ƒæ€§</code>ã€‚é‡‡ç”¨æ‚²è§‚é”çš„æ–¹å¼ï¼Œå¯ä»¥åœ¨æ•°æ®åº“å±‚é¢é˜»æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¯¥æ•°æ®çš„æ“ä½œæƒé™ï¼Œé˜²æ­¢<code>è¯» - å†™</code>å’Œ<code>å†™ - å†™</code>çš„å†²çªã€‚</p></li></ol><h5 id="3-4-æŒ‰åŠ é”çš„æ–¹å¼åˆ’åˆ†ï¼šæ˜¾å¼é”ã€éšå¼é”"><a href="#3-4-æŒ‰åŠ é”çš„æ–¹å¼åˆ’åˆ†ï¼šæ˜¾å¼é”ã€éšå¼é”" class="headerlink" title="3.4 æŒ‰åŠ é”çš„æ–¹å¼åˆ’åˆ†ï¼šæ˜¾å¼é”ã€éšå¼é”"></a><strong>3.4</strong> <strong>æŒ‰åŠ é”çš„æ–¹å¼åˆ’åˆ†ï¼šæ˜¾å¼é”ã€éšå¼é”</strong></h5><p><strong>1.</strong> <strong>éšå¼é”</strong></p><ul><li><p><strong>æƒ…æ™¯ä¸€ï¼š</strong>å¯¹äºèšç°‡ç´¢å¼•è®°å½•æ¥è¯´ï¼Œæœ‰ä¸€ä¸ª<code>trx_id</code>éšè—åˆ—ï¼Œè¯¥éšè—åˆ—è®°å½•ç€æœ€åæ”¹åŠ¨è¯¥è®°å½•çš„<code>äº‹åŠ¡id</code>ã€‚é‚£ä¹ˆå¦‚æœåœ¨å½“å‰äº‹åŠ¡ä¸­æ–°æ’å…¥ä¸€æ¡èšç°‡ç´¢å¼•è®°å½•åï¼Œè¯¥è®°å½•çš„<code>trx_id</code>éšè—åˆ—ä»£è¡¨çš„çš„å°±æ˜¯å½“å‰äº‹åŠ¡çš„<code>äº‹åŠ¡id</code>ï¼Œå¦‚æœå…¶ä»–äº‹åŠ¡æ­¤æ—¶æƒ³å¯¹è¯¥è®°å½•æ·»åŠ <code>Sé”</code>æˆ–è€…<code>Xé”</code>æ—¶ï¼Œé¦–å…ˆä¼šçœ‹ä¸€ä¸‹è¯¥è®°å½•çš„<code>trx_id</code>éšè—åˆ—ä»£è¡¨çš„äº‹åŠ¡æ˜¯å¦æ˜¯å½“å‰çš„æ´»è·ƒäº‹åŠ¡ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆå°±å¸®åŠ©å½“å‰äº‹åŠ¡åˆ›å»ºä¸€ä¸ª<code>Xé”</code>ï¼ˆä¹Ÿå°±æ˜¯ä¸ºå½“å‰äº‹åŠ¡åˆ›å»ºä¸€ä¸ªé”ç»“æ„ï¼Œ<code>is_waiting</code>å±æ€§æ˜¯<code>false</code>ï¼‰ï¼Œç„¶åè‡ªå·±è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ˆä¹Ÿå°±æ˜¯ä¸ºè‡ªå·±ä¹Ÿåˆ›å»ºä¸€ä¸ªé”ç»“æ„ï¼Œ<code>is_waiting</code>å±æ€§æ˜¯<code>true</code>ï¼‰ã€‚</p></li><li><p><strong>æƒ…æ™¯äºŒï¼š</strong>å¯¹äºäºŒçº§ç´¢å¼•è®°å½•æ¥è¯´ï¼Œæœ¬èº«å¹¶æ²¡æœ‰<code>trx_id</code>éšè—åˆ—ï¼Œä½†æ˜¯åœ¨äºŒçº§ç´¢å¼•é¡µé¢çš„<code>Page Header</code>éƒ¨åˆ†æœ‰ä¸€ä¸ª<code>PAGE_MAX_TRX_ID</code>å±æ€§ï¼Œè¯¥å±æ€§ä»£è¡¨å¯¹è¯¥é¡µé¢åšæ”¹åŠ¨çš„æœ€å¤§çš„<code>äº‹åŠ¡id</code>ï¼Œå¦‚æœ<code>PAGE_MAX_TRX_ID</code>å±æ€§å€¼å°äºå½“å‰æœ€å°çš„æ´»è·ƒ<code>äº‹åŠ¡id</code>ï¼Œé‚£ä¹ˆè¯´æ˜å¯¹è¯¥é¡µé¢åšä¿®æ”¹çš„äº‹åŠ¡éƒ½å·²ç»æäº¤äº†ï¼Œå¦åˆ™å°±éœ€è¦åœ¨é¡µé¢ä¸­å®šä½åˆ°å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œç„¶åå›è¡¨æ‰¾åˆ°å®ƒå¯¹åº”çš„èšç°‡ç´¢å¼•è®°å½•ï¼Œç„¶åå†é‡å¤<code>æƒ…æ™¯ä¸€</code>çš„åšæ³•ã€‚</p></li></ul><p>å³ï¼šä¸€ä¸ªäº‹åŠ¡å¯¹æ–°æ’å…¥çš„è®°å½•å¯ä»¥ä¸æ˜¾ç¤ºçš„åŠ é”ï¼ˆç”Ÿæˆä¸€ä¸ªé”ç»“æ„ï¼‰ï¼Œä½†æ˜¯ç”±äº<code>äº‹åŠ¡id</code>çš„å­˜åœ¨ï¼Œç›¸å½“äºåŠ äº†ä¸€ä¸ª<code>éšå¼é”</code>ã€‚åˆ«çš„äº‹åŠ¡åœ¨å¯¹è¿™æ¡è®°å½•åŠ <code>Sé”</code>æˆ–è€…<code>Xé”</code>æ—¶ï¼Œç”±äº<code>éšå¼é”</code>çš„å­˜åœ¨ï¼Œä¼šå…ˆå¸®åŠ©å½“å‰äº‹åŠ¡ç”Ÿæˆä¸€ä¸ªé”ç»“æ„ï¼Œç„¶åè‡ªå·±å†ç”Ÿæˆä¸€ä¸ªé”ç»“æ„åè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚éšå¼é”æ˜¯ä¸€ç§<code>å»¶è¿ŸåŠ é”</code>çš„æœºåˆ¶ï¼Œä»è€Œæ¥å‡å°‘åŠ é”çš„æ•°é‡ã€‚</p><p><strong>2.</strong> <strong>æ˜¾å¼é”</strong></p><p>é€šè¿‡ç‰¹å®šçš„è¯­å¥è¿›è¡ŒåŠ é”ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºæ˜¾ç¤ºåŠ é”ã€‚</p><h5 id="3-5-å…¶å®ƒé”ä¹‹ï¼šå…¨å±€é”"><a href="#3-5-å…¶å®ƒé”ä¹‹ï¼šå…¨å±€é”" class="headerlink" title="3.5 å…¶å®ƒé”ä¹‹ï¼šå…¨å±€é”"></a><strong>3.5</strong> <strong>å…¶å®ƒé”ä¹‹ï¼šå…¨å±€é”</strong></h5><p>å…¨å±€é”å°±æ˜¯å¯¹<code>æ•´ä¸ªæ•°æ®åº“å®ä¾‹</code>åŠ é”ã€‚å½“ä½ éœ€è¦è®©æ•´ä¸ªåº“å¤„äº<code>åªè¯»çŠ¶æ€</code>çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œä¹‹åå…¶ä»–çº¿ç¨‹çš„ä»¥ä¸‹è¯­å¥ä¼šè¢«é˜»å¡ï¼šæ•°æ®æ›´æ–°è¯­å¥ï¼ˆæ•°æ®çš„å¢åˆ æ”¹ï¼‰ã€æ•°æ®å®šä¹‰è¯­å¥ï¼ˆåŒ…æ‹¬å»ºè¡¨ã€ä¿®æ”¹è¡¨ç»“æ„ç­‰ï¼‰å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ã€‚å…¨å±€é”çš„å…¸å‹ä½¿ç”¨<code>åœºæ™¯</code>æ˜¯ï¼šåš<code>å…¨åº“é€»è¾‘å¤‡ä»½</code>ã€‚</p><p>å…¨å±€é”çš„å‘½ä»¤ï¼š</p><pre><code class="mysql">Flush tables with read lock</code></pre><h5 id="3-6-å…¶å®ƒé”ä¹‹ï¼šæ­»é”"><a href="#3-6-å…¶å®ƒé”ä¹‹ï¼šæ­»é”" class="headerlink" title="3.6 å…¶å®ƒé”ä¹‹ï¼šæ­»é”"></a><strong>3.6</strong> <strong>å…¶å®ƒé”ä¹‹ï¼šæ­»é”</strong></h5><p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡åœ¨åŒä¸€èµ„æºä¸Šç›¸äº’å ç”¨ï¼Œå¹¶è¯·æ±‚é”å®šå¯¹æ–¹å ç”¨çš„èµ„æºï¼Œä»è€Œå¯¼è‡´æ¶æ€§å¾ªç¯ã€‚</p><p><strong>1. å¦‚ä½•å¤„ç†æ­»é”</strong></p><p><strong>æ–¹å¼1ï¼š</strong>ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ï¼ˆinnodb_lock_wait_timeout&#x3D;50sï¼‰</p><p>å³å½“ä¸¤ä¸ªäº‹åŠ¡äº’ç›¸ç­‰å¾…æ—¶ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡ç­‰å¾…æ—¶é—´è¶…è¿‡è®¾ç½®çš„é˜ˆå€¼æ—¶ï¼Œå°±å°†å…¶<code>å›æ»š</code>ï¼Œå¦å¤–äº‹åŠ¡ç»§ç»­è¿›è¡Œã€‚</p><p><strong>æ–¹å¼2ï¼š</strong>ä½¿ç”¨æ­»é”æ£€æµ‹è¿›è¡Œæ­»é”å¤„ç†</p><p>å‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼ˆå°†æŒæœ‰æœ€å°‘è¡Œçº§æ’ä»–é”çš„äº‹åŠ¡è¿›è¡Œå›æ»šï¼‰ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚</p><h4 id="4-é”çš„å†…å­˜ç»“æ„"><a href="#4-é”çš„å†…å­˜ç»“æ„" class="headerlink" title="4. é”çš„å†…å­˜ç»“æ„"></a><strong>4.</strong> <strong>é”çš„å†…å­˜ç»“æ„</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051514736.png" alt="image-20220405151409557"></p><p>ç»“æ„è§£æï¼š</p><p><code>1. é”æ‰€åœ¨çš„äº‹åŠ¡ä¿¡æ¯</code>ï¼š</p><p>ä¸è®ºæ˜¯<code>è¡¨é”</code>è¿˜æ˜¯<code>è¡Œé”</code>ï¼Œéƒ½æ˜¯åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„ï¼Œå“ªä¸ªäº‹åŠ¡ç”Ÿæˆäº†è¿™ä¸ª é”ç»“æ„ ï¼Œè¿™é‡Œå°±è®°å½•è¿™ä¸ªäº‹åŠ¡çš„ä¿¡æ¯ã€‚</p><p>æ­¤<code>é”æ‰€åœ¨çš„äº‹åŠ¡ä¿¡æ¯</code>åœ¨å†…å­˜ç»“æ„ä¸­åªæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé€šè¿‡æŒ‡é’ˆå¯ä»¥æ‰¾åˆ°å†…å­˜ä¸­å…³äºè¯¥äº‹åŠ¡çš„æ›´å¤šä¿¡æ¯ï¼Œæ¯”æ–¹è¯´äº‹åŠ¡idç­‰ã€‚</p><p><code>2. ç´¢å¼•ä¿¡æ¯</code>ï¼š</p><p>å¯¹äº<code>è¡Œé”</code>æ¥è¯´ï¼Œéœ€è¦è®°å½•ä¸€ä¸‹åŠ é”çš„è®°å½•æ˜¯å±äºå“ªä¸ªç´¢å¼•çš„ã€‚è¿™é‡Œä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚</p><p><code>3. è¡¨é”ï¼è¡Œé”ä¿¡æ¯</code>ï¼š </p><p><code>è¡¨é”ç»“æ„</code>å’Œ<code>è¡Œé”ç»“æ„</code>åœ¨è¿™ä¸ªä½ç½®çš„å†…å®¹æ˜¯ä¸åŒçš„ï¼š</p><ul><li>è¡¨é”ï¼šè®°è½½ç€æ˜¯å¯¹å“ªä¸ªè¡¨åŠ çš„é”ï¼Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›ä¿¡æ¯ã€‚</li><li>è¡Œé”ï¼šè®°è½½äº†ä¸‰ä¸ªé‡è¦çš„ä¿¡æ¯ï¼š<ul><li>Space ID ï¼šè®°å½•æ‰€åœ¨è¡¨ç©ºé—´ã€‚</li><li>Page Number ï¼šè®°å½•æ‰€åœ¨é¡µå·ã€‚</li><li>n_bits ï¼šå¯¹äºè¡Œé”æ¥è¯´ï¼Œä¸€æ¡è®°å½•å°±å¯¹åº”ç€ä¸€ä¸ªæ¯”ç‰¹ä½ï¼Œä¸€ä¸ªé¡µé¢ä¸­åŒ…å«å¾ˆå¤šè®°å½•ï¼Œç”¨ä¸åŒçš„æ¯”ç‰¹ä½æ¥åŒºåˆ†åˆ°åº•æ˜¯å“ªä¸€æ¡è®°å½•åŠ äº†é”ã€‚ä¸ºæ­¤åœ¨è¡Œé”ç»“æ„çš„æœ«å°¾æ”¾ç½®äº†ä¸€å †æ¯”ç‰¹ä½ï¼Œè¿™ä¸ªn_bits å±æ€§ä»£è¡¨ä½¿ç”¨äº†å¤šå°‘æ¯”ç‰¹ä½ã€‚</li></ul></li></ul><blockquote><p>n_bitsçš„å€¼ä¸€èˆ¬éƒ½æ¯”é¡µé¢ä¸­è®°å½•æ¡æ•°å¤šä¸€äº›ã€‚ä¸»è¦æ˜¯ä¸ºäº†ä¹‹ååœ¨é¡µé¢ä¸­æ’å…¥äº†æ–°è®°å½•åä¹Ÿä¸è‡³äºé‡æ–°åˆ†é…é”ç»“æ„</p></blockquote><p><code>4. type_mode</code>ï¼š</p><p>è¿™æ˜¯ä¸€ä¸ª32ä½çš„æ•°ï¼Œè¢«åˆ†æˆäº†<code>lock_mode</code>ã€<code>lock_type</code>å’Œ<code>rec_lock_type</code>ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051518659.png" alt="image-20220405151829547"></p><ul><li>é”çš„æ¨¡å¼ï¼ˆ<code>lock_mode</code>ï¼‰ï¼Œå ç”¨ä½4ä½ï¼Œå¯é€‰çš„å€¼å¦‚ä¸‹ï¼š<ul><li><code>LOCK_IS</code>ï¼ˆåè¿›åˆ¶çš„<code>0</code>ï¼‰ï¼šè¡¨ç¤ºå…±äº«æ„å‘é”ï¼Œä¹Ÿå°±æ˜¯<code>ISé”</code>ã€‚ </li><li><code>LOCK_IX</code>ï¼ˆåè¿›åˆ¶çš„<code>1</code>ï¼‰ï¼šè¡¨ç¤ºç‹¬å æ„å‘é”ï¼Œä¹Ÿå°±æ˜¯<code>IXé”</code>ã€‚ </li><li><code>LOCK_S</code>ï¼ˆåè¿›åˆ¶çš„<code>2</code>ï¼‰ï¼šè¡¨ç¤ºå…±äº«é”ï¼Œä¹Ÿå°±æ˜¯<code>Sé”</code>ã€‚ </li><li><code>LOCK_X</code>ï¼ˆåè¿›åˆ¶çš„<code>3</code>ï¼‰ï¼šè¡¨ç¤ºç‹¬å é”ï¼Œä¹Ÿå°±æ˜¯<code>Xé”</code>ã€‚ </li><li><code>LOCK_AUTO_INC</code>ï¼ˆåè¿›åˆ¶çš„<code>4</code>ï¼‰ï¼šè¡¨ç¤º<code>AUTO-INCé”</code>ã€‚</li></ul></li></ul><p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼ŒLOCK_ISï¼ŒLOCK_IXï¼ŒLOCK_AUTO_INCéƒ½ç®—æ˜¯è¡¨çº§é”çš„æ¨¡å¼ï¼ŒLOCK_Så’Œ LOCK_Xæ—¢å¯ä»¥ç®—æ˜¯è¡¨çº§é”çš„æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯è¡Œçº§é”çš„æ¨¡å¼ã€‚</p><ul><li>é”çš„ç±»å‹ï¼ˆ<code>lock_type</code>ï¼‰ï¼Œå ç”¨ç¬¬5ï½8ä½ï¼Œä¸è¿‡ç°é˜¶æ®µåªæœ‰ç¬¬5ä½å’Œç¬¬6ä½è¢«ä½¿ç”¨ï¼š<ul><li><code>LOCK_TABLE</code>ï¼ˆåè¿›åˆ¶çš„<code>16</code>ï¼‰ï¼Œä¹Ÿå°±æ˜¯å½“ç¬¬5ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºè¡¨çº§é”ã€‚</li><li><code>LOCK_REC</code>ï¼ˆåè¿›åˆ¶çš„<code>32</code>ï¼‰ï¼Œä¹Ÿå°±æ˜¯å½“ç¬¬6ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºè¡Œçº§é”ã€‚</li></ul></li><li>è¡Œé”çš„å…·ä½“ç±»å‹ï¼ˆ<code>rec_lock_type</code>ï¼‰ï¼Œä½¿ç”¨å…¶ä½™çš„ä½æ¥è¡¨ç¤ºã€‚åªæœ‰åœ¨ <code>lock_type</code>çš„å€¼ä¸º<code>LOCK_REC</code>æ—¶ï¼Œä¹Ÿå°±æ˜¯åªæœ‰åœ¨è¯¥é”ä¸ºè¡Œçº§é”æ—¶ï¼Œæ‰ä¼šè¢«ç»†åˆ†ä¸ºæ›´å¤šçš„ç±»å‹ï¼š<ul><li><code>LOCK_ORDINARY</code>ï¼ˆåè¿›åˆ¶çš„<code>0</code>ï¼‰ï¼šè¡¨ç¤º<code>next-keyé”</code>ã€‚ </li><li><code>LOCK_GAP</code>ï¼ˆåè¿›åˆ¶çš„<code>512</code>ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬10ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤º<code>gapé”</code>ã€‚ </li><li><code>LOCK_REC_NOT_GAP</code>ï¼ˆåè¿›åˆ¶çš„<code>1024</code>ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬11ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ­£ç»<code>è®°å½•é”</code>ã€‚</li><li><code>LOCK_INSERT_INTENTION</code>ï¼ˆåè¿›åˆ¶çš„<code>2048</code>ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬12ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ’å…¥æ„å‘é”ã€‚å…¶ä»–çš„ç±»å‹ï¼šè¿˜æœ‰ä¸€äº›ä¸å¸¸ç”¨çš„ç±»å‹æˆ‘ä»¬å°±ä¸å¤šè¯´äº†ã€‚</li></ul></li><li><code>is_waiting</code>å±æ€§å‘¢ï¼ŸåŸºäºå†…å­˜ç©ºé—´çš„èŠ‚çœï¼Œæ‰€ä»¥æŠŠ is_waiting å±æ€§æ”¾åˆ°äº† type_mode è¿™ä¸ª32ä½çš„æ•°å­—ä¸­ï¼š<ul><li><code>LOCK_WAIT</code>ï¼ˆåè¿›åˆ¶çš„<code>256</code>ï¼‰ ï¼šå½“ç¬¬9ä¸ªæ¯”ç‰¹ä½ç½®ä¸º<code>1</code>æ—¶ï¼Œè¡¨ç¤º<code>is_waiting</code>ä¸º<code>true</code>ï¼Œä¹Ÿå°±æ˜¯å½“å‰äº‹åŠ¡å°šæœªè·å–åˆ°é”ï¼Œå¤„åœ¨ç­‰å¾…çŠ¶æ€ï¼›å½“è¿™ä¸ªæ¯”ç‰¹ä½ä¸º<code>0</code>æ—¶ï¼Œè¡¨ç¤º<code>is_waiting</code>ä¸º<code>false</code>ï¼Œä¹Ÿå°±æ˜¯å½“å‰äº‹åŠ¡è·å–é”æˆåŠŸã€‚</li></ul></li></ul><p><code>5. å…¶ä»–ä¿¡æ¯</code>ï¼š</p><p>ä¸ºäº†æ›´å¥½çš„ç®¡ç†ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„å„ç§é”ç»“æ„è€Œè®¾è®¡äº†å„ç§å“ˆå¸Œè¡¨å’Œé“¾è¡¨ã€‚</p><p><code>6. ä¸€å †æ¯”ç‰¹ä½</code>ï¼š</p><p>å¦‚æœæ˜¯<code>è¡Œé”ç»“æ„</code>çš„è¯ï¼Œåœ¨è¯¥ç»“æ„æœ«å°¾è¿˜æ”¾ç½®äº†ä¸€å †æ¯”ç‰¹ä½ï¼Œæ¯”ç‰¹ä½çš„æ•°é‡æ˜¯ç”±ä¸Šè¾¹æåˆ°çš„<code>n_bits</code>å±æ€§è¡¨ç¤ºçš„ã€‚InnoDBæ•°æ®é¡µä¸­çš„æ¯æ¡è®°å½•åœ¨<code>è®°å½•å¤´ä¿¡æ¯</code>ä¸­éƒ½åŒ…å«ä¸€ä¸ª heap_no å±æ€§ï¼Œä¼ªè®°å½•<code>Infimum</code>çš„<code>heap_no</code>å€¼ä¸º<code>0</code>ï¼Œ<code>Supremum</code>çš„<code>heap_no</code>å€¼ä¸º<code>1</code>ï¼Œä¹‹åæ¯æ’å…¥ä¸€æ¡è®°å½•ï¼Œ<code>heap_no</code>å€¼å°±å¢1ã€‚<code>é”ç»“æ„</code>æœ€åçš„ä¸€å †æ¯”ç‰¹ä½å°±å¯¹åº”ç€ä¸€ä¸ªé¡µé¢ä¸­çš„è®°å½•ï¼Œä¸€ä¸ªæ¯”ç‰¹ä½æ˜ å°„ä¸€ä¸ª<code>heap_no</code>ï¼Œå³ä¸€ä¸ªæ¯”ç‰¹ä½æ˜ å°„åˆ°é¡µå†…çš„ä¸€æ¡è®°å½•ã€‚</p><h4 id="5-é”ç›‘æ§"><a href="#5-é”ç›‘æ§" class="headerlink" title="5. é”ç›‘æ§"></a><strong>5.</strong> <strong>é”ç›‘æ§</strong></h4><pre><code class="mysql">mysql&gt; show status like &#39;innodb_row_lock%&#39;;</code></pre><ul><li>Innodb_row_lock_current_waitsï¼šå½“å‰æ­£åœ¨ç­‰å¾…é”å®šçš„æ•°é‡ï¼›</li><li><code>Innodb_row_lock_time</code>ï¼šä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨é”å®šæ€»æ—¶é—´é•¿åº¦ï¼›ï¼ˆç­‰å¾…æ€»æ—¶é•¿ï¼‰</li><li><code>Innodb_row_lock_time_avg</code>ï¼šæ¯æ¬¡ç­‰å¾…æ‰€èŠ±å¹³å‡æ—¶é—´ï¼›ï¼ˆç­‰å¾…å¹³å‡æ—¶é•¿ï¼‰</li><li>Innodb_row_lock_time_maxï¼šä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨ç­‰å¾…æœ€å¸¸çš„ä¸€æ¬¡æ‰€èŠ±çš„æ—¶é—´ï¼›</li><li><code>Innodb_row_lock_waits</code>ï¼šç³»ç»Ÿå¯åŠ¨ååˆ°ç°åœ¨æ€»å…±ç­‰å¾…çš„æ¬¡æ•°ï¼›ï¼ˆç­‰å¾…æ€»æ¬¡æ•°ï¼‰</li></ul><p><strong>å…¶ä»–ç›‘æ§æ–¹æ³•ï¼š</strong></p><p>MySQLæŠŠäº‹åŠ¡å’Œé”çš„ä¿¡æ¯è®°å½•åœ¨äº†<code>information_schema</code>åº“ä¸­ï¼Œæ¶‰åŠåˆ°çš„ä¸‰å¼ è¡¨åˆ†åˆ«æ˜¯<code>INNODB_TRX</code>ã€<code>INNODB_LOCKS</code>å’Œ<code>INNODB_LOCK_WAITS</code>ã€‚ </p><p><code>MySQL5.7åŠä¹‹å‰</code>ï¼Œå¯ä»¥é€šè¿‡information_schema.INNODB_LOCKSæŸ¥çœ‹äº‹åŠ¡çš„é”æƒ…å†µï¼Œä½†åªèƒ½çœ‹åˆ°é˜»å¡äº‹åŠ¡çš„é”ï¼›å¦‚æœäº‹åŠ¡å¹¶æœªè¢«é˜»å¡ï¼Œåˆ™åœ¨è¯¥è¡¨ä¸­çœ‹ä¸åˆ°è¯¥äº‹åŠ¡çš„é”æƒ…å†µã€‚</p><p>MySQL8.0åˆ é™¤äº†information_schema.INNODB_LOCKSï¼Œæ·»åŠ äº†<code>performance_schema.data_locks</code>ï¼Œå¯ä»¥é€šè¿‡performance_schema.data_locksæŸ¥çœ‹äº‹åŠ¡çš„é”æƒ…å†µï¼Œå’ŒMySQL5.7åŠä¹‹å‰ä¸åŒï¼Œperformance_schema.data_locksä¸ä½†å¯ä»¥çœ‹åˆ°é˜»å¡è¯¥äº‹åŠ¡çš„é”ï¼Œè¿˜å¯ä»¥çœ‹åˆ°è¯¥äº‹åŠ¡æ‰€æŒæœ‰çš„é”ã€‚</p><p>åŒæ—¶ï¼Œinformation_schema.INNODB_LOCK_WAITSä¹Ÿè¢«<code>performance_schema.data_lock_waits</code>æ‰€ä»£æ›¿ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
